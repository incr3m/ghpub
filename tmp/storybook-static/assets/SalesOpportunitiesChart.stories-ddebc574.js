import{j as O}from"./TransitionGroupContext-9d36972e.js";import{R as Ye}from"./index-f1f749bf.js";import{b4 as ee,b1 as He,b2 as Xe,v as We,w as ze,a2 as qe,J as Ue,P as Qe,B as Pe,T as ye,bg as Ke,bh as Ge}from"./papaparse.min-b66e70e7.js";import{j as je,k as we,L as Be,r as H,n as Me,s as j,l as X,p as R,P as se,G as Ve,b as ae,o as $e,C as Je,a as Ae,q as Ze,t as et,S as Fe,u as Ee,w as be,e as C,v as tt,x as ke,y as it,g as ve,h as _e,m as xe,z as st,R as at,A as rt,E as nt}from"./EmptyFiltersWarning-efcfc65c.js";import"./_baseForOwn-9b89c4b6.js";import{w as lt}from"./index-bcfaa842.js";import"./index-96c5f47c.js";import{c as F,p as ot}from"./constant-1abab5a9.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./Button-352c3435.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./isNativeReflectConstruct-05c29d01.js";class re extends je{constructor(){super(...arguments),Object.defineProperty(this,"_display",{enumerable:!0,configurable:!0,writable:!0,value:this._root._renderer.makeRadialText("",this.textStyle)})}_afterNew(){super._afterNew()}_beforeChanged(){super._beforeChanged(),this._display.clear(),this.isDirty("textType")&&(this._display.textType=this.get("textType"),this.markDirtyBounds()),this.isDirty("radius")&&(this._display.radius=this.get("radius"),this.markDirtyBounds()),this.isDirty("startAngle")&&(this._display.startAngle=(this.get("startAngle",0)+90)*we,this.markDirtyBounds()),this.isDirty("inside")&&(this._display.inside=this.get("inside"),this.markDirtyBounds()),this.isDirty("orientation")&&(this._display.orientation=this.get("orientation"),this.markDirtyBounds()),this.isDirty("kerning")&&(this._display.kerning=this.get("kerning"),this.markDirtyBounds())}}Object.defineProperty(re,"className",{enumerable:!0,configurable:!0,writable:!0,value:"RadialText"});Object.defineProperty(re,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:je.classNames.concat([re.className])});class ne extends Be{constructor(){super(...arguments),Object.defineProperty(this,"_flipped",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._textKeys.push("textType","kerning"),super._afterNew()}_makeText(){this._text=this.children.push(re.new(this._root,{}))}baseRadius(){const t=this.getPrivate("radius",0),e=this.getPrivate("innerRadius",0),i=this.get("baseRadius",0);return e+H(i,t-e)}radius(){const t=this.get("inside",!1);return this.baseRadius()+this.get("radius",0)*(t?-1:1)}_updateChildren(){if(super._updateChildren(),this.isDirty("baseRadius")||this.isPrivateDirty("radius")||this.isPrivateDirty("innerRadius")||this.isDirty("labelAngle")||this.isDirty("radius")||this.isDirty("inside")||this.isDirty("orientation")||this.isDirty("textType")){const t=this.get("textType","adjusted"),e=this.get("inside",!1),i=this.get("orientation");let s=Me(this.get("labelAngle",0));this._text.set("startAngle",this.get("labelAngle",0)),this._text.set("inside",e);const r=j(s),l=X(s);let a=this.baseRadius(),o=this.radius();if(this._display.angle=0,t=="circular")this.setAll({paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}),this._text.set("orientation",i),this._text.set("radius",o);else{a==0&&(s=0,o=0);let n=o*l,h=o*r;t=="radial"?(this.setRaw("x",n),this.setRaw("y",h),s<90||s>270||i!="auto"?(this._display.angle=s,this._flipped=!1):(this._display.angle=s+180,this._flipped=!0),this._dirty.rotation=!1):t=="adjusted"?(this.setRaw("centerX",R),this.setRaw("centerY",R),this.setRaw("x",n),this.setRaw("y",h)):t=="regular"&&(this.setRaw("x",n),this.setRaw("y",h))}this.markDirtyPosition(),this.markDirtyBounds()}}_updatePosition(){const t=this.get("textType","regular"),e=this.get("inside",!1);let i=0,s=0,r=this.get("labelAngle",0),l=this.localBounds(),a=l.right-l.left,o=l.bottom-l.top;if(t=="radial"){if(this._flipped){let n=this.get("centerX");n instanceof se&&(a=a*(1-n.value*2)),i=a*X(r),s=a*j(r)}}else!e&&t=="adjusted"&&(i=a/2*X(r),s=o/2*j(r));this.setRaw("dx",i),this.setRaw("dy",s),super._updatePosition()}get text(){return this._text}}Object.defineProperty(ne,"className",{enumerable:!0,configurable:!0,writable:!0,value:"RadialLabel"});Object.defineProperty(ne,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Be.classNames.concat([ne.className])});var Ce=Math.abs,b=Math.atan2,Y=Math.cos,ut=Math.max,Re=Math.min,L=Math.sin,q=Math.sqrt,_=1e-12,U=Math.PI,le=U/2,ct=2*U;function ht(c){return c>1?0:c<-1?U:Math.acos(c)}function Se(c){return c>=1?le:c<=-1?-le:Math.asin(c)}function dt(c){return c.innerRadius}function gt(c){return c.outerRadius}function pt(c){return c.startAngle}function ft(c){return c.endAngle}function mt(c){return c&&c.padAngle}function yt(c,t,e,i,s,r,l,a){var o=e-c,n=i-t,h=l-s,d=a-r,u=d*o-h*n;if(!(u*u<_))return u=(h*(t-r)-d*(c-s))/u,[c+u*o,t+u*n]}function te(c,t,e,i,s,r,l){var a=c-e,o=t-i,n=(l?r:-r)/q(a*a+o*o),h=n*o,d=-n*a,u=c+h,p=t+d,f=e+h,A=i+d,y=(u+f)/2,D=(p+A)/2,v=f-u,x=A-p,T=v*v+x*x,B=s-r,S=u*A-f*p,M=(x<0?-1:1)*q(ut(0,B*B*T-S*S)),V=(S*x-v*M)/T,w=(-S*v-x*M)/T,P=(S*x+v*M)/T,k=(-S*v+x*M)/T,g=V-y,m=w-D,E=P-y,I=k-D;return g*g+m*m>E*E+I*I&&(V=P,w=k),{cx:V,cy:w,x01:-h,y01:-d,x11:V*(s/B-1),y11:w*(s/B-1)}}function bt(){var c=dt,t=gt,e=F(0),i=null,s=pt,r=ft,l=mt,a=null;function o(){var n,h,d=+c.apply(this,arguments),u=+t.apply(this,arguments),p=s.apply(this,arguments)-le,f=r.apply(this,arguments)-le,A=Ce(f-p),y=f>p;if(a||(a=n=ot()),u<d&&(h=u,u=d,d=h),!(u>_))a.moveTo(0,0);else if(A>ct-_)a.moveTo(u*Y(p),u*L(p)),a.arc(0,0,u,p,f,!y),d>_&&(a.moveTo(d*Y(f),d*L(f)),a.arc(0,0,d,f,p,y));else{var D=p,v=f,x=p,T=f,B=A,S=A,M=l.apply(this,arguments)/2,V=M>_&&(i?+i.apply(this,arguments):q(d*d+u*u)),w=Re(Ce(u-d)/2,+e.apply(this,arguments)),P=w,k=w,g,m;if(V>_){var E=Se(V/d*L(M)),I=Se(V/u*L(M));(B-=E*2)>_?(E*=y?1:-1,x+=E,T-=E):(B=0,x=T=(p+f)/2),(S-=I*2)>_?(I*=y?1:-1,D+=I,v-=I):(S=0,D=v=(p+f)/2)}var W=u*Y(D),z=u*L(D),G=d*Y(T),$=d*L(T);if(w>_){var J=u*Y(v),Z=u*L(v),he=d*Y(x),de=d*L(x),N;if(A<U&&(N=yt(W,z,he,de,J,Z,G,$))){var ge=W-N[0],pe=z-N[1],fe=J-N[0],me=Z-N[1],De=1/L(ht((ge*fe+pe*me)/(q(ge*ge+pe*pe)*q(fe*fe+me*me)))/2),Te=q(N[0]*N[0]+N[1]*N[1]);P=Re(w,(d-Te)/(De-1)),k=Re(w,(u-Te)/(De+1))}}S>_?k>_?(g=te(he,de,W,z,u,k,y),m=te(J,Z,G,$,u,k,y),a.moveTo(g.cx+g.x01,g.cy+g.y01),k<w?a.arc(g.cx,g.cy,k,b(g.y01,g.x01),b(m.y01,m.x01),!y):(a.arc(g.cx,g.cy,k,b(g.y01,g.x01),b(g.y11,g.x11),!y),a.arc(0,0,u,b(g.cy+g.y11,g.cx+g.x11),b(m.cy+m.y11,m.cx+m.x11),!y),a.arc(m.cx,m.cy,k,b(m.y11,m.x11),b(m.y01,m.x01),!y))):(a.moveTo(W,z),a.arc(0,0,u,D,v,!y)):a.moveTo(W,z),!(d>_)||!(B>_)?a.lineTo(G,$):P>_?(g=te(G,$,J,Z,d,-P,y),m=te(W,z,he,de,d,-P,y),a.lineTo(g.cx+g.x01,g.cy+g.y01),P<w?a.arc(g.cx,g.cy,P,b(g.y01,g.x01),b(m.y01,m.x01),!y):(a.arc(g.cx,g.cy,P,b(g.y01,g.x01),b(g.y11,g.x11),!y),a.arc(0,0,d,b(g.cy+g.y11,g.cx+g.x11),b(m.cy+m.y11,m.cx+m.x11),y),a.arc(m.cx,m.cy,P,b(m.y11,m.x11),b(m.y01,m.x01),!y))):a.arc(0,0,d,T,x,y)}if(a.closePath(),n)return a=null,n+""||null}return o.centroid=function(){var n=(+c.apply(this,arguments)+ +t.apply(this,arguments))/2,h=(+s.apply(this,arguments)+ +r.apply(this,arguments))/2-U/2;return[Y(h)*n,L(h)*n]},o.innerRadius=function(n){return arguments.length?(c=typeof n=="function"?n:F(+n),o):c},o.outerRadius=function(n){return arguments.length?(t=typeof n=="function"?n:F(+n),o):t},o.cornerRadius=function(n){return arguments.length?(e=typeof n=="function"?n:F(+n),o):e},o.padRadius=function(n){return arguments.length?(i=n==null?null:typeof n=="function"?n:F(+n),o):i},o.startAngle=function(n){return arguments.length?(s=typeof n=="function"?n:F(+n),o):s},o.endAngle=function(n){return arguments.length?(r=typeof n=="function"?n:F(+n),o):r},o.padAngle=function(n){return arguments.length?(l=typeof n=="function"?n:F(+n),o):l},o.context=function(n){return arguments.length?(a=n??null,o):a},o}class oe extends Ve{constructor(){super(...arguments),Object.defineProperty(this,"ix",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"iy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_generator",{enumerable:!0,configurable:!0,writable:!0,value:bt()})}_getTooltipPoint(){let t=this.get("tooltipX"),e=this.get("tooltipY"),i=0,s=0;ae(t)&&(i=t),ae(e)&&(s=e);let r=this.get("radius",0),l=this.get("innerRadius",0),a=this.get("dRadius",0),o=this.get("dInnerRadius",0);return r+=a,l+=o,l<0&&(l=r+l),t instanceof se&&(i=this.ix*(l+(r-l)*t.value)),e instanceof se&&(s=this.iy*(l+(r-l)*e.value)),this.get("arc")>=360&&l==0&&(i=0,s=0),{x:i,y:s}}_beforeChanged(){super._beforeChanged(),(this.isDirty("radius")||this.isDirty("arc")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("dRadius")||this.isDirty("dInnerRadius")||this.isDirty("cornerRadius")||this.isDirty("shiftRadius"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){let t=this.get("startAngle",0),e=this.get("arc",0);const i=this._generator;e<0&&(t=t+e,e=e*-1),e>.1&&i.cornerRadius(this.get("cornerRadius",0)),i.context(this._display);let s=this.get("radius",0),r=this.get("innerRadius",0),l=this.get("dRadius",0),a=this.get("dInnerRadius",0);s+=l,r+=a,r<0&&(r=s+r),i({innerRadius:r,outerRadius:s,startAngle:(t+90)*we,endAngle:(t+e+90)*we});let o=t+e/2;this.ix=X(o),this.iy=j(o);const n=this.get("shiftRadius",0);this.setRaw("dx",this.ix*n),this.setRaw("dy",this.iy*n),this.markDirtyPosition()}}}Object.defineProperty(oe,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Slice"});Object.defineProperty(oe,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Ve.classNames.concat([oe.className])});class vt extends $e{setupDefaultRules(){super.setupDefaultRules();const t=this._root.interfaceColors,e=this.rule.bind(this);e("PercentSeries").setAll({legendLabelText:"{category}",legendValueText:"{valuePercentTotal.formatNumber('0.00p')}",colors:Je.new(this._root,{}),width:Ae,height:Ae}),e("PieChart").setAll({radius:Ze(80),startAngle:-90,endAngle:270}),e("PieSeries").setAll({alignLabels:!0,startAngle:-90,endAngle:270}),e("PieSeries").states.create("hidden",{endAngle:-90,opacity:0}),e("Slice",["pie"]).setAll({position:"absolute",isMeasured:!1,x:0,y:0,toggleKey:"active",tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}",strokeWidth:1,strokeOpacity:1,role:"figure",lineJoin:"round"}),e("Slice",["pie"]).states.create("active",{shiftRadius:20,scale:1}),e("Slice",["pie"]).states.create("hoverActive",{scale:1.04}),e("Slice",["pie"]).states.create("hover",{scale:1.04}),e("RadialLabel",["pie"]).setAll({textType:"aligned",radius:10,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",paddingTop:5,paddingBottom:5,populateText:!0}),e("Tick",["pie"]).setAll({location:1}),e("SlicedChart").setAll({paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10}),e("FunnelSeries").setAll({startLocation:0,endLocation:1,orientation:"vertical",alignLabels:!0,sequencedInterpolation:!0}),e("FunnelSlice").setAll({interactive:!0,expandDistance:0}),e("FunnelSlice").states.create("hover",{expandDistance:.15}),e("Label",["funnel"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:R}),e("Label",["funnel","horizontal"]).setAll({centerX:0,centerY:R,rotation:-90}),e("Label",["funnel","vertical"]).setAll({centerY:R,centerX:0}),e("Tick",["funnel"]).setAll({location:1}),e("FunnelSlice",["funnel","link"]).setAll({fillOpacity:.5,strokeOpacity:0,expandDistance:-.1}),e("FunnelSlice",["funnel","link","vertical"]).setAll({height:10}),e("FunnelSlice",["funnel","link","horizontal"]).setAll({width:10}),e("PyramidSeries").setAll({valueIs:"area"}),e("FunnelSlice",["pyramid","link"]).setAll({fillOpacity:.5}),e("FunnelSlice",["pyramid","link","vertical"]).setAll({height:0}),e("FunnelSlice",["pyramid","link","horizontal"]).setAll({width:0}),e("FunnelSlice",["pyramid"]).setAll({interactive:!0,expandDistance:0}),e("FunnelSlice",["pyramid"]).states.create("hover",{expandDistance:.15}),e("Label",["pyramid"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:R}),e("Label",["pyramid","horizontal"]).setAll({centerX:0,centerY:R,rotation:-90}),e("Label",["pyramid","vertical"]).setAll({centerY:R,centerX:0}),e("Tick",["pyramid"]).setAll({location:1}),e("FunnelSlice",["pictorial"]).setAll({interactive:!0,tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}"}),e("Label",["pictorial"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:R}),e("Label",["pictorial","horizontal"]).setAll({centerX:0,centerY:R,rotation:-90}),e("Label",["pictorial","vertical"]).setAll({centerY:R,centerX:0}),e("FunnelSlice",["pictorial","link"]).setAll({fillOpacity:.5,width:0,height:0}),e("Tick",["pictorial"]).setAll({location:.5});{const i=e("Graphics",["pictorial","background"]);i.setAll({fillOpacity:.2}),et(i,"fill",t,"alternativeBackground")}}}class Q extends Fe{_afterNew(){this._defaultThemes.push(vt.new(this._root)),super._afterNew(),this.chartContainer.children.push(this.seriesContainer),this.seriesContainer.children.push(this.bulletsContainer)}_processSeries(t){super._processSeries(t),this.seriesContainer.children.moveValue(this.bulletsContainer,this.seriesContainer.children.length-1)}}Object.defineProperty(Q,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentChart"});Object.defineProperty(Q,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Fe.classNames.concat([Q.className])});class K extends Ee{constructor(){super(...arguments),Object.defineProperty(this,"slicesContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(be.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"labelsContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(be.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"ticksContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(be.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"_lLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_rLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_hLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"slices",{enumerable:!0,configurable:!0,writable:!0,value:this._makeSlices()}),Object.defineProperty(this,"labels",{enumerable:!0,configurable:!0,writable:!0,value:this._makeLabels()}),Object.defineProperty(this,"ticks",{enumerable:!0,configurable:!0,writable:!0,value:this._makeTicks()})}makeSlice(t){const e=this.slicesContainer.children.push(this.slices.make());return e.on("fill",()=>{this.updateLegendMarker(t)}),e.on("stroke",()=>{this.updateLegendMarker(t)}),e._setDataItem(t),t.set("slice",e),this.slices.push(e),e}makeLabel(t){const e=this.labelsContainer.children.push(this.labels.make());return e._setDataItem(t),t.set("label",e),this.labels.push(e),e}_shouldMakeBullet(t){return t.get("value")!=null}makeTick(t){const e=this.ticksContainer.children.push(this.ticks.make());return e._setDataItem(t),t.set("tick",e),this.ticks.push(e),e}_afterNew(){this.fields.push("category","fill"),super._afterNew()}_onDataClear(){const t=this.get("colors");t&&t.reset()}_prepareChildren(){if(super._prepareChildren(),this._lLabels=[],this._rLabels=[],this._hLabels=[],this._valuesDirty){let t=0,e=0,i=0,s=1/0,r=0;C(this._dataItems,l=>{let a=l.get("valueWorking",0);t+=a,e+=Math.abs(a)}),C(this._dataItems,l=>{let a=l.get("valueWorking",0);a>i&&(i=a),a<s&&(s=a),r++;let o=a/e;e==0&&(o=0),l.setRaw("valuePercentTotal",o*100)}),this.setPrivateRaw("valueLow",s),this.setPrivateRaw("valueHigh",i),this.setPrivateRaw("valueSum",t),this.setPrivateRaw("valueAverage",t/r),this.setPrivateRaw("valueAbsoluteSum",e)}}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return ee(this,void 0,void 0,function*(){let i=[];i.push(e.show.call(this,t)),i.push(this._sequencedShowHide(!0,t)),yield Promise.all(i)})}hide(t){const e=Object.create(null,{hide:{get:()=>super.hide}});return ee(this,void 0,void 0,function*(){let i=[];i.push(e.hide.call(this,t)),i.push(this._sequencedShowHide(!1,t)),yield Promise.all(i)})}_updateChildren(){super._updateChildren(),this._valuesDirty&&C(this._dataItems,t=>{t.get("label").text.markDirtyText()}),(this.isDirty("legendLabelText")||this.isDirty("legendValueText"))&&C(this._dataItems,t=>{this.updateLegendValue(t)}),this._arrange()}_arrange(){this._arrangeDown(this._lLabels),this._arrangeUp(this._lLabels),this._arrangeDown(this._rLabels),this._arrangeUp(this._rLabels),this._arrangeLeft(this._hLabels),this._arrangeRight(this._hLabels),C(this.dataItems,t=>{this._updateTick(t)})}_afterChanged(){super._afterChanged(),this._arrange()}processDataItem(t){if(super.processDataItem(t),t.get("fill")==null){let e=this.get("colors");e&&t.setRaw("fill",e.next())}}showDataItem(t,e){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return ee(this,void 0,void 0,function*(){const s=[i.showDataItem.call(this,t,e)];ae(e)||(e=this.get("stateAnimationDuration",0));const r=this.get("stateAnimationEasing");let l=t.get("value");const a=t.animate({key:"valueWorking",to:l,duration:e,easing:r});a&&s.push(a.waitForStop());const o=t.get("tick");o&&s.push(o.show(e));const n=t.get("label");n&&s.push(n.show(e));const h=t.get("slice");h&&s.push(h.show(e)),h.get("active")&&h.states.applyAnimate("active"),yield Promise.all(s)})}hideDataItem(t,e){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return ee(this,void 0,void 0,function*(){const s=[i.hideDataItem.call(this,t,e)],r=this.states.create("hidden",{});ae(e)||(e=r.get("stateAnimationDuration",this.get("stateAnimationDuration",0)));const l=r.get("stateAnimationEasing",this.get("stateAnimationEasing")),a=t.animate({key:"valueWorking",to:0,duration:e,easing:l});a&&s.push(a.waitForStop());const o=t.get("tick");o&&s.push(o.hide(e));const n=t.get("label");n&&s.push(n.hide(e));const h=t.get("slice");h.hideTooltip(),h&&s.push(h.hide(e)),yield Promise.all(s)})}disposeDataItem(t){super.disposeDataItem(t);let e=t.get("label");e&&(this.labels.removeValue(e),e.dispose());let i=t.get("tick");i&&(this.ticks.removeValue(i),i.dispose());let s=t.get("slice");s&&(this.slices.removeValue(s),s.dispose())}hoverDataItem(t){const e=t.get("slice");e&&!e.isHidden()&&e.hover()}unhoverDataItem(t){const e=t.get("slice");e&&e.unhover()}updateLegendMarker(t){if(t){const e=t.get("slice");if(e){const i=t.get("legendDataItem");if(i){const s=i.get("markerRectangle");C(tt,r=>{e.get(r)!=null&&s.set(r,e.get(r))})}}}}_arrangeDown(t){if(t){let e=this._getNextDown();t.sort((i,s)=>i.y>s.y?1:i.y<s.y?-1:0),C(t,i=>{const s=i.label.adjustedLocalBounds();let r=s.top;i.y+r<e&&(i.y=e-r),i.label.set("y",i.y),e=i.y+s.bottom})}}_getNextUp(){return this.labelsContainer.maxHeight()}_getNextDown(){return 0}_arrangeUp(t){if(t){let e=this._getNextUp();t.sort((i,s)=>i.y<s.y?1:i.y>s.y?-1:0),C(t,i=>{const s=i.label.adjustedLocalBounds();let r=s.bottom;i.y+r>e&&(i.y=e-r),i.label.set("y",i.y),e=i.y+s.top})}}_arrangeRight(t){if(t){let e=0;t.sort((i,s)=>i.y>s.y?1:i.y<s.y?-1:0),C(t,i=>{const s=i.label.adjustedLocalBounds();let r=s.left;i.y+r<e&&(i.y=e-r),i.label.set("x",i.y),e=i.y+s.right})}}_arrangeLeft(t){if(t){let e=this.labelsContainer.maxWidth();t.sort((i,s)=>i.y<s.y?1:i.y>s.y?-1:0),C(t,i=>{const s=i.label.adjustedLocalBounds();let r=s.right;i.y+r>e&&(i.y=e-r),i.label.set("x",i.y),e=i.y+s.left})}}_updateSize(){super._updateSize(),this.markDirty()}_updateTick(t){}_dispose(){super._dispose();const t=this.chart;t&&t.series.removeValue(this)}}Object.defineProperty(K,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentSeries"});Object.defineProperty(K,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Ee.classNames.concat([K.className])});class ue extends Q{constructor(){super(...arguments),Object.defineProperty(this,"_maxRadius",{enumerable:!0,configurable:!0,writable:!0,value:1})}_afterNew(){super._afterNew(),this.seriesContainer.setAll({x:R,y:R})}_prepareChildren(){super._prepareChildren();const t=this.chartContainer,e=t.innerWidth(),i=t.innerHeight(),s=this.get("startAngle",0),r=this.get("endAngle",0),l=this.get("innerRadius");let a=ke(0,0,s,r,1);const o=e/(a.right-a.left),n=i/(a.bottom-a.top);let h={left:0,right:0,top:0,bottom:0};if(l instanceof se){let p=l.value,f=Math.min(o,n);p=Math.max(f*p,f-Math.min(i,e))/f,h=ke(0,0,s,r,p),this.setPrivateRaw("irModifyer",p/l.value)}a=it([a,h]);const d=this._maxRadius;this._maxRadius=Math.min(o,n);const u=H(this.get("radius",0),this._maxRadius);this.seriesContainer.setAll({dy:-u*(a.bottom+a.top)/2,dx:-u*(a.right+a.left)/2}),(this.isDirty("startAngle")||this.isDirty("endAngle")||d!=this._maxRadius)&&this.series.each(p=>{p._markDirtyKey("startAngle")}),(this.isDirty("innerRadius")||this.isDirty("radius"))&&this.series.each(p=>{p._markDirtyKey("innerRadius")})}radius(t){let e=H(this.get("radius",0),this._maxRadius),i=H(this.get("innerRadius",0),e);if(t){let s=this.series.indexOf(t),r=this.series.length,l=t.get("radius");return l!=null?i+H(l,e-i):i+(e-i)/r*(s+1)}return e}innerRadius(t){const e=this.radius();let i=H(this.get("innerRadius",0),e);if(i<0&&(i=e+i),t){let s=this.series.indexOf(t),r=this.series.length,l=t.get("innerRadius");return l!=null?i+H(l,e-i):i+(e-i)/r*s}return i}}Object.defineProperty(ue,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieChart"});Object.defineProperty(ue,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Q.classNames.concat([ue.className])});class ce extends K{_makeSlices(){return new ve(_e.new({}),()=>oe._new(this._root,{themeTags:xe(this.slices.template.get("themeTags",[]),["pie","series"])},[this.slices.template]))}_makeLabels(){return new ve(_e.new({}),()=>ne._new(this._root,{themeTags:xe(this.labels.template.get("themeTags",[]),["pie","series"])},[this.labels.template]))}_makeTicks(){return new ve(_e.new({}),()=>st._new(this._root,{themeTags:xe(this.ticks.template.get("themeTags",[]),["pie","series"])},[this.ticks.template]))}processDataItem(t){super.processDataItem(t);const e=this.makeSlice(t);e.on("scale",()=>{this._updateTick(t)}),e.on("shiftRadius",()=>{this._updateTick(t)}),e.events.on("positionchanged",()=>{this._updateTick(t)});const i=this.makeLabel(t);i.events.on("positionchanged",()=>{this._updateTick(t)}),this.makeTick(t),e.events.on("positionchanged",()=>{i.markDirty()})}_getNextUp(){const t=this.chart;return t?t._maxRadius:this.labelsContainer.maxHeight()/2}_getNextDown(){const t=this.chart;return t?-t._maxRadius:-this.labelsContainer.maxHeight()/2}_prepareChildren(){super._prepareChildren();const t=this.chart;if(t){if(this.isDirty("alignLabels")){let e=this.labels.template;if(this.get("alignLabels"))e.set("textType","aligned");else{let i=e.get("textType");(i==null||i=="aligned")&&e.set("textType","adjusted")}}if(this._valuesDirty||this.isDirty("radius")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("endAngle")||this.isDirty("alignLabels")){this.markDirtyBounds();const e=this.get("startAngle",t.get("startAngle",-90)),s=this.get("endAngle",t.get("endAngle",270))-e;let r=e;const l=t.radius(this);this.setPrivateRaw("radius",l);let a=t.innerRadius(this)*t.getPrivate("irModifyer",1);a<0&&(a=l+a),C(this._dataItems,o=>{this.updateLegendValue(o);let n=s*o.get("valuePercentTotal")/100;const h=o.get("slice");if(h){h.set("radius",l),h.set("innerRadius",a),h.set("startAngle",r),h.set("arc",n);const p=o.get("fill");h._setDefault("fill",p),h._setDefault("stroke",p)}let d=Me(r+n/2);const u=o.get("label");if(u&&(u.setPrivate("radius",l),u.setPrivate("innerRadius",a),u.set("labelAngle",d),u.get("textType")=="aligned")){let p=l+u.get("radius",0),f=l*j(d);d>90&&d<=270?(!u.isHidden()&&!u.isHiding()&&this._lLabels.push({label:u,y:f}),p*=-1,p-=this.labelsContainer.get("paddingLeft",0),u.set("centerX",Ae),u.setPrivateRaw("left",!0)):(!u.isHidden()&&!u.isHiding()&&this._rLabels.push({label:u,y:f}),p+=this.labelsContainer.get("paddingRight",0),u.set("centerX",0),u.setPrivateRaw("left",!1)),u.set("x",p),u.set("y",l*j(d))}r+=n,this._updateTick(o)})}}}_updateTick(t){const e=t.get("tick"),i=t.get("label"),s=t.get("slice"),r=e.get("location",1);if(e&&i&&s){const l=(s.get("shiftRadius",0)+s.get("radius",0))*s.get("scale",1)*r,a=i.get("labelAngle",0),o=X(a),n=j(a),h=this.labelsContainer,d=h.get("paddingLeft",0),u=h.get("paddingRight",0);let p=0,f=0;p=i.x(),f=i.y();let A=[];if(p!=0&&f!=0){if(i.get("textType")=="circular"){const D=i.radius()-i.get("paddingBottom",0),v=i.get("labelAngle",0);p=D*X(v),f=D*j(v)}let y=-u;i.getPrivate("left")&&(y=d),A=[{x:s.x()+l*o,y:s.y()+l*n},{x:p+y,y:f},{x:p,y:f}]}e.set("points",A)}}_positionBullet(t){const e=t.get("sprite");if(e){const s=e.dataItem.get("slice");if(s){const r=s.get("innerRadius",0),l=s.get("radius",0),a=s.get("startAngle",0),o=s.get("arc",0),n=t.get("locationX",.5),h=t.get("locationY",.5),d=a+o*n,u=r+(l-r)*h;e.setAll({x:X(d)*u,y:j(d)*u})}}}}Object.defineProperty(ce,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieSeries"});Object.defineProperty(ce,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:K.classNames.concat([ce.className])});async function _t(c){var o,n,h,d,u,p;const{agentId:t,dateStart:e,dateEnd:i}=c||{},s=await He({index:"opportunity",body:{size:0,_source:["id","name","closeDate","opportunityOppManagerId","estimatedValue"],query:{bool:{must_not:[{terms:{"stage.keyword":["won","lost"]}}],filter:Xe([t&&{term:{"opportunityOppManagerId.keyword":t}},e&&{range:{closeDate:{gte:e,lte:i}}}])}},aggs:{totalValue:{sum:{field:"estimatedValue"}},totalNet:{sum:{field:"netValue"}},byStages:{terms:{field:"stage.keyword",size:999},aggs:{totalNet:{sum:{field:"netValue"}},totalValue:{sum:{field:"estimatedValue"}}}}}}}),r=((n=(o=s.aggregations)==null?void 0:o.totalValue)==null?void 0:n.value)||0,l=((d=(h=s.aggregations)==null?void 0:h.totalNet)==null?void 0:d.value)||0,a=[];return(((p=(u=s.aggregations)==null?void 0:u.byStages)==null?void 0:p.buckets)||[]).forEach(f=>{a.push({stage:f.key,oppCount:f.doc_count,totalNet:f.totalNet.value||0,totalValue:f.totalValue.value||0})}),console.log(">>charts/getSalesOpportunityChartData::","oppStages",a),{oppStages:a,totalValue:r,totalNet:l}}function Ie(){const[{agent:c}]=We({agent:ze}),{data:t}=qe({queryKey:["AGENT_ACTIVITY_REPORT_SALES_OPPORTUNITIES_CHART_DATA",{agent:c}],queryFn:async()=>{if(!c)return;const e=await _t({agentId:c}),i=e.oppStages.reduce((s,r)=>s+r.oppCount,0);return{...e,totalOpportunities:i}}});return console.log("@SALES_OPPORTUNITY_CHART_DATA::",t),Ye.useLayoutEffect(()=>{if(!t)return;const e=at.new("sales-opportunities-pie-chart");e.setThemes([rt.new(e)]),e!=null&&e._logo&&e._logo.dispose();const s=e.container.children.push(ue.new(e,{endAngle:270})).series.push(ce.new(e,{valueField:"value",categoryField:"stage",endAngle:270}));s.states.create("hidden",{endAngle:-90}),s.labels.template.setAll({fontSize:14,radius:-120}),s.labels.template.set("text","{stage}\n (${value}) [bold]{valuePercentTotal.formatNumber('0.00')}%[/]");const r=t.oppStages.map(l=>({stage:Ue(l.stage),value:l.totalValue}));return s.data.setAll(r),s.appear(1e3,100),()=>e.dispose()},[t]),O.jsxs(Qe,{sx:{borderRadius:"4px",p:4,display:"flex",flexDirection:"column"},children:[O.jsxs(Pe,{sx:e=>({pr:8,pb:2,display:"flex",flexDirection:"row",justifyContent:"space-between",borderBottom:`1px solid ${e.palette.text.disabled}`}),children:[O.jsx(ye,{component:"h6",fontWeight:900,children:"Sales Opportunities"}),O.jsxs(ye,{component:"h6",fontWeight:900,children:["Total Number: ",t==null?void 0:t.totalOpportunities]})]}),c?O.jsx(Pe,{id:"sales-opportunities-pie-chart",sx:{width:1,height:777}}):O.jsx(nt,{height:575,message:"Please fill agent filter accordingly"}),O.jsxs(ye,{component:"h4",fontWeight:900,children:["Total Property Value:",lt.numberFormatter(t==null?void 0:t.totalValue).toCurrencyRounded()]})]})}const It={title:"LAWD/User View Sales Opportunities Chart",component:Ie},xt=new Ke,ie={render:()=>O.jsx(Ge,{client:xt,children:O.jsx(Ie,{})})};var Le,Ne,Oe;ie.parameters={...ie.parameters,docs:{...(Le=ie.parameters)==null?void 0:Le.docs,source:{originalSource:`{
  render: () => <QueryClientProvider client={queryClient}>
      <SalesOpportunitiesChart />
    </QueryClientProvider>
}`,...(Oe=(Ne=ie.parameters)==null?void 0:Ne.docs)==null?void 0:Oe.source}}};const Yt=["Default"];export{ie as Default,Yt as __namedExportsOrder,It as default};
