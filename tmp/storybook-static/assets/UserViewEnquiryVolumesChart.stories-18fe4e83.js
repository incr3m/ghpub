import{j as o}from"./TransitionGroupContext-9d36972e.js";import{R as V}from"./index-f1f749bf.js";import{R as O,A as Q,p as d,E as j,T as z,c as b,a as F,L as S}from"./EmptyFiltersWarning-efcfc65c.js";import{bd as J,b0 as M,b1 as R,v as W,w as k,be as C,a2 as B,P as G,B as T,x as N,T as _,bf as U,bg as H,bh as K}from"./papaparse.min-b66e70e7.js";import"./_baseForOwn-9b89c4b6.js";import{l as u,i as A,f as P}from"./index-bcfaa842.js";import"./index-96c5f47c.js";import{X as Z,L as Y,A as $,V as ee,a as te,b as re,B as I}from"./AxisRendererY-0d50d85b.js";import{C as se,a as ne}from"./ColumnSeries-d191de0f.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./Button-352c3435.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./isNativeReflectConstruct-05c29d01.js";const ae=async l=>{const{ids:t,ignoreWithLiveJobStatus:a=!0}=l,c={"id.keyword":t,"type.keyword":["LAWD_SALES"]};let i={};return a&&(i={query:{bool:{must_not:[{terms:{"attributes.liveJobStatus.keyword":["invoiced","lost"]}}]}}}),await J(c,"project",M,{size:1e4,...i})||[]},oe=async l=>{var h,y,w,g;const{enquiryDateRange:t,agentIds:a}=l,c=await R({index:"activity",body:{size:0,query:{bool:{filter:u.compact([(A(t==null?void 0:t.start)||A(t==null?void 0:t.end))&&{range:{when:{gte:P(t==null?void 0:t.start,"yyyy-MM-dd"),lte:P(t==null?void 0:t.end,"yyyy-MM-dd")}}},(A(t==null?void 0:t.start)||A(t==null?void 0:t.end))&&{exists:{field:"when"}},((h=u.compact(a))==null?void 0:h.length)&&{terms:{"activityTeamMemberId.keyword":u.compact(a)}}])}},aggs:{byJob:{terms:{field:"activityProjectId.keyword",min_doc_count:1,size:1e4}}}}}),i=u.keyBy((g=(w=(y=c==null?void 0:c.aggregations)==null?void 0:y.byJob)==null?void 0:w.buckets)==null?void 0:g.map(r=>({id:r==null?void 0:r.key,value:r==null?void 0:r.doc_count})),"id"),n=u.compact(u.uniq(Object.keys(i))),s=(await ae({ids:n})||[]).map(r=>{var v,f;const x=i==null?void 0:i[(f=(v=r==null?void 0:r.id)==null?void 0:v.toLowerCase())==null?void 0:f.trim()];return{id:r==null?void 0:r.id,job:r==null?void 0:r.name,value:x==null?void 0:x.value}});return{totalEnquiries:u.sumBy(s,"value"),salesJobs:s}};function q(){const[{agent:l,enqStartDate:t,enqEndDate:a},c]=W({agent:k,enqStartDate:C,enqEndDate:C}),i=e=>{if(!e){c({enqStartDate:void 0,enqEndDate:void 0});return}const{startDate:s,endDate:p}=e;c({enqStartDate:s,enqEndDate:p})},{data:n}=B({queryKey:["AGENT_ACTIVITY_REPORT_ENQUIRY_VOLUMES_CHART_DATA",{agent:l,enqStartDate:t,enqEndDate:a}],queryFn:async()=>{if(!(!l||!t||!a))return oe({agentIds:[l],enquiryDateRange:{start:t,end:a}})}});return console.log("@AGENT_ACTIVITY_REPORT_ENQUIRY_VOLUMES_CHART_DATA::",n),V.useLayoutEffect(()=>{if(!n)return;const e=O.new("enquiry-volumes-column-bar-chart");e.setThemes([Q.new(e)]),e!=null&&e._logo&&e._logo.dispose();const s=e.container.children.push(Z.new(e,{panX:!0,panY:!0,wheelY:"zoomXY",paddingLeft:0,layout:e.verticalLayout}));let p=s.children.push(Y.new(e,{centerX:d,x:d}));const h=(n==null?void 0:n.salesJobs)||[],y=s.yAxes.push(se.new(e,{categoryField:"job",renderer:$.new(e,{inversed:!0,cellStartLocation:.1,cellEndLocation:.9,minorGridEnabled:!0})}));y.data.setAll(h);const w=s.xAxes.push(ee.new(e,{renderer:te.new(e,{strokeOpacity:.1,minGridDistance:110}),min:0}));function g(x,v,f){const m=s.series.push(ne.new(e,{name:v,xAxis:w,yAxis:y,valueXField:x,categoryYField:"job",sequencedInterpolation:!0,tooltip:z.new(e,{pointerOrientation:"horizontal",labelText:`[bold]{name}[/]
{categoryY}: {valueX}`}),fill:b(f),stroke:b(f)}));return m.columns.template.setAll({height:F,strokeOpacity:0}),m.bullets.push(function(){return I.new(e,{locationX:1,locationY:.5,sprite:S.new(e,{centerY:d,text:"{valueX}",populateText:!0})})}),m.bullets.push(function(){return I.new(e,{locationX:1,locationY:.5,sprite:S.new(e,{centerX:d,centerY:d,fill:b(16777215)})})}),m.data.setAll(h),m.appear(),m}g("value","Value","#184e9a"),p=s.children.push(Y.new(e,{centerX:d,x:d})),p.data.setAll(s.series.values);const r=s.set("cursor",re.new(e,{behavior:"zoomY"}));return r.lineY.set("forceHidden",!0),r.lineX.set("forceHidden",!0),s.appear(1e3,100),()=>e.dispose()},[n]),o.jsxs(G,{sx:{borderRadius:"4px",p:4,display:"flex",flexDirection:"column"},children:[o.jsxs(T,{sx:e=>({pb:2,pr:8,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",borderBottom:`1px solid ${e.palette.text.disabled}`}),children:[o.jsxs(N,{direction:"row",alignItems:"center",columnGap:2.5,children:[o.jsx(_,{component:"h6",fontWeight:900,children:"Enquiry Volumes"}),o.jsx(U,{onChange:i,defaultDateRange:t&&a?{startDate:t,endDate:a}:void 0,variant:"outlined",label:"Period",InputLabelProps:{shrink:!0},zIndex:9999,sx:{width:300,"& input":{fontSize:14},"& label":{mt:"10px"}}})]}),o.jsxs(_,{component:"h6",fontWeight:900,children:["Total Number: ",(n==null?void 0:n.totalEnquiries)??""]})]}),!l||!t||!a?o.jsx(j,{message:"Please fill the agent & period filters accordingly."}):o.jsx(T,{id:"enquiry-volumes-column-bar-chart",sx:{width:1,height:800}})]})}const _e={title:"LAWD/User View Enquiry Volumes Chart",component:q},ie=new H,E={render:()=>o.jsx(K,{client:ie,children:o.jsx(q,{})})};var L,D,X;E.parameters={...E.parameters,docs:{...(L=E.parameters)==null?void 0:L.docs,source:{originalSource:`{
  render: () => <QueryClientProvider client={queryClient}>
      <EnquiryVolumesChart />
    </QueryClientProvider>
}`,...(X=(D=E.parameters)==null?void 0:D.docs)==null?void 0:X.source}}};const Pe=["Default"];export{E as Default,Pe as __namedExportsOrder,_e as default};
