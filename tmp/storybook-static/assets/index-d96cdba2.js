import{j as e}from"./TransitionGroupContext-9d36972e.js";import{R as m}from"./index-f1f749bf.js";import{au as C,av as K,bo as M,o as $,K as P,aV as B,g as v,ad as y,Z as F,m as T,d as N,p as O,u as R,a1 as D,aW as V,B as f,T as b,a3 as A,L as E,J as g,bv as q}from"./papaparse.min-b66e70e7.js";import{w as J,S as j,e as U}from"./Play-87fed129.js";import H from"./index-6ede752a.js";import{d as L}from"./Add-be7f5660.js";import{N as W}from"./SelectEsModelInput-d580a9f7.js";import{g as z}from"./_baseForOwn-9b89c4b6.js";import{M as Q}from"./index-864004f3.js";import{b as G,u as Z,w as X}from"./index-bcfaa842.js";import{B as x}from"./Button-352c3435.js";import{u as Y}from"./react-router-19e5b27c.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./index-96c5f47c.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./react-router-dom-60ea8218.js";import"./tiny-invariant-dd7d57d2.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";import"./useBeforeSave-e049f6dd.js";import"./useIncludeFieldNames-35a180a9.js";import"./isNativeReflectConstruct-05c29d01.js";var _={},ee=K;Object.defineProperty(_,"__esModule",{value:!0});var S=_.default=void 0,te=ee(C()),se=e;S=_.default=(0,te.default)((0,se.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11zM8 21V7h6v5h5v9z"}),"FileCopyOutlined");function ie({userId:h,onSuccess:c}){const[u,l]=m.useState({copying:!1}),d=M(),{enqueueSnackbar:t}=G(),n=$();return e.jsx(x,{variant:"outlined",disabled:u.copying,startIcon:e.jsx(S,{}),onClick:async s=>{s.stopPropagation();let r;if(await d({title:"Select Team Member",content:o=>e.jsxs("div",{children:[e.jsx(P,{model:"User",label:"Team Member",icon:Q,sort:[{"fullname.keyword":{order:"asc"}}],onChange:(k,p)=>{r=p==null?void 0:p._source},fullWidth:!0}),e.jsxs(B,{children:[e.jsx(x,{variant:"contained",color:"primary",onClick:o.submit,children:"Submit"}),e.jsx(x,{onClick:o.close,children:"Close"})]})]})}),console.log(">>MemberKpi/CopyKpiButton::","teamMemberId",r),!!r)try{if(!r.kpi)throw new Error("No KPI found.");l(o=>({...o,copying:!0})),await n.mutate({mutation:v`
              mutation($input: UpdateUserInput!) {
                updateUser(input: $input) {
                  id
                  kpi
                }
              }
            `,variables:{input:{id:h,kpi:JSON.stringify(r.kpi)}}}),t("KPI copied successfully",{variant:"success"}),c&&c(),l(o=>({...o,copying:!1}))}catch(o){t(o.message,{variant:"error"})}},children:"Copy from other Team Member"})}const re=J(F),oe=T({root:{"& form":{paddingTop:"0 !important"}}});function Re(){const[h,c]=m.useState(Date.now()),u=oe(),{userId:l}=Y(),d={};return e.jsx("div",{className:u.root,children:e.jsx(re,{name:"user",title:"User KPI",initialValues:d,id:l,withTags:!1,canDelete:!1,actions:[e.jsx(ie,{id:"copy-kpi",userId:l,onSuccess:()=>c(Date.now())},"actions")],headerProps:{showDivider:!1,forceShowActions:!0},children:e.jsx(H,{field:"kpi",beforeSave:t=>{const n={...t},s=t.kpi;for(const r in s)s[r]&&y(n,`kpi.${r.replace(/_/g,".")}`,s[r]),delete s[r];return delete n.kpiKeys,n},initialValues:t=>{const n={kpiKeys:[]},s=t==null?void 0:t.kpi_items;console.log(">>MemberKpi/index::","datakpi",t);for(const r in s){n.kpiKeys.push(r);for(const o in s[r])y(n,`kpi_items_${r}_${o}`,s[r][o])}return n},children:e.jsx(ae,{})})},h)})}function ae(){const[h,c]=m.useState({kpiItems:{}}),u=m.useContext(N),l=!u.state.readOnly,d=u.fetching,{values:t,setValues:n}=O(),s=m.useMemo(()=>(t==null?void 0:t.kpiKeys)||[],[t==null?void 0:t.kpiKeys]),r=R(v`
      query ($filter: AWSJSON) {
        kpi: nestedSearch(type: "KpiList", filter: $filter) {
          metadata
        }
      }
    `,{variables:{filter:JSON.stringify({enabledOnly:!0})},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});m.useEffect(()=>{const{items:a={}}=JSON.parse(z(r,"data.kpi.metadata","{}"));c(i=>({...i,kpiItems:a}))},[r]);const o=h.kpiItems,k=m.useCallback((a,i)=>{s.includes(i)||n({...t,kpiKeys:[...s,i],[`kpi_items_${i}_period`]:o[i].period,[`kpi_items_${i}_target`]:o[i].target,[`kpi_items_${i}_measure`]:o[i].measure})},[o,s,n,t]),p=Object.keys(D(o,s)),I=Z("FORMAT_TARGET_NUMBER").on;return console.log(">>MemberKpi/index::","kpiItems",{kpiItems:o,kpiKeys:s,opts:p,isEditing:l}),e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs(f,{children:[!l&&s.length<1&&!d&&e.jsx("center",{children:e.jsx(b,{variant:"subtitle1",children:"No KPI items found."})}),d?e.jsx(A,{}):s.map(a=>e.jsxs(f,{display:"flex",mb:2,alignItems:"center",children:[e.jsx(E,{text:"KPI",width:"200px",children:e.jsx(b,{variant:"subtitle1",children:g(a)})}),e.jsx(f,{width:"250px",children:e.jsx(j,{name:`kpi_items_${a}_period`,label:"Period",options:["month","quarter","year"]})}),e.jsx(f,{width:"150px",ml:2,children:e.jsx(U,{name:`kpi_items_${a}_target`,label:"Target #",fullWidth:!0,InputProps:{inputComponent:W},format:i=>i&&I?X.numberFormatter(i).toCurrency():i})}),e.jsx(f,{width:"150px",ml:2,children:e.jsx(j,{name:`kpi_items_${a}_measure`,label:"Better ðŸ”¼/ðŸ”½",options:["higher","lower"]})}),l&&e.jsx(f,{ml:2,children:e.jsx(x,{size:"small",variant:"outlined",onClick:()=>{const i={...t,kpiKeys:s.filter(w=>w!==a)};delete i[`kpi_items_${a}_period`],delete i[`kpi_items_${a}_target`],delete i[`kpi_items_${a}_measure`],n(i)},children:"Remove"})})]},a))]}),l&&p.length>0&&e.jsx(q,{icon:e.jsx(L,{}),label:"Add KPI",options:p.map(a=>({value:a,label:g(a)})),onClick:k,saveSelection:!1})]})}export{Re as default};
