import{j as e}from"./TransitionGroupContext-9d36972e.js";import{u as O}from"./ProjectLink-987015ba.js";import{R as m}from"./index-f1f749bf.js";import{n as M,o as $,q as N,P as Q,t as J,K as U}from"./VewJobDetails.story-c6ae2e88.js";import{r as Y,G as V}from"./Play-87fed129.js";import{au as X,av as Z,e as A,bc as ee,bJ as te,B as u,i as I,j as z,h as R,n as re,bn as se,a4 as ie,T as oe,L as ne,as as ae,bR as t,bS as D,a as le,a2 as de,D as ce,ae as me}from"./papaparse.min-b66e70e7.js";import{d as pe}from"./debounce-213cd46f.js";import{c as ue}from"./camelCase-4e7e8b23.js";import{K as he}from"./Key-1051e01b.js";import{d as ge}from"./DeleteForeverOutlined-2dc96511.js";import{D as xe,f as fe,P as ye}from"./pick-dba65392.js";import{B as _}from"./Button-352c3435.js";import{S as be}from"./index-63a3e378.js";import{h as je}from"./index-bcfaa842.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./index-72884e22.js";import"./index-147ad7aa.js";import"./index-356e4a49.js";import"./stories-1f769a10.js";import"./_baseForOwn-9b89c4b6.js";import"./index-96c5f47c.js";import"./SyncEagleDevTool-4c34bdb8.js";import"./index.esm-bf21a293.js";import"./zod-575fe4a8.js";import"./index-ce960f89.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./userGroups-edff3f7b.js";import"./index-f70ce446.js";import"./searchUsers-04324aeb.js";import"./find-8750f979.js";import"./index-18188c67.js";import"./index-61adb48a.js";import"./_arrayIncludes-2cfb33ae.js";import"./useFetchMore-be228481.js";import"./useTagSearch-f4fcfbe9.js";import"./Skeleton-cd6f071e.js";import"./ExpandMore-79a3c159.js";import"./react-router-dom-60ea8218.js";import"./react-router-19e5b27c.js";import"./index-4d501b15.js";import"./tiny-invariant-dd7d57d2.js";import"./uniqBy-baac1626.js";import"./uniq-0d482d7b.js";import"./RemoveCircle-617bdac2.js";import"./index-b769406f.js";import"./DragIndicator-582939ba.js";import"./TableRow-00aadd87.js";import"./TableHead-dd1583ce.js";import"./capitalize-c31f38e2.js";import"./isString-2f2f79c0.js";import"./Save-b67fa0ac.js";import"./Person-5be09a1e.js";import"./Add-be7f5660.js";import"./times-069ea398.js";import"./_castFunction-353dfc26.js";import"./TaskForm-863cdb73.js";import"./SelectEsModelInput-d580a9f7.js";import"./useIncludeFieldNames-35a180a9.js";import"./RepeatFields-8275ed19.js";import"./useBeforeSave-e049f6dd.js";import"./Alert-fd9a067a.js";import"./TaskAssignees-858ea3c9.js";import"./useTaskAssignees-9f1fd5d3.js";import"./github-91d085b0.js";import"./SortUpIcon-3aecf5f0.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./OpportunityLink-b32d0c35.js";import"./index-9d3afdfc.js";import"./index-79afbab1.js";import"./Check-78df5e8e.js";import"./bundle-053bdffd.js";import"./MilestoneIcon-61fb6e69.js";import"./Trash-822e65ce.js";import"./index-5d349c56.js";import"./EstimateEditorPopover-b8debf9a.js";import"./AssigneeEditorPopover-2b4e6473.js";import"./isNativeReflectConstruct-05c29d01.js";import"./isPlainObject-07477f89.js";import"./ToggleButtonGroup-93d9af56.js";import"./index-71ed01a9.js";import"./index-4d31058a.js";import"./Undo-33c7aa7a.js";import"./cloneDeep-91467704.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./Link-c687dc07.js";import"./AuditLogsNoBreadCrumbs-8da9c0ce.js";import"./ExpenseView-2f5d1473.js";import"./MenuOptions-0bc3bb51.js";import"./MultipleSelectFieldInput-d0cee4a2.js";import"./LocationBeFormBody-c033b2b3.js";import"./reduce-4f6f1985.js";var T={},we=Z;Object.defineProperty(T,"__esModule",{value:!0});var P=T.default=void 0,ve=we(X()),Ce=e;P=T.default=(0,ve.default)((0,Ce.jsx)("path",{d:"M20 9H4v2h16zM4 15h16v-2H4z"}),"DragHandle");function Ke({id:l,archived:x=!1,text:i="",index:n,onChange:c,onChecked:p,onRemove:f,dragHandle:h}){const g=m.useRef({changed:!1,index:n}),[y,v]=m.useState({text:i}),a=!x,b=`${n}`;m.useEffect(()=>{g.current.changed&&c&&c(g.current.index,y.text)},[c,y.text]),m.useEffect(()=>{v({text:i})},[n,i]);const C=m.useCallback(w=>{const K=w.target.value;v(k=>({...k,text:K})),g.current.changed=!0},[]);return e.jsxs(u,{style:{display:"grid",gridTemplateColumns:"repeat(4, auto)",justifyContent:"stretch"},children:[e.jsx(ae,{name:b,checked:a,tabIndex:-1,disableRipple:!0,onChange:p}),e.jsx(R,{value:y.text,disabled:!a,variant:"outlined",name:b,onChange:C}),e.jsx(I,{onClick:()=>f(l),size:"large",children:e.jsx(ge,{})}),h]})}function ke({kw:l,customKeyPrefix:x,data:i,onSave:n,onCancel:c}){var B;const p=!!x;console.log(">>Keywords/KeywordForm::","custom",p);const[f,h]=m.useState({keyword:l,items:i.value.items.map(o=>({...o,id:A.v4()})),loading:!1}),[g,y]=m.useState({id:l||i.id,name:i.name,description:i.description}),[v,a]=m.useState(!1),{items:b,loading:C}=f,w=o=>{h(r=>{const s=r.items;return{...r,items:s.filter(d=>d.id!==o)}})},K=m.useCallback(()=>{h(o=>{const r=o.items,s=ee(r);return s&&s.text===""?s.archived=!1:r.push({id:A.v4(),text:"",archived:!1}),{...o,items:r}})},[]),k=m.useCallback(async()=>{if(p&&!g.name){a(!0);return}const{keyword:o,items:r}=f;h(d=>({...d,loading:!0}));const s={...i,value:{items:r},...g};await M(s),await Y({ids:[$(o)]}),h(d=>({...d,loading:!1})),n&&n(s)},[p,f,g,i,n]),L=m.useCallback(pe((o,r)=>{console.log(">>settings/Keywords::","index",o,r),h(s=>{const{items:d}=s;return d[o].text=r,{...s,items:d}})},500),[]),q=m.useCallback((o,r)=>{const s=o.currentTarget.getAttribute("name");h(d=>{const{items:j}=d;return j[s].archived=!r,{...d,items:j}})},[]),F=m.useCallback(async o=>{try{const{source:r,destination:s}=o;await N({name:l,items:f.items,source:r,destination:s,onSorted:d=>{h(j=>({...j,items:d})),te.dispatch(`keywords-${l}-sorted`,{sortedItems:d})}})}catch(r){console.log(r)}},[f.items,l]);return e.jsxs(u,{style:{display:"grid",padding:40,width:430,gridRowGap:35},children:[p?e.jsxs(u,{position:"relative",width:"100%",children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(u,{fontSize:"smaller",children:["Key:",e.jsx(u,{component:"span",ml:1,fontWeight:"bold",children:g.id})]}),e.jsx(I,{onClick:c,size:"small",children:e.jsx(z,{})})]}),e.jsx(u,{mt:2,children:e.jsx(R,{fullWidth:!0,label:"Name",value:g.name,onChange:o=>{a(!1);const r=o.target.value,s=`${x}Kw${re(ue(se(r)))}`;y(d=>({...d,name:r,id:s,code:s}))},error:v})}),e.jsx(u,{mt:2,children:e.jsx(R,{variant:"outlined",fullWidth:!0,label:"Description",value:g.description,onChange:o=>{const r=o.target.value;y(s=>({...s,description:r}))}})}),e.jsx(ie,{sx:{mt:2}})]}):e.jsxs(u,{style:{display:"grid",gridTemplateColumns:"10fr 2fr",alignItems:"center"},children:[e.jsx(oe,{style:{color:"#052649",fontWeight:"bold",fontSize:20},children:(B=i==null?void 0:i.name)==null?void 0:B.toUpperCase()}),e.jsx(I,{onClick:c,size:"large",children:e.jsx(z,{})})]}),e.jsx(u,{style:{display:"grid",gridRowGap:15},children:e.jsx(xe,{onDragEnd:F,children:e.jsx(fe,{droppableId:l,children:o=>{if(!f.items)return null;const{droppableProps:r,innerRef:s,placeholder:d}=o;return e.jsxs("div",{ref:s,...r,children:[e.jsx(ne,{text:"Items",mt:1,sx:{display:"grid",gridRowGap:15},children:b.map((j,S)=>e.jsx(ye,{draggableId:j.id,index:S,children:W=>{const{innerRef:E,draggableProps:G,dragHandleProps:H}=W;return e.jsx("div",{ref:E,...G,children:e.jsx(Ke,{...j,index:S,onChange:L,onChecked:q,onRemove:w,dragHandle:e.jsx("div",{...H,style:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(P,{})})},S)})}},j.id))}),d]})}})})}),e.jsxs(u,{style:{display:"grid",gridTemplateColumns:"repeat(2, auto)",justifyContent:"end",gridColumnGap:15},children:[e.jsx(_,{size:"large",variant:"outlined",color:"primary",onClick:K,children:"Add Item"}),e.jsx(_,{size:"large",startIcon:e.jsx(he,{}),variant:"contained",disabled:C,color:"primary",onClick:k,children:"Save keywords"})]})]})}const Se=t.object({id:t.string(),code:t.string(),createdAt:t.string(),module:t.string(),name:t.string(),recOwner:t.string(),updatedAt:t.string(),value:D.awsJson().optional().nullish(),__typename:t.literal("Setting")}),Ie=t.record(t.string().length(10),t.array(t.number()));Se.extend({value:t.object({unlockedPeriods:Ie.optional().nullable().describe("[attribute]: unlocked periods")})});const Re=t.object({id:t.string(),archived:t.boolean().optional(),text:t.string()}),De=t.object({id:t.string(),code:t.string(),name:t.string(),module:t.string(),description:t.string().optional(),value:t.object({items:Re.array()}),createdAt:D.awsDateTime().optional().nullable(),updatedAt:D.awsDateTime().optional().nullable()}),_e=async()=>{var i;const l=await le({key:"settingByModule",variables:{module:"custom"},depthLimit:4}),x=[];return(i=l==null?void 0:l.items)==null||i.forEach(n=>{if(!n)return null;let c=n.value;typeof c=="string"&&(c=JSON.parse(c)),n.description=n.description??"-";const p=De.parse({...n,value:c});x.push(p)}),x},Te=l=>{const{title:x="Custom Keywords",instance:i}=l,[n,c]=m.useState({selectedKw:null,searchTxt:null}),{data:p,isLoading:f,refetch:h}=de({queryKey:["LIST_CUSTOM_KEYWORDS"],queryFn:()=>_e()}),g=m.useCallback(()=>{},[]),y=m.useCallback(()=>{c(a=>({...a,selectedKw:null})),h()},[h]),v=m.useCallback(a=>{if(!p)return;const b=a.currentTarget.getAttribute("name"),C=p.find(w=>w.id===b);C&&c(w=>({...w,selectedKw:C}))},[p]);return e.jsxs("div",{children:[e.jsx(Q,{mb:2,children:x}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",mt:1,mb:1,alignItems:"center"},children:[e.jsx(J,{mr:3,width:"300px",mb:2,children:e.jsx(ce,{placeholder:"Name..",textFieldProps:{label:"Search"},onChange:g})}),e.jsx(_,{variant:"contained",startIcon:e.jsx(V,{}),onClick:()=>{c(a=>({...a,selectedKw:{id:"",code:"",name:"",module:"custom",value:{items:[]}}}))},children:"Add Custom Keyword"})]}),f?e.jsx(be,{}):e.jsx(u,{sx:{display:"grid",gridRowGap:5},children:(p||[]).map(a=>{const b=a.name;return n.searchTxt&&!b.toLowerCase().includes(n.searchTxt.toLowerCase())?null:e.jsx(U,{name:a.id,val:a,onKwClicked:v},a.id)})}),e.jsx(me,{maxWidth:"xl",scroll:"body",open:!!n.selectedKw,onClose:()=>{c(a=>({...a,selectedKw:null}))},children:n.selectedKw&&e.jsx(ke,{kw:n.selectedKw.id,data:n.selectedKw,customKeyPrefix:i,onSave:y,onCancel:()=>{c(a=>({...a,selectedKw:null}))}})})]})};function yr(){var i;O({paths:[{label:"",link:"/"},{label:"Settings",link:"/settings"},{label:"LAWD"},{label:"Keywords",link:"/settings/lawd/keywords"}]});const l=je(),x=(i=l==null?void 0:l.getAttributes())==null?void 0:i.instance;return e.jsx(Te,{title:"Keywords",instance:x})}export{yr as default};
