import{j as e}from"./TransitionGroupContext-9d36972e.js";import{R as o,r as Y}from"./index-f1f749bf.js";import{au as H,av as _,m as L,B as x,ax as ne,u as B,l as V,aw as be,W as ae,ag as le,a9 as ie,aV as oe,J as w,ad as Se,cH as ve,cI as Re,ab as Te,g as De,a6 as X,F as Ce,N as we,O as $,al as Pe,R as Me,v as de,G as ce,P as ke,w as G,at as Ie,L as Ee,ak as Z,cO as Ne,cP as Oe,be as ee,c0 as te}from"./papaparse.min-b66e70e7.js";import{b as $e,ae as re}from"./Play-87fed129.js";import{b as Ae,f as u,w as pe,$ as Ge,a0 as Fe,d as He,e as _e,s as Le,J as Be}from"./index-bcfaa842.js";import he from"./purify.es-cf254a40.js";import{g as m}from"./_baseForOwn-9b89c4b6.js";import{B as b}from"./Button-352c3435.js";import{d as Ve}from"./Replay-bbc3c678.js";import{u as ze}from"./useFetchMore-be228481.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./index-96c5f47c.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./react-router-19e5b27c.js";import"./tiny-invariant-dd7d57d2.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./react-router-dom-60ea8218.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";import"./isNativeReflectConstruct-05c29d01.js";var z={},Qe=_;Object.defineProperty(z,"__esModule",{value:!0});var Q=z.default=void 0,Ke=Qe(H()),We=e;Q=z.default=(0,Ke.default)((0,We.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"}),"AssessmentOutlined");const qe=L({root:s=>{var t;return{...(t=s.styles)==null?void 0:t.root}}});function Je(s){var a;const t=s.content;return{html:he.sanitize(t),styles:(a=s.metadata)==null?void 0:a.styles,type:s.contentType||"html"}}const Ue=o.forwardRef(function({id:s,defaultValue:t},r){const[a,n]=o.useState({html:null,styles:null,type:null}),i=qe({styles:a.styles}),{report:d,loading:h}=Ye(s),p=t||d;o.useEffect(()=>{p&&n(c=>({...c,...Je(p)}))},[p]);const l=o.useCallback(()=>({__html:a.html}),[a.html]);return e.jsxs(e.Fragment,{children:[e.jsx(x,{height:"10px",children:h&&e.jsx(ne,{})}),e.jsx("div",{ref:r,className:i.root,children:e.jsx("div",{dangerouslySetInnerHTML:l()})})]})}),xe=Ue;function Ye(s){const t=B(V`
      query($id: ID!) {
        getGeneratedReport(id: $id) {
          id
          reportKey
          type
          date
          subType
          contentData {
            id
            content
          }
          contentType
          metadata
          createdAt
          updatedAt
          recOwner
        }
      }
    `,{skip:!s,variables:{id:s}});return{report:o.useMemo(()=>{const{contentData:a,...n}={...m(t,"data.getGeneratedReport",{})};return console.log(">>reports/GeneratedReportView::","idQ",n),typeof(n==null?void 0:n.metadata)=="string"&&(n.metadata=JSON.parse(n.metadata)),n.content=a==null?void 0:a.content,n},[t]),loading:t.loading}}var K={},Xe=_;Object.defineProperty(K,"__esModule",{value:!0});var ue=K.default=void 0,Ze=Xe(H()),et=e;ue=K.default=(0,Ze.default)((0,et.jsx)("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"}),"HourglassEmptyOutlined");var W={},tt=_;Object.defineProperty(W,"__esModule",{value:!0});var q=W.default=void 0,rt=tt(H()),st=e;q=W.default=(0,rt.default)((0,st.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z"}),"CheckCircleOutlineOutlined");const g=o.createContext(),nt=L({root:s=>{var r;const t={...(r=s.styles)==null?void 0:r.root,display:"none"};return s.debug&&delete t.display,t}});function at({data:s=null,companyLogo:t="",debug:r=!1,loading:a,report:{reportKey:n,type:i,subType:d,contentType:h,metadata:p},onSave:l,filters:c,...j}){const y=o.useRef(null),v=nt({styles:p==null?void 0:p.styles,debug:r}),P=o.useRef(null),[R,E]=o.useState({report:null,saved:!1}),N={reportKey:n,type:i,subType:d,contentType:h,metadata:p},O=a||s===null,J=Ae();o.useEffect(()=>{E(T=>({...T,saved:!1}))},[N.reportKey]);const[U,{loading:je}]=be(V`
    mutation(
      $input: CreateGeneratedReportInput!
      $contentInput: CreateGeneratedReportContentInput!
    ) {
      createGeneratedReport(input: $input) {
        id
      }
      createGeneratedReportContent(input: $contentInput) {
        id
      }
    }
  `),me=o.useCallback(()=>{const T=P.current;if(!T)return;console.log(">>reports/GeneratedReportContext::","container.innerHTML",T.innerHTML);const D=T.innerHTML,C=he.sanitize(D);E(M=>({...M,report:{...N,content:C}})),y.current.open()},[N]),ye=o.useCallback(()=>{y.current.close()},[]),fe=o.useCallback(async()=>{const{content:T,...D}=R.report,C=await U({variables:{input:{...D,metadata:JSON.stringify(D.metadata||{}),filters:JSON.stringify(c||{})},contentInput:{id:D.reportKey,content:T,contentType:D.contentType}},refetchQueries:()=>["GEN_RPT_LIST"]});console.log(">>reports/GeneratedReportContext::","res",C);const M=m(C,"data.createGeneratedReport.id");if(!M){console.error(">>reports/GeneratedReportContext::","res",C),alert("something wrong happened");return}J.enqueueSnackbar("Report Saved Successfully",{variant:"success"}),E(ge=>({...ge,saved:!0})),l&&l(M),y.current.close()},[c,l,U,J,R.report]);return e.jsxs(g.Provider,{value:{data:s,companyLogo:t},children:[e.jsx(x,{height:"10px",children:O&&e.jsx(ne,{})}),e.jsx("div",{className:v.root,children:e.jsx("div",{ref:P,children:j.children})}),e.jsx(b,{color:"primary",variant:"contained",disabled:O||R.saved,onClick:me,children:!R.saved&&O?e.jsxs(e.Fragment,{children:[e.jsx(ue,{})," Generating"]}):R.saved?e.jsxs(e.Fragment,{children:[e.jsx(q,{})," Saved"]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{})," Open Report"]})}),e.jsxs(ae,{variant:"dialog",ref:y,dialogProps:{maxWidth:"lg",fullWidth:!0},children:[e.jsx(le,{children:e.jsx(x,{mt:2,children:"Report"})}),e.jsx(ie,{children:e.jsx(xe,{defaultValue:R.report})}),e.jsx(oe,{children:e.jsxs(x,{p:2,display:"flex",children:[e.jsx(b,{variant:"outlined",onClick:ye,children:"Cancel"}),e.jsx(x,{mr:1}),e.jsx(b,{variant:"contained",color:"primary",disabled:je,onClick:fe,children:"Save"})]})})]})]})}const lt={"& .rpt-tbl":{marginTop:20},"& .rpt-tbl table":{width:"100%",borderCollapse:"collapse",border:"1px solid #E6E9ED"},"& .rpt-tbl table caption":{textAlign:"left",textTransform:"uppercase",borderBottom:"none",padding:"10px 15px",background:"#F3F7FB",border:"1px solid #E6E9ED"},"& .rpt-tbl table td":{padding:"5px 15px",border:"1px solid #E6E9ED",textAlign:"center"},"& .rpt-tbl table th":{textAlign:"center",letterSpacing:"0.75px",textTransform:"uppercase",color:"#697D92",fontWeight:"bold",padding:"5px 15px",fontSize:"10px"},"& .rpt-tbl table th:nth-child(1)":{textAlign:"left"},"& .rpt-tbl table tr > td:nth-child(1)":{textAlign:"left"},"& .rpt-tbl table td a":{textDecoration:"none",color:"#151D27"},"& .rpt-tbl table td a:hover":{textDecoration:"underline"}};function S({style:s,children:t}){const r="rpt-tbl";return e.jsx("div",{className:r,style:s,children:t})}function it(){const{data:s}=o.useContext(g),{issues:t=[]}=s;return e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"ISSUES"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Impact"}),e.jsx("th",{children:"Priority"}),e.jsx("th",{children:"Critical Resolution Date"}),e.jsx("th",{children:"Resolution Steps Taken"}),e.jsx("th",{children:"Date Resolved"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"date-cell",children:r.identifiedDate&&u(new Date(r.identifiedDate),"dd/MM/yyyy")}),e.jsx("td",{className:"algn-left",children:r.description}),e.jsx("td",{className:"algn-left",children:r.impact}),e.jsx("td",{children:r.priority}),e.jsx("td",{className:"date-cell",children:r.criticalResolutionDate&&u(new Date(r.criticalResolutionDate),"dd/MM/yyyy")}),e.jsx("td",{className:"algn-left",children:r.resolutionSteps}),e.jsx("td",{className:"date-cell",children:r.resolvedDate&&u(new Date(r.resolvedDate),"dd/MM/yyyy")})]},r.id))})]})})}function ot(){const{data:s}=o.useContext(g),{notes:t=[]}=s;return console.log(">>ProjectPsrReport/PsrSummaryNotes::","notes",t),e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"NOTES"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Subject"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"w200",children:r.subject}),e.jsx("td",{className:"date-cell",children:r.when&&u(new Date(r.when),"dd/MM/yyyy")}),e.jsx("td",{className:"no-wrap",children:w(r.type)}),e.jsx("td",{className:"algn-left",children:r.details})]},r.id))})]})})}function dt(){const{data:s}=o.useContext(g),{risks:t=[]}=s;return console.log(">>ProjectPsrReport/PsrSummaryRisks::","risks",t),e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"RISKS"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Exposure"}),e.jsx("th",{children:"Probability"}),e.jsx("th",{children:"Containment"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"date-cell",children:r.date&&u(new Date(r.date),"dd/MM/yyyy")}),e.jsx("td",{className:"algn-left",children:r.description}),e.jsx("td",{children:r.status}),e.jsx("td",{children:r.exposure}),e.jsx("td",{children:r.probability}),e.jsx("td",{className:"algn-left",children:r.containment})]},r.id))})]})})}const ct={"& .rpt-labelled-box":{display:"block"},"& .rpt-labelled-box.inline":{display:"inline-block"},"& .rpt-labelled-box > p":{color:"rgb(155, 168, 182)",fontSize:12,lineHeight:1,marginBottom:5}};function f({text:s,inline:t,style:r,children:a}){let n="rpt-labelled-box";return t&&(n+=" inline"),e.jsxs("div",{className:n,style:r,children:[e.jsx("p",{children:s}),a]})}const pt={"& .rpt-box-pnl":{border:"1px solid #E6E9ED",borderRadius:"6px",padding:15},"& .rpt-box-pnl > span":{fontWeight:"bold",fontSize:"14px",lineHeight:"150%",letterSpace:"0.75px",color:"#697D92"},"& .rpt-box-pnl > div":{padding:"0 15px",marginTop:15}};function A({header:s,style:t,children:r}){return e.jsxs("div",{className:"rpt-box-pnl",style:t,children:[e.jsx("span",{children:s}),e.jsx("div",{children:r})]})}const F=s=>Object.keys(s).reduce((t,r)=>(t[r==null?void 0:r.toLowerCase()]=s==null?void 0:s[r],t),{}),ht="dd/MM/yyyy hh:mm a",k="dd/MM/yyyy";function xt(){const s=o.useContext(g),t=s.data.sectionHeaders||{};console.log(">>ProjectPsrReport/PsrSummarySection::","ctx",s);const r=m(s,"data.milestones",[]);let a=m(s,"data.project.startDateActual"),n=m(s,"data.project.endDateEst");a&&(a=u(new Date(a),k)),n&&(n=u(new Date(n),k));const{startDate:i,endDate:d}=(t==null?void 0:t.reportDateRange)||{},h=(p,l)=>parseFloat(p-l).toFixed(2);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{marginTop:"25px"},children:"Project Status Report"}),e.jsxs(f,{text:"Generated",style:{flex:1},children:[t.reportDate&&e.jsx("strong",{children:u(new Date(t.reportDate),ht)})," by ",t.reportOwner&&e.jsx("strong",{children:t.reportOwner})]}),e.jsx(f,{text:"Report Date Range",style:{flex:1},children:i&&d&&e.jsxs("strong",{children:[u(new Date(i),k)," - ",u(new Date(d),k)]})})]}),e.jsx("div",{children:e.jsx("img",{src:s.companyLogo,width:"300"})})]}),e.jsxs("div",{style:{marginTop:40,marginBottom:40,display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{style:{width:"400px"},children:[e.jsx(A,{header:"PROJECT INFORMATION",children:e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{marginRight:10,flex:1},children:[e.jsx(f,{text:"Client Name",children:e.jsx("strong",{children:t.clientName})}),e.jsx(f,{text:"Project Name",children:e.jsx("strong",{children:t.projectName})})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx(f,{text:"Client Contact",children:e.jsx("strong",{children:t.clientContact})}),e.jsx(f,{text:"MB Contact",children:e.jsx("strong",{children:t.projMgrName})})]})]})}),e.jsx(ut,{})]}),e.jsx("div",{style:{flex:1,marginRight:15,marginLeft:15},children:e.jsxs(A,{header:"MILESTONES",children:[e.jsxs("div",{children:[e.jsx(f,{text:"Project Commencement Date",children:e.jsx("strong",{children:a})}),e.jsx(f,{text:"Est Completion Date",children:e.jsx("strong",{children:n})})]}),e.jsx(jt,{milestones:r})]})}),!m(s,"data.hideTimes")&&e.jsx("div",{style:{width:"300px"},children:e.jsx(A,{header:"PROGRESS",children:e.jsxs("div",{children:[e.jsx(f,{text:"Total Hours in Period",children:e.jsx("strong",{children:I(m(s,"data.totals.totalPeriodIntervalMs"))})}),e.jsx(f,{text:"Total Hours to Date",children:e.jsx("strong",{children:I(m(s,"data.totals.totalIntervalMs"))})}),e.jsx(f,{text:"Total Estimated Hours",children:e.jsxs("strong",{children:[m(s,"data.totals.totalProjectEstimateHr",0)," hrs"]})}),e.jsx(f,{text:"Total Estimated Remaining",children:e.jsxs("strong",{title:`${m(s,"data.totals.totalRemHrEstimated",0)} - ${m(s,"data.totals.totalRemHrInProgress",0)}`,children:[h(m(s,"data.totals.totalRemHrEstimated",0),m(s,"data.totals.totalRemHrInProgress",0)),"hrs"]})})]})})})]})]})}function ut(){const{data:s}=o.useContext(g),{teamMembers:t=[],userMapping:r,hideTimes:a}=s;return e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"TEAM MEMBERS"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),!a&&e.jsxs(e.Fragment,{children:[e.jsx("th",{children:"Time Recorded"}),e.jsx("th",{children:"Total Time"})]})]})}),e.jsx("tbody",{children:t.map(n=>{var h,p,l;const d=F(r)[(h=n==null?void 0:n.userId)==null?void 0:h.toLowerCase()]||{};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("a",{href:`/member/${n.userId}`,children:d.fullname})}),!a&&e.jsxs(e.Fragment,{children:[e.jsx("td",{children:I((p=n.totals)==null?void 0:p.periodTotalMs)}),e.jsx("td",{children:I((l=n.totals)==null?void 0:l.projectTotalMs)})]})]},n.id)})})]})})}function jt({milestones:s}){return e.jsxs("table",{style:{width:"100%",marginTop:"20px"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Completed"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:s.map((t,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.completed?e.jsx(e.Fragment,{children:"  ✅"}):" "}),e.jsx("td",{children:t.name}),e.jsx("td",{className:"date-cell",children:u(new Date(t.due),"dd/MM/yyyy")})]},r))})]})}function I(s=0){const t=(s/1e3/60/60).toFixed(2);return`${pe.numberFormatter(t).toFormatted()} hrs`}const mt={root:{...ct,...pt,...lt,"& thead th":{textAlign:"left"},"& .algn-left":{textAlign:"left !important"},"& td.date-cell":{width:"100px",whiteSpace:"nowrap"},"& td.no-wrap":{whiteSpace:"nowrap"},"& td.pre-wrap":{whiteSpace:"pre-wrap"},"& td.w100":{width:"100px"},"& td.w200":{width:"200px"},"& .big-fnt":{fontSize:"large"}}};function yt(){const{data:s}=o.useContext(g),{activities:t=[],userMapping:r={},contactMapping:a={}}=s;return console.log(">>ProjectPsrReport/PsrSummaryActivities::","activities",t,a,r),e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"ACTIVITIES"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Subject"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsxs("th",{children:["Contact /",e.jsx("br",{}),"Team Member"]}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:t.map(n=>{var i,d;return console.log(">>ProjectPsrReport/PsrSummaryActivities::","activities",t),e.jsxs("tr",{children:[e.jsx("td",{className:"w200",children:e.jsx("a",{href:`/crm/activity/${n.id}`,children:n.subject})}),e.jsx("td",{className:"date-cell",children:n.when&&u(new Date(n.when),"dd/MM/yyyy")}),e.jsx("td",{className:"no-wrap",children:w(n.type)}),e.jsx("td",{children:w(n.status)}),e.jsxs("td",{className:"no-wrap",children:[(i=a[n.activityContactId])==null?void 0:i.firstName," /"," ",(d=r[n.activityTeamMemberId])==null?void 0:d.fullname]}),e.jsx("td",{className:"algn-left",children:n.details})]},n.id)})})]})})}function ft(){const[s,t]=o.useState({taskIdsByStatus:{},taskMapping:{},sprintMapping:{},hideTimes:!0}),{data:r}=o.useContext(g);o.useEffect(()=>{const{tasksLoading:h,inPeriodTasks:p={},taskMapping:l={},sprintMapping:c={},hideTimes:j}=r;if(h)return;const y={};Object.entries(p).map(([v,P])=>{const R=l[v]||{};Se(y,[R.status,v],P)}),t(v=>({...v,taskIdsByStatus:y,taskMapping:l,sprintMapping:c,hideTimes:j}))},[r]);const{COMPLETE:a,"IN PROGRESS":n,...i}=s.taskIdsByStatus;function d(h){return h?Object.entries(h).map(([p,l])=>{const c=F(s==null?void 0:s.taskMapping),j=F(s==null?void 0:s.sprintMapping),y=c[p]||{},v=j[y.taskSprintId]||{};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("a",{href:`/project/${y.projectId}/sprint/${y.taskSprintId}/tasks/${p}`,children:y.title})}),e.jsx("td",{className:"w100",children:v.name}),e.jsx("td",{children:y.status}),!s.hideTimes&&e.jsxs(e.Fragment,{children:[e.jsx("td",{children:se(l.total_time)}),e.jsx("td",{children:se(l.period_total_time)})]})]},p)}):null}return e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"TASKS UNDERTAKEN IN PERIOD"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Task Name"}),e.jsx("th",{children:"Stage"}),e.jsx("th",{children:"Status"}),!s.hideTimes&&e.jsxs(e.Fragment,{children:[e.jsx("th",{children:"Total Time"}),e.jsx("th",{children:"Time Recorded"})]})]})}),e.jsxs("tbody",{children:[d(a),d(n),Object.values(i).map(h=>d(h))]})]})})}function se(s=0){return`${(s/1e3/60/60).toFixed(2)}`}function gt(){const{data:s}=o.useContext(g),{nextPeriodScheds:t=[],taskMapping:r={},hideTimes:a}=s;return console.log(">>ProjectPsrReport/PsrSummaryNextPeriodScheds::","activities",t,r),e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"TASKS ASSIGNED FOR NEXT PERIOD"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Task Name"}),e.jsx("th",{children:"Date"}),!a&&e.jsx("th",{children:"Estimate"})]})}),e.jsx("tbody",{children:t.map(n=>{const i=r[n.taskId]||{};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("a",{href:`/project/${i.projectId}/sprint/${i.taskSprintId}/tasks/${n.taskId}`,children:i.title})}),e.jsx("td",{className:"date-cell",children:n.startTime&&u(new Date(n.startTime),"dd/MM/yyyy")}),!a&&e.jsx("td",{children:i.estimatedEffort&&`${i.estimatedEffort}`})]},n.id)})})]})})}function bt(){const{data:s}=o.useContext(g),t=s.commentaries||[];return e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"SUMMARY"}),e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{children:(t==null?void 0:t.length)>0?"Content":null})})}),e.jsx("tbody",{children:t.map(r=>e.jsx("tr",{children:e.jsx("td",{className:"w200 pre-wrap",children:r.details})},r.id))})]})})}function St({includeIntervals:s}){var p;const[t,r]=o.useState({intervalsByTask:{}}),{data:a}=o.useContext(g),{intervals:n,userMapping:i={},taskMapping:d={}}=a;o.useEffect(()=>{n&&r(l=>({...l,intervalsByTask:ve(n,"taskId")}))},[n]);const h=[];for(const l in t.intervalsByTask)h.push(e.jsx("tr",{children:e.jsx("td",{children:e.jsx("strong",{children:(p=d[l])==null?void 0:p.title})})},l)),Re(t.intervalsByTask[l]||[],"startedAt").forEach(c=>{var j;h.push(e.jsxs("tr",{children:[e.jsx("td",{children:(j=i[c.userId])==null?void 0:j.fullname}),e.jsx("td",{className:"date-cell",children:c.startedAt&&u(new Date(c.startedAt),"dd/MM/yyyy")}),e.jsx("td",{className:"date-cell",children:c.startedAt&&u(new Date(c.startedAt),"hh:mm")}),e.jsx("td",{className:"date-cell",children:c.stoppedAt&&u(new Date(c.stoppedAt),"hh:mm")}),s&&e.jsx("td",{className:"w200",children:vt(c.durationMs)}),e.jsx("td",{className:"algn-left",children:c.comment})]},c.id))});return n?e.jsx(S,{children:e.jsxs("table",{children:[e.jsx("caption",{children:"TASK INTERVALS"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Team Member"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Stopped"}),s&&e.jsx("th",{style:{color:"black"},children:"Hours"}),e.jsx("th",{children:"Comment"})]})}),e.jsx("tbody",{children:h})]})}):null}function vt(s=0){const t=(s/1e3/60/60).toFixed(2);return`${pe.numberFormatter(t).toFormatted()} hrs`}function Rt({filter:{projectId:s,startDate:t,endDate:r,userId:a,hideTimes:n,includeIntervals:i}}){const{data:d,loading:h,companyLogo:p}=Tt({projectId:s,startDate:t,endDate:r,userId:a,hideTimes:n,includeIntervals:i}),[l]=Te("project-setting",{withQueryState:!0});return console.log(">>ProjectPsrReport/PsrSummary::","data",d,n),e.jsxs(at,{loading:h,data:d,companyLogo:p,filters:{projectId:s,startDate:t,endDate:r,userId:a,hideTimes:n},report:{reportKey:`project-report::${s}::${Date.now()}`,type:"project-report",subType:"project-psr-report",contentType:"html",metadata:{styles:mt}},children:[e.jsx(xt,{}),e.jsx(bt,{}),e.jsx(ft,{}),e.jsx(St,{includeIntervals:i}),e.jsx(gt,{}),(l==null?void 0:l.psr)&&(l==null?void 0:l.activities)&&e.jsx(yt,{}),(l==null?void 0:l.psr)&&(l==null?void 0:l.notes)&&e.jsx(ot,{}),(l==null?void 0:l.psr)&&(l==null?void 0:l.issues)&&e.jsx(it,{}),(l==null?void 0:l.psr)&&(l==null?void 0:l.risks)&&e.jsx(dt,{}),e.jsx("br",{})]})}function Tt(s){const[t,r]=Y.useState(""),a=B(De`
      query PSR_SUMMARY_Q($filter: AWSJSON) {
        psr: nestedSearch(type: "reports/PsrSummary", filter: $filter) {
          metadata
        }
      }
    `,{variables:{filter:JSON.stringify(s)},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});console.log(">>ProjectPsrReport/PsrSummary::","psrQ",a);const n=o.useMemo(()=>({companyLogo:t,data:JSON.parse(m(a,"data.psr.metadata","{}")),loading:a.loading}),[a,t]);return console.log(">>ProjectPsrReport/PsrSummaryff::","res",n),Y.useEffect(()=>{(async()=>{var p,l;const d=await X.list("logo/logo");if(!((p=d==null?void 0:d[0])!=null&&p.key))return;const h=await X.get((l=d[0])==null?void 0:l.key);r(h)})()},[]),n.data&&(n.data.hideTimes=s.hideTimes),n}function Dt(s){return e.jsx(Ce,{...s,width:"15",height:"16",viewBox:"0 0 15 16",paths:["M2.5 7.6036C2.81198 7.19496 3.2192 6.67126 3.48176 6.38308C4.70877 5.03636 6.10093 4.25 7.8125 4.25C11.806 4.25 13.75 7.00764 13.75 10.5H12.5C12.5 7.62324 11.0032 5.5 7.8125 5.5C6.50553 5.5 5.41734 6.11466 4.40576 7.22494C4.1415 7.51498 3.6378 8.17652 3.29278 8.625H6.875V9.875H1.25V4.25H2.5V7.6036Z"]})}const Ct=Ve,wt=L({root:{display:"flex","& > button svg":{marginRight:5}}});function Pt({generator:s,onCancel:t,onReset:r,filter:a={}}){const n=wt(),[i,d]=o.useState({generating:!1,canGenerate:!1,saved:!1});o.useEffect(()=>{console.log(">>reports/ReportGenerator::","filters",a);const c=Object.values(a).some(j=>j===void 0);console.log(">>reports/ReportGenerator::","hasEmpty",c),d(j=>c===!j.canGenerate?j:{...j,canGenerate:!c})},[JSON.stringify(a)]),console.log(">>reports/ReportGenerator::","filter",a);const h=o.useCallback(()=>{t&&t(),r&&r()},[t,r]),p=o.useCallback(()=>{d(c=>({...c,generating:!0}))},[]),l=o.useCallback(()=>{d(c=>({...c,generating:!1})),r&&r()},[r]);return e.jsxs(x,{className:n.root,children:[!i.generating&&e.jsx(b,{variant:"contained",color:"primary",disabled:!i.canGenerate||i.saved,onClick:p,children:i.saved?"Generated ✔":e.jsxs(e.Fragment,{children:[e.jsx(q,{})," Generate Report"]})}),i.generating&&e.jsxs(e.Fragment,{children:[e.jsx(s,{filter:a}),e.jsx(x,{mr:1}),e.jsxs(b,{variant:"outlined",onClick:l,children:[e.jsx(Ct,{})," Reset"]})]}),e.jsx(x,{mr:1}),e.jsxs(b,{onClick:h,variant:"outlined",children:[e.jsx(Dt,{})," Cancel"]})]})}function Mt({type:s,keyFilter:t=null}){const r=o.useRef(null),[a,n]=o.useState({selectedReportId:null}),i=B(V`
      query GEN_RPT_LIST(
        $nextToken: String
        $type: String
        $keyFilter: ModelIDKeyConditionInput
      ) {
        list: geneneratedReportsByTypeRecordKey(
          nextToken: $nextToken
          type: $type
          reportKey: $keyFilter
          limit: 10
          sortDirection: DESC
        ) {
          nextToken
          items {
            id
            reportKey
            type
            subType
            date
            contentType
            recOwner
            filters
            createdAt
            updatedAt
          }
        }
      }
    `,{variables:{type:s,keyFilter:t},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),d=ze({...i,listPath:"list",maxLength:10});console.log(">>ProjectPsrReport/PsrList::","psrListQ",i);const h=m(i,"data.list.items",[]);console.log(">>reports/GeneratedReportList::","list",h);const p=o.useCallback(()=>{r.current.close()},[]),l=o.useCallback(c=>()=>{n(j=>({...j,selectedReportId:c})),r.current.open()},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(we,{data:h,loading:i.loading,rowProps:{style:{cursor:"pointer"}},onRowActionSelect:console.log,children:[e.jsx($,{dataId:"type",render:kt}),e.jsx(Pe,{dataId:"createdAt",label:"Generate Date",format:"dd/MM/yyyy"}),e.jsx($,{dataId:"recOwner",label:"Generated By",render:It}),e.jsx($,{label:"Action",dataId:"id",render:c=>e.jsxs(b,{variant:"outlined",onClick:l(c),children:[e.jsx(x,{component:Q,mr:1}),"Open"]})})]}),!i.loading&&e.jsx(Me,{onClick:d.more}),e.jsxs(ae,{variant:"dialog",ref:r,dialogProps:{maxWidth:"xl",fullWidth:!0},children:[e.jsx(le,{children:"Report"}),e.jsx(ie,{children:e.jsx(xe,{id:a.selectedReportId})}),e.jsx(oe,{children:e.jsxs(x,{p:2,display:"flex",justifyContent:"space-between",width:"100%",children:[e.jsx("div",{}),e.jsxs(x,{display:"flex",children:[e.jsx(b,{variant:"outlined",onClick:()=>{window.open(`/html-viewer/${a.selectedReportId}`,"_blank","noopener")},children:"Open In New Tab"}),e.jsx(x,{mr:1}),e.jsx(b,{variant:"outlined",onClick:p,children:"Cancel"})]})]})})]})]})}function kt(s,t){var n,i;const r=t!=null&&t.filters?new Date((n=JSON.parse(t==null?void 0:t.filters))==null?void 0:n.startDate):null,a=t!=null&&t.filters?new Date((i=JSON.parse(t==null?void 0:t.filters))==null?void 0:i.endDate):null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:w(t.type)}),e.jsxs(x,{fontSize:"smaller",color:"darkgrey",children:[r?u(r,"dd/MM/yyyy"):""," -"," ",a?u(a,"dd/MM/yyyy"):""]})]})}function It(s){return s?e.jsx($e,{id:s}):null}function Et({subTypes:s={}}){const[t,r]=de({rptSubType:G}),a=o.useCallback(i=>{const d=i.currentTarget.value;r({rptSubType:d})},[r]),n=o.useCallback(()=>{r({rptSubType:void 0})},[r]);return e.jsxs(x,{children:[e.jsx(x,{maxWidth:"300px",children:e.jsx(ce,{fullWidth:!0,label:"Generate New Report",value:t.rptSubType,onChange:a,options:Object.entries(s).map(([i,d])=>({value:i,text:d.label}))})}),e.jsx(x,{mt:1}),t.rptSubType&&e.jsx(ke,{children:e.jsx(x,{p:2,children:s[t.rptSubType].render({onCancel:n})})})]})}function Nt(s){const t=new Date;switch(s){case"this-week":return{startDate:Le(t,{weekStartsOn:1}),endDate:Be(t,{weekStartsOn:1})};case"this-month":return{startDate:He(t),endDate:_e(t)};case"this-quarter":return{startDate:Ne(t),endDate:Oe(t)};case"this-year":return{startDate:Ge(t),endDate:Fe(t)}}}function Ot({projectId:s,onCancel:t}){const[r,a]=de({psrUid:G,psrSd:ee,psrEd:ee,psrDr:G,psrHideTimes:te,psrIncludeIntervals:te}),{globalState:{authUser:n}}=Ie();o.useEffect(()=>{if(!r.psrDr)return;const l=Nt(r.psrDr);a({psrSd:l.startDate,psrEd:l.endDate,psrHideTimes:!1,psrIncludeIntervals:!1})},[r.psrDr,a]);const i=o.useMemo(()=>({startDate:r.psrSd,endDate:r.psrEd}),[r.psrSd,r.psrEd]);console.log(">>ProjectPsrReport/index::","filter",i);const d=o.useCallback(l=>{const c=l.currentTarget.value;a({psrDr:c})},[a]),h=o.useCallback(l=>c=>{a({[l]:c})},[a]),p=o.useCallback(()=>{a({psrDr:void 0,psrSd:void 0,psrEd:void 0,psrHideTimes:!1,psrIncludeIntervals:!1})},[a]);return e.jsxs("div",{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",minHeight:"56px",children:[e.jsx(Ee,{text:"Date Range to Filter",width:"200px",mr:2,children:e.jsx(ce,{fullWidth:!0,variant:"slim-boxed",value:r.psrDr,disableClearable:!0,onChange:d,options:["this-week","this-month","this-quarter","this-year"].map(l=>({value:l,text:w(l)}))})}),r.psrDr&&e.jsxs(x,{display:"flex",children:[e.jsx(x,{mr:2,width:"160px",children:e.jsx(re,{label:"Start Date",value:r.psrSd,onChange:h("psrSd")})}),e.jsx(x,{mr:2,width:"160px",children:e.jsx(re,{label:"End Date",value:r.psrEd,onChange:h("psrEd")})}),e.jsx(x,{m2:2,marginTop:"10px",children:e.jsx(Z,{checked:r.psrHideTimes,label:"Hide Times",onChange:()=>{a({psrHideTimes:!r.psrHideTimes})},value:r.psrHideTimes})}),e.jsx(x,{m2:2,marginTop:"10px",children:e.jsx(Z,{checked:r.psrIncludeIntervals,label:"Include Intervals",onChange:()=>{a({psrIncludeIntervals:!r.psrIncludeIntervals})},value:r.psrIncludeIntervals})})]})]}),e.jsx(x,{mt:3,children:e.jsx(Pt,{filter:{...i,projectId:s,userId:n.id,hideTimes:r.psrHideTimes,includeIntervals:r.psrIncludeIntervals},generator:Rt,onCancel:t,onReset:p})})]})}function or({projectId:s}){return e.jsxs(x,{children:[e.jsx(Et,{subTypes:{"project-psr":{label:"Project PSR Report",render(t){return e.jsx(Ot,{projectId:s,...t})}}}}),e.jsx(x,{mt:1}),e.jsx(Mt,{type:"project-report",keyFilter:{beginsWith:`project-report::${s}`}})]})}export{or as default};
