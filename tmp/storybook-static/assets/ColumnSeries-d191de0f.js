import{c as K,d as Z,R as V}from"./AxisRendererY-0d50d85b.js";import{e as b,v as z,P as G,i as q,b as w,m as S,f as J,d as Q,g as B,h as W}from"./EmptyFiltersWarning-efcfc65c.js";import{b4 as H}from"./papaparse.min-b66e70e7.js";class F extends K{constructor(){super(...arguments),Object.defineProperty(this,"_ph",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pw",{enumerable:!0,configurable:!0,writable:!0,value:0})}_makeGraphics(t,e){return this.makeColumn(e,t)}_makeFieldNames(){super._makeFieldNames();const t=this.get("xAxis"),e=this.get("yAxis"),i="CategoryAxis",s="ValueAxis";t.isType(i)&&(this.get("openCategoryXField")||(this._xOpenField=this._xField)),t.isType(s)&&(this.get("openValueXField")||(this._xOpenField=this._xField)),e.isType(i)&&(this.get("openCategoryYField")||(this._yOpenField=this._yField)),e.isType(s)&&(this.get("openValueYField")||(this._yOpenField=this._yField))}_prepareChildren(){super._prepareChildren();const t=this.get("xAxis"),e=this.get("yAxis"),i=this.dataItems.length,s=Math.max(0,this.startIndex()-2),a=Math.min(this.endIndex()+2,i-1);if(t.inited&&e.inited)for(let o=s;o<=a;o++){let n=this.dataItems[o];this._createGraphics(n)}}_updateChildren(){const t=this.chart;t&&(this._ph=t.plotContainer.height(),this._pw=t.plotContainer.width());const e=this.get("xAxis"),i=this.get("yAxis"),s=this.get("baseAxis"),a=this.columns.template;this.isDirty("fill")&&a.get("fill")==null&&a.set("fill",this.get("fill")),this.isDirty("stroke")&&a.get("stroke")==null&&a.set("stroke",this.get("stroke"));let o=0,n=0,l=0;b(s.series,u=>{if(u instanceof F){const m=u.get("stacked");m&&l==0&&n++,!m&&u.get("clustered")&&n++}u===this&&(o=n-1),l++}),this.get("clustered")||(o=0,n=1),n===0&&(n=1,o=0);const d=e.get("renderer"),g=i.get("renderer"),r="cellStartLocation",h="cellEndLocation",p=d.get(r,0),P=d.get(h,1),f=g.get(r,0),c=g.get(h,1);if(this._aLocationX0=p+o/n*(P-p),this._aLocationX1=p+(o+1)/n*(P-p),this._aLocationY0=f+o/n*(c-f),this._aLocationY1=f+(o+1)/n*(c-f),e.inited&&i.inited){if(this._axesDirty||this._valuesDirty||this._stackDirty||this.isDirty("vcx")||this.isDirty("vcy")||this._sizeDirty){const u=this.dataItems.length;let m=Math.max(0,this.startIndex()-2),k=Math.min(this.endIndex()+2,u-1);for(let x=0;x<m;x++)this._toggleColumn(this.dataItems[x],!1);let L=this.dataItems[m];for(let x=m;x<=k;x++){let T=this.dataItems[x];if(T.get("valueX")!=null&&T.get("valueY")!=null){if(L=T,x>0&&m>0)for(let M=x-1;M>=0;M--){let _=this.dataItems[M];if(_.get("valueX")!=null&&_.get("valueY")!=null){L=_;break}}break}else this._toggleColumn(T,!1)}for(let x=m;x<=k;x++){let T=this.dataItems[x];this._updateGraphics(T,L),T.get("valueX")!=null&&T.get("valueY")!=null&&(L=T)}for(let x=k+1;x<u;x++)this._toggleColumn(this.dataItems[x],!1)}}else this._skipped=!0;this.updateLegendMarker(this.get("tooltipDataItem")),super._updateChildren()}_createGraphics(t){let e=t.get("graphics");if(!e){e=this._makeGraphics(this.columns,t),t.set("graphics",e),e._setDataItem(t);const i=t.get("legendDataItem");if(i){const a=i.get("markerRectangle");if(a){const o=a.states.lookup("default");b(z,n=>{const l=e.get(n,this.get(n));a.set(n,l),o.set(n,l)})}}let s=t.get("rangeGraphics");s&&b(s,a=>{a.dispose()}),s=[],t.setRaw("rangeGraphics",s),this.axisRanges.each(a=>{const o=a.container,n=this._makeGraphics(a.columns,t);s&&s.push(n),n.setPrivate("list",a.columns),o.children.push(n)})}}createAxisRange(t){return b(this.dataItems,e=>{const i=e.get("graphics");i&&(i.dispose(),e.set("graphics",void 0))}),super.createAxisRange(t)}_updateGraphics(t,e){let i=t.get("graphics");const s=this._xField,a=this._yField,o=t.get(s),n=t.get(a);if(o!=null&&n!=null){const l=this._xOpenField,d=this._yOpenField,g=this.get("locationX",t.get("locationX",.5)),r=this.get("locationY",t.get("locationY",.5)),h=this.get("openLocationX",t.get("openLocationX",g)),p=this.get("openLocationY",t.get("openLocationY",r)),P=i.get("width"),f=i.get("height"),c=this.get("stacked"),u=this.get("xAxis"),m=this.get("yAxis"),k=this.get("baseAxis"),L=u.get("start"),x=u.get("end"),T=m.get("start"),M=m.get("end");let _,C,D,A,X=this.get("vcy",1),Y=this.get("vcx",1),N=!1,R=!1;if(m.isType("CategoryAxis")&&u.isType("CategoryAxis")){let I=this._aLocationX0+h-.5,v=this._aLocationX1+g-.5;if(P instanceof G){let y=(v-I)*(1-P.value)/2;I+=y,v-=y}if(_=u.getDataItemPositionX(t,l,I,Y),C=u.getDataItemPositionX(t,s,v,Y),I=this._aLocationY0+p-.5,v=this._aLocationY1+r-.5,f instanceof G){let y=(v-I)*(1-f.value)/2;I+=y,v-=y}D=m.getDataItemPositionY(t,d,I,X),A=m.getDataItemPositionY(t,a,v,X),t.setRaw("point",{x:_+(C-_)/2,y:D+(A-D)/2})}else if(u===k){let I=this._aLocationX0+h-.5,v=this._aLocationX1+g-.5;if(P instanceof G){let y=(v-I)*(1-P.value)/2;I+=y,v-=y}if(_=u.getDataItemPositionX(t,l,I,Y),C=u.getDataItemPositionX(t,s,v,Y),D=m.getDataItemPositionY(t,a,r,X),this._yOpenField!==this._yField)A=m.getDataItemPositionY(t,d,p,X);else if(c){let y=t.get("stackToItemY");y?A=m.getDataItemPositionY(y,a,p,y.component.get("vcy")):A=m.basePosition()}else A=m.basePosition();t.setRaw("point",{x:_+(C-_)/2,y:D}),R=!0}else if(m===k){let I=this._aLocationY0+p-.5,v=this._aLocationY1+r-.5;if(f instanceof G){let y=(v-I)*(1-f.value)/2;I+=y,v-=y}if(D=m.getDataItemPositionY(t,d,I,X),A=m.getDataItemPositionY(t,a,v,X),C=u.getDataItemPositionX(t,s,g,Y),this._xOpenField!==this._xField)_=u.getDataItemPositionX(t,l,h,Y);else if(c){let y=t.get("stackToItemX");y?_=u.getDataItemPositionX(y,s,h,y.component.get("vcx")):_=u.basePosition()}else _=u.basePosition();N=!0,t.setRaw("point",{x:C,y:D+(A-D)/2})}this._updateSeriesGraphics(t,i,_,C,D,A,N,R),_<L&&C<L||_>x&&C>x||D<T&&A<=T||D>=M&&A>M||q(_)||q(D)?this._toggleColumn(t,!1):this._toggleColumn(t,!0);let E=t.get("rangeGraphics");E&&b(E,I=>{this._updateSeriesGraphics(t,I,_,C,D,A,N,R)}),this._applyGraphicsStates(t,e)}}_updateSeriesGraphics(t,e,i,s,a,o,n,l){const d=e.get("width"),g=e.get("height"),r=e.get("maxWidth"),h=e.get("maxHeight"),p=this.getPoint(i,a),P=this.getPoint(s,o),f=t.get("point");if(f){const c=this.getPoint(f.x,f.y);f.x=c.x+this._x,f.y=c.y+this._y}if(i=p.x,s=P.x,a=p.y,o=P.y,w(d)){const c=(s-i-d)/2;i+=c,s-=c}if(w(r)&&r<Math.abs(s-i)){const c=(s-i-r)/2;i+=c,s-=c}if(w(g)){const c=(o-a-g)/2;a+=c,o-=c}if(w(h)&&h<Math.abs(o-a)){const c=(o-a-h)/2;a+=c,o-=c}this.get("adjustBulletPosition")&&(n&&(s=Math.min(Math.max(0,s),this._pw),i=Math.min(Math.max(0,i),this._pw)),l&&(a=Math.min(Math.max(0,a),this._ph),o=Math.min(Math.max(0,o),this._ph))),t.setRaw("left",i),t.setRaw("right",s),t.setRaw("top",a),t.setRaw("bottom",o),e.setPrivate("width",s-i),e.setPrivate("height",o-a),e.set("x",i),e.set("y",o-(o-a))}_handleDataSetChange(){super._handleDataSetChange(),b(this._dataItems,t=>{this._toggleColumn(t,!1)})}_applyGraphicsStates(t,e){const i=t.get("graphics"),s=i.states.lookup("dropFromOpen"),a=i.states.lookup("riseFromOpen"),o=i.states.lookup("dropFromPrevious"),n=i.states.lookup("riseFromPrevious");if(s||o||a||n){const l=this.get("xAxis"),d=this.get("yAxis"),g=this.get("baseAxis");let r,h,p;g===l&&d.isType("ValueAxis")?(r=t.get(this._yOpenField),h=t.get(this._yField),p=e.get(this._yField)):g===d&&l.isType("ValueAxis")&&(r=t.get(this._xOpenField),h=t.get(this._xField),p=e.get(this._xField)),w(r)&&w(h)&&(h<r?s&&s.apply():a&&a.apply(),w(p)&&(h<p?o&&o.apply():n&&n.apply()))}}disposeDataItem(t){super.disposeDataItem(t);const e=t.get("graphics");e&&(this.columns.removeValue(e),e.dispose());const i=t.get("rangeGraphics");i&&b(i,s=>{const a=s.getPrivate("list");a&&a.removeValue(s),s.dispose()})}hideDataItem(t,e){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return H(this,void 0,void 0,function*(){const s=[i.hideDataItem.call(this,t,e)],a=t.get("graphics");a&&s.push(a.hide(e));const o=t.get("rangeGraphics");o&&b(o,n=>{s.push(n.hide(e))}),yield Promise.all(s)})}_toggleColumn(t,e){const i=t.get("graphics");i&&i.setPrivate("visible",e);const s=t.get("rangeGraphics");s&&b(s,o=>{o.setPrivate("visible",e)});const a=t.bullets;a&&b(a,o=>{o.setPrivate("hidden",!e)})}showDataItem(t,e){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return H(this,void 0,void 0,function*(){const s=[i.showDataItem.call(this,t,e)],a=t.get("graphics");a&&s.push(a.show(e));const o=t.get("rangeGraphics");o&&b(o,n=>{s.push(n.show(e))}),yield Promise.all(s)})}updateLegendMarker(t){let e=this.get("legendDataItem");if(this.get("useLastColorForLegendMarker")&&!t){const i=this.dataItems[this.endIndex()-1];i&&(t=i)}if(e){let i=this.columns.template;if(t){let a=t.get("graphics");a&&(i=a)}const s=e.get("markerRectangle");if(s&&!e.get("itemContainer").get("disabled")){const a=s.states.lookup("default");b(z,o=>{const n=i.get(o,this.get(o));s.set(o,n),a.set(o,n)})}}}_getTooltipTarget(t){if(this.get("seriesTooltipTarget")=="bullet")return super._getTooltipTarget(t);let e=t.get("graphics");return e||this}}Object.defineProperty(F,"className",{enumerable:!0,configurable:!0,writable:!0,value:"BaseColumnSeries"});Object.defineProperty(F,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:K.classNames.concat([F.className])});class O extends Z{constructor(){super(...arguments),Object.defineProperty(this,"_frequency",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"_itemMap",{enumerable:!0,configurable:!0,writable:!0,value:{}})}_afterNew(){this._settings.themeTags=S(this._settings.themeTags,["axis"]),this.fields.push("category"),this.setPrivateRaw("name","category"),this.addTag("category"),super._afterNew()}_prepareChildren(){super._prepareChildren();const t=this.dataItems.length;let e=0;this._valuesDirty&&(this._itemMap={},b(this.dataItems,i=>{i.setRaw("index",e),this._itemMap[i.get("category")]=i,e++}),this.setPrivateRaw("maxZoomFactor",t)),this.setPrivateRaw("startIndex",Math.max(Math.round(this.get("start",0)*t),0)),this.setPrivateRaw("endIndex",Math.min(Math.round(this.get("end",1)*t),t)),(this._sizeDirty||this._valuesDirty||this.isDirty("start")||this.isDirty("end")||this.isPrivateDirty("endIndex")||this.isPrivateDirty("startIndex")||this.isPrivateDirty("width")||this.isPrivateDirty("height"))&&this.dataItems.length>0&&(this._handleRangeChange(),this._prepareAxisItems(),this._updateAxisRanges())}_handleRangeChange(){b(this.series,t=>{let e=this.dataItems[this.startIndex()].get("category"),i=this.dataItems[this.endIndex()-1].get("category"),s=t.get("baseAxis"),a=t.get("xAxis"),o=t.get("yAxis");if(a instanceof O&&o instanceof O)t._markDirtyAxes();else if(s===this){let n,l,d=o;if(a===s?(t.get("categoryXField")&&(n="categoryX"),t.get("openCategoryXField")&&(l="openCategoryX")):o===s&&(t.get("categoryYField")&&(n="categoryY"),t.get("openCategoryYField")&&(l="openCategoryY"),d=a),d.className=="ValueAxis"&&(n||l)){let g,r;for(let f=0,c=t.dataItems.length;f<c;f++){let u=t.dataItems[f];if(n&&u.get(n)===e){g=u;break}if(l&&u.get(l)===e){g=u;break}}for(let f=t.dataItems.length-1;f>=0;f--){let c=t.dataItems[f];if(n&&c.get(n)===i){r=c;break}if(l&&c.get(l)===i){r=c;break}}let h=0,p=t.dataItems.length;g&&(h=t.dataItems.indexOf(g)),r&&(p=t.dataItems.indexOf(r)+1),t.setPrivate("startIndex",h),t.setPrivate("endIndex",p);let P=!1;for(let f=h;f<p;f++){const c=t.dataItems[f];if(b(t.__valueXShowFields,u=>{c.get(u)!=null&&(P=!0)}),b(t.__valueYShowFields,u=>{c.get(u)!=null&&(P=!0)}),P)break}t.setPrivate("outOfSelection",!P)}t._markDirtyAxes()}})}_prepareAxisItems(){var t;const e=this.get("renderer"),i=this.dataItems.length;let s=this.startIndex();s>0&&s--;let a=this.endIndex();a<i&&a++;const o=e.get("minorLabelsEnabled"),n=e.get("minorGridEnabled",o);let l=e.axisLength()/Math.max(e.get("minGridDistance"),1),d=Math.max(1,Math.min(i,Math.ceil((a-s)/l)));s=Math.floor(s/d)*d,this._frequency=d;for(let r=0;r<i;r++)this._toggleDataItem(this.dataItems[r],!1);let g=this.dataItems[s].get("index",0);for(let r=s;r<a;r=r+d){let h=this.dataItems[r];this._createAssets(h,[]),this._toggleDataItem(h,!0);let p=d;n&&(p=1),this._prepareDataItem(h,g,p),g++}if(e.get("minorGridEnabled"))for(let r=s;r<a;r++){let h=this.dataItems[r];r%d!=0&&(this._createAssets(h,["minor"],!0),this._toggleDataItem(h,!0),this._prepareDataItem(h,0,1),o||(t=h.get("label"))===null||t===void 0||t.setPrivate("visible",!1))}this._updateGhost()}_prepareDataItem(t,e,i){let s=this.get("renderer"),a=t.get("categoryLocation",0),o=t.get("endCategoryLocation",1),n=t.get("index");w(n)||(n=this.categoryToIndex(t.get("category")));let l=this.indexToPosition(n,a),d=t.get("endCategory"),g;d?(g=this.categoryToIndex(d),w(g)||(g=n)):g=n;let r=this.indexToPosition(g,o),h,p;t.get("isRange")?h=g:h=n+this._frequency-1,p=this.indexToPosition(h,o),s.updateLabel(t.get("label"),l,r,i),s.updateGrid(t.get("grid"),l,r),s.updateTick(t.get("tick"),l,r,i),s.updateFill(t.get("axisFill"),l,p),this._processBullet(t),s.updateBullet(t.get("bullet"),l,r);const P=this.get("fillRule");P&&P(t,e)}startIndex(){let t=this.dataItems.length;return Math.min(Math.max(this.getPrivate("startIndex",0),0),t-1)}endIndex(){let t=this.dataItems.length;return Math.max(1,Math.min(this.getPrivate("endIndex",t),t))}baseValue(){}basePosition(){return 0}getX(t){let e=this._itemMap[t];return e?this._settings.renderer.positionToCoordinate(this.indexToPosition(e.get("index",0))):NaN}getY(t){let e=this._itemMap[t];return e?this._settings.renderer.positionToCoordinate(this.indexToPosition(e.get("index",0))):NaN}getDataItemPositionX(t,e,i,s){const a=t.get(e),o=this._itemMap[a];return o?this.indexToPosition(o.get("index",0),i):NaN}getDataItemCoordinateX(t,e,i,s){return this._settings.renderer.positionToCoordinate(this.getDataItemPositionX(t,e,i,s))}getDataItemPositionY(t,e,i,s){const a=t.get(e),o=this._itemMap[a];return o?this.indexToPosition(o.get("index",0),i):NaN}getDataItemCoordinateY(t,e,i,s){return this._settings.renderer.positionToCoordinate(this.getDataItemPositionY(t,e,i,s))}indexToPosition(t,e){w(e)||(e=.5);let i=this.dataItems.length,s=this.get("startLocation",0),a=this.get("endLocation",1);i-=s,i-=1-a;let o=(t+e-s)/i,n=this.dataItems[t];return n&&(o+=n.get("deltaPosition",0)),o}categoryToIndex(t){let e=this._itemMap[t];return e?e.get("index"):NaN}dataItemToPosition(t){return this.indexToPosition(t.get("index"))}roundAxisPosition(t,e){return t+=(.5-e)/this.dataItems.length,this.indexToPosition(this.axisPositionToIndex(t),e)}axisPositionToIndex(t){let e=this.dataItems.length;return J(Math.floor(t*e),0,e-1)}getTooltipText(t,e){const i=this.dataItems[this.axisPositionToIndex(t)];if(i){const s=i.get("label");if(s)return Q(s,this.get("tooltipText",""))}}_updateTooltipText(t,e){t._setDataItem(this.dataItems[this.axisPositionToIndex(e)]),t.label.text.markDirtyText()}getSeriesItem(t,e){if(this.dataItems.length>0){let i=this.getPrivate("name")+this.get("renderer").getPrivate("letter"),s=this.axisPositionToIndex(e),a=t.dataItems[s],o=this.dataItems[s],n=o.get("category");if(a&&o&&a.get(i)===n)return a;for(let l=0,d=t.dataItems.length;l<d;l++){let g=t.dataItems[l];if(g.get(i)===n)return g}}}zoomToIndexes(t,e,i){let s=this.dataItems.length;this.zoom(t/s,e/s,i)}zoomToCategories(t,e,i){this.zoomToIndexes(this.categoryToIndex(t),this.categoryToIndex(e)+1,i)}getCellWidthPosition(){return this._frequency/this.dataItems.length/(this.get("end",1)-this.get("start",0))}}Object.defineProperty(O,"className",{enumerable:!0,configurable:!0,writable:!0,value:"CategoryAxis"});Object.defineProperty(O,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Z.classNames.concat([O.className])});class j extends F{constructor(){super(...arguments),Object.defineProperty(this,"columns",{enumerable:!0,configurable:!0,writable:!0,value:new B(W.new({}),()=>V._new(this._root,{position:"absolute",themeTags:S(this.columns.template.get("themeTags",[]),["series","column"])},[this.columns.template]))})}makeColumn(t,e){const i=this.mainContainer.children.push(e.make());return i._setDataItem(t),e.push(i),i}_processAxisRange(t){super._processAxisRange(t),t.columns=new B(W.new({}),()=>V._new(this._root,{position:"absolute",themeTags:S(t.columns.template.get("themeTags",[]),["series","column"])},[this.columns.template,t.columns.template]))}}Object.defineProperty(j,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ColumnSeries"});Object.defineProperty(j,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:F.classNames.concat([j.className])});export{O as C,j as a};
