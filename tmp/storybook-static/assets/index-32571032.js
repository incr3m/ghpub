import{j as t}from"./TransitionGroupContext-9d36972e.js";import{r as j,R as B}from"./index-f1f749bf.js";import{u as A,f as Q}from"./index-bcfaa842.js";import{v as W,B as n,T as u,x as q,y as H,z as _,D as K,E as X,G as Z,H as tt,J as y,K as et,N as it,O as d,Q as st,R as rt,i as ot,w as h,U as nt}from"./papaparse.min-b66e70e7.js";import{f as at}from"./find-8750f979.js";import{L as ct,i as lt,d as dt,C as pt}from"./pick-dba65392.js";import{A as M,S as mt,a as ut,b as xt,d as ft,D as ht,c as jt,e as yt,f as vt,g as bt,h as It,i as At}from"./SyncEagleDevTool-4c34bdb8.js";import{b as Ct,d as St}from"./Play-87fed129.js";import{d as wt}from"./debounce-213cd46f.js";import{u as Tt}from"./react-router-19e5b27c.js";import{B as gt}from"./Button-352c3435.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./index-96c5f47c.js";import"./isNativeReflectConstruct-05c29d01.js";import"./_arrayIncludes-2cfb33ae.js";import"./_baseForOwn-9b89c4b6.js";import"./isPlainObject-07477f89.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./index.esm-bf21a293.js";import"./index-18188c67.js";import"./index-61adb48a.js";import"./LocalizationProvider-a287304f.js";import"./filter-f99df4e5.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./SelectEsModelInput-d580a9f7.js";import"./Link-c687dc07.js";import"./react-router-dom-60ea8218.js";import"./tiny-invariant-dd7d57d2.js";import"./useIncludeFieldNames-35a180a9.js";import"./Save-b67fa0ac.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";import"./uniq-0d482d7b.js";import"./zod-575fe4a8.js";import"./index-ce960f89.js";import"./userGroups-edff3f7b.js";import"./index-f70ce446.js";import"./searchUsers-04324aeb.js";import"./useFetchMore-be228481.js";import"./useTagSearch-f4fcfbe9.js";import"./Skeleton-cd6f071e.js";import"./cloneDeep-91467704.js";const _t={pending:{icon:yt,color:"#697D92"},inprogress:{icon:vt,color:"#FF9F4B"},done:{icon:St,color:"#1AE970"},missed:{icon:bt,color:"#FA126C"}},Ee=({showButton:i=!0,activeOnly:r})=>{const{contactId:o,opportunityId:c,projectId:p,userId:x,companyId:f}=Tt(),{compact:a}=A("ACTIVITY_TABLE_COMPACT").value,{project:v,source:N,contactEmail:P,contactNumber:D}=A("ACTIVITY_TABLE_COLUMNS").value,[l,m]=W({search:h,locationId:h,actId:h,userId:h,statusId:h,status:h}),[C,S]=j.useState(),[R,w]=j.useState(!1);B.useEffect(()=>{r&&m({status:"unactioned"})},[]);const{activities:b,loading:E,more:$,refetch:F}=M.useListActivities({qParams:l,activityProjectId:p,activityOpportunityId:c,activityContactId:o,userId:x,companyId:f});j.useEffect(()=>{if(l.actId&&!T.form){const e=at(b,s=>(s==null?void 0:s.id)===l.actId);e&&(w(!0),S(e))}},[l.actId,b]);const V=wt(e=>{m({search:e})},500),[T,I]=j.useState({form:!1,viewMode:!1}),J=async e=>{await M.deleteActivity(e),F()},k=e=>{m({actId:e==null?void 0:e.id}),S(e),I(s=>({...s,form:!0}))},Y=e=>{m({actId:e==null?void 0:e.id}),S(e),w(!0)},L=j.useMemo(()=>{let{...e}=C||{};if(e!=null&&e.attributes){const s=e.attributes.includes("\\")?JSON.parse(JSON.parse(e.attributes)):JSON.parse(e.attributes);e={...e,...s}}return{...C?e:{activityCompanyId:f,status:"pending",__typename:"Activity"}}},[C,f]),g=A("DEVELOPER_TOOLS").value,{TextFieldClear:z,ClearVisibilityRuleSx:U,isValueUndefined:G}=nt(),O=B.useRef();return t.jsxs(n,{children:[t.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3},children:[t.jsx(u,{variant:"h1",sx:{textTransform:"uppercase",fontSize:20,fontWeight:"bold"},children:"Activities"}),t.jsxs(q,{direction:"row",columnGap:1,children:[i&&t.jsx(gt,{color:"primary",variant:"contained",sx:{height:"38px"},startIcon:t.jsx(ct,{}),onClick:()=>{m({actId:void 0}),I(e=>({...e,form:!0}))},children:"Add Activity"},"add-btn"),t.jsx(H,{name:"CRM.CrmActivities.ActivityList.ActionButtons",slotProps:{activities:b},children:()=>null})]})]}),(g==null?void 0:g.eagleAPISyncButton)&&t.jsx(n,{mb:2,children:t.jsx(mt,{isFieldsRemoved:!0})}),t.jsx(ut,{open:R,handleClose:()=>w(!1),data:L}),t.jsx(xt,{contactId:o,formOnProject:!!p,projectId:p,id:l.actId,open:T.form,viewMode:T.viewMode,loading:status==="loading",handleClose:()=>{I(e=>({...e,form:!1,viewMode:!1}))},handleSubmit:()=>{I(e=>({...e,form:!1}))},initialValues:L},l.actId??"new"),t.jsx(n,{sx:{mb:"32px",display:"flex",justifyContent:"space-between"},children:t.jsxs(n,{display:"flex",children:[t.jsx(_,{mr:1,width:"300px",mb:2,children:t.jsx(K,{label:"Job Name",tooltip:`
Type in keywords for:
 • Activity subject
 • ${X("Project")} name
                `.trim(),placeholder:"Enter text...",onChange:e=>V(e.target.value),textFieldProps:{endAdornment:G(l==null?void 0:l.search)?void 0:t.jsx(z,{clearFn:()=>{m({search:""}),O.current.value=""}}),sx:{...U},inputProps:{ref:O}}})}),t.jsx(n,{mr:1,width:"200px",children:t.jsx(_,{children:t.jsx(Z,{fullWidth:!0,variant:"medium",value:l.status,label:"Status",iconStyles:{marginTop:"0px"},icon:tt,onChange:e=>{const s=e.currentTarget.value;m({status:s})},options:["unactioned","pending","inProgress","done","missed"].map(e=>({value:e,text:y(e)}))})})},"status-filter"),!x&&t.jsx(_,{mr:1,width:"300px",mb:2,children:t.jsx(et,{icon:ft,iconStyles:{marginTop:"0px"},variant:"medium",model:"User",label:"Team Member",fullWidth:!0,value:l.userId,onChange:e=>{const s=e.currentTarget.value;m({userId:s})},query:lt})})]})}),t.jsx(n,{sx:{fontSize:a?12:16},children:t.jsxs(it,{loading:E,data:b,children:[t.jsx(d,{width:a?"200px":"300px",dataId:"type",label:"Type",render:(e,s)=>t.jsx(Rt,{type:e,record:s,viewActivity:()=>Y(s),compact:a})}),N.show&&v.show&&t.jsx(d,{width:"400px",dataId:"sourceAndJob",label:"Source & Job",render:Dt}),t.jsx(st,{width:a?"200px":"650px",dataId:"subject",label:"Subject"}),t.jsx(d,{width:a?"250px":"375px",dataId:"contact",label:"Contact",render:Mt}),P.show&&t.jsx(d,{width:"400px",dataId:"contactEmail",label:"Contact Email",render:Nt}),D.show&&t.jsx(d,{width:"200px",dataId:"contactNumber",label:"Contact Number",render:Pt}),t.jsx(d,{width:a?"225px":"375px",dataId:"teamMember",label:"Team Member",render:Bt}),t.jsx(d,{width:a?"160px":"250px",dataId:"when",label:"Date",render:e=>t.jsx(Ot,{date:e,compact:a})}),t.jsx(d,{width:a?"120px":"140px",dataId:"status",label:"Status",render:e=>t.jsx(Lt,{status:e,compact:a})}),t.jsx(d,{width:"120px",dataId:"id",label:"Actions",render:(e,s)=>t.jsx(Et,{id:e,data:s,actions:{handleDeleteActivity:J,handleEditActivity:k}})})]})}),!E&&t.jsx(rt,{onClick:$})]})};function Et(i){const{id:r,data:o,actions:c}=i;return t.jsxs(t.Fragment,{children:[t.jsx(ht,{tooltip:"Delete activity",onDelete:()=>c.handleDeleteActivity(r),IconButtonProps:{sx:{border:"none"}}}),t.jsx(ot,{"aria-label":"delete",onClick:()=>c.handleEditActivity(o),children:t.jsx(dt,{})})]})}function Lt(i){const{status:r,compact:o}=i,{icon:c,color:p}=_t[r==null?void 0:r.toLowerCase()]||{},x=o?12:16;return t.jsxs(n,{display:"flex",alignItems:"center",color:p,children:[t.jsx(n,{mr:1,component:"span",color:p,sx:{transform:"translateY(3px)"},children:c&&t.jsx(c,{})}),t.jsx(u,{variant:"caption",sx:{fontSize:x},children:y(r)})]})}function Ot(i){const{date:r,compact:o}=i,c=o?12:16;return t.jsxs(n,{display:"flex",alignItems:"center",children:[t.jsx(n,{mr:1,component:"span",color:"lightgrey",sx:{transform:"translateY(4px)"},children:t.jsx(jt,{})}),t.jsx(u,{variant:"caption",sx:{fontSize:c},children:Q(new Date(r),"LLL dd, yyyy")})]})}function Bt(i){return i?t.jsx(Ct,{member:i}):null}function Mt(i){return t.jsx(pt,{contact:i})}function Nt(i){return t.jsx(u,{variant:"caption",children:i??""})}function Pt(i){return t.jsx(u,{variant:"caption",children:i??""})}function Dt(i){return t.jsx(u,{component:"pre",variant:"caption",sx:{overflowX:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:`Source: ${i==null?void 0:i.source}
Job: ${i==null?void 0:i.job}`})}function Rt(i){const{type:r,record:o,viewActivity:c,compact:p}=i,x=A("DISABLE_ICON_GRADIENT").on;if(!r)return null;const f=It[r]??At,a=p?12:16,v=o!=null&&o.attributes?o.attributes.includes("\\")?JSON.parse(JSON.parse(o.attributes)):JSON.parse(o.attributes):void 0;return t.jsxs(n,{display:"flex",children:[f&&t.jsx(f,{gradient:{disabled:x}}),t.jsx(n,{component:"span",ml:1,onClick:c,sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:t.jsx(u,{variant:"caption",sx:{fontSize:a},children:v?`${y(r)} - ${y(v.enquiryType)}`:y(r)})})]})}export{Ee as default};
