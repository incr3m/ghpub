import{j as f}from"./TransitionGroupContext-9d36972e.js";import{R as d}from"./index-f1f749bf.js";import x from"./index-6ede752a.js";import{g as L}from"./_baseForOwn-9b89c4b6.js";import{ab as h,u as b,g as v,ac as S,aY as _,a1 as O,B as F,a4 as N,T as k,m as I}from"./papaparse.min-b66e70e7.js";import{p as J}from"./_arrayIncludes-2cfb33ae.js";import{u as P}from"./useBeforeSave-e049f6dd.js";import{u as B}from"./useIncludeFieldNames-35a180a9.js";import{L as T}from"./LocationBeFormBody-c033b2b3.js";import{a as w}from"./Play-87fed129.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./index-bcfaa842.js";import"./index-96c5f47c.js";import"./isNativeReflectConstruct-05c29d01.js";import"./Button-352c3435.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./SelectEsModelInput-d580a9f7.js";import"./react-router-19e5b27c.js";import"./tiny-invariant-dd7d57d2.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./react-router-dom-60ea8218.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";var A=function(y,a){a||(a={}),typeof a=="function"&&(a={cmp:a});var e=typeof a.cycles=="boolean"?a.cycles:!1,c=a.cmp&&function(s){return function(t){return function(r,i){var o={key:r,value:t[r]},n={key:i,value:t[i]};return s(o,n)}}}(a.cmp),l=[];return function s(t){if(t&&t.toJSON&&typeof t.toJSON=="function"&&(t=t.toJSON()),t!==void 0){if(typeof t=="number")return isFinite(t)?""+t:"null";if(typeof t!="object")return JSON.stringify(t);var r,i;if(Array.isArray(t)){for(i="[",r=0;r<t.length;r++)r&&(i+=","),i+=s(t[r])||"null";return i+"]"}if(t===null)return"null";if(l.indexOf(t)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=l.push(t)-1,n=Object.keys(t).sort(c&&c(t));for(i="",r=0;r<n.length;r++){var u=n[r],m=s(t[u]);m&&(i&&(i+=","),i+=JSON.stringify(u)+":"+m)}return l.splice(o,1),"{"+i+"}"}}(y)};const g=A,p="projectLocation",D=I({root:{"& > hr":{marginBottom:"5px"},"& .MuiTypography-caption":{opacity:.6}},addressFields:{display:"flex",flexFlow:"wrap",marginTop:"5px","& > *":{marginTop:"10px",marginRight:"10px",display:"inline-block",width:"200px"},"& > div:nth-of-type(1),div:nth-of-type(2)":{minWidth:"300px"}}});function pt(){const[y,a]=d.useState({initialValue:null}),{formik:{values:e,setFieldValue:c}}=w(),l=L(e,"locationId"),s=h("project-setting");B(["locationId"]);const t=D(),r=b(v`
      query GetLocation($id: ID!) {
        getLocation(id: $id) {
          id
          name
          locationCompanyId
          type
          address1
          address2
          suburb
          state
          postcode
          country
          source
          incLotAndPlanDetails
        }
      }
    `,{skip:!l,variables:{id:l},fetchPolicy:"network-only"});return d.useEffect(()=>{e&&Object.keys(e).includes("projectLocation_country")&&(e!=null&&e.projectLocation_country||c("projectLocation_country","Australia"))},[e,c]),d.useEffect(()=>{var o;const i=(o=r.data)==null?void 0:o.getLocation;i&&(c(p,i),a(n=>({...n,initialValue:i})),console.log(">>plugins/ProjectFormLocation::","set!"))},[r.data,c]),P(async i=>{const o=J(i[p]);console.log(">>plugins/ProjectFormLocation::","valuqes",i,o);const n=g(y.initialValue)!==g(o);if(console.log(">>plugins/ProjectFormLocation::","changed",n),!S(o)&&n){let u=(o.name||"").trim();u||(u=o.address1||"-",o.suburb&&(u+=` , ${o.suburb}`));const[m]=await _([{...o,__typename:"Location"}]);i.locationId=m.id,a(j=>({...j,initialValue:o}))}return O(i,p)}),f.jsxs(F,{mt:2,className:t.root,children:[f.jsx(N,{}),f.jsx(k,{variant:"caption",children:"Location:"}),f.jsx(x,{field:p,stringifyOnSave:!1,children:f.jsx(T,{fieldPrefix:p,incLotAndPlanDetails:s==null?void 0:s.incLotAndPlanDetails})})]})}export{pt as default};
