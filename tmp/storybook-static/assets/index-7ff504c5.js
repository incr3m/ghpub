import{j as t,e as Jr}from"./TransitionGroupContext-9d36972e.js";import{r as Vt,R as m}from"./index-f1f749bf.js";import{P as Yr}from"./index-79afbab1.js";import{bx as Zr,g as ea,a as ta,ag as na,a9 as ra,aV as aa,cs as oa,a3 as kt,m as Le,cI as Qt,i as pr,l as we,u as wt,ac as tr,s as sa,bG as ia,ah as la,ai as ca,aj as da,W as Ne,o as hr,b as Ze,R as ua,aP as fa,B as $e,X as pa,aS as ha,ad as Ft,v as ma,z as Gt,K as va,H as ga,G as nr,bC as rr,bQ as ya,w as ar,cJ as ba,cK as xa}from"./papaparse.min-b66e70e7.js";import{_ as mr}from"./iframe-ed7f5a3f.js";import{B as et}from"./Button-352c3435.js";import{a6 as wa,o as vr,a7 as gr,p as or,L as Sa,a5 as ka,O as _a,a8 as ja,a9 as Pa,aa as Ta,h as sr,ab as Ma}from"./Play-87fed129.js";import{g as G}from"./_baseForOwn-9b89c4b6.js";import{S as Xt,f as ir,l as Oa,b as Ia}from"./index-bcfaa842.js";import{u as St}from"./useFetchMore-be228481.js";import{M as Ea,u as Ca,a as Da,D as Na,H as $a}from"./MilestoneIcon-61fb6e69.js";import{m as La,I as Ba}from"./pick-dba65392.js";import{p as Ra}from"./_arrayIncludes-2cfb33ae.js";import"./index-96c5f47c.js";import{T as za,a as Fa}from"./ToggleButtonGroup-93d9af56.js";import{c as Ga,g as Aa}from"./_commonjsHelpers-042e6b4d.js";import{p as qa}from"./index-4d501b15.js";import{d as Ha}from"./RemoveCircle-617bdac2.js";import{d as Wa}from"./debounce-213cd46f.js";import"./assertThisInitialized-ad1db8e7.js";import"./isPlainObject-07477f89.js";import"../sb-preview/runtime.js";import"./react-router-19e5b27c.js";import"./tiny-invariant-dd7d57d2.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./react-router-dom-60ea8218.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";import"./isNativeReflectConstruct-05c29d01.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./SelectEsModelInput-d580a9f7.js";import"./Link-c687dc07.js";import"./useIncludeFieldNames-35a180a9.js";import"./Save-b67fa0ac.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";let lr=!1;const Va=()=>{lr||(console.warn(["MUI: The TreeItem component was moved from `@mui/lab` to `@mui/x-tree-view`.","","You should use `import { TreeItem } from '@mui/x-tree-view'`","or `import { TreeItem } from '@mui/x-tree-view/TreeItem'`","","More information about this migration on our blog: https://mui.com/blog/lab-tree-view-to-mui-x/."].join(`
`)),lr=!0)},Qa=Vt.forwardRef(function(){return Va(),null}),Xa=Qa;let cr=!1;const Ka=()=>{cr||(console.warn(["MUI: The TreeView component was moved from `@mui/lab` to `@mui/x-tree-view`.","","You should use `import { TreeView } from '@mui/x-tree-view'`","or `import { TreeView } from '@mui/x-tree-view/TreeView'`","","More information about this migration on our blog: https://mui.com/blog/lab-tree-view-to-mui-x/."].join(`
`)),cr=!0)},Ua=Vt.forwardRef(function(){return Ka(),null}),Ja=Ua,Ya=e=>ea`
{
  query getMilestone(id:${JSON.stringify(e)}) {
      name
  }
}
`,Za=async({milestoneId:e})=>({...(await Zr.query({query:Ya(e),variables:{id:e},fetchPolicy:"network-only"})).data.getMilestone}),eo=async({taskId:e})=>{const o=await ta({key:"getTask",variables:{id:e}});return o.repeatSetting=JSON.parse(o.repeatSetting),o.urls=JSON.parse(o.urls),o.milestoneId&&(o.milestoneName=await Za({milestoneId:o.milestoneId})),o};function to(e){return t.jsx(no,{quickPopperContext:e})}function no({quickPopperContext:e}){const[o,f]=m.useState(!1),{state:u={},close:y}=e;return t.jsxs(t.Fragment,{children:[t.jsx(na,{children:"Confirm"}),t.jsx(ra,{style:{fontSize:"larger"},children:u.content||""}),t.jsxs(aa,{children:[t.jsx(et,{variant:"outlined",onClick:async d=>{u.onCancel&&await Promise.resolve(u.onCancel(d)),y()},children:"Close"}),t.jsx(et,{disabled:o,variant:"outlined",color:"secondary",onClick:async d=>{f(!0),u.onSubmit&&await Promise.resolve(u.onSubmit(d)),f(!1),y()},children:"Continue"})]})]})}function ro(e){return t.jsx(Xt,{fontSize:"inherit",style:{width:14,height:14},...e,children:t.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function ao(e){return t.jsx(Xt,{fontSize:"inherit",style:{width:14,height:14},...e,children:t.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function oo(e){return t.jsx(Xt,{className:"close",fontSize:"inherit",style:{width:14,height:14},...e})}const yr=oa(e=>({iconContainer:{width:14,marginLeft:5,marginRight:5,"&:hover":{color:e.palette.secondary.light},"& .close":{opacity:.3}},content:{height:38,borderBottom:"solid 1px whitesmoke"},group:{marginLeft:7,paTreeItemingLeft:18,borderLeft:`1px dashed ${Jr(e.palette.text.primary,.4)}`}}))(({loading:e,onExpand:o,onShrink:f,children:u,...y})=>t.jsx(Xa,{...y,...e&&{icon:t.jsx(wa,{})},children:u&&t.jsx(so,{onExpand:o,onShrink:f,children:u})}));function so(e){const o=m.useRef({});return o.current.onExpand=e.onExpand,o.current.onShrink=e.onShrink,m.useEffect(()=>{const{onExpand:f,onShrink:u}=o.current;return f&&f(),()=>{u&&u()}},[]),e.children}function io(e){return t.jsx(yr,{...e,label:t.jsx(kt,{})})}const lo=Le({root:{flexGrow:1,"& .MuiTreeItem-label":{overflow:"hidden"},"& .MuiTreeItem-iconContainer > svg":{heigth:14,width:14}}});function co({children:e,itemHeight:o,...f}){const u=lo({itemHeight:o});return t.jsx(Ja,{className:u.root,defaultExpanded:["1"],defaultCollapseIcon:t.jsx(ro,{}),defaultExpandIcon:t.jsx(ao,{}),defaultEndIcon:t.jsx(oo,{}),...f,children:e})}const ge={Project:{label:"name",start:"startDateEst",end:"endDateEst",expandable:!0,precedence:0,acceptedTypes:["Milestone","Task"],typeIcon:vr},Opportunity:{label:"name",start:"startDateEst",end:"endDateEst",expandable:!0,precedence:0,acceptedTypes:["Milestone","OppItem"],typeIcon:gr},Milestone:{label:"name",start:"start",end:"due",movable:!0,precedence:10,expandable:!0,acceptedTypes:["Milestone","Task","OppItem"],typeIcon:Ea},Task:{label:"title",start:"start",end:"due",extraFields:"projectId, taskSprintId",precedence:20,movable:!0,allowDependencies:!0,typeIcon:or,predecessor:{parentField:"parent",taskField:"task"}},OppItem:{label:"name",start:"start",end:"end",extraFields:"opportunityId",precedence:20,movable:!0,allowDependencies:!0,predecessor:{parentField:"oppItemParent",taskField:"oppItemTask"},typeIcon:or}};function uo({node:e,subNodes:o,className:f,onNodeMoved:u}){const[y]=e.key.split("#"),{handleDateEdit:d,updateNodeMapping:b,handleNodeLabelClicked:w,handleNodeItemMoved:s,handleNodeOptionClicked:h}=m.useContext(Kt);m.useEffect(()=>{b(r=>{var k;const v={};for(const D in o)v[D]={...o[D]},(k=r[D])!=null&&k.nodes&&(v[D].nodes=r[D].nodes);const n={};return Qt(Object.values(o||{}),"precedence").forEach(D=>{n[D.key]=D}),v[e.key]={...r[e.key],nodes:n},{...r,...v}})},[b,o,e]);const c=m.useCallback(r=>{r.stopPropagation(),w(r,e.key)},[e,w]),{acceptedTypes:i,icon:S}=m.useMemo(()=>{let r=null,v=[];const n=ge[y];return n&&(r=n.typeIcon,v=n.acceptedTypes||[]),{icon:r,acceptedTypes:v}},[y]),[{canDrop:N,isOver:M},p]=Ca({accept:i,drop:r=>{if(!(!r||!r.node))return s({movedNode:r.node,targetNode:e}).then(()=>{u&&u(r.node)}),{name:e.key,node:e}},collect:r=>({isOver:r.isOver(),canDrop:r.canDrop()})}),a=N&&M;return t.jsxs("div",{ref:p,className:`${f} ${a?"on-drag":""}`,children:[t.jsx(fo,{icon:S,node:e,type:y,onClick:c}),t.jsxs("div",{children:[t.jsx(et,{name:`${e.key}###start`,onClick:d,children:e.start?ir(new Date(e.start),"dd/MM/yy"):"-"}),t.jsx(et,{name:`${e.key}###end`,onClick:d,children:e.end?ir(new Date(e.end),"dd/MM/yy"):"-"}),t.jsx("div",{children:t.jsx(pr,{name:e.key,size:"small",onClick:h,children:t.jsx(La,{})})})]})]})}function fo({node:e,type:o,icon:f,onClick:u}){const[,y]=Da({type:o,item:{name:e.key,type:o,node:e},end:(d,b)=>{const w=b.getDropResult();console.log(">>SchedGanttChart/GanttNodeItemLabel::","dropResult",w),d&&w&&console.info(">>SchedGanttChart/GanttNodeItemLabel:: item dropped",d)}});return t.jsxs("span",{ref:y,onClick:u,title:e.label,className:"nt",children:[f&&t.jsx(f,{className:"blue"}),e.label]})}function qt(e){const o=ge[e];if(!o||!o.predecessor)return;const f=` 
    ${o.label}
    ${o.start}
    ${o.end} 
    ${o.extraFields||""}
  `;return`
    id
    milestoneId
    ${f}
    predecessors(limit: 25) {
      items {
        id
        ${o.predecessor.parentField} {
          id
          milestoneId
          ${f}
        }
      }
    }
    successors(limit: 25) {
      items {
        id
        ${o.predecessor.taskField} {
          id
          milestoneId
          ${f}
        }
      }
    }
  `}function po({node:e,itemsPerNode:o,skip:f}){let u,y;const d=G(e,"data.__typename"),b=e.id,w={archived:{ne:!0}},s=d==="Milestone",h=d==="Project"||s&&G(e,"data.milestoneProjectId"),c=d==="Opportunity"||s&&G(e,"data.milestoneOppId");h?(u="Task",y="title",w.projectId={eq:b},w.milestoneId={exists:!1}):c&&(u="Task",y="title",w.opportunityId={eq:b},w.milestoneId={exists:!1}),s&&(delete w.projectId,delete w.opportunityId,w.milestoneId={eq:b});let i=qt(u);i&&(i=`items{${i}}`);const S=m.useMemo(()=>b.replace(/[\W_]+/g,""),[b]),N=we`
  query Q_TASKS_${S}($nextToken: String, $filter: Searchable${u}FilterInput) {
    tasks: search${u}s(
      nextToken: $nextToken
      filter: $filter
      limit: ${o}
      sort: { field: ${y}, direction: asc }
    ) {
      nextToken
      ${i}
    }
  }
`,M=wt(N,{skip:f,variables:{filter:w},fetchPolicy:"cache-first"});return M._q=N,M}function ho({rootTypes:e=[],rootId:o,itemsPerNode:f}){const u={};o&&(u.id={eq:o});function y(i){return we`
    query($nextToken: String, $filter: Searchable${i}FilterInput ) {
      listNodes: search${i}s(nextToken: $nextToken, filter: $filter, limit: ${f}, 
      sort:{
        field: name,
        direction: asc
      }) {
        nextToken
        items {
          id
          name
          startDateEst
          endDateEst
        }
      }
    }
  `}const d=wt(y("Project"),{skip:!e.includes("Project"),variables:{...!tr(u)&&{filter:u}}}),b=wt(y("Opportunity"),{skip:!e.includes("Opportunity"),variables:{...!tr(u)&&{filter:u}}}),w=St({...d,listPath:"listNodes",maxLength:5}),s=St({...b,listPath:"listNodes",maxLength:5}),h=m.useMemo(()=>[...G(d,"data.listNodes.items",[]),...G(b,"data.listNodes.items",[])],[d,b]),c=m.useCallback(()=>{w.more(),s.more()},[w,s]);return{list:h,more:c,loading:d.loading||b.loading}}const At="__SHOW_MORE__";function dr(e){return`${e.__typename}#${e.id}`}function Ht(e){const o={id:e.id,data:e,precedence:999};o.key=dr(e);const f=ge[e.__typename];f&&(o.label=e[f.label],o.start=e[f.start],o.end=e[f.end],o.precedence=f.precedence);const u=G(e,"predecessors.items",[]);if(u.length>0){const y=f.predecessor.parentField;o.dependencies=u.map(d=>d[y]?dr(d[y]):"").join(", ")}return o}const mo=we`
  query($nextToken: String, $filter: SearchableMilestoneFilterInput) {
    searchMilestones(
      nextToken: $nextToken
      filter: $filter
      limit: 999
      sort: { field: name, direction: asc }
    ) {
      nextToken
      items {
        id
        name
        start
        due
        milestoneProjectId
        milestoneOppId
      }
    }
  }
`,vo=Le({lbl:{display:"flex",justifyContent:"space-between",alignItems:"center","&.on-drag":{backgroundColor:"gainsboro"},"& > span":{flex:1,textOverflow:"ellipsis",overflowX:"hidden",whiteSpace:"nowrap"},"& > span:hover":{textDecoration:"underline"},"& > span > svg":{width:18,height:18,marginRight:8,marginLeft:5,verticalAlign:"middle"},"& svg.blue":{color:"#12C7FA"},"& > div":{display:"flex",width:"185px"},"& > div > button":{width:"80px",fontSize:"14px",opacity:.7},"& .MuiIconButton-root":{marginTop:3,opacity:.5}},nodeBtn:{fontSize:"x-small",borderColor:"gainsboro"}});function br({node:e,loading:o,onClick:f,itemsPerNode:u=10,itemsSortKey:y}){const d=e.id,b=vo(),[w,s]=m.useState({loading:!1,expanded:!1,queryOpts:null,nodes:null,children:[]}),h=o||w.loading,{children:c}=w,i=w.nodes||(e==null?void 0:e.nodes),S=G(e,"data.__typename"),N={archived:{ne:!0}};S==="Project"?N.milestoneProjectId={eq:d}:S==="Opportunity"&&(N.milestoneOppId={eq:d}),S==="Milestone"?N.parentMilestoneId={eq:d}:N.parentMilestoneId={exists:!1};const M=wt(mo,{skip:!(["Project","Opportunity","Milestone"].includes(S)&&w.expanded),variables:{filter:N},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});St({...M,model:"Milestone",op:"search",maxLength:999});const p=po({node:e,itemsPerNode:u,skip:!(["Project","Opportunity","Milestone"].includes(S)&&w.expanded)}),r=St({...p,listPath:"tasks",maxLength:999}).more,v=M.loading||p.loading;m.useEffect(()=>{const I=G(p.data,"tasks.items",[]);I.length<1||s(C=>{const x={...C.nodes||{}};for(const _ of I){const E=Ht(_);if(["Project","Opportunity"].includes(S)&&_.milestoneId||S==="Milestone"&&_.milestoneId!==d){delete x[E.key];continue}x[E.key]=E}return{...C,nodes:x}})},[S,d,p.data]),m.useEffect(()=>{const I=G(M.data,"searchMilestones.items",[]);I.length<1||s(C=>{const x={...C.nodes||{}};for(const _ of I){const E=Ht(_);x[E.key]=E}return{...C,nodes:x}})},[M.data]),m.useEffect(()=>{const I=[];console.log(">>SchedGanttChart/GanttTreeNode::","subNodes",i,y),Qt(Object.values(i||{}),y).forEach(C=>{const x={key:C.key,loading:h,node:C,itemsPerNode:u,itemsSortKey:y};G(C,"data.__typename")===At&&(x.onClick=()=>{r()}),I.push(t.jsx(br,{...x}))}),s(C=>({...C,children:I}))},[r,h,i,u,y]);const n=m.useCallback(()=>{s(I=>({...I,expanded:!0}))},[]),k=m.useCallback(()=>{s(I=>({...I,expanded:!1,nodes:null}))},[]),D=m.useCallback(async I=>{w.expanded&&p.updateQuery(function(C){const x=G(C,"tasks.items",[]),_={...I.data};_.milestoneId=S==="Milestone"?d:null;const E=sa("tasks.items",[_,...x])(p.data);return console.log(">>SchedGanttChart/GanttTreeNode::","newData",E),E})},[w.expanded,p,S,d]),l=m.useMemo(()=>{const I=[];for(const C in ge)ge[C].expandable||I.push(C);return I},[]);if(!e)return null;if(d===Ge)return c;const L={nodeId:d,loading:h,onExpand:n,onShrink:k,onClick:f};return S===At?(delete L.onClick,L.label=t.jsx(go,{onClick:f,className:b.nodeBtn})):L.label=t.jsx(uo,{node:e,subNodes:i,className:b.lbl,onNodeMoved:D}),t.jsx(yr,{...L,children:[At,...l].includes(S)?null:t.jsxs(t.Fragment,{children:[c,t.jsx("div",{children:v&&t.jsx(io,{nodeId:`LOADER::${d}`})})]})})}function go({className:e,onClick:o}){return t.jsx(et,{size:"small",variant:"outlined",className:e,onClick:o,children:"Show More Tasks .."})}async function xr(e,o){console.log(">>SchedGanttChart/GranttTaskList::","data",o);const[f,u]=o.id.split("#"),y={id:u,__typename:f,__op:"update"},d=ge[f];if(!d)return;const b=[d.start,d.end];y.__fields=b.filter(Boolean).join(", "),o.start&&d.start&&(y[d.start]=o.start),o.end&&d.end&&(y[d.end]=o.end);const w=ia(y);await e.mutate({mutation:we`
    mutation (
      ${w.args}
    ){
      ${w.body}
    }
    `,variables:{...w.vars}})}const yo=m.lazy(()=>mr(()=>import("./MilestoneForm-9825d61c.js"),["./MilestoneForm-9825d61c.js","./TransitionGroupContext-9d36972e.js","./index-f1f749bf.js","./_commonjsHelpers-042e6b4d.js","./assertThisInitialized-ad1db8e7.js","./camelCase-4e7e8b23.js","./capitalize-c31f38e2.js","./_baseForOwn-9b89c4b6.js","./papaparse.min-b66e70e7.js","./_arrayIncludes-2cfb33ae.js","./index-bcfaa842.js","./index-96c5f47c.js","./isNativeReflectConstruct-05c29d01.js","./Button-352c3435.js","./isPlainObject-07477f89.js","./debounce-213cd46f.js","./iframe-ed7f5a3f.js","./index-4d501b15.js","./papaparse-cdbe7e6d.css","./Play-87fed129.js","./react-router-19e5b27c.js","./tiny-invariant-dd7d57d2.js","./filter-f99df4e5.js","./LocalizationProvider-a287304f.js","./react-router-dom-60ea8218.js","./uniq-0d482d7b.js","./cloneDeep-91467704.js","./useIncludeFieldNames-35a180a9.js","./pick-dba65392.js","./index-61adb48a.js","./useGetProjectSummaryFields-0ab32aca.js","./SelectEsModelInput-d580a9f7.js","./Link-c687dc07.js","./Save-b67fa0ac.js","./index-147ad7aa.js","./Add-be7f5660.js","./Skeleton-cd6f071e.js","./Alert-fd9a067a.js"],import.meta.url));function bo({context:e}){const[o,f]=m.useState({formComponent:null}),u=m.useRef(null),y=G(e,"state.nodeKey"),{nodeMapping:d}=m.useContext(Kt),b=d[y],w=m.useMemo(()=>xo(b),[b]),s=m.useCallback(c=>{var a,r;const N=c.target.closest('[role="button"]').getAttribute("name");if(!N)return;const M=G(b,"data.__typename");let p;switch(N){case"Milestone":{const v={};M==="Project"&&(v.milestoneProjectId=b.id),M==="Opportunity"&&(v.milestoneOppId=b.id),M==="Milestone"&&(v.parentMilestoneId=b.id,v.milestoneProjectId=(a=b.data)==null?void 0:a.milestoneProjectId,v.milestoneOppId=(r=b.data)==null?void 0:r.milestoneOppId),p=t.jsx(yo,{initialValues:Ra(v),onCancel:()=>{u.current.close()},onSubmit:()=>{u.current.close()}});break}}p&&(f(v=>({...v,formComponent:p})),u.current.open())},[b]),h=m.useCallback(()=>{f(c=>({...c,formComponent:null}))},[]);return y?t.jsxs(t.Fragment,{children:[t.jsx(la,{component:"nav",children:w.map(c=>{const i=G(ge,[c,"typeIcon"]);return t.jsxs(ca,{name:c,button:!0,onClick:s,children:[i&&t.jsx(Sa,{children:t.jsx(i,{})}),t.jsx(da,{primary:`Add ${c}`})]},c)})}),t.jsx(Ne,{scroll:"body",maxWidth:"md",variant:"dialog",ref:u,dialogProps:{maxWidth:"sm",fullWidth:!0},onClose:h,children:t.jsx(m.Suspense,{fallback:t.jsx(kt,{}),children:o.formComponent})})]}):null}function xo(e){const o=G(e,"data.__typename"),f=[];if(o==="Milestone"){const{milestoneOppId:u,milestoneProjectId:y}=(e==null?void 0:e.data)||{};f.push("Milestone"),u?f.push("OppItem"):y&&f.push("Task")}else f.push(...G(ge,[o,"acceptedTypes"],[]));return f.filter(u=>u==="Milestone")}const wo=m.lazy(()=>mr(()=>import("./GanttNodeItemDetails-2decf372.js"),["./GanttNodeItemDetails-2decf372.js","./TransitionGroupContext-9d36972e.js","./index-f1f749bf.js","./_commonjsHelpers-042e6b4d.js","./assertThisInitialized-ad1db8e7.js","./papaparse.min-b66e70e7.js","./_arrayIncludes-2cfb33ae.js","./_baseForOwn-9b89c4b6.js","./index-bcfaa842.js","./index-96c5f47c.js","./isNativeReflectConstruct-05c29d01.js","./Button-352c3435.js","./isPlainObject-07477f89.js","./debounce-213cd46f.js","./iframe-ed7f5a3f.js","./index-4d501b15.js","./papaparse-cdbe7e6d.css","./Play-87fed129.js","./react-router-19e5b27c.js","./tiny-invariant-dd7d57d2.js","./filter-f99df4e5.js","./LocalizationProvider-a287304f.js","./react-router-dom-60ea8218.js","./uniq-0d482d7b.js","./cloneDeep-91467704.js","./TaskForm-863cdb73.js","./pick-dba65392.js","./index-61adb48a.js","./useGetProjectSummaryFields-0ab32aca.js","./SelectEsModelInput-d580a9f7.js","./Link-c687dc07.js","./useIncludeFieldNames-35a180a9.js","./Save-b67fa0ac.js","./index-147ad7aa.js","./Add-be7f5660.js","./RepeatFields-8275ed19.js","./useBeforeSave-e049f6dd.js","./capitalize-c31f38e2.js","./Alert-fd9a067a.js","./TaskAssignees-858ea3c9.js","./useTaskAssignees-9f1fd5d3.js"],import.meta.url)),Ge="__root",Kt=m.createContext(),So=Le(e=>({root:{backgroundColor:e.palette.background.paper},header:{display:"flex",height:60,padding:20,fontSize:"16px","& > div":{width:200},"& > span":{display:"block",width:90,textAlign:"center",paddingLeft:10}},list:o=>({backgroundColor:"#f8f8f9","& li > .MuiTreeItem-content":{height:o.rowHeight,marginLeft:"-4px"},"& li > .MuiTreeItem-content > div > svg":{width:"18px !important",height:"18px !important"},"& ul":{paddingLeft:"18px"},"& li ul span.nt":{fontSize:"smaller",opacity:.9}})}));function ko({itemsPerNode:e,onData:o,rootTypes:f,rowHeight:u,rootId:y,sortKey:d="precedence"}){const b=m.useRef(null),w=m.useRef(null),s=m.useRef(null),h=m.useRef(null),c=So({rowHeight:u}),[i,S]=m.useState({itemsPerNode:e,taskMapping:{},selectedTask:null,targetField:null,saving:!1,nodeMapping:{}}),N=hr(),{list:M,more:p,loading:a}=ho({rootTypes:f,rootId:y,itemsPerNode:e});m.useEffect(()=>{S(x=>{const _={...x.nodeMapping},E={id:Ge,nodes:{}};return Qt(M.map(F=>Ht(F)),"label").forEach(F=>{E.nodes[F.key]=F,_[F.key]=F}),_[Ge]=E,{...x,nodeMapping:_}})},[M]),m.useEffect(()=>{const x=[];function _(E){if(!E)return;if(E.id!==Ge){const H={id:E.key,start:E.start?new Date(E.start).toLocaleDateString("en-se"):void 0,end:E.end?new Date(E.end).toLocaleDateString("en-se"):void 0,name:E.label||".",progress:1,dependencies:E.dependencies,precedence:E.precedence};x.push(H)}const F=E.nodes||{},O=[];for(const H in F){const Q=i.nodeMapping[H];O.push(Q)}for(const H of fa(O,d))_(H)}_(i.nodeMapping[Ge]),o(x)},[i.nodeMapping,o,d]);const r=m.useCallback(x=>{S(_=>({..._,nodeMapping:x(_.nodeMapping)}))},[]),v=m.useCallback(x=>{x.stopPropagation();const F=x.target.closest("button").getAttribute("name");if(!F)return;const[O,H]=F.split("###");S(Q=>{const Se=Q.nodeMapping[O];return{...Q,selectedTask:Se,targetField:H}}),s.current.open(x.target)},[]),n=ka({form:Ma}),k=_a({api:eo}),D=m.useCallback(async(x,_)=>{var H,Q,Se,Be,je,ce,j,R,g;S($=>{const q=$.nodeMapping[_];return{...$,selectedTask:q,targetField:null}});const E=i.nodeMapping[_],F=E.data,O=await k.request({taskId:F.id});n.initializeForm({project:{value:(H=O.project)==null?void 0:H.id,data:{text:(Q=O.project)==null?void 0:Q.name}},opportunity:{value:(Se=O.opportunity)==null?void 0:Se.id,data:{text:(Be=O.opportunity)==null?void 0:Be.name}},title:{value:O.title},details:{value:O.description},description:{value:O.description},dueDate:{value:O.due},billable:{value:O.billable},assignees:{value:O.userAssignments.items.map($=>({value:$.id,label:$.user.fullname,userId:$.user.id}))},stage:{value:O.sprint.id,data:{text:O.sprint.name}},startDate:{value:O.start},estEffort:{value:O.estimatedEffort},type:{value:O.type},status:{value:O.status,data:{text:O.status}},priority:{value:O.priority,data:{text:O.priority}},milestone:{value:O.milestoneId,data:{text:O.milestoneName||""}},repeatingTask:{value:!!O.repeatSetting},timePeriod:{value:{count:(je=O.repeatSetting)==null?void 0:je.every,every:(ce=O.repeatSetting)==null?void 0:ce.period},data:{text:ja((j=O.repeatSetting)==null?void 0:j.period),week:(R=O.repeatSetting)==null?void 0:R.weekDay}},links:{value:((g=O.urls)==null?void 0:g.map($=>({value:$.url,label:$.label})))||[]}},!0,{title:"EDIT TASK",submitButtonText:"Update Task",action:"UPDATE",id:E.id})},[i,n,k]),l=m.useCallback(({movedNode:x,targetNode:_})=>{const{id:E,__typename:F}=G(x,"data",{}),{id:O,__typename:H}=G(_,"data",{});if(E===O)return Ze.resolve();const Q=t.jsxs($e,{component:"span",display:"flex",children:["Moved",t.jsx($e,{display:"inline-block",ml:2,mr:2,children:t.jsx(sr,{modelName:F,modelId:E})}),"to",t.jsx($e,{display:"inline-block",ml:2,mr:2,children:t.jsx(sr,{modelName:H,modelId:O})}),"?"]});return new Ze((Se,Be)=>{b.current.open(null,{content:Q,onSubmit:async()=>{var je;if((je=ge[F])!=null&&je.movable&&H==="Milestone"){let ce;F==="Milestone"?ce="parentMilestoneId":ce="milestoneId",await N.mutate({mutation:we`
                  mutation($input: Update${F}Input!) {
                    update${F}(input: $input) {
                      id
                      ${ce}
                    }
                  }
                `,variables:{input:{id:E,[ce]:O}}})}Se()},onCancel:Be})})},[N]),L=m.useCallback(x=>{x.stopPropagation();const _=x.target.closest("button"),E=_.getAttribute("name");E&&h.current.open(_,{nodeKey:E})},[]);i.updateNodeMapping=r,i.handleDateEdit=v,i.handleNodeLabelClicked=D,i.handleNodeItemMoved=l,i.handleNodeOptionClicked=L;const I=m.useCallback(async x=>{!i.targetField||!i.selectedTask||(S(_=>({..._,saving:!0})),s.current.close(),await xr(N,{id:i.selectedTask.key,[i.targetField]:x}))},[i.targetField,i.selectedTask,N]),C=i.nodeMapping[Ge];return t.jsx(Na,{backend:$a,children:t.jsxs(Kt.Provider,{value:i,children:[t.jsxs("div",{className:c.root,children:[t.jsxs("div",{className:c.header,children:[t.jsx("div",{children:"Task Name"}),t.jsx("span",{children:"Start"}),t.jsx("span",{children:"Due"})]}),t.jsx("div",{className:c.list,children:t.jsx(co,{children:C&&t.jsx(br,{node:C,itemsPerNode:e,itemsSortKey:d})})})]}),!y&&!a&&t.jsx(ua,{onClick:p}),t.jsx(Ne,{ref:s,variant:"popover",anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"left"},children:t.jsx(Pa,{autoOk:!0,orientation:"landscape",variant:"static",openTo:"date",value:G(i,["selectedTask",i.targetField]),onChange:I})}),t.jsx(Ta,{form:n,callback:()=>{}}),t.jsx(Ne,{scroll:"body",maxWidth:"md",variant:"dialog",ref:w,dialogProps:{maxWidth:"sm",fullWidth:!0},children:t.jsx(m.Suspense,{fallback:t.jsx(kt,{}),children:t.jsx(wo,{node:i.selectedTask,onClose:()=>{w.current.close()}})})}),t.jsx(Ne,{scroll:"body",maxWidth:"md",variant:"dialog",ref:b,dialogProps:{maxWidth:"sm"},children:to}),t.jsx(Ne,{ref:h,variant:"popover",anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"left"},children:x=>t.jsx(bo,{context:x})})]})})}const _o=Le(e=>({root:({height:o})=>({backgroundColor:"inherit","& > button:not(:last-child)":{marginRight:5},"& > button":{height:o,backgroundColor:e.palette.background.paper}})}));function jo({height:e=34,options:o=[],value:f,onChange:u}){const y=_o({height:e});return t.jsx(za,{className:y.root,size:"small",value:f,onChange:u,children:o.map(d=>t.jsx(Fa,{value:d.value,title:d.title,children:d.label},d.value))})}var Wt={},Po={get exports(){return Wt},set exports(e){Wt=e}};(function(e,o){(function(u,y){e.exports=y(Vt,Oa,qa)})(Ga,function(f,u,y){return function(){var d={"./src/utils/buzzier.js":function(h,c,i){i.r(c),i.d(c,{bzFunction:function(){return S},buzzierMinSols:function(){return N}});var S=function(p,a,r,v){return function(n){return Math.pow(1-n,3)*p+3*Math.pow(1-n,2)*n*a+3*(1-n)*Math.pow(n,2)*r+Math.pow(n,3)*v}},N=function(p,a,r,v){var n=S(p,a,r,v),k=-6*p+12*a-6*r,D=Math.pow(-6*p+12*a-6*r,2)-4*(3*a-3*p)*(-3*p+9*a-9*r+3*v),l=2*(-3*p+9*a-9*r+3*v),L=n((k+Math.sqrt(D))/l),I=n((k-Math.sqrt(D))/l);return[L,I]}},"./src/Xarrow.tsx":function(h,c,i){var S=this&&this.__assign||function(){return S=Object.assign||function(j){for(var R,g=1,$=arguments.length;g<$;g++){R=arguments[g];for(var q in R)Object.prototype.hasOwnProperty.call(R,q)&&(j[q]=R[q])}return j},S.apply(this,arguments)},N=this&&this.__createBinding||(Object.create?function(j,R,g,$){$===void 0&&($=g),Object.defineProperty(j,$,{enumerable:!0,get:function(){return R[g]}})}:function(j,R,g,$){$===void 0&&($=g),j[$]=R[g]}),M=this&&this.__setModuleDefault||(Object.create?function(j,R){Object.defineProperty(j,"default",{enumerable:!0,value:R})}:function(j,R){j.default=R}),p=this&&this.__importStar||function(j){if(j&&j.__esModule)return j;var R={};if(j!=null)for(var g in j)g!=="default"&&Object.prototype.hasOwnProperty.call(j,g)&&N(R,j,g);return M(R,j),R},a=this&&this.__rest||function(j,R){var g={};for(var $ in j)Object.prototype.hasOwnProperty.call(j,$)&&R.indexOf($)<0&&(g[$]=j[$]);if(j!=null&&typeof Object.getOwnPropertySymbols=="function")for(var q=0,$=Object.getOwnPropertySymbols(j);q<$.length;q++)R.indexOf($[q])<0&&Object.prototype.propertyIsEnumerable.call(j,$[q])&&(g[$[q]]=j[$[q]]);return g},r=this&&this.__spreadArray||function(j,R){for(var g=0,$=R.length,q=j.length;g<$;g++,q++)j[q]=R[g];return j},v=this&&this.__importDefault||function(j){return j&&j.__esModule?j:{default:j}};Object.defineProperty(c,"__esModule",{value:!0});var n=p(i("react")),k=i("./src/utils/index.ts"),D=v(i("lodash")),l=v(i("prop-types")),L=i("./src/utils/buzzier.js"),I=i("./src/utils/anchors.ts"),C=i("./src/types.ts"),x=function(j){var R,g=D.default.omit(j,["start","end"]),$=g.startAnchor,q=$===void 0?"auto":$,Ut=g.endAnchor,Sr=Ut===void 0?"auto":Ut,Jt=g.label,de=Jt===void 0?null:Jt,Yt=g.color,_t=Yt===void 0?"CornflowerBlue":Yt,Zt=g.lineColor,tt=Zt===void 0?null:Zt,en=g.headColor,nt=en===void 0?null:en,tn=g.tailColor,rt=tn===void 0?null:tn,nn=g.strokeWidth,U=nn===void 0?4:nn,rn=g.showHead,Ae=rn===void 0?!0:rn,an=g.headSize,qe=an===void 0?6:an,on=g.showTail,He=on===void 0?!1:on,sn=g.tailSize,jt=sn===void 0?6:sn,ln=g.path,ye=ln===void 0?"smooth":ln,cn=g.curveness,kr=cn===void 0?.8:cn,dn=g.gridBreak,Re=dn===void 0?.5:dn,un=g.dashness,be=un===void 0?!1:un,fn=g.headShape,Pe=fn===void 0?"arrow1":fn,pn=g.tailShape,Te=pn===void 0?"arrow1":pn,hn=g.showXarrow,at=hn===void 0?!0:hn,mn=g.animateDrawing,xe=mn===void 0?!1:mn,vn=g.passProps,Pt=vn===void 0?{}:vn,gn=g.arrowBodyProps,_r=gn===void 0?{}:gn,yn=g.arrowHeadProps,jr=yn===void 0?{}:yn,bn=g.arrowTailProps,Pr=bn===void 0?{}:bn,xn=g.SVGcanvasProps,Tr=xn===void 0?{}:xn,wn=g.divContainerProps,Mr=wn===void 0?{}:wn,Sn=g.divContainerStyle,Or=Sn===void 0?{}:Sn,kn=g.SVGcanvasStyle,Ir=kn===void 0?{}:kn,_n=g._extendSVGcanvas,ot=_n===void 0?0:_n,jn=g._debug,Tt=jn===void 0?!1:jn,Pn=g._cpx1Offset,Er=Pn===void 0?0:Pn,Tn=g._cpy1Offset,Cr=Tn===void 0?0:Tn,Mn=g._cpx2Offset,Dr=Mn===void 0?0:Mn,On=g._cpy2Offset,Nr=On===void 0?0:On,$r=a(g,["startAnchor","endAnchor","label","color","lineColor","headColor","tailColor","strokeWidth","showHead","headSize","showTail","tailSize","path","curveness","gridBreak","dashness","headShape","tailShape","showXarrow","animateDrawing","passProps","arrowBodyProps","arrowHeadProps","arrowTailProps","SVGcanvasProps","divContainerProps","divContainerStyle","SVGcanvasStyle","_extendSVGcanvas","_debug","_cpx1Offset","_cpy1Offset","_cpx2Offset","_cpy2Offset"]),Mt=n.useRef(null),We=n.useRef(null),st=n.useRef(null);n.useRef(null);var Me=n.useRef(null),In=n.useRef(null),En=n.useRef(null),it=n.useRef(null),lt=n.useRef(null),ct=n.useRef(null),dt=n.useRef(null),Cn=n.useState(!xe),Ot=Cn[0],Dn=Cn[1],Lr=n.useState({});Lr[1];var Nn=n.useState({cx0:0,cy0:0,cw:0,ch:0,x1:0,y1:0,x2:0,y2:0,dx:0,dy:0,absDx:0,absDy:0,cpx1:0,cpy1:0,cpx2:0,cpy2:0,headOrient:0,tailOrient:0,labelStartPos:{x:0,y:0},labelMiddlePos:{x:0,y:0},labelEndPos:{x:0,y:0},arrowEnd:{x:0,y:0},arrowHeadOffset:{x:0,y:0},arrowTailOffset:{x:0,y:0},headOffset:0,excRight:0,excLeft:0,excUp:0,excDown:0,startPoints:[],endPoints:[],mainDivPos:{x:0,y:0},xSign:1,ySign:1,lineLength:0,fHeadSize:1,fTailSize:1,arrowPath:""}),P=Nn[0],$n=Nn[1],ut=function(){if(!(it.current==null||lt.current==null||at==!1))if(!D.default.isEqual(g,dt.current))dt.current&&(dt.current=g,ct.current=Rn(),zn());else{var T=Rn();D.default.isEqual(ct.current,T)||(ct.current=T,zn())}};qe=Number(qe),U=Number(U),nt=nt||_t,rt=rt||_t,tt=tt||_t;var ft=0,pt=0,Oe,It=1;be&&(typeof be=="object"?(ft=be.strokeLen?Number(be.strokeLen):Number(U)*2,pt=be.strokeLen?Number(be.nonStrokeLen):Number(U),Oe=be.animation?Number(be.animation):null):typeof be=="boolean"&&(ft=Number(U)*2,pt=Number(U),Oe=null));var Et=null,ht=null,Ct=null;de&&(typeof de=="string"||"type"in de?ht=de:["start","middle","end"].some(function(T){return T in de})&&(de=de,Et=de.start,ht=de.middle,Ct=de.end));var Ln=function(T){return typeof T=="string"&&(T in C.arrowShapes?T=C.arrowShapes[T]:(console.warn("'"+T+"' is not supported arrow shape. the supported arrow shapes is one of "+C.tArrowShapes+`.
           reverting to default shape.`),T=C.arrowShapes.arrow1)),T=T,(T==null?void 0:T.offsetForward)===void 0&&(T.offsetForward=.25),(T==null?void 0:T.svgElem)===void 0&&(T.svgElem="path"),(T==null?void 0:T.svgProps)===void 0&&(T.svgProps=C.arrowShapes.arrow1.svgProps),T};Pe=Ln(Pe),Te=Ln(Te);var Br=function(){var T=Mt.current.getBoundingClientRect(),A=T.left,Z=T.top,Ie=getComputedStyle(Mt.current),Ee=Number(Ie.left.slice(0,-2)),ee=Number(Ie.top.slice(0,-2));return{x:A-Ee,y:Z-ee}},Bn=function(T){var A=T.getBoundingClientRect();return{x:A.left,y:A.top,right:A.right,bottom:A.bottom}},Rn=function(){var T=Bn(it.current),A=Bn(lt.current);return{start:T,end:A}},zn=function(T){var A,Z;T===void 0&&(T=ct.current);var Ie=T.start,Ee=T.end,ee=0,ue=0,Gn=I.prepareAnchor(q,Ie),An=I.prepareAnchor(Sr,Ee),qn=I.getShortestLine(Gn,An),Hn=qn.chosenStart,Wn=qn.chosenEnd,Ce=Hn.anchor.position,fe=Wn.anchor.position,ze=D.default.pick(Hn,["x","y"]),Fe=D.default.pick(Wn,["x","y"]);Pe=Pe,Te=Te;var $t=Br(),Vn=Math.min(ze.x,Fe.x)-$t.x,Qn=Math.min(ze.y,Fe.y)-$t.y,Lt=Fe.x-ze.x,Bt=Fe.y-ze.y,W=Math.abs(Fe.x-ze.x),V=Math.abs(Fe.y-ze.y),B=Lt>0?1:-1,z=Bt>0?1:-1,Xn=[Pe.offsetForward,Te.offsetForward],ke=Xn[0],De=Xn[1],X=qe*U,K=jt*U,gt=0,Qe=0,Xe=0,Ke=0,Ue=X*ke,yt=K*De,oe=Number(kr);Re=Number(Re),C.tPaths.includes(ye)||(ye="smooth"),ye==="straight"&&(oe=0,ye="smooth");var Ar=qe>jt?qe:jt,_e=U+U*Ar/2,Je=_e,pe=_e,he=_e,Ye=_e;pe+=Number(ot),Je+=Number(ot),he+=Number(ot),Ye+=Number(ot);var se=0,te=W,ie=0,ne=V;if(Lt<0&&(A=[te,se],se=A[0],te=A[1]),Bt<0&&(Z=[ne,ie],ie=Z[0],ne=Z[1]),oe===0){var me=Math.atan(V/W);Ae&&(te-=X*(1-ke)*B*Math.cos(me),ne-=X*(1-ke)*z*Math.sin(me),me*=z,B<0&&(me=(Math.PI-me*B)*B),gt=Math.cos(me)*Ue-Math.sin(me)*X/2,Qe=Math.cos(me)*X/2+Math.sin(me)*Ue,ee=me*180/Math.PI);var ve=Math.atan(V/W);He&&(se+=K*(1-De)*B*Math.cos(ve),ie+=K*(1-De)*z*Math.sin(ve),ve*=-z,B>0&&(ve=(Math.PI-ve*B)*B),Xe=Math.cos(ve)*yt-Math.sin(ve)*K/2,Ke=Math.cos(ve)*K/2+Math.sin(ve)*yt,ue=ve*180/Math.PI)}else fe==="middle"&&(W>V?fe=B?"left":"right":fe=z?"top":"bottom"),Ae&&(["left","right"].includes(fe)?(gt+=Ue*B,te-=X*(1-ke)*B,Qe+=X*B/2,fe==="left"?(ee=0,B<0&&(ee+=180)):(ee=180,B>0&&(ee+=180))):["top","bottom"].includes(fe)&&(gt+=X*-z/2,Qe+=Ue*z,ne-=X*z-Qe,fe==="top"?(ee=270,z>0&&(ee+=180)):(ee=90,z<0&&(ee+=180))));He&&oe!==0&&(["left","right"].includes(Ce)?(Xe+=yt*-B,se+=K*B+Xe,Ke+=-(K*B)/2,Ce==="left"?(ue=180,B<0&&(ue+=180)):(ue=0,B>0&&(ue+=180))):["top","bottom"].includes(Ce)&&(Ke+=yt*-z,ie+=K*z+Ke,Xe+=K*z/2,Ce==="top"?(ue=90,z>0&&(ue+=180)):(ue=270,z<0&&(ue+=180))));var qr={x:gt,y:Qe},Hr={x:Xe,y:Ke},J=se,Y=ie,re=te,ae=ne,Rt={};ye==="smooth"?Rt={hh:function(){J+=W*oe*B,re-=W*oe*B},vv:function(){Y+=V*oe*z,ae-=V*oe*z},hv:function(){J+=W*oe*B,ae-=V*oe*z},vh:function(){Y+=V*oe*z,re-=W*oe*B}}:ye==="grid"&&(Rt={hh:function(){J+=W*Re*B,re-=W*(1-Re)*B,Ae&&(J-=X*(1-ke)/2*B,re+=X*(1-ke)/2*B),He&&(J-=K*(1-De)/2*B,re+=K*(1-De)/2*B)},vv:function(){Y+=V*Re*z,ae-=V*(1-Re)*z,Ae&&(Y-=X*(1-ke)/2*z,ae+=X*(1-ke)/2*z),He&&(Y-=K*(1-De)/2*z,ae+=K*(1-De)/2*z)},hv:function(){J=te},vh:function(){Y=ne}});var le="";["left","right"].includes(Ce)?le+="h":["bottom","top"].includes(Ce)?le+="v":Ce==="middle"&&(le+="m"),["left","right"].includes(fe)?le+="h":["bottom","top"].includes(fe)?le+="v":fe==="middle"&&(le+="m"),W>V?le=le.replace(/m/g,"h"):le=le.replace(/m/g,"v"),Rt[le](),J+=Er,Y+=Cr,re+=Dr,ae+=Nr;var Kn=L.buzzierMinSols(se,J,re,te),Un=Kn[0],Jn=Kn[1],Yn=L.buzzierMinSols(ie,Y,ae,ne),Zn=Yn[0],er=Yn[1];Un<0&&(pe+=-Un),Jn>W&&(Je+=Jn-W),Zn<0&&(he+=-Zn),er>V&&(Ye+=er-V),ye==="grid"&&(pe+=_e,Je+=_e,he+=_e,Ye+=_e),se+=pe,te+=pe,ie+=he,ne+=he,J+=pe,re+=pe,Y+=he,ae+=he;var Wr=W+pe+Je,Vr=V+he+Ye;Vn-=pe,Qn-=he;var bt=L.bzFunction(se,J,re,te),xt=L.bzFunction(ie,Y,ae,ne),Qr={x:bt(.01),y:xt(.01)},Xr={x:bt(.5),y:xt(.5)},Kr={x:bt(.99),y:xt(.99)},Ur={x:bt(1),y:xt(1)},zt;ye==="grid"?zt="M "+se+" "+ie+" L  "+J+" "+Y+" L "+re+" "+ae+" "+te+" "+ne:ye==="smooth"&&(zt="M "+se+" "+ie+" C "+J+" "+Y+", "+re+" "+ae+", "+te+" "+ne),$n({cx0:Vn,cy0:Qn,x1:se,x2:te,y1:ie,y2:ne,cw:Wr,ch:Vr,cpx1:J,cpy1:Y,cpx2:re,cpy2:ae,dx:Lt,dy:Bt,absDx:W,absDy:V,headOrient:ee,tailOrient:ue,labelStartPos:Qr,labelMiddlePos:Xr,labelEndPos:Kr,arrowEnd:Ur,excLeft:pe,excRight:Je,excUp:he,excDown:Ye,headOffset:Ue,arrowHeadOffset:qr,arrowTailOffset:Hr,startPoints:Gn,endPoints:An,mainDivPos:$t,xSign:B,ySign:z,lineLength:We.current.getTotalLength(),fHeadSize:X,fTailSize:K,arrowPath:zt})},Rr=P.x2-P.arrowHeadOffset.x,zr=P.y2-P.arrowHeadOffset.y,Fr=P.x1-P.arrowTailOffset.x,Gr=P.y1-P.arrowTailOffset.y,Fn=ft+pt;Oe<0&&(Oe*=-1,It=-1);var Dt,mt,Nt,Ve,vt=0;return xe&&Ot==!1?(typeof xe=="boolean"&&(xe=1),mt=xe+"s",Dt=P.lineLength,Ve=P.lineLength,Nt=1,xe<0&&(R=[vt,Ve],Ve=R[0],vt=R[1],mt=xe*-1+"s")):(Dt=ft+" "+pt,mt=1/Oe+"s",Ve=Fn*It,Nt="indefinite",vt=0),n.useLayoutEffect(function(){ut()}),n.useLayoutEffect(function(){it.current=k.getElementByPropGiven(j.start)},[j.start]),n.useLayoutEffect(function(){lt.current=k.getElementByPropGiven(j.end)},[j.end]),n.useLayoutEffect(function(){We.current&&$n(function(T){var A,Z;return S(S({},T),{lineLength:(Z=(A=We.current)===null||A===void 0?void 0:A.getTotalLength())!==null&&Z!==void 0?Z:0})})},[We.current]),n.useEffect(function(){at&&(dt.current=g,it.current=k.getElementByPropGiven(j.start),lt.current=k.getElementByPropGiven(j.end),ut());var T=function(){window.addEventListener("resize",ut);var Z=function(){var Ee;Dn(!0),En.current.beginElement(),(Ee=In.current)===null||Ee===void 0||Ee.beginElement()},Ie=function(){return st.current.style.opacity="0"};return Me.current&&st.current&&(Me.current.addEventListener("endEvent",Z),Me.current.addEventListener("beginEvent",Ie)),function(){window.removeEventListener("resize",ut),Me.current&&(Me.current.removeEventListener("endEvent",Z),st.current&&Me.current.removeEventListener("beginEvent",Ie))}},A=T();return function(){Dn(!1),A()}},[at]),n.default.createElement("div",S({},Mr,{style:S({position:"absolute"},Or)},$r),at?n.default.createElement(n.default.Fragment,null,n.default.createElement("svg",S({ref:Mt,width:P.cw,height:P.ch,style:S({position:"absolute",left:P.cx0,top:P.cy0,pointerEvents:"none",border:Tt?"1px dashed yellow":null},Ir),overflow:"auto"},Tr),n.default.createElement("path",S({ref:We,d:P.arrowPath,stroke:tt,strokeDasharray:Dt,strokeWidth:U,fill:"transparent",pointerEvents:"visibleStroke"},Pt,_r),n.default.createElement(n.default.Fragment,null,Ot?n.default.createElement(n.default.Fragment,null,Oe?n.default.createElement("animate",{ref:In,attributeName:"stroke-dashoffset",values:Fn*It+";0",dur:1/Oe+"s",repeatCount:"indefinite"}):null):n.default.createElement(n.default.Fragment,null,xe?n.default.createElement("animate",{ref:Me,id:"svgEndAnimate",attributeName:"stroke-dashoffset",values:Ve+";"+vt,dur:mt,repeatCount:Nt}):null))),He?n.default.createElement(Te.svgElem,S({fill:rt,pointerEvents:"auto",transform:"translate("+Fr+","+Gr+") rotate("+P.tailOrient+") scale("+P.fTailSize+")"},Te.svgProps,Pt,Pr)):null,Ae?n.default.createElement(Pe.svgElem,S({ref:st,fill:nt,pointerEvents:"auto",transform:"translate("+Rr+","+zr+") rotate("+P.headOrient+") scale("+P.fHeadSize+")",opacity:xe&&!Ot?0:1},Pe.svgProps,Pt,jr),n.default.createElement("animate",{ref:En,dur:"0.4",attributeName:"opacity",from:"0",to:"1",begin:"indefinite",repeatCount:"0",fill:"freeze"}),") : null"):null,Tt?n.default.createElement(n.default.Fragment,null,n.default.createElement("circle",{r:"5",cx:P.cpx1,cy:P.cpy1,fill:"green"}),n.default.createElement("circle",{r:"5",cx:P.cpx2,cy:P.cpy2,fill:"blue"}),n.default.createElement("rect",{x:P.excLeft,y:P.excUp,width:P.absDx,height:P.absDy,fill:"none",stroke:"pink",strokeWidth:"2px"})):null),Et?n.default.createElement("div",{style:{transform:P.dx<0?"translate(-100% , -50%)":"translate(-0% , -50%)",width:"max-content",position:"absolute",left:P.cx0+P.labelStartPos.x,top:P.cy0+P.labelStartPos.y-U-5}},Et):null,ht?n.default.createElement("div",{style:{display:"table",width:"max-content",transform:"translate(-50% , -50%)",position:"absolute",left:P.cx0+P.labelMiddlePos.x,top:P.cy0+P.labelMiddlePos.y}},ht):null,Ct?n.default.createElement("div",{style:{transform:P.dx>0?"translate(-100% , -50%)":"translate(-0% , -50%)",width:"max-content",position:"absolute",left:P.cx0+P.labelEndPos.x,top:P.cy0+P.labelEndPos.y+U+5}},Ct):null,Tt?n.default.createElement(n.default.Fragment,null,r(r([],P.startPoints),P.endPoints).map(function(T,A){return n.default.createElement("div",{key:A,style:{background:"gray",opacity:.5,borderRadius:"50%",transform:"translate(-50%, -50%)",height:5,width:5,position:"absolute",left:T.x-P.mainDivPos.x,top:T.y-P.mainDivPos.y}})})):null):null)},_=l.default.oneOf(C.tAnchorEdge),E=l.default.exact({position:_.isRequired,offset:l.default.exact({rightness:l.default.number,bottomness:l.default.number}).isRequired}),F=l.default.oneOfType([_,E]),O=l.default.oneOfType([F,l.default.arrayOf(F)]),H=l.default.oneOfType([l.default.string,l.default.exact({current:l.default.any})]),Q=l.default.oneOfType([l.default.element,l.default.string]),Se=l.default.exact({start:Q,middle:Q,end:Q}),Be=l.default.oneOf(Object.keys(C.arrowShapes)),je=l.default.oneOf(C.tSvgElems),ce=l.default.oneOfType([Be,l.default.exact({svgElem:je,svgProps:l.default.any,offsetForward:l.default.number}).isRequired]);x.propTypes={start:H.isRequired,end:H.isRequired,startAnchor:O,endAnchor:O,label:l.default.oneOfType([Q,Se]),color:l.default.string,lineColor:l.default.string,showHead:l.default.bool,headColor:l.default.string,headSize:l.default.number,tailSize:l.default.number,tailColor:l.default.string,strokeWidth:l.default.number,showTail:l.default.bool,path:l.default.oneOf(C.tPaths),showXarrow:l.default.bool,curveness:l.default.number,gridBreak:l.default.number,dashness:l.default.oneOfType([l.default.bool,l.default.object]),headShape:ce,tailShape:ce,animateDrawing:l.default.oneOfType([l.default.bool,l.default.number]),passProps:l.default.object,arrowBodyProps:l.default.object,arrowHeadProps:l.default.object,arrowTailProps:l.default.object,SVGcanvasProps:l.default.object,divContainerProps:l.default.object,_extendSVGcanvas:l.default.number,_debug:l.default.bool,_cpx1Offset:l.default.number,_cpy1Offset:l.default.number,_cpx2Offset:l.default.number,_cpy2Offset:l.default.number},c.default=x},"./src/index.tsx":function(h,c,i){var S=this&&this.__createBinding||(Object.create?function(a,r,v,n){n===void 0&&(n=v),Object.defineProperty(a,n,{enumerable:!0,get:function(){return r[v]}})}:function(a,r,v,n){n===void 0&&(n=v),a[n]=r[v]}),N=this&&this.__exportStar||function(a,r){for(var v in a)v!=="default"&&!Object.prototype.hasOwnProperty.call(r,v)&&S(r,a,v)},M=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var p=i("./src/Xarrow.tsx");Object.defineProperty(c,"default",{enumerable:!0,get:function(){return M(p).default}}),N(i("./src/types.ts"),c)},"./src/types.ts":function(h,c){Object.defineProperty(c,"__esModule",{value:!0}),c.tArrowShapes=c.arrowShapes=c.tFacingDir=c.tSvgElems=c.tPaths=c.tAnchorEdge=void 0,c.tAnchorEdge=["middle","left","right","top","bottom","auto"],c.tPaths=["smooth","grid","straight"],c.tSvgElems=["circle","ellipse","line","path","polygon","polyline","rect"],c.tFacingDir=["auto","inwards","outwards","left","right","up","down"],c.arrowShapes={arrow1:{svgElem:"path",svgProps:{d:"M 0 0 L 1 0.5 L 0 1 L 0.25 0.5 z"},offsetForward:.25},heart:{svgElem:"path",svgProps:{d:"M 0,0.25 A 0.125,0.125 0,0,1 0.5,0.25 A 0.125,0.125 0,0,1 1,0.25 Q 1,0.625 0.5,1 Q 0,0.625 0,0.25 z"},offsetForward:.1},circle:{svgElem:"circle",svgProps:{r:.5,cx:.5,cy:.5},offsetForward:0}},c.tArrowShapes=Object.keys(c.arrowShapes)},"./src/utils/anchors.ts":function(h,c,i){h=i.nmd(h);var S=this&&this.__assign||function(){return S=Object.assign||function(n){for(var k,D=1,l=arguments.length;D<l;D++){k=arguments[D];for(var L in k)Object.prototype.hasOwnProperty.call(k,L)&&(n[L]=k[L])}return n},S.apply(this,arguments)};Object.defineProperty(c,"__esModule",{value:!0}),c.getShortestLine=c.prepareAnchor=void 0;var N=i("./src/types.ts"),M=function(n,k){return{middle:{rightness:n*.5,bottomness:k*.5},left:{rightness:0,bottomness:k*.5},right:{rightness:n,bottomness:k*.5},top:{rightness:n*.5,bottomness:0},bottom:{rightness:n*.5,bottomness:k}}},p=function(n,k){var D=Array.isArray(n)?n:[n],l=D.map(function(x){return typeof x=="string"?{position:x}:x});l=l.filter(function(x){return N.tAnchorEdge.includes(x.position)}),l.length==0&&(l=[{position:"auto"}]);var L=l.filter(function(x){return x.position==="auto"});L.length>0&&(l=l.filter(function(x){return x.position!=="auto"}),l.push.apply(l,L.flatMap(function(x){return["left","right","top","bottom"].map(function(_){return S(S({},x),{position:_})})})));var I=l.map(function(x){if(typeof x=="object"){var _=x;return _.position||(_.position="auto"),_.offset||(_.offset={rightness:0,bottomness:0}),_.offset.bottomness||(_.offset.bottomness=0),_.offset.rightness||(_.offset.rightness=0),_=_,_}else return x}),C=I;return C.map(function(x){var _=M(k.right-k.x,k.bottom-k.y),E=_[x.position],F=E.rightness,O=E.bottomness;return{x:k.x+F+x.offset.rightness,y:k.y+O+x.offset.bottomness,anchor:x}})};c.prepareAnchor=p;var a=function(n,k){return Math.sqrt(Math.pow(n.x-k.x,2)+Math.pow(n.y-k.y,2))},r=function(n,k){var D=1/0,l=1/0,L;return n.forEach(function(I){k.forEach(function(C){l=a(I,C),l<D&&(D=l,L={chosenStart:I,chosenEnd:C})})}),L};if(c.getShortestLine=r,i.c[i.s]===h){var v=c.prepareAnchor(["auto"],{x:0,y:0,bottom:10,right:20});console.log(v)}},"./src/utils/index.ts":function(h,c){Object.defineProperty(c,"__esModule",{value:!0}),c.measureFunc=c.factorDpathStr=c.getElementByPropGiven=void 0;var i=function(M){var p;return typeof M=="string"?p=document.getElementById(M):p=M==null?void 0:M.current,p};c.getElementByPropGiven=i;var S=function(M,p){var a=M.split(/(\d+(?:\.\d+)?)/);return a=a.map(function(r){return Number(r)?(Number(r)*p).toString():r}),a.join("")};c.factorDpathStr=S;var N=function(M,p){p===void 0&&(p="");var a=performance.now(),r=M();return console.log("time ",p,":",performance.now()-a),r};c.measureFunc=N},lodash:function(h){h.exports=u},"prop-types":function(h){h.exports=y},react:function(h){h.exports=f}},b={};function w(h){var c=b[h];if(c!==void 0)return c.exports;var i=b[h]={id:h,loaded:!1,exports:{}};return d[h].call(i.exports,i,i.exports,w),i.loaded=!0,i.exports}w.c=b,function(){w.d=function(h,c){for(var i in c)w.o(c,i)&&!w.o(h,i)&&Object.defineProperty(h,i,{enumerable:!0,get:c[i]})}}(),function(){w.o=function(h,c){return Object.prototype.hasOwnProperty.call(h,c)}}(),function(){w.r=function(h){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})}}(),function(){w.nmd=function(h){return h.paths=[],h.children||(h.children=[]),h}}();var s=w(w.s="./src/index.tsx");return s}()})})(Po);const To=Aa(Wt);function ur({chartRef:e,onDetach:o,...f}){const[u,y]=m.useState({attached:!1});m.useEffect(()=>{console.log(">>GanttChart/index::","chartRef",e);const b=e.current.lastHoveredBarId,w=G(e,`current.predecessors.${b}`),s=G(e,`current.successors.${b}`);console.log(">>GanttChart/index::","predecessors,successors",w,s),f.id==="gantt-connector-right"?y(h=>({...h,attached:!!s})):f.id==="gantt-connector-left"&&y(h=>({...h,attached:!!w}))},[]);const d={...f};return u.attached&&(d.onClick=b=>{b.stopPropagation(),o&&o()}),t.jsx(pa,{title:u.attached?"Remove":"Connect",children:t.jsx(pr,{...d,size:"small",children:u.attached?t.jsx(Ha,{}):t.jsx(Ba,{})})})}const wr="#ff1e1e",fr="#gantt",Mo=Le(e=>({wrapper:{},cursor:{position:"fixed",pointerEvents:"none",zIndex:9999},arrowBtn:{color:wr,backgroundColor:e.palette.background.default}}));function Oo({tasks:e,viewMode:o,onDateChange:f,onDependencyChange:u,barHeight:y}){const[d,b]=m.useState({connecting:!1,gantt:null,arrow:null}),w=Mo(),s=m.useRef({}),h=d.gantt;s.current.gantt=h,s.current.onDateChange=f,s.current.onDependencyChange=u,s.current.connecting=d.connecting;const c=m.useCallback(()=>{b(a=>({...a,connecting:!1,arrow:null})),s.current.rightBtnHovered=!1,s.current.leftBtnHovered=!1},[]);m.useEffect(()=>(document.addEventListener("mouseup",c),()=>{document.removeEventListener("mouseup",c)}),[c]),s.current.gridEvents=m.useMemo(()=>({mouseover:()=>{var a,r;s.current.barHovered=!1,!s.current.leftBtnHovered&&((a=s.current.connecting)==null?void 0:a.pos)!=="left"&&i.current.close(),!s.current.rightBtnHovered&&((r=s.current.connecting)==null?void 0:r.pos)!=="right"&&S.current.close(),b(v=>({...v,arrow:{start:`gantt-connector-${s.current.connecting.pos}`,end:null}}))}}),[]),s.current.barEvents=m.useMemo(()=>({mouseup:()=>{let a,r;s.current.connecting&&(s.current.connecting.target==="left"?(r=s.current.connecting.barId,a=s.current.lastHoveredBarId):(r=s.current.lastHoveredBarId,a=s.current.connecting.barId),s.current.onDependencyChange&&s.current.onDependencyChange({op:"create",taskId:r,dependency:a}),b(v=>({...v,connecting:!1,arrow:null})))},mouseover:a=>{const r=a.target.closest(".bar-wrapper");if(!r)return;const v=r.querySelector("rect.bar");s.current.barHovered=!0,s.current.lastHoveredBarId=r.getAttribute("data-id"),!s.current.leftBtnHovered&&i.current.open(v),!s.current.rightBtnHovered&&S.current.open(v),s.current.connecting&&Ze.delay(250).then(()=>{b(n=>({...n,arrow:{start:`gantt-connector-${s.current.connecting.pos}`,end:`gantt-connector-${s.current.connecting.target}`}}))})}}),[]);const i=m.useRef(null),S=m.useRef(null),N=ha("/libs/frappe-gantt.js");m.useEffect(()=>{h&&h.change_view_mode(o||"Week")},[h,o]),m.useEffect(()=>{if(N!=="ready"||!e||e.length<1||s.current.gantt)return;console.log(">>GanttChart/index::","tasks",e);const a=new window.Gantt(fr,e,{view_mode:o,on_click:function(r){console.log(">>SchedGanttChart/index::","task",r)},on_date_change:async function(r,v,n){console.log(">>SchedGanttChart/index::","date_changed",r,v,n),s.current.onDateChange(r,v,n)},on_progress_change:function(r,v){console.log(">>SchedGanttChart/index::",r,v)},bar_height:y});b(r=>({...r,gantt:a}))},[e,o,N,y]),m.useEffect(()=>{if(!(!h||e.length<1)){console.log(">>GanttChart/index::","tasks",e),h.refresh(e),Ze.delay(100).then(()=>{const a=h.$svg;if(!a)return;const r=a.querySelectorAll("g.bar-wrapper"),v=a.querySelector("g.grid");for(const D in s.current.gridEvents)v.addEventListener(D,s.current.gridEvents[D]);for(const D of r){const l=D.querySelector("g.bar-group");if(l)for(const L in s.current.barEvents)l.addEventListener(L,s.current.barEvents[L])}const n=document.getElementById(fr.replace("#","")),k=n==null?void 0:n.querySelector(".today-highlight");k&&(k.style.scrollMargin="100px",k.scrollIntoView({behavior:"smooth",block:"start",inline:"start"}))}),s.current.tasksByKey={},s.current.successors={},s.current.predecessors={};for(const a of e){Ft(s,["current","tasksByKey",a.id],a);for(const r of a.dependencies||[])Ft(s,["current","successors",r,a.id],!0),Ft(s,["current","predecessors",a.id,r],!0)}}},[h,e]);const M=m.useCallback(a=>()=>{const r=s.current.lastHoveredBarId;console.log(">>SchedGanttChart/GanttChart::","connect barId",r),b(v=>({...v,connecting:{barId:r,pos:a,target:a==="right"?"left":"right"},arrow:{start:`gantt-connector-${a}`}}))},[]),p=a=>async()=>{console.log(">>GanttChart/index::","pos",a);const r=s.current.lastHoveredBarId;console.log(">>GanttChart/index::","detach barId",r);const v=[];if(a==="right"){const n=G(s,`current.successors.${r}`,{});console.log(">>GanttChart/index::","successors",n);for(const k in n)v.push({taskId:k,dependency:r})}else if(a==="left"){const n=G(s,`current.predecessors.${r}`,{});console.log(">>GanttChart/index::","predecessors",n);for(const k in n)v.push({taskId:r,dependency:k})}await Ze.map(v,async({taskId:n,dependency:k})=>{s.current.onDependencyChange({op:"delete",taskId:n,dependency:k})},{concurrency:5})};return t.jsxs("div",{className:w.wrapper,children:[N!=="ready"&&t.jsx(kt,{}),t.jsx("svg",{id:"gantt"}),t.jsx(Ne,{variant:"popper",ref:i,popperProps:{placement:"left"},children:t.jsx(ur,{id:"gantt-connector-left",size:"small",chartRef:s,className:w.arrowBtn,onDetach:p("left"),onMouseDown:M("left"),onMouseEnter:()=>{s.current.leftBtnHovered=!0},onMouseLeave:()=>{var a;((a=s.current.connecting)==null?void 0:a.pos)!=="left"&&(s.current.leftBtnHovered=!1,i.current.close())}})}),t.jsx(Ne,{variant:"popper",ref:S,popperProps:{placement:"right"},children:t.jsx(ur,{id:"gantt-connector-right",size:"small",chartRef:s,className:w.arrowBtn,onDetach:p("right"),onMouseDown:M("right"),onMouseEnter:()=>{s.current.rightBtnHovered=!0},onMouseLeave:()=>{var a;((a=s.current.connecting)==null?void 0:a.pos)!=="right"&&(s.current.rightBtnHovered=!1,S.current.close())}})}),d.arrow&&t.jsx(Io,{id:"gantt-cursor",className:w.cursor,arrow:d.arrow})]})}function Io({id:e,className:o,arrow:f}){const[u,y]=m.useState({x:0,y:0}),d=m.useCallback(b=>{y({x:b.clientX,y:b.clientY})},[]);return m.useEffect(()=>(document.addEventListener("mousemove",d),()=>{document.removeEventListener("mousemove",d)}),[d]),t.jsxs(t.Fragment,{children:[u.x>0&&t.jsx(To,{divContainerProps:{className:"x-arrow",style:{pointerEvents:"none"}},path:"grid",headSize:0,start:f.start,end:f.end||"gantt-cursor",dashness:!f.end,startAnchor:"middle",endAnchor:"middle",color:wr}),t.jsx("div",{id:e,className:o,style:{left:`${u.x}px`,top:`${u.y}px`}})]})}const Eo=Le({root:{"& > *":{height:"100% !important",minHeight:"350px"}}});function Co({children:e,paddingBottom:o=0,paddingRight:f=0,stretchWidth:u=!1,onStretch:y=()=>{}}){const d=m.useRef({}),b=m.useRef(null);d.current.paddingBottom=o,d.current.paddingRight=f,d.current.stretchWidth=u,d.current.onStretch=y;const w=Eo();return m.useEffect(()=>{const s=b.current;if(!s)return;const h=Wa(function(){var N,M;const i=s.getBoundingClientRect(),S=window.innerHeight-i.top;if(s.style.height=`${S-d.current.paddingBottom}px`,d.current.stretchWidth){console.log(">>Flex/FlexStretch::","rect,window.innerWidth",i,window.innerWidth);const p=window.innerWidth-i.left;s.style.width=`${p-d.current.paddingRight}px`}(M=(N=d.current).onStretch)==null||M.call(N,i)},100),c=new ResizeObserver(h,{rootMargin:"0px",threshold:1});return b.current&&c.observe(s),()=>{c.unobserve(s)}},[]),t.jsx("div",{ref:b,className:w.root,children:e})}const Do=420,No=Le(e=>({root:{marginBottom:e.spacing(6)},controls:{display:"flex",alignItems:"center",marginBottom:"24px","& .MuiButtonGroup-root":{height:"55px"},"& .MuiButtonGroup-root button":{padding:"20px"}},chartWrapper:{display:"flex"}}));function bs({recordId:e,recordTypes:o}){const[f,u]=m.useState({viewMode:"Week",taskData:[]}),[y,d]=ma({recordId:ar,itemsPerNode:ba,recordTypes:xa,sort:ar}),b=y.itemsPerNode||1e3,w=o||y.recordTypes||["Project","Opportunity"],s=e||y.recordId,h=No(),{enqueueSnackbar:c}=Ia(),i=hr(),S=m.useCallback(p=>{u(a=>({...a,taskData:p||[]}))},[]),N=m.useCallback(async(p,a,r)=>{await xr(i,{id:p.id,start:a,end:r})},[i]),M=m.useCallback(async p=>{var D,l;if(console.log(">>SchedGanttChart/index::","data",p),!p)return;const[a,r]=p.taskId.split("#"),[v,n]=p.dependency.split("#"),k=ge[a];if(!(v===a&&k.allowDependencies)){c("Invalid dependency",{variant:"warning"});return}if(v==="Task"){if(p.op==="delete"){const L=await i.query({query:we`
              {
                q:taskPredecessorByTaskId(
                  taskId: ${JSON.stringify(r)}
                  filter: {
                    parentId: { eq: ${JSON.stringify(n)} }
                  }
                  limit: 999
                ) {
                  items {
                    id
                    parentId
                    taskId
                    parent {
                      id
                      title
                    }
                    task {
                      id
                      title
                    }
                  }
                }
              }
            `,fetchPolicy:"network-only"}),I=G(L,"data.q.items.0.id");if(!I){c("Cant delete dependency",{variant:"warning"});return}await i.mutate({mutation:we`mutation{
              deleteTaskPredecessor(input:{id:${JSON.stringify(I)}}){
                id
                task {
                  ${qt("Task")}
                }
                parent {
                  ${qt("Task")}
                }
              }
            }`})}else if(p.op==="create"){const L=await i.query({query:we`
            {
              rec: getTask(id: ${JSON.stringify(r)}) {
                id
                projectId
                opportunityId
              }
              dep: getTask(id: ${JSON.stringify(n)}) {
                id
                projectId
                opportunityId
              }
            }
          `,fetchPolicy:"network-only"});console.log(">>SchedGanttChart/index::","checkQ",L);const I=(D=L.data)==null?void 0:D.rec,C=(l=L.data)==null?void 0:l.dep;if(!I||!C||I.opportunityId!==C.opportunityId||I.projectId!==C.projectId)return;let x="Opportunity",_=I.opportunityId;I.projectId&&(x="Project",_=I.projectId),await i.mutate({mutation:we`
          mutation($input: CreateTaskPredecessorInput!) {
            createTaskPredecessor(input: $input) {
              id
              ${k.predecessor.taskField} {
                id
                predecessors(limit: 25) {
                  items {
                    id
                    ${k.predecessor.parentField} {
                      id
                      ${k.label}
                      ${k.start}
                      ${k.end}
                    }
                  }
                }
              }
            }
          }
        `,variables:{input:{[`${k.predecessor.parentField}Id`]:r,[`${k.predecessor.taskField}Id`]:n,rootType:x,rootId:_}}})}}},[i,c]);return t.jsxs("div",{className:h.root,children:[t.jsx(Yr,{mt:3,mb:3,children:"GANTT CHART"}),t.jsxs("div",{children:[t.jsx("div",{className:h.controls,children:t.jsxs($e,{marginRight:2,display:"flex",children:[!e&&t.jsx(Gt,{width:"500px",children:t.jsx(va,{shrinkLabel:!0,fullWidth:!0,model:"Project,Opportunity",label:"Project/Opportunity",placeholder:"Search...",value:s,iconStyles:{marginTop:"0px"},onChange:p=>{const a=p.currentTarget.value;d({recordId:a})},icon:ga})}),t.jsx(Gt,{width:"190px",ml:e?0:1,children:t.jsx(nr,{variant:"default",fullWidth:!0,value:b,label:"Items Per Node",disableClearable:!0,icon:rr,iconStyles:{marginTop:"0px"},onChange:p=>{const a=p.currentTarget.value;d({itemsPerNode:Number(a)})},options:["10","20","50","100","1000"].map(p=>({value:Number(p),text:p}))})}),t.jsx(Gt,{width:"300px",ml:1,children:t.jsx(nr,{shrinkLabel:!0,fullWidth:!0,variant:"default",value:y.sort,label:"Sort",disableClearable:!0,icon:rr,iconStyles:{marginTop:"0px"},onChange:p=>{const a=p.currentTarget.value;d({sort:a})},options:[{value:"precedence",text:"Precedence"},{value:"start",text:"Start Date"}]})}),t.jsx($e,{display:"flex",alignItems:"center",ml:1,children:t.jsx(ya,{value:f.viewMode,options:["Day","Week","Month"],onChange:(p,a)=>{u(r=>({...r,viewMode:a}))}})}),!o&&t.jsx($e,{display:"flex",alignItems:"center",ml:1,children:t.jsx(jo,{options:[{value:"Project",label:t.jsx(vr,{}),title:"Show/Hide Projects"},{value:"Opportunity",label:t.jsx(gr,{}),title:"Show/Hide Opportunities"}],value:w,onChange:(p,a)=>{d({recordTypes:a})}})})]})}),t.jsxs("div",{className:h.chartWrapper,children:[t.jsx($e,{width:`${Do}px`,children:t.jsx(ko,{itemsPerNode:b,onData:S,rootTypes:w,rootId:s,rowHeight:"58px",sortKey:y.sort},`${w.join("_")}::${b}`)}),t.jsx(Co,{stretchWidth:!0,paddingRight:100,children:t.jsx(Oo,{barHeight:40,viewMode:f.viewMode,tasks:f.taskData,onDateChange:N,onDependencyChange:M})})]})]})]})}export{bs as default};
