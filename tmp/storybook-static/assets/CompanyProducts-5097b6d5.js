import{j as e}from"./TransitionGroupContext-9d36972e.js";import{R as d}from"./index-f1f749bf.js";import{P as le}from"./index-79afbab1.js";import{F as ae,Y as Q,T as $,B as u,bN as T,p as O,L as F,cr as E,V as J,m as W,d as A,o as K,u as M,l as w,bG as Y,b as L,ah as ce,ai as de,aj as ue,bP as pe,i as X,ad as z,W as ee,P as me,K as U,ac as N,J as he,cg as xe,f as te,cs as oe,$ as ge,a6 as fe,ak as ye,a0 as je,c8 as Pe,bz as G,Z as be,z as V,D as Ce,N as Ie,Q as D,O as Z,H as Se}from"./papaparse.min-b66e70e7.js";import{e as C,S as re,c as we,s as ke,w as Fe}from"./Play-87fed129.js";import{v as B,u as Le,w as ve}from"./pick-dba65392.js";import{u as Te}from"./useBeforeSave-e049f6dd.js";import{u as se}from"./useIncludeFieldNames-35a180a9.js";import{N as _,S as Ee}from"./SelectEsModelInput-d580a9f7.js";import{M as _e,F as $e}from"./MultipleSelectFieldInput-d0cee4a2.js";import{a as Oe}from"./Save-b67fa0ac.js";import{g as P}from"./_baseForOwn-9b89c4b6.js";import{u as We}from"./useFetchMore-be228481.js";import{w as q,E as Ae}from"./index-bcfaa842.js";import{B as H}from"./Button-352c3435.js";import{u as R,f as Me}from"./react-router-19e5b27c.js";import{p as Be}from"./_arrayIncludes-2cfb33ae.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./index-96c5f47c.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./react-router-dom-60ea8218.js";import"./tiny-invariant-dd7d57d2.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./Link-c687dc07.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";import"./isNativeReflectConstruct-05c29d01.js";function Re(t){return e.jsx(ae,{...t,width:"15",viewBox:"0 0 15 15",paths:["M 14.996094 3.699219 C 14.980469 3.539062 14.878906 3.394531 14.730469 3.324219 L 7.699219 0.0429688 C 7.574219 -0.015625 7.425781 -0.015625 7.300781 0.0429688 L 0.269531 3.324219 C 0.121094 3.394531 0.0195312 3.539062 0.00390625 3.699219 C 0.00390625 3.703125 0 3.746094 0 3.75 L 0 11.71875 C 0 11.910156 0.117188 12.082031 0.292969 12.152344 L 7.324219 14.964844 C 7.382812 14.988281 7.441406 15 7.5 15 C 7.558594 15 7.617188 14.988281 7.675781 14.964844 L 14.707031 12.152344 C 14.882812 12.082031 15 11.910156 15 11.71875 L 15 3.75 C 15 3.746094 14.996094 3.703125 14.996094 3.699219 Z M 7.5 0.984375 L 13.351562 3.71875 L 11.097656 4.617188 L 5.136719 2.089844 Z M 3.992188 2.621094 L 9.863281 5.113281 L 7.5 6.058594 L 1.648438 3.71875 Z M 0.9375 4.441406 L 7.03125 6.878906 L 7.03125 13.839844 L 0.9375 11.402344 Z M 7.96875 13.839844 L 7.96875 6.878906 L 14.0625 4.441406 L 14.0625 11.402344 Z M 7.96875 13.839844 "]})}function De(){const[t]=Q(["kwInventoryUnitMeasureList"]);return e.jsxs(B,{maxWidth:"600px",children:[e.jsx($,{variant:"overline",children:e.jsx("strong",{children:"Online Product Details"})}),e.jsx(u,{children:e.jsxs(u,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(C,{name:"period",fullWidth:!0}),e.jsx(u,{mr:2,ml:2,minWidth:"170px",children:e.jsx(re,{name:"unitOfPeriod",options:(t==null?void 0:t.kwInventoryUnitMeasureList)||[]})})]})})]})}function Ne(){return e.jsxs(B,{maxWidth:"600px",children:[e.jsx($,{variant:"overline",children:e.jsx("strong",{children:"Physical Product Details"})}),e.jsxs(u,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(C,{name:"barCode",fullWidth:!0}),e.jsx(u,{mr:2}),e.jsx(C,{name:"weight",label:"Weight",readOnlyBoxProps:{minWidth:"200px"},fullWidth:!0,InputProps:{inputComponent:_,endAdornment:e.jsx(T,{position:"start",children:"kg"})}})]}),e.jsx(qe,{})]})]})}function qe(){const[t,o]=d.useState({height:null,width:null,length:null}),{values:r={}}=O(),{dimensions:i}=r;return se(["dimensions"]),Te(n=>{console.log(">>types/ProductPhysicalFields::","values",n);const p=JSON.stringify(t),s={...n,dimensions:p,weight:Number(n.weight)};return console.log(">>types/ProductPhysicalFields::","dimensions",p),s}),console.log(">>types/ProductPhysicalFields::","values",r),d.useEffect(()=>{if(!i)return;const{width:n,height:p,length:s}=JSON.parse(i);o(a=>({...a,height:p,width:n,length:s})),console.log(">>types/ProductPhysicalFields::","set!",p,n,s)},[i]),e.jsxs(F,{text:"Dimensions (cm)",contentBox:{display:"flex",justifyContent:"space-between",mt:2},children:[e.jsx(E,{fullWidth:!0,label:"Height",value:t.height,onChange:n=>{const p=n.target.value;o(s=>({...s,height:p}))},InputProps:{inputComponent:_,endAdornment:e.jsx(T,{position:"end",children:"cm"})}}),e.jsx(u,{width:"80px",textAlign:"center",alignSelf:"center"}),e.jsx(E,{fullWidth:!0,label:"Width",value:t.width,onChange:n=>{const p=n.target.value;o(s=>({...s,width:p}))},InputProps:{inputComponent:_,endAdornment:e.jsx(T,{position:"end",children:"cm"})}}),e.jsx(u,{width:"80px",textAlign:"center",alignSelf:"center"}),e.jsx(E,{fullWidth:!0,label:"Length",value:t.length,onChange:n=>{const p=n.target.value;o(s=>({...s,length:p}))},InputProps:{inputComponent:_,endAdornment:e.jsx(T,{position:"end",children:"cm"})}})]})}function Qe(){const[t]=Q(["kwInventoryUnitMeasureList"]);return e.jsxs(B,{maxWidth:"600px",children:[e.jsx($,{variant:"overline",children:e.jsx("strong",{children:"Service Product Details"})}),e.jsxs(u,{mt:2,children:[e.jsx(u,{minWidth:"170px",mb:2,children:e.jsx(re,{fullWidth:!0,name:"unitOfMeasure",options:(t==null?void 0:t.kwInventoryUnitMeasureList)||[]})}),e.jsx(ze,{})]})]})}function ze(){const[t]=Q(["kwTeamMemberSkillsList"]);return e.jsx(e.Fragment,{children:e.jsx(_e,{fullWidth:!0,name:"skill",label:"Skill(s)",placeholder:"Skill(s)",parseValue:o=>{if(o)return JSON.parse(o).map(r=>({value:r}))},formatValue:o=>JSON.stringify(o.map(r=>r.value)),readOnlyDisplay:Ue,options:t.kwTeamMemberSkillsList||[]})})}function Ue(t=[]){return e.jsx(F,{text:"SKILL(S)",mb:2,children:t.map(o=>e.jsx(J,{label:o.value},o.value))})}function He(){return e.jsxs(B,{maxWidth:"600px",children:[e.jsx($,{variant:"overline",children:e.jsx("strong",{children:"Package Details"})}),e.jsx(u,{children:e.jsx(Ve,{})})]})}const Ge=W({root:{"& li":{marginBottom:"15px"},"& li>div":{paddingLeft:0},"& li .MuiListItemSecondaryAction-root":{display:"flex",alignItems:"center"},"& li .MuiListItemSecondaryAction-root > *":{marginLeft:10},"& li .MuiTextField-root":{width:"90px"}}});function Ve(){const[t,o]=d.useState({products:[]}),{id:r,state:{readOnly:i}}=d.useContext(A);console.log(">>types/ProductPackageFields::","parentProductId",r);const n=d.useRef(null),p=Ge(),s=K(),a=M(w`
      query ($id: ID, $nextToken: String) {
        list: packageProducts(packageId: $id, nextToken: $nextToken) {
          nextToken
          items {
            id
            qty
            price
            product {
              id
              name
              sellPrice
              type
            }
            archived
          }
        }
      }
    `,{variables:{id:r},skip:!r,fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});console.log(">>types/ProductPackageFields::","pkgProdsQ",a),We({...a,listPath:"list",maxLength:999}),d.useEffect(()=>{const c=P(a,"data.list.items",[]);o(l=>({...l,products:c}))},[a]),Le(async c=>{console.log(">>types/ProductPackageFields::","savedValues",c);const l=c==null?void 0:c.id,m=[];if((t.products||[]).forEach(g=>{m.push({id:g.id,packageId:l,productId:g.product.id,qty:g.qty,archived:g.archived,__typename:"PackageProduct",__op:g.id?"update":"create"})}),console.log(">>types/ProductPackageFields::","state.products",t.products,m),m.length>0){const g=Y(...m),S=await s.mutate({mutation:w`
      mutation (
        ${g.args}
      ){
        ${g.body}
      }
      `,variables:{...g.vars}});console.log(">>types/ProductPackageFields::","res",S)}});const h=d.useCallback((c,l)=>{const m=l==null?void 0:l._source;console.log(">>types/ProductPackageFields::","prodId",m),m&&(o(g=>({...g,products:[...g.products,{product:m,qty:1}]})),L.delay(500).then(()=>n.current.close()))},[]);console.log(">>types/ProductPackageFields::","state",t);const x=t.products.length?`(${t.products.length})`:"";return e.jsxs(F,{text:`Products${x}`,className:p.root,mt:2,children:[e.jsx(ce,{children:t.products.map((c,l)=>c.archived?null:e.jsxs(de,{dense:!0,button:!0,children:[e.jsx(ue,{primary:c.product.name}),e.jsxs(pe,{children:[e.jsx(E,{format:m=>`$${m||0}`,disabled:i,size:"small",label:"Price",value:q.numberFormatter(P(c,"product.sellPrice")||0).toFormatted(),variant:"outlined",InputProps:{startAdornment:e.jsx(T,{position:"start",children:"$"})}}),e.jsx(u,{width:"150px",textAlign:"center",children:e.jsx(E,{fullWidth:!0,disabled:i,type:"number",size:"small",label:"Qty",value:c.qty||"1",variant:"outlined"})}),!i&&e.jsx(u,{mb:1,children:e.jsx(X,{edge:"end",size:"small",onClick:()=>{o(m=>({...m,products:[...z(m.products,`${l}.archived`,!0)]}))},children:e.jsx(Oe,{})})})]})]},l))}),!i&&e.jsx(H,{size:"small",variant:"outlined",onClick:c=>{n.current.open(c.target)},children:"Add Product"}),e.jsx(ee,{ref:n,variant:"popover",anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx("div",{children:e.jsx(me,{elevation:10,children:e.jsx(u,{minWidth:"250px",p:1,children:e.jsx(U,{fullWidth:!0,model:"Product",label:"Product",sort:[{"name.keyword":{order:"asc"}}],onChange:h})})})})})]})}const k={PHYSICAL:{color:"#FF9999",fields:Ne},SERVICE:{fields:Qe,color:"#ffe283"},ONLINE:{color:"#99FFCC",fields:De},PACKAGE:{color:"#E0E0E0",fields:He}};function Ze(t,o){return{background:t?`${o.palette.primary.main} !important`:o.palette.background.paper,backgroundColor:t?`${o.palette.primary.main} !important`:o.palette.background.paper,borderColor:t?"none":"white",boxShadow:t?"unset":"0px 2px 1px -1px rgb(241, 241, 241), 0px 1px 1px 0px rgb(241, 241, 241), 0px 1px 3px 0px rgb(187, 187, 187)","& strong":{borderRadius:1.25,background:t?`linear-gradient(270deg, ${o.palette.gradient.color1} 0%, ${o.palette.gradient.color2} 100%)`:"gray",color:t?"inherit":"white",ml:.625,py:0,px:t?.875:.625}}}function ne({readOnly:t,value:o,onChange:r,typeOptions:i={}}){const n=d.useMemo(()=>{const s=[],a=N(i)?k:i;console.log(">>product/ProductTypeSelect::","typeOptions sourceOpts",a,i,N(i));for(const h in a)s.push({text:he(h),key:h,extra:a[h].extra}),console.log(">>ProductForm/ProductTypeSelect::","pType",h);return s},[i]),p=d.useCallback(s=>()=>{r&&r(s)},[r]);return console.log(">>ProductForm/ProductTypeSelect::","typeOptions",i,n),e.jsx(xe,{disabled:t,color:"primary",sx:{"& svg":{fontSize:"inherit",marginRight:5},"& button":{textTransform:"none"},"& strong":{marginLeft:5,background:"rgba(0, 0, 0, 0.08)",padding:1,paddingRight:7,paddingLeft:7,borderRadius:5}},children:n.map(s=>e.jsxs(H,{variant:o===s.key?"contained":void 0,onClick:p(s.key),sx:a=>Ze(o===s.key,a),children:[s.text,s.extra]},s.key))})}const Je=W({root:{display:"flex",alignItems:"center",flexFlow:"wrap",minHeight:46,"& > *":{marginRight:5,marginBottom:5},"& .mbs-searchable":{marginTop:5,marginBottom:5}}});function Ke({model:t,readOnly:o,onChange:r,onAdd:i,onRemove:n,style:p=null,value:s=null}){const[a,h]=d.useState({itemIds:s!=null&&s.length&&(s==null?void 0:s.length)<1?{}:null,isAdding:!1}),{isAdding:x}=a,c=Je(),l=d.useRef(null),m=te({key:"ES_MODEL_MULTI_Q",index:t.toLowerCase(),skip:a.itemIds!==null,body:{size:(s==null?void 0:s.length)||0,query:{bool:{must:[{bool:{should:(s||[]).map(y=>({term:{"id.keyword":y}}))}}]}}},cached:!0});d.useEffect(()=>{h(y=>{const f=P(m,"result.hits.hits",[]),b={...y.itemIds};return f.length<1?y:(f.forEach(I=>{const j=(I==null?void 0:I._source)||{};j.id&&(b[j.id]=j)}),{...y,itemIds:b})})},[m]),d.useEffect(()=>{x&&L.delay(200).then(()=>{l.current.focus()})},[x]);const g=d.useCallback(()=>{h(y=>({...y,isAdding:!1}))},[]),S=d.useCallback(async(y,f,b)=>{const I=P(f,"_source.id");if(!I&&!b)return;const j={...a.itemIds};I&&(j[I]=P(f,"_source"),i&&await L.resolve(i(j[I]))),b&&(n&&await L.resolve(n(j[b])),delete j[b]),r&&await L.resolve(r(j)),h(ie=>({...ie,itemIds:j,isAdding:!1}))},[i,r,n,a.itemIds]);return e.jsxs("div",{className:c.root,children:[Object.entries(a.itemIds||{}).map(y=>{const f=y[0];return e.jsx(Ye,{source:y[1],onDelete:o?void 0:()=>S(null,null,f)},f)}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{onClickAway:g,children:e.jsx(u,{display:x?"block":"none",children:e.jsx(U,{style:p,inputRef:l,variant:"slim",model:t,onChange:S})})}),!x&&e.jsx(X,{color:"default",size:"small",onClick:()=>h(y=>({...y,isAdding:!0})),children:e.jsx(we,{})})]})]})}function Ye({source:t,onDelete:o}){const[{details:r},i]=d.useState({details:null});return d.useEffect(()=>{i(n=>({...n,details:ke(t)}))},[t]),r?e.jsx(J,{label:r==null?void 0:r.display,onDelete:o}):null}const Xe=W({root:{}});function et({formRef:t}){const[o,r]=d.useState({catIds:void 0}),i=Xe(),{data:n,state:p}=d.useContext(A),s=n==null?void 0:n.id,a=M(w`
      query PROD_CAT_Q($id: ID!) {
        productCatalogues(productId: $id) {
          items {
            id
            catalogueId
          }
          nextToken
        }
      }
    `,{variables:{id:s},skip:!s,fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});console.log(">>product/ProductCatalogueInput::","debu1",s,a),d.useEffect(()=>{if(!a.data)return;const c=P(a.data,"productCatalogues.items",[]).map(l=>l.catalogueId);console.log(">>product/ProductCatalogueInput::","debu2",c),r(l=>({...l,catIds:c}))},[a.data]),console.log(">>product/ProductCategoryInput::","catQ",a);const h=d.useCallback(c=>{console.log(">>product/ProductCategoryInput::","itemIds",c);const l=[];l.push(...Object.keys(c)),r(m=>({...m,catIds:l}))},[]),x=K();return t.current.save=d.useCallback(async c=>{var y;const l={};P(a,"data.productCatalogues.items",[]).forEach(f=>l[f.catalogueId]=f);const m=[];(o.catIds||[]).forEach(f=>{if(l[f]){delete l[f];return}m.push({catalogueId:f,productId:c.id,__typename:"CatalogueProduct",__op:"create"})}),console.log(">>product/ProductCatalogueInput::","input,state.catIds,prevCatids",m,o.catIds,l);for(const f in l){const b=(y=l[f])==null?void 0:y.id;m.push({id:b,__typename:"CatalogueProduct",__op:"delete"})}const g=Y(...m);if(console.log(">>product/ProductCategoryInput::","m",g),!g)return;const S=await x.mutate({mutation:w`
        mutation (
          ${g.args}
        ){
          ${g.body}
        }
        `,variables:{...g.vars}});console.log(">>product/ProductCategoryInput::","res",S)},[x,a,o.catIds]),e.jsx("div",{className:i.root,children:e.jsx(Ke,{readOnly:p.readOnly,model:"Catalogue",value:o.catIds,onChange:h})})}const v="150px",tt=W({imageInput:{"& > *:nth-child(1)":{backgroundColor:"gainsboro",height:v,textAlign:"center"}}});function ot(){const[t,o]=d.useState({tempPhoto:null,showSupplier:!1}),r=tt(),{data:i,state:n}=d.useContext(A),{values:p={}}=O();console.log(">>ProductForm/ProductCommonFields::","data",i,p);const s=d.useCallback((...h)=>{const c=h[0].target.files[0];c&&ve(c).then(l=>{o(m=>({...m,tempPhoto:l}))})},[]),a=i==null?void 0:i.image;return ge(async h=>{let x=null;a&&(x=await fe.get(a,{level:"public"}),console.log(">>product/ProductCommonFields::","imgPhoto",a,x)),h()&&o(c=>({...c,tempPhoto:x}))},[a]),e.jsxs(F,{text:"Information",mt:2,children:[e.jsxs(u,{display:"flex",mt:1,children:[e.jsx(u,{mr:1,flex:"1",maxWidth:"300px",children:e.jsx(C,{name:"name",fullWidth:!0})}),e.jsx(C,{name:"productCode",label:"code"})]}),e.jsxs(u,{display:"flex",mt:1,children:[e.jsxs(u,{className:r.imageInput,width:v,children:[e.jsx("div",{children:n.readOnly?e.jsx("img",{src:t.tempPhoto,height:v}):e.jsx(e.Fragment,{children:!n.readOnly&&t.tempPhoto?e.jsx("img",{src:t.tempPhoto,height:v,width:150,style:{objectFit:"scale-down",backgroundColor:"white"}}):e.jsx(st,{height:v})})}),e.jsx("center",{children:e.jsx(u,{mt:1,width:"102px",display:"inline-block",children:e.jsx($e,{fullWidth:!0,name:"image",asBlob:!0,single:!0,label:e.jsx(u,{component:"span",whiteSpace:"nowrap",marginLeft:"8px",children:"Product Image"}),onChange:s})})})]}),e.jsxs(u,{ml:1,flex:"1",maxWidth:"375px",children:[e.jsx(C,{name:"description",fullWidth:!0,multiline:!0}),e.jsx(u,{mt:1}),e.jsx(C,{name:"sellPrice",fullWidth:!0}),e.jsx(u,{mt:1}),e.jsx(C,{name:"buyPrice",fullWidth:!0})]})]}),e.jsx(u,{mt:1,children:e.jsx(C,{name:"details",fullWidth:!0})}),e.jsxs(u,{mt:4,display:"flex",children:[e.jsx(ye,{label:"Internal",color:"primary",checked:t.showSupplier,onChange:()=>o({...t,showSupplier:!t.showSupplier})}),!t.showSupplier&&e.jsx(u,{width:"250px",children:e.jsx(rt,{})})]})]})}function rt(){const{companyId:t}=R(),o=z({},"bool.must.term",{"type.keyword":"supplier"});return e.jsx(Ee,{readOnly:!!t,dataId:"productSupplierId",model:"Company",label:"Supplier",query:o})}const st=oe({root:t=>({placeContent:"center",display:"flex",alignItems:"center",height:t.height||"100px"})})(({classes:t,text:o="Empty"})=>e.jsx("div",{className:t.root,children:e.jsx("center",{children:o})}));function nt(t){return{index:"productitem",body:{size:0,query:{bool:{must:[{term:{"productId.keyword":t}}]}},aggs:{qty_total:{sum:{field:"qty"}}}}}}function it(t,{skip:o=!1,withStockDetails:r=!1}={}){let i="";r&&(i+=je({stockDetailsQ:nt(t)}));const n=M(w`
      query PRODUCT_INFO${r?"_DETAILS":""}($id: ID!) {
        product: getProduct(id: $id) {
          id
          type
          productCode
          name
          description
          image
          buyPrice
          sellPrice
        }
        ${i}
      }
    `,{variables:{id:t},skip:o||!t}),{product:p,...s}=(n==null?void 0:n.data)||{};return r?{product:p,extras:s}:p}const lt=Fe(be);function at(){const{values:t={},setFieldValue:o}=O(),{state:r}=d.useContext(A);console.log(">>ProductForm/index::producttypesele","type",t),se(["type"]);const i=d.useCallback(n=>{console.log(">>ProductForm/index::producttypesele","type",n),o("type",n)},[o]);return e.jsxs("div",{children:[e.jsx(F,{text:"Type",children:r.readOnly?e.jsx("i",{children:t==null?void 0:t.type}):e.jsx(ne,{readOnly:r.readOnly,value:t==null?void 0:t.type,onChange:i})}),e.jsx(ot,{})]})}function ct(t){return"File"in window&&t instanceof File}function dt({id:t,title:o,...r}){const i=d.useRef({}),n=R(),p=Pe(),s=d.useCallback(async l=>{let m={...l};if(ct(l.image)&&(m.image=await p({path:"inventory/products",key:"test",file:l.image})),!l.type)throw new Error("No product type selected");if(!l.name)throw new Error("Product name should not be empty");if(!l.productCode)throw new Error("Product code should not be empty");if(!G(l.buyPrice))throw new Error("Buy price should not be empty");if(!G(l.sellPrice))throw new Error("Sell price should not be empty");return t||(m=Be(m)),console.log(">>product/ProductForm::","saveValues",m),m},[t,p]),a=d.useCallback(async(...l)=>{const[m]=l;console.log(">>product/ProductForm::","args",m),await i.current.save(m),r.onSubmit&&await Promise.resolve(r.onSubmit(...l))},[r]),h=it(t),{type:x}=h||{},c={productSupplierId:n.companyId};if(!t)c.type=Object.keys(k)[0];else if(!x)return null;return e.jsx("div",{children:e.jsxs(lt,{name:"product",title:o||`${t?"Update":"Create"} Product`,initialValues:c,id:t,readOnly:!!t,...r,beforeSave:s,onSubmit:a,children:[e.jsx(at,{}),e.jsx(ut,{type:x}),e.jsx(F,{text:"Catalogues",mt:2,children:e.jsx(et,{formRef:i})})]})})}function ut({type:t}){const{values:o={}}=O(),r=(o==null?void 0:o.type)||t,{fields:i}=k[r]||{};return e.jsx(u,{mt:2,children:i&&e.jsx(i,{})})}const pt=oe({root:{"& button > span > strong":{marginLeft:5,backgroundColor:"grey",borderRadius:5,padding:"0 5px",fontSize:"smaller",color:"white"}}})(t=>{const{companyId:o}=R(),[r,i]=d.useState({count:{}}),n=te({index:"product",body:{size:0,query:o?{bool:{must:{term:{"productSupplierId.keyword":o}},must_not:{term:{archived:!0}}}}:void 0,aggs:{per_type:{terms:{field:"type.keyword",size:999}}}}});d.useEffect(()=>{const s={};let a=0;P(n,"result.aggregations.per_type.buckets",[]).forEach(h=>{s[h.key]=h.doc_count,a+=h.doc_count}),s.ALL=a,i(h=>({...h,count:s}))},[n]);const p=d.useMemo(()=>{const s={ALL:{extra:e.jsx("strong",{children:r.count.ALL||""})}};for(const a in k){let h;r.count[a]&&(h=e.jsx("strong",{children:r.count[a]})),s[a]={...k[a],extra:h}}return s},[r.count]);return e.jsx(ne,{...t,typeOptions:p,className:t.classes.root})});function mt({supplierId:t}){const o=d.useRef(null),[r,i]=d.useState({searchText:null,typeFilter:"ALL",supplierFilter:t||null}),n=Me(),p={};r.typeFilter!=="ALL"&&(p.type={eq:r.typeFilter}),r.supplierFilter&&(p.productSupplierId={eq:r.supplierFilter}),r.searchText&&(p.or=[{productCode:{matchPhrasePrefix:r.searchText.toLowerCase()}},{name:{matchPhrasePrefix:r.searchText.toLowerCase()}}]),console.log(">>product/ProductList::","state,filter",r,p);const s=M(w`
      query QUERY_PRODUCT_LIST($filter: SearchableProductFilterInput) {
        searchProducts(filter: $filter) {
          items {
            id
            name
            type
            productCode
            name
            description
            image
            buyPrice
            sellPrice
            supplier {
              id
              name
            }
          }
        }
      }
    `,{variables:{...!N(p)&&{filter:p}},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),a=P(s,"data.searchProducts.items",[]);console.log(">>inventory/ProductList::","state",r);const h=d.useCallback((x,c)=>{const l=c==null?void 0:c._source.id;i(m=>({...m,supplierFilter:l}))},[]);return e.jsx(e.Fragment,{children:e.jsxs(u,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsx(le,{mt:2.5,mb:3,children:"PRODUCTS"}),e.jsxs(H,{variant:"contained",color:"primary",onClick:()=>{o.current.open()},children:[e.jsx(u,{component:Re,mr:1})," Create Product"]})]}),e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(V,{width:"300px",children:e.jsx(Ce,{placeholder:"Search...",textFieldProps:{label:"Products"},onChange:x=>{const c=x.target.value;console.log(">>inventory/ProductList::","searchText",c),i(l=>({...l,searchText:c}))}})}),!t&&e.jsx(V,{ml:1,mt:.5,width:"300px",mr:1,children:e.jsx(u,{sx:{"& div > svg":{marginTop:0}},children:e.jsx(ft,{onChange:h,value:r.supplierFilter})})})]}),e.jsx("div",{children:e.jsx(pt,{value:r.typeFilter,onChange:x=>{i(c=>({...c,typeFilter:x}))}})})]}),e.jsx(u,{mt:2,children:e.jsxs(Ie,{selectable:!0,loading:s.loading,data:a,onRowClick:({id:x})=>{n.push(`/inventory/product/${x}`)},onRowActionSelect:console.log,children:[e.jsx(D,{dataId:"productCode",label:"Code"}),e.jsx(D,{dataId:"name",label:"Name"}),e.jsx(Z,{dataId:"type",label:"Type",render:gt}),e.jsx(Z,{dataId:"price",label:"Price (Sell/Price)",render:ht}),e.jsx(D,{dataId:"supplier.name",label:"Supplier"})]})}),e.jsx(ee,{scroll:"body",maxWidth:"md",variant:"dialog",ref:o,dialogProps:{maxWidth:"sm",fullWidth:!0},children:e.jsx(dt,{onCancel:()=>{o.current.close()},onSubmit:()=>{o.current.close(),s.refetch()}})})]})})}const ht=(t,o)=>e.jsx(xt,{data:o}),xt=t=>{const[{s:o,b:r},i]=d.useState({s:null,b:null});return d.useEffect(()=>{try{i(n=>({...n,s:`${q.numberFormatter(t.data.sellPrice).toCurrency()}`,b:`${q.numberFormatter(t.data.buyPrice).toCurrency()}`}))}catch{}},[t.data.buyPrice,t.data.sellPrice]),e.jsx(u,{children:`${o} / ${r}`})};function gt(t){const o=P(k,[t,"color"]);return e.jsx(u,{component:"span",bgcolor:o,color:"white",padding:"5px 10px",borderRadius:"10px",children:t})}function ft({value:t,onChange:o}){const r=z({},"bool.must.term",{"type.keyword":"supplier"});return console.log(">>product/ProductList::","value supplier",t),e.jsx(U,{fullWidth:!0,shrinkLabel:!0,variant:"default",model:"Company",label:"Filter Supplier",query:r,value:t,onChange:o,icon:Se})}function to(){const{companyId:t}=R();return e.jsx(mt,{supplierId:t})}export{to as default};
