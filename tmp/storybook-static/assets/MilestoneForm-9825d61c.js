import{j as o}from"./TransitionGroupContext-9d36972e.js";import{R as d}from"./index-f1f749bf.js";import{c as u}from"./camelCase-4e7e8b23.js";import{ad as f,B as y,Y as x,b6 as j,Z as I}from"./papaparse.min-b66e70e7.js";import{x as S,y as h,e as p,S as g,a as v,w}from"./Play-87fed129.js";import{u as M}from"./useIncludeFieldNames-35a180a9.js";import{F as k}from"./pick-dba65392.js";import"./index-96c5f47c.js";import{g as C}from"./_baseForOwn-9b89c4b6.js";import{S as b}from"./Skeleton-cd6f071e.js";import{A as F}from"./Alert-fd9a067a.js";import{u as O}from"./react-router-19e5b27c.js";import{f as P}from"./index-bcfaa842.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./capitalize-c31f38e2.js";import"./_arrayIncludes-2cfb33ae.js";import"./Button-352c3435.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./react-router-dom-60ea8218.js";import"./tiny-invariant-dd7d57d2.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./SelectEsModelInput-d580a9f7.js";import"./Link-c687dc07.js";import"./Save-b67fa0ac.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";import"./isNativeReflectConstruct-05c29d01.js";const _=e=>o.jsx(S,{props:e,model:"Invoice",onData:t=>{var r;C(t,"hits.hits",[]).length||(r=e.onEmpty)==null||r.call(e)},query:t=>(e.projectId&&f(t,"bool.must.term",{"invoiceProjectId.keyword":e.projectId}),t)});function B(e){var m,i;const[t,s]=d.useState(!!((m=e.invoiceSetting)!=null&&m.invoiceId)),[r,c]=d.useState(!1),[l,a]=d.useState(!1);return console.log(">>MilestoneList/MilestoneInvoiceSetting::","props.",e.invoiceSetting,r),l?o.jsx(b,{width:"200px"}):o.jsxs(y,{display:"flex",children:[o.jsx(h,{value:t,label:"Link Invoice",onChange:async n=>{!n&&t&&(a(!0),await Promise.resolve(e.onChange(null)),a(!1)),s(n)}}),t&&(r?o.jsx(F,{severity:"error",children:"No invoices available"}):o.jsx(_,{sx:{ml:2,width:"200px"},value:((i=e.invoiceSetting)==null?void 0:i.invoiceId)||"",projectId:e.projectId,onEmpty:()=>c(!0),onChange:async n=>{a(!0),await Promise.resolve(e.onChange(JSON.stringify({invoiceId:n}))),a(!1)},fieldOnly:!0}))]})}const D=w(I),E=({id:e,header:t,initialValues:s,...r})=>{const{projectId:c,opportunityId:l}=O(),a={...c&&{milestoneProjectId:c},...l&&{milestoneOppId:l},...s||{}},[m]=x(["kwMilestoneTypeList"]);return o.jsxs(D,{name:"milestone",title:t||"Milestone",secondary:!0,initialValues:a,id:e,readOnly:!!e,beforeSave:i=>{const n={...i};return i.due&&(n.due=new Date(i.due)),i.start&&(n.start=new Date(i.start)),n},...r,children:[o.jsx(p,{name:"name"}),o.jsx(g,{name:"type",options:(m==null?void 0:m.kwMilestoneTypeList.map(i=>u(i)))||[]}),o.jsx(p,{type:"date",name:"due",label:"Due Date",format:i=>i&&P(new Date(i),"MMM dd, yyyy")}),o.jsx(k,{name:"completed",label:"Milestone completed?"}),o.jsx(L,{})]})};function L(){M(["invoiceSetting"]);const e=v(),{values:t={}}=e.formik;return e.isReadOnly?o.jsx(B,{projectId:t.milestoneProjectId,invoiceSetting:t!=null&&t.invoiceSetting?JSON.parse(t==null?void 0:t.invoiceSetting):null,onChange:async s=>{await j([{id:e.id,__op:"update",__typename:"Milestone",invoiceSetting:s}]),e.reload({queryOpts:{fetchPolicy:"network-only"}})}},t==null?void 0:t.invoiceSetting):null}const Se=E;export{Se as default};
