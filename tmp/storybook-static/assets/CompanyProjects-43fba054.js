import{j as e,s as Ne}from"./TransitionGroupContext-9d36972e.js";import{R as h}from"./index-f1f749bf.js";import{u as V,l as M,ab as ne,ax as oe,F as Ee,cg as _e,B as n,b7 as $e,ch as Ae,ci as Me,P as Be,cj as qe,M as De,K as ie,Y as le,G as ce,E as de,v as pe,z as _,H as F,bC as X,as as U,m as R,w as A,D as Oe,ct as Ve,U as Fe,V as H,aw as ze,T as z,N as We,O as I,al as Ue,at as He,s as O,aP as Ke,W as Qe,h as Je,bN as Ge,cu as Ye,aC as Ze,R as Xe,cv as et,o as tt,ak as st,g as ee}from"./papaparse.min-b66e70e7.js";import{g as S}from"./_baseForOwn-9b89c4b6.js";import{t as ue,M as rt,p as me,g as at,b as fe,V as nt}from"./Play-87fed129.js";import{x as ot,y as it,z as lt,A as ct,e as dt,T as K,B as pt,E as ut,q as mt}from"./pick-dba65392.js";import{B as te}from"./Button-352c3435.js";import{E as ft,u as W,q as Q,l as ht}from"./index-bcfaa842.js";import{L as xt,K as jt,f as gt}from"./index-9d3afdfc.js";import{T as yt,a as se}from"./ToggleButtonGroup-93d9af56.js";import{a as bt,P as he}from"./ProjectLink-987015ba.js";import{d as Ct}from"./debounce-213cd46f.js";import{U as St}from"./filter-f99df4e5.js";import{f as xe,u as je}from"./react-router-19e5b27c.js";import{M as Pt}from"./index-864004f3.js";import{c as vt}from"./capitalize-c31f38e2.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./index-96c5f47c.js";import"./isPlainObject-07477f89.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./react-router-dom-60ea8218.js";import"./tiny-invariant-dd7d57d2.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./SelectEsModelInput-d580a9f7.js";import"./Link-c687dc07.js";import"./useIncludeFieldNames-35a180a9.js";import"./Save-b67fa0ac.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";import"./isNativeReflectConstruct-05c29d01.js";import"./index-79afbab1.js";import"./TaskAssignees-858ea3c9.js";import"./Check-78df5e8e.js";import"./Skeleton-cd6f071e.js";import"./useFetchMore-be228481.js";import"./bundle-053bdffd.js";import"./MilestoneIcon-61fb6e69.js";import"./SortUpIcon-3aecf5f0.js";import"./DragIndicator-582939ba.js";import"./Trash-822e65ce.js";import"./index.esm-bf21a293.js";import"./index-f70ce446.js";import"./index-5d349c56.js";import"./TaskForm-863cdb73.js";import"./RepeatFields-8275ed19.js";import"./useBeforeSave-e049f6dd.js";import"./Alert-fd9a067a.js";import"./useTaskAssignees-9f1fd5d3.js";import"./EstimateEditorPopover-b8debf9a.js";import"./AssigneeEditorPopover-2b4e6473.js";import"./searchUsers-04324aeb.js";import"./LocalizationProvider-a287304f.js";function kt(t){var s;const{data:a,loading:i}=V(M`
      query($id: ID!) {
        getProject(id: $id) {
          id
          type
        }
      }
    `,{variables:{id:t.id},skip:!t.id}),[o,{loading:d}]=ne("project-setting",{withQueryState:!0}),c=S(a,"getProject.type")||S(t,"initialValues.type")||(o==null?void 0:o.defaultType);if(i||d)return e.jsx(oe,{});if(!c)return e.jsx("div",{children:"Linear Project Type"});const u=(s=ue[c])==null?void 0:s.form;return u?e.jsx(u,{...t}):e.jsx(ot,{...t})}function ge(t){return e.jsx(Ee,{...t,width:"13px",height:"14px",viewBox:"0 0 13 14",paths:["M5.875 13.25H4.625C3.93464 13.25 3.375 12.6904 3.375 12H0.875V8.5625L3.375 6.6875V4.5C3.375 2.52745 4.57097 0.125 6.5 0.125C8.42903 0.125 9.625 2.52745 9.625 4.5V6.6875L12.125 8.5625V12H9.625C9.625 12.6904 9.06536 13.25 8.375 13.25H7.125V13.875H5.875V13.25ZM7.125 12H8.375V5.75V4.5C8.375 3.12952 7.50157 1.375 6.5 1.375C5.49843 1.375 4.625 3.12952 4.625 4.5V5.75V12H5.875V8.25H7.125V12ZM3.375 8.25L2.125 9.1875V10.75H3.375V8.25ZM9.625 8.25V10.75H10.875V9.1875L9.625 8.25ZM6.5 6.375C5.80964 6.375 5.25 5.81536 5.25 5.125C5.25 4.43464 5.80964 3.875 6.5 3.875C7.19036 3.875 7.75 4.43464 7.75 5.125C7.75 5.81536 7.19036 6.375 6.5 6.375Z"]})}const wt=Ne(n)({"& > div":{zIndex:1}});function Tt({onClick:t,fullWidth:a}){var m;const[i,o]=h.useState(!1),d=h.useRef(null),[c,u]=h.useState(null),{options:s}=it();console.log(">>project/ProjectCreateButton::","options",s);const l=x=>{c!==null&&c>-1?t&&t(x,s[c].value):o(!0)},f=(x,y)=>{u(y),o(!1),y>-1&&t&&t(x,s[y].value)},j=x=>{x&&x.stopPropagation(),o(y=>!y)},r=x=>{d.current&&d.current.contains(x.target)||o(!1)};return e.jsxs(wt,{children:[e.jsxs(_e,{variant:"contained",color:"primary",ref:d,"aria-label":"split button",style:{width:a?"100%":void 0},children:[e.jsxs(te,{onClick:l,style:{width:a?"100%":void 0},children:[e.jsx(n,{mr:1,children:e.jsx(ge,{style:{fontSize:"12px"}})}),e.jsx(n,{display:"flex",alignItems:"center",children:c?(m=s[c])==null?void 0:m.label:"Create Project"})]}),e.jsx(te,{color:"primary",size:"small","aria-controls":i?"split-button-menu":void 0,"aria-expanded":i?"true":void 0,"aria-label":"select merge strategy","aria-haspopup":"menu",onClick:j,children:e.jsx($e,{})})]}),e.jsx(Ae,{open:i,anchorEl:d.current,role:void 0,transition:!0,disablePortal:!0,children:({TransitionProps:x,placement:y})=>e.jsx(Me,{...x,style:{transformOrigin:y==="bottom"?"center top":"center bottom"},children:e.jsx(n,{children:e.jsx(Be,{children:e.jsx(ft,{onClickAway:r,children:e.jsx(qe,{id:"split-button-menu",children:s.map((P,w)=>e.jsx(De,{selected:w===c,onClick:g=>f(g,w),children:P.label},P.value))})})})})})})]})}function It({value:t,onChange:a,icon:i}){const o=h.useCallback(d=>{const c=d.currentTarget.value;a(c)},[a]);return e.jsx(ie,{value:t,variant:"default",label:"Client",model:"Company",fullWidth:!0,shrinkLabel:!0,onChange:o,icon:i,iconStyles:{marginTop:"0px"}})}function Lt({value:t,onChange:a,icon:i}){const o=h.useCallback(d=>{const c=d.currentTarget.value;a(c)},[a]);return e.jsx(ie,{value:t,variant:"default",label:"Project Manager",model:"User",fullWidth:!0,shrinkLabel:!0,onChange:o,query:lt(),icon:i,iconStyles:{marginTop:"0px"}})}function Rt({value:t,onChange:a,icon:i}){var c;const[o]=le(["kwProjectStatus"]),d=h.useCallback(u=>{const s=u.currentTarget.value;a&&a(s)},[a]);return e.jsx(ce,{fullWidth:!0,value:t,variant:"default",options:(c=o==null?void 0:o.kwProjectStatus)==null?void 0:c.map(u=>({label:`${de(u)}`,value:u})),label:"Status",shrinkLabel:!0,onChange:d,icon:i,iconStyles:{marginTop:"0px"}})}function Nt({value:t,onChange:a,icon:i}){const o=[{value:"red",text:"red"},{value:"amber",text:"amber"},{value:"green",text:"green"}],d=h.useCallback(c=>{const u=c.currentTarget.value;a&&a(u)},[a]);return e.jsx(ce,{fullWidth:!0,value:t,variant:"default",options:o,label:"Traffic Light",shrinkLabel:!0,onChange:d,icon:i,iconStyles:{marginTop:"0px"}})}const Et=R(()=>({filters:{display:"flex",alignItems:"center",flexWrap:"wrap","& > *":{marginRight:5}}})),ye={client:A,manager:A,status:A,traffic:A};function _t({setFilterState:t,showTemplates:a}){const[i,o]=pe(ye),[d,c]=h.useState(!1),u=Et();return e.jsxs("div",{className:u.filters,children:[e.jsx(_,{containerProps:{padding:1},width:200,children:e.jsx(It,{value:i.client,onChange:s=>{o({client:s}),t(l=>({...l,client:s}))},icon:F})}),e.jsx(_,{containerProps:{padding:1},width:200,children:e.jsx(Lt,{value:i.manager,onChange:s=>{o({manager:s}),t(l=>({...l,manager:s}))},icon:F})}),e.jsx(_,{containerProps:{padding:1},width:200,children:e.jsx(Rt,{value:i.status,onChange:s=>{o({status:s}),t(l=>({...l,status:s}))},icon:X})}),e.jsx(_,{containerProps:{padding:1},width:200,children:e.jsx(Nt,{value:i.traffic,onChange:s=>{o({traffic:s}),t(l=>({...l,trafficLight:s}))},icon:X})}),a?"":e.jsxs("div",{children:[e.jsx(U,{checked:d,onChange:s=>{c(s.target.checked),t(l=>({...l,templateSetting:s.target.checked}))}}),e.jsx("span",{children:"Is Template"})]})]})}const $t=R(()=>({types:{display:"flex",alignItems:"center","& > *":{marginLeft:5},"& .MuiButton-label":{opacity:.8},"& .MuiButton-label > strong":{marginLeft:5,backgroundColor:"grey",borderRadius:5,padding:"0 5px",fontSize:"smaller",color:"white"}},filter:{display:"flex",justifyContent:"space-between",marginTop:5}}));function At({typeCount:t,onChange:a,key:i,setViewMode:o,viewMode:d,showTemplates:c}){const u=$t(),[s,l]=h.useState({search:"",type:null});h.useEffect(()=>{a&&a(s)},[s]),console.log("filter check - ","state",s);const f=h.useCallback(b=>{l(k=>({...k,type:b==="all"?null:b}))},[]),j=h.useMemo(()=>{const b={all:{key:"all",icon:ge,label:"All"},...ue};return Object.entries(t).forEach(k=>{const[T,B]=k;b[T]&&(b[T]={...b[T],extra:e.jsx("strong",{children:B})})}),b.all.extra=e.jsx("strong",{children:t._all}),b},[t]);console.log(">>project/ProjectListFilter::","typeCount",t);const r=W("LIST_KANBAN_VIEW").value,{TextFieldClear:m,ClearVisibilityRuleSx:x,isValueUndefined:y}=Fe(),P=h.useRef(null),[w,g]=h.useState();return e.jsxs(n,{display:"flex",justifyContent:"space-between",flexDirection:"column",children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",flexDirection:"row",children:[e.jsx(_,{width:"300px",mb:.5,containerProps:{minHeight:"0",pl:1.5},children:e.jsx(Oe,{label:"Project Name",placeholder:"Search...",value:s.search||"",onChange:b=>{const k=b.target.value;g(b.target.value),l(T=>({...T,search:k}))},textFieldProps:{endAdornment:y(w)?void 0:e.jsx(m,{clearFn:()=>{g(void 0),l(b=>({...b,search:""})),P.current&&(P.current.value="")}}),sx:x,inputProps:{ref:P}}})}),e.jsxs(n,{className:u.types,mb:2,children:[e.jsx(ct,{value:s.type||"all",types:j,label:"",onChange:f}),!r&&e.jsxs(yt,{size:"small",value:d,exclusive:!0,sx:{marginTop:"5px"},onChange:(b,k)=>{try{localStorage.setItem(i,k)}catch{console.log("Something went wrong saving to localstorage.")}o(k)},children:[e.jsx(se,{value:"listView",size:"small",children:e.jsx(xt,{fontSize:"small"})}),e.jsx(se,{value:"cardView",size:"small",children:e.jsx(Ve,{fontSize:"small"})})]})]})]}),e.jsx(n,{className:u.filter,children:e.jsx(_t,{setFilterState:l,showTemplates:c})})]})}const Mt=R(t=>({default:{},info:{backgroundColor:t.palette.info.main,"& > span":{color:"white"}},warning:{backgroundColor:t.palette.warning.main,"& > span":{color:"white"}},success:{backgroundColor:t.palette.success.main,"& > span":{color:"white"}},error:{backgroundColor:t.palette.error.main,"& > span":{color:"white"}}}));function Bt({variant:t="default",...a}){const i=Mt();return e.jsx(H,{size:"small",...a,label:(a.label||"").toUpperCase(),className:i[t]})}const be="#9BA8B6",qt=R({root:{padding:10,minHeight:100,justifyContent:"space-between",alignItems:"baseline",cursor:"pointer"},title:{fontSize:15,display:"flex",alignItems:"center","& svg":{opacity:.4,height:16}},type:{fontSize:13,height:17,color:"white",borderRadius:5},createdAt:{fontSize:11,color:be,display:"flex","& svg":{height:15}},memberlink:{"& a":{"& > div":{"& div":{"& span":{color:"#9BA8B6",fontSize:15}}}}},cName:{fontSize:"x-small",fontWeight:"normal",opacity:.6,marginLeft:40,marginTop:3},link:{display:"inline-flex",alignItems:"center","& > .mb-avatar":{marginRight:5}}});function Dt({data:t}){var m;const a=qt(),i=Q(),o=dt(),{metadata:d,filters:c}=h.useContext(gt),u=t==null?void 0:t.id,{mainContact:s,overallEstimate:l}=t||{};let f="";const j=S(d,`intervals.totals.${u}`)||"0.00",r=l;return r?f=`${(j/r*100).toFixed(2)}%`:f="0.00",e.jsxs(e.Fragment,{children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"end",children:[e.jsxs(n,{children:[e.jsxs(z,{variant:"h3",className:a.title,children:[e.jsx(bt,{project:t}),e.jsx(n,{marginLeft:"15px",children:e.jsx(rt,{title:t.name,actions:[{icon:e.jsx(me,{}),label:"Create Task",onClick(){o.open("Task",{projectId:t.id})}}],children:e.jsx(n,{className:a.link,children:e.jsx(at,{model:"Project",data:t,children:t.name})})})})]}),e.jsx(z,{className:a.cName,variant:"h3",children:(m=t==null?void 0:t.company)==null?void 0:m.name})]}),e.jsx(n,{children:e.jsx(K,{width:3,height:3,readOnly:!0,value:t.trafficLight,withLabel:!1})})]}),e.jsx(n,{fontSize:11,children:e.jsxs(n,{display:"flex",justifyContent:"space-between",color:be,children:[e.jsxs(n,{children:[!!s&&e.jsxs(n,{fontSize:11,className:a.title,children:[e.jsx(St,{size:"small",s3Key:s==null?void 0:s.profilePhoto,...s}),e.jsx(n,{marginLeft:"10px"}),e.jsxs("p",{children:[s.firstName," ",s.lastName]})]}),e.jsx(n,{fontSize:11,className:a.memberlink,children:!!(t!=null&&t.managerUserId)&&e.jsx(fe,{compact:!0,id:t.managerUserId,color:i.palette.primary.dark})}),e.jsx(n,{mt:2}),e.jsxs(n,{display:"flex",justifyContent:"space-between",children:[e.jsx(n,{children:e.jsx(H,{label:e.jsxs("span",{children:[j," h"]})})}),e.jsx(n,{mr:1}),e.jsx(n,{fontSize:"small",children:e.jsx("span",{className:"lhtblu",children:f})})]})]}),e.jsx(n,{}),e.jsx(n,{display:"flex",justifyContent:"flex-end",alignItems:"flex-end",children:t.templateSetting&&c.templateSetting?e.jsx(U,{checked:!0,disabled:!0,size:"small"}):null})]})})]})}const Ot=M`
  mutation UpdateProjectStatus($status: String!, $projectId: ID!) {
    updateProject(input: { id: $projectId, status: $status }) {
      id
      status
    }
  }
`;function Vt({data:t,metadata:a,filters:i}){const[o]=ze(Ot),d=xe(),c=h.useCallback(r=>{d.push(`/project/${r.id}/tasks`)},[d]),u=h.useCallback(r=>({type:"CARD_ENTRY",item:{item:{...r},type:"CARD_ENTRY"},collect:m=>({isDragging:m.isDragging()})}),[]),s=h.useCallback(r=>({accept:"CARD_ENTRY",collect:m=>{var x,y;return{isOver:!!m.isOver(),canDrop:!!m.canDrop&&((y=(x=m.getItem())==null?void 0:x.item)==null?void 0:y.status)!==r}},drop:async m=>{var x;if(((x=m==null?void 0:m.item)==null?void 0:x.status)!==r)try{await o({variables:{projectId:m.item.id,status:r}}),console.log("Kraketoa done updating project status!")}catch(y){console.error("kraketoa Something went wrong updating project status: ",y)}}}),[o]);function l(r){return{key:r,filter:m=>(m.status||"").toLowerCase()===r.toLowerCase()&&!m.archived}}const[f]=le(["kwProjectStatus"],{sort:["sortOrder","text"]});console.log(">>ProjectList/ProjectKanban::","kw.kwProjectStatus");const j=f.kwProjectStatus||[];return e.jsx("div",{children:e.jsx(jt,{data:t,context:{metadata:a,filters:i},boards:j.map(r=>l(r)),CardComponent:Dt,onCardClick:c,cardDragOptions:u,cardDropOptions:s},JSON.stringify(j))})}const Ft=R({root:{display:"flex",alignItems:"center","& > svg":{opacity:.3},"& > *":{marginRight:5}}});function re({component:t=void 0,...a}){const i=Ft(),o=t||n;return e.jsx(o,{...a,className:i.root,children:a.children})}function zt(t){const{loading:a,projects:i,filters:o,metadata:d}=t,[c,u]=h.useState([]),s=Q();return e.jsxs(We,{selectable:!0,loading:a,data:i,selectedRows:c,onRowSelect:l=>{let f=[];c.includes(l.id)?f=c.filter(j=>j!==l.id):f=c.concat(l.id),u(f)},children:[e.jsx(I,{dataId:"id",label:"Project",render:(l,f)=>e.jsx(he,{color:s.palette.primary.dark,project:f})}),e.jsx(I,{dataId:"templateSetting",label:"TPL",width:"50px",render:l=>{if(o.templateSetting&&l)return e.jsx(n,{display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(U,{checked:!0,disabled:!0})})}}),e.jsx(I,{dataId:"_totalTime",label:"Total Time",width:"100px",render:(l,f)=>{const j=S(d,`intervals.totals.${f.id}`);if(!j)return null;const r=f.overallEstimate;let m="";return r&&(m=`${(j/r*100).toFixed(2)}%`),e.jsxs(n,{textAlign:"center",children:[e.jsx(H,{label:e.jsxs("span",{children:[j," h"]})}),e.jsx(n,{fontSize:"small",children:e.jsx("span",{className:"lhtblu",children:m})})]})}}),e.jsx(I,{width:"75px",render:l=>l?e.jsx(n,{textAlign:"center",children:e.jsx(fe,{id:l,color:s.palette.primary.dark,compact:!0,iconOnly:!0})}):null,dataId:"managerUserId",label:"Prj Mgr"}),e.jsx(I,{dataId:"members",label:"Team",width:"130px",render:(l,f)=>{const j=S(d,`members.totals.${f.id}`);return j?e.jsxs(re,{color:s.palette.primary.dark,children:[e.jsx(n,{component:Pt}),e.jsxs(n,{component:"span",whiteSpace:"nowrap",children:[e.jsx("strong",{children:j})," members"]})]}):null}}),e.jsx(I,{dataId:"trafficLight",label:"Traffic light",width:"110px",render:l=>e.jsx(n,{textAlign:"center",children:e.jsx(K,{readOnly:!0,value:l,withLabel:!1})})}),e.jsx(I,{dataId:"tasks",width:"120px",render:(l,f)=>{const j=S(d,`tasks.totals.${f.id}`);return j?e.jsxs(re,{color:s.palette.primary.dark,children:[e.jsx(n,{component:me,mr:1}),e.jsxs(n,{component:"span",whiteSpace:"nowrap",children:[e.jsx("strong",{children:j})," tasks"]})]}):null}}),e.jsx(I,{dataId:"progress",width:"170px",render:(l,f)=>{const j=S(d,`tasks.totals.${f.id}`),r=S(d,`tasks.totalCompleted.${f.id}`);function m(x){var y;return e.jsx(n,{textAlign:"left",fontWeight:"bold",children:ht.startCase((y=de(x==null?void 0:x.toUpperCase()))==null?void 0:y.toLowerCase())})}return r===void 0?null:r<1?m(f.status?vt(f.status):"Not Complete"):r>=j?m("Completed"):e.jsx(pt,{total:j,completed:r})}}),e.jsx(Ue,{dataId:"startDateActual",width:"140px",label:"Start Date",format:"dd/MM/yyyy"})]})}const ae="mb-project-list-switch-btn",Wt=R(t=>({progressRoot:{borderRadius:5},progressSuccessBarColor:{borderRadius:5,backgroundColor:ut},progressWarnBarColor:{borderRadius:5,backgroundColor:mt},progressCircle:{},title:{fontWeight:"600",color:"#052649",letterSpacing:"1.25px",lineHeight:"150%",fontSize:"20px",fontStyle:"normal"},body:{"& .MuiChip-root":{backgroundColor:"#E6E9ED",color:t.palette.primary.main,height:"20px",lineHeight:"150%"},"& .lhtblu":{color:"#697D92"}}}));function Ut({managerId:t,filterTags:a,includedIds:i,activeOnly:o,headerControls:d,showTemplates:c}){const u=Wt(),s=h.useRef(null),[l]=pe(ye),[f,j]=h.useState({newProjectType:null}),[r,m]=h.useState(l),{companyId:x}=je(),y=W("LIST_KANBAN_VIEW").value,[P,w]=h.useState(y?"listView":localStorage.getItem(ae)||"cardView");console.log({removeListKanbanView:y}),console.log(">>ProjectList/index::","filters",r);const{globalState:{authUser:g,isMobile:b}}=He(),k=g==null?void 0:g.id,T=Q(),B=ne("project-setting"),Ce=xe(),J=h.useMemo(()=>{var C;const p={sort:{field:"name",direction:"asc"},limit:30};if(p.filter={opportunity:{ne:!0}},x&&(p.filter.companyId={eq:x}),t&&(p.filter.managerUserId={eq:t}),o&&(p.filter.status={ne:nt}),r.client&&(p.filter.companyId={eq:r.client}),r.manager&&(p.filter.managerUserId={eq:r.manager}),r.status&&(p.filter.status={eq:r.status}),r.trafficLight&&(p.filter.trafficLight={eq:r.trafficLight}),r.type&&(p.filter.type={eq:r.type}),c&&(p.filter.templateSetting={exists:!0}),((C=r.search)==null?void 0:C.length)>0&&(p.filter.or=[{name:{matchPhrasePrefix:r.search}},{code:{matchPhrasePrefix:r.search}}]),a&&(p.filter.tags={includes:a[0]}),i!=null&&i.length){const{companyId:v,managerUserId:D,...Le}=p.filter;let L;v&&(L=O("companyId",v)(L)),D&&(L=O("managerUserId",D)(L)),console.log(">>project/ProjectList::","companyId,managerUserId,refFilter",v,D,L),p.filter={...Le,or:[...i.map(Re=>({id:{eq:Re}})),L].filter(Boolean)}}return console.log(">>project/ProjectList::","v.filter",p.filter),{...p,filter:JSON.stringify(p.filter),sort:JSON.stringify(p.sort)}},[x,t,o,r.search,r.type,r.client,r.manager,r.status,r.trafficLight,a,i,c]),{data:$,loading:q,refetch:Se,fetchMore:Pe}=V(M`
      query PROJECT_LIST_Q(
        $nextToken: String
        $filter: AWSJSON
        $sort: AWSJSON
        $limit: Int
      ) {
        searchProjects: nestedSearch(
          type: "Project"
          sort: $sort
          limit: $limit
          filter: $filter
          nextToken: $nextToken
        ) {
          nextToken
          metadata
          items {
            ... on Project {
              id
              name
              companyId
              color
              trafficLight
              type
              status
              code
              templateSetting
              managerUserId
              mainContact {
                id
                firstName
                lastName
                profilePhoto
              }
              company {
                id
                name
              }
              startDateActual
              code
              opportunity
              overallEstimate
            }
          }
          total
        }
      }
    `,{variables:J,fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),N=S($,"searchProjects.items",[]);console.log(">>project/ProjectList::","Projects",N);const E=Ht(S($,"searchProjects.metadata")),ve=S($,"searchProjects.nextToken"),{templateData:ke}=V(M`
    query PROJECT_LIST_Q(
      $nextToken: String
      $filter: AWSJSON
      $sort: AWSJSON
      $limit: Int
    ) {
      searchProjects(filter: { templateSetting: { exists: true } }) {
        items {
          id
          templateSetting
        }
      }
    }
  `);console.log("template",ke);let G={},Y="460px";f.newProjectType!=="simple"&&(Y=void 0,G={maxWidth:"md",fullWidth:!0});const we=h.useRef(),Te=h.useCallback(Ct(()=>{},300),[]),Ie=W("HANDLE_TYPE_CHANGE").on,Z=h.useMemo(()=>Ke(N,[C=>{const v=C.name.match(/^\s\d+/);return v?parseInt(v[0]):1/0},C=>C.name.replace(/^\s\d+/,"").toLocaleLowerCase()]),[N]);return e.jsxs(n,{mb:2,children:[e.jsx(Qe,{variant:"dialog",ref:s,dialogProps:G,children:e.jsx(n,{width:Y,children:B?e.jsx(kt,{initialValues:{type:f.newProjectType,managerUserId:k},onCancel:()=>{s.current.close()},onSubmit:async()=>{s.current.close(),Se()}}):e.jsx("div",{})})}),e.jsxs(n,{my:2,display:"flex",flexDirection:b?"column-reverse":"row-reverse",justifyContent:"space-between",children:[e.jsxs(n,{display:b?"block":"inline-flex",float:"right",style:{alignSelf:"stretch",alignItems:"center",marginTop:24},children:[d&&e.jsx(n,{display:b?"block":"inline-block",children:d}),e.jsx(Tt,{fullWidth:!0,onClick:(p,C)=>{j(v=>({...v,newProjectType:Ie?C:""})),s.current.open()}})]}),e.jsxs(z,{className:u.title,variant:"h5",children:["PROJECT LIST"," ",a&&a.map(p=>e.jsx(Bt,{label:p,variant:"info",size:"small"},p))]})]}),e.jsxs(n,{style:{display:b?"grid":"none",rowGap:10},children:[e.jsx(Je,{variant:"outlined",placeholder:"Search..",inputRef:we,onChange:Te,fullWidth:!0,margin:"dense",className:u.searchBox,InputProps:{startAdornment:e.jsx(Ge,{mr:1,children:e.jsx(F,{style:{fontSize:"20px",color:"#CDD3DB"}})})}}),q&&e.jsx(Ye,{}),Z.map(p=>{const C=S(E,`tasks.totalCompleted.${p.id}`,0)/S(E,`tasks.totals.${p.id}`,0)*100,v=C<100?u.progressWarnBarColor:u.progressSuccessBarColor;return e.jsxs(Ze,{onClick:()=>{Ce.push(`/project/${p.id}`)},style:{height:"auto",padding:"10px 5px",display:"grid",gridTemplateColumns:"10fr 1fr"},children:[e.jsx(n,{style:{position:"relative",top:-5,gridColumn:"1 / span 2"},children:e.jsx(oe,{classes:{root:u.progressRoot,bar:v},value:C,variant:"determinate"})}),e.jsx(he,{color:T.palette.primary.dark,project:p}),e.jsx(K,{readOnly:!0,value:p.trafficLight,withLabel:!1})]},p.id)})]}),e.jsxs(n,{display:b?"none":"block",className:u.body,my:2,children:[e.jsx(At,{viewMode:P,setViewMode:w,onChange:p=>{m(C=>({...C,...p}))},typeCount:E.typeTotals||{},showTemplates:c},ae),e.jsx(n,{mt:2}),P==="cardView"?e.jsx(Vt,{data:N,metadata:E,filters:r}):e.jsx(zt,{loading:q,projects:Z,metadata:E,filters:r}),ve&&e.jsx(Xe,{disabled:q,onClick:()=>{Pe({variables:{...J,limit:10,nextToken:S($,"searchProjects.nextToken")},updateQuery:(p,{fetchMoreResult:C})=>{if(!C)return p;const v=[...N,...S(C,"searchProjects.items",[])];return O("searchProjects.items",v)(C)}})}})]})]})}function Ht(t){const[a,i]=h.useState(null);return h.useEffect(()=>{i(o=>t?et(o,JSON.parse(t)):o)},[t]),a||{}}function Zs(){var u;const[t,a]=h.useState({companyRelatedProjectIds:null,loading:!1}),{companyId:i}=je(),o=tt();async function d(){var r,m,x,y,P,w;if(t.companyRelatedProjectIds){a(g=>({...g,companyRelatedProjectIds:null}));return}a(g=>({...g,loading:!0}));const s=await o.query({query:ee`
        query ($companyId: String) {
          searchContacts(filter: { contactCompanyId: { eq: $companyId } }, limit: 50) {
            items {
              id
            }
          }
        }
      `,variables:{companyId:i},fetchPolicy:"network-only"}),l={or:[{entity1:{eq:i},entity1Type:{eq:"Company"}},{entity2:{eq:i},entity2Type:{eq:"Company"}}]};(x=(m=(r=s.data)==null?void 0:r.searchContacts)==null?void 0:m.items)==null||x.forEach(g=>{l.or.push({entity1:{eq:g.id},entity1Type:{eq:g.__typename}},{entity2:{eq:g.id},entity2Type:{eq:g.__typename}})});const j=(w=(P=(y=(await o.query({query:ee`
        query ($filter: SearchableEntityRelationFilterInput) {
          searchEntityRelations(limit: 999, filter: $filter) {
            items {
              id
              entity1
              entity1Type
              entity2
              entity2Type
            }
          }
        }
      `,variables:{filter:l},fetchPolicy:"network-only"})).data)==null?void 0:y.searchEntityRelations)==null?void 0:P.items)==null?void 0:w.map(g=>g.entity1Type==="Project"?g.entity1:g.entity2Type==="Project"?g.entity2:null).filter(Boolean);a(g=>({...g,companyRelatedProjectIds:j,loading:!1}))}const c={headerControls:e.jsx("div",{children:e.jsx(st,{label:"Show related projects",disabled:t.loading,onChange:d,checked:!!t.companyRelatedProjectIds})})};return(u=t.companyRelatedProjectIds)!=null&&u.length&&(c.includedIds=t.companyRelatedProjectIds),e.jsx(Ut,{...c})}export{Zs as default};
