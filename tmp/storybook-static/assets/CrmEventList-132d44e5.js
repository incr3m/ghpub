import{j as t}from"./TransitionGroupContext-9d36972e.js";import{u as T}from"./ProjectLink-987015ba.js";import{R as m}from"./index-f1f749bf.js";import{d as L}from"./Event-58562d39.js";import{e as I,d as v,p as C,L as b,a3 as F,b9 as k,Z as B,B as o,v as P,ad as R,u as N,g as W,T as D,z as V,D as $,N as M,O as h,Q as O,al as Q,R as _,W as A,w as z,U,ba as q,V as E}from"./papaparse.min-b66e70e7.js";import{w as H,e as f,S as J}from"./Play-87fed129.js";import{C as j,N as Y,S as Z}from"./SelectEsModelInput-d580a9f7.js";import{e as G,f as K}from"./VewJobDetails.story-c6ae2e88.js";import{u as g}from"./useIncludeFieldNames-35a180a9.js";import{u as X}from"./useBeforeSave-e049f6dd.js";import{g as tt}from"./_baseForOwn-9b89c4b6.js";import{d as et}from"./debounce-213cd46f.js";import{L as rt}from"./react-router-dom-60ea8218.js";import{u as nt}from"./useFetchMore-be228481.js";import{u as it}from"./useTagSearch-f4fcfbe9.js";import{B as ot}from"./Button-352c3435.js";import"./assertThisInitialized-ad1db8e7.js";import"./pick-dba65392.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-bcfaa842.js";import"./index-96c5f47c.js";import"./_commonjsHelpers-042e6b4d.js";import"./isNativeReflectConstruct-05c29d01.js";import"./react-router-19e5b27c.js";import"./index-4d501b15.js";import"./tiny-invariant-dd7d57d2.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./Link-c687dc07.js";import"./_arrayIncludes-2cfb33ae.js";import"./Save-b67fa0ac.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";import"./uniq-0d482d7b.js";import"./isPlainObject-07477f89.js";import"./cloneDeep-91467704.js";import"./index-72884e22.js";import"./index-356e4a49.js";import"./stories-1f769a10.js";import"./index-63a3e378.js";import"./index.esm-bf21a293.js";import"./index-ce960f89.js";import"./index-f70ce446.js";import"./zod-575fe4a8.js";import"./userGroups-edff3f7b.js";import"./SyncEagleDevTool-4c34bdb8.js";import"./searchUsers-04324aeb.js";import"./find-8750f979.js";import"./index-18188c67.js";import"./Skeleton-cd6f071e.js";import"./ExpandMore-79a3c159.js";import"./uniqBy-baac1626.js";import"./RemoveCircle-617bdac2.js";import"./index-b769406f.js";import"./DragIndicator-582939ba.js";import"./TableRow-00aadd87.js";import"./TableHead-dd1583ce.js";import"./capitalize-c31f38e2.js";import"./isString-2f2f79c0.js";import"./Person-5be09a1e.js";import"./times-069ea398.js";import"./_castFunction-353dfc26.js";import"./TaskForm-863cdb73.js";import"./RepeatFields-8275ed19.js";import"./Alert-fd9a067a.js";import"./TaskAssignees-858ea3c9.js";import"./useTaskAssignees-9f1fd5d3.js";import"./github-91d085b0.js";import"./SortUpIcon-3aecf5f0.js";import"./OpportunityLink-b32d0c35.js";import"./index-9d3afdfc.js";import"./index-79afbab1.js";import"./Check-78df5e8e.js";import"./bundle-053bdffd.js";import"./MilestoneIcon-61fb6e69.js";import"./Trash-822e65ce.js";import"./index-5d349c56.js";import"./EstimateEditorPopover-b8debf9a.js";import"./AssigneeEditorPopover-2b4e6473.js";import"./ToggleButtonGroup-93d9af56.js";import"./index-71ed01a9.js";import"./index-4d31058a.js";import"./Undo-33c7aa7a.js";import"./camelCase-4e7e8b23.js";import"./AuditLogsNoBreadCrumbs-8da9c0ce.js";import"./ExpenseView-2f5d1473.js";import"./MenuOptions-0bc3bb51.js";import"./MultipleSelectFieldInput-d0cee4a2.js";import"./LocationBeFormBody-c033b2b3.js";import"./reduce-4f6f1985.js";function at(){const[e]=m.useState({newId:I.v4()});g(["attachmentPath"]);const{id:r}=m.useContext(v),{values:a}=C();let i=null;return r?i=a==null?void 0:a.attachmentPath:i=`crm/event/attachments/${e.newId}`,X(s=>({...s,attachmentPath:i})),t.jsx(b,{text:"Attachments",contentBox:{mt:2},children:i?t.jsx(k,{path:i}):t.jsx(F,{})})}const st=H(B);function mt(){g(["crmEventLocationId"]);const{state:e}=m.useContext(v),{values:r={}}=C(),a=i=>{var s;return(s=i==null?void 0:i.sort)==null?void 0:s[0]};return e.readOnly?t.jsx(b,{text:"Location",children:t.jsx(K,{id:r.crmEventLocationId})}):t.jsx(Z,{getOptionLabel:a,autoFit:!0,name:"crmEventLocationId",model:"Location",label:"Location"})}function lt({sections:e={}}){return t.jsxs(t.Fragment,{children:[e.default&&t.jsxs(o,{children:[t.jsxs(o,{display:"flex",children:[t.jsx(j,{fieldName:"name",fullWidth:!0}),t.jsx(o,{ml:2,minWidth:"250px",children:t.jsx(f,{type:"formik-date",name:"when",label:"Date / Time",withTime:!0,fullWidth:!0})}),t.jsx(o,{ml:2,minWidth:"150px",children:t.jsx(f,{fullWidth:!0,name:"duration",label:"Duration (hrs)",InputProps:{inputComponent:Y}})}),t.jsx(o,{ml:2,minWidth:"200px",children:t.jsx(J,{name:"status",label:"Status",options:["Draft","Scheduled","Completed"]})})]}),t.jsx(o,{mt:1,children:t.jsx(j,{fieldName:"description",multiline:!0,rows:3,fullWidth:!0})}),t.jsx(o,{mt:2,children:t.jsx(mt,{})})]}),e.attachments&&t.jsx(o,{mt:2,mb:1,children:t.jsx(at,{})}),e.attendees&&t.jsx(o,{mt:2,children:t.jsx(G,{})})]})}function ct({id:e,sections:r={default:!0,attendees:!0,attachments:!0},titleHeader:a,...i}){const s=m.useCallback(n=>{const l={...n};if(console.log(">>CrmEvent/CrmEventForm::","values",n),"name"in n&&!n.name)throw new Error("Name should not be empty");if("when"in n&&!n.when)throw new Error("Date / Time should not be empty");return"attendees"in n&&typeof n.attendees=="object"&&(l.attendees=JSON.stringify(n.attendees)),l},[]);return t.jsx("div",{children:t.jsx(st,{name:"crmEvent",title:a||`${e?"Update":"Create"} Event`,initialValues:i.initialValues||{},id:e,readOnly:!!e,beforeSave:s,...i,children:t.jsx(lt,{sections:r})})})}function tr(){const e=m.useRef(null),[r,a]=P({searchText:z});T({paths:[{label:"CRM",link:"/crm"},{label:"CRM",link:"/crm"},{label:"Events",link:"/crm/event/list"}]});const i=it({model:"CrmEvent",keyword:r.searchText}),s={archived:{ne:!0}};r.searchText&&R(s,"or.0",{or:[{name:{matchPhrasePrefix:r.searchText}},{description:{matchPhrasePrefix:r.searchText}},...(i||[]).map(d=>({id:{eq:d.id}}))]});const n=N(W`
      query QUERY_EVENT_LIST($filter: SearchableCrmEventFilterInput, $nextToken: String) {
        searchCrmEvents(filter: $filter, nextToken: $nextToken) {
          items {
            id
            name
            status
            description
            crmEventLocationId
            location {
              id
              name
            }
            attendees
            when
            duration
            recOwner
          }
        }
      }
    `,{variables:{filter:s},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),l=nt({...n,model:"CrmEvent",op:"search",maxLength:5}),u=et(d=>{const w=d.target.value;a({searchText:w})},800);console.log(">>CrmEvent/CrmEventList::","eventQ",n);const c=tt(n,"data.searchCrmEvents.items",[]),{TextFieldClear:p,ClearVisibilityRuleSx:y,isValueUndefined:S}=U(),x=m.useRef();return t.jsxs(o,{mr:5,sx:{marginTop:"15px"},children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3},children:[t.jsx(D,{variant:"h1",sx:{textTransform:"uppercase",fontSize:20,fontWeight:"bold"},children:"EVENTS"}),t.jsxs(ot,{variant:"contained",color:"primary",onClick:()=>{e.current.open()},children:[t.jsx(o,{component:L,mr:1})," Create Event"]})]}),t.jsx(o,{pr:1,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",children:t.jsx("div",{children:t.jsx(V,{mr:2,width:"300px",mb:2,children:t.jsx($,{label:"Event Name",value:r.searchText,onChange:u,textFieldProps:{endAdornment:S(r==null?void 0:r.searchText)?void 0:t.jsx(p,{clearFn:()=>{a({searchText:""}),x.current.value=""}}),sx:y,inputProps:{ref:x}}})})})}),t.jsxs(o,{mt:2,children:[t.jsxs(M,{loading:n.loading,data:c,children:[t.jsx(h,{dataId:"name",label:"Name",render:dt}),t.jsx(O,{dataId:"location.name",label:"Location"}),t.jsx(h,{dataId:"attendees",label:"Invitees / Rsvp / Attended",width:"200px",render:d=>t.jsx(pt,{attendees:d})}),t.jsx(h,{dataId:"status",label:"Status",width:"120px",render:ut}),t.jsx(h,{dataId:"duration",label:"Duration",render:ht,width:"120px"}),t.jsx(Q,{dataId:"when",label:"Date / Time",format:"dd/MM/yyyy hh:mm a",width:"220px"})]}),!n.loading&&t.jsx(_,{onClick:l.more})]}),t.jsx(A,{scroll:"body",maxWidth:"lg",variant:"dialog",ref:e,dialogProps:{maxWidth:"lg",fullWidth:!0},children:t.jsx(ct,{initialValues:{duration:1,status:"Draft",attendees:"{}"},onCancel:()=>{e.current.close()},onSubmit:()=>{e.current.close(),n.refetch()}})})]})}function pt({attendees:e}){const[r,a]=m.useState({i:null,r:null,a:null});return m.useEffect(()=>{if(!e)return;const i=JSON.parse(e||"{}");let s=0,n=0,l=0;const u=(i==null?void 0:i.contacts)||{};for(const c in u){const p=u[c];p.invited&&s++,p.rsvp&&n++,p.attended&&l++}a(c=>({...c,i:s,r:n,a:l}))},[e]),r.i+r.r+r.a===0?null:t.jsxs("span",{children:[r.i," / ",r.r," / ",r.a]})}function dt(e,r){return t.jsx(q,{component:rt,to:`/crm/event/${r.id}`,children:e})}function ut(e){return e?t.jsx(E,{label:e,size:"small"}):null}function ht(e){return e?t.jsx(E,{label:`${e} hr`,size:"small"}):null}export{dt as CrmEventLinkCell,ut as CrmEventStatusCell,tr as default};
