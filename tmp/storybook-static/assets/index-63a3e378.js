import{j as e}from"./TransitionGroupContext-9d36972e.js";import{R as D,r as R}from"./index-f1f749bf.js";import{u as ue,a as xe}from"./index.esm-bf21a293.js";import{B as n,cu as he,$ as pe,C as ye,cw as ge,M as $,cx as Y,cy as Ce,u as me,l as fe,a as je,br as Se,cz as Q,a$ as ve,b3 as be,ac as J,Y as te,a2 as re,aC as _,T as r,as as we,cA as Te,b2 as U,v as ne,w as ae,au as Pe,av as Ie,bq as Le,b6 as Ve,aJ as Ae,at as Ee,cB as Re,e as Fe}from"./papaparse.min-b66e70e7.js";import"./_baseForOwn-9b89c4b6.js";import{I as ie,l as q,b as Ke}from"./index-bcfaa842.js";import"./index-96c5f47c.js";import{F as w}from"./index-ce960f89.js";import{F as S}from"./index-f70ce446.js";import{s as Be}from"./zod-575fe4a8.js";import{d as We}from"./Add-be7f5660.js";import{B}from"./Button-352c3435.js";import{L as W}from"./userGroups-edff3f7b.js";import{h as ke,f as Ne,u as Me}from"./react-router-19e5b27c.js";function De(i){return e.jsx(n,{...i,children:e.jsx(he,{})})}const _e=Ce();function Ge(i){const{onAdd:t,defaultValue:l,name:o,control:d,options:a,rules:c,...x}=i,{onChange:f,renderOption:h,capitalizeLabel:T,...P}=x,{field:p}=ue({name:o,control:d,defaultValue:l,rules:c}),[u,g]=D.useState(null);console.log(">>components/FormQuickAddSelect::","props123",d),pe(async y=>{if(!u)return;const s=await t(u.value);if(y()){if(g(null),!u._event)throw new Error("Event should be supplied");f==null||f(u._event,s,"createOption")}},[u]);let m={...P};u&&(m={...m,disabled:!0,loading:!0,label:e.jsxs(e.Fragment,{children:[m.label,e.jsx(ye,{size:15,sx:{ml:1}})]})});const A=R.useCallback((y,s)=>typeof s=="string"?p==null?void 0:p.onChange(s):s&&"value"in s?p==null?void 0:p.onChange(s.value):Array.isArray(s)?p==null?void 0:p.onChange(s.map(v=>typeof v=="string"?v:v.value)):p==null?void 0:p.onChange(s),[p]);return e.jsx(ge,{...m,freeSolo:!0,name:o,onChange:(y,s,v)=>{if(A(y,s),typeof s=="string"){g({_label:"...",value:s,_event:y});return}f==null||f(y,s,v)},options:a,getOptionLabel:y=>y.label??y,filterOptions:(y,s)=>{const v=_e(y,s),{inputValue:C}=s,F=C==null?void 0:C.toLowerCase(),K=y.some(({label:k,name:I})=>{const N=(k||I||"").toLowerCase();return F===N});return C!==""&&!K&&v.push({value:C,label:C,title:`Add: "${C}"`}),v},renderOption:(y,s,v)=>typeof s=="string"?null:"_label"in s?R.createElement($,{...y,key:s._label,onClick:(...C)=>{var K;const[F]=C;g({...s,_event:F}),(K=y.onClick)==null||K.call(y,...C)}},Y(s,T)):R.createElement($,{...y,key:(s==null?void 0:s.id)||(s==null?void 0:s.value)||(s==null?void 0:s.key)},h?h(y,s,v):Y(s,T))})}const Z={[W.sales]:"sales-job",[W.valuation]:"job"};function Oe(){switch(ke().pathname.split("/")[2]){case Z.sales:return W.sales;case Z.valuation:return W.valuation;default:return W.valuation}}function jt(i){var c,x;const t=me(fe`
      query ListActivities($nextToken: String, $filter: AWSJSON, $sort: AWSJSON) {
        searchActivitys: nestedSearch(
          type: "Activity"
          filter: $filter
          nextToken: $nextToken
          sort: $sort
          limit: 999
        ) {
          nextToken
          items {
            ... on Activity {
              id
            }
          }
        }
      }
    `,{variables:{filter:JSON.stringify({archived:{ne:!0},activityProjectId:{eq:i}})},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),{data:l,loading:o,refetch:d}=t;return[(x=(c=l==null?void 0:l.searchActivitys)==null?void 0:c.items)==null?void 0:x.length,o,d]}const O=async i=>{const t=await je({key:"getProject",variables:{id:i},depthLimit:2});return t?Se(Q,t):null},qe=ve(Q),X=async i=>{const{searchText:t="",jobIds:l,ids:o,size:d=1e4}=i||{},a=[t&&{multi_match:{query:t,type:"phrase_prefix",fields:["name","attributes.address1","attributes.suburb","attributes.address2","attributes.postcode"]}}].filter(Boolean),c={"id.keyword":o!=null&&o.length?o:void 0,"groups.id.keyword":l!=null&&l.length?l:void 0};return await qe.find(be(c),{size:d,query:{bool:{must_not:[{exists:{field:"archived"}}],must:a!=null&&a.length?a:void 0}}})};function Qe(i){return!i||!Object.hasOwn(ee,i)?[]:ee[i]}const ze=["Banana Shire Council","Blackall-Tambo Regional Council","Brisbane City Council","Bundaberg Regional Council","Cairns Regional Council","Cassowary Coast Regional Council","Cook Shire Council","Fraser Coast Regional Council","Gold Coast City Council","Goondiwindi Regional Council","Gympie Regional Council","Ipswich City Council","Lockyer Valley Regional Council","Logan City Council","Maranoa Regional Council","Moreton Bay Regional Council","Noosa Shire Council","North Burnett Regional Council","Redland City Council","Scenic Rim Regional Council","Somerset Regional Council","South Burnett Regional Council","Southern Downs Regional Council","Sunshine Coast Regional Council","Tablelands Regional Council","Toowoomba Regional Council","Western Downs Regional Council"],He=["Auburn","Bayside Council","Blacktown","Blue Mountains City Council","Botany Bay","Burwood","Byron Shire Council","Camden","Campbelltown","Canada Bay","Canterbury Bankstown Council","Central Coast Council","Cessnock City Council","Cumberland Council","Dungog Shire Council","Fairfield","Georges River Council","Goulburn Mulwaree Council","Hawkesbury","Holroyd","Hornsby","Hunters Hill","Inner West Council - Ashfield","Inner West Council - Leichhardt","Inner West Council - Marrickville","Kiama Municipal Council","Ku-Ring-Gai","Lake Macquarie City Council","Lane Cove","Liverpool","Maitland City Council","Mosman","Newcastle City Council","North Sydney","Northern Beaches - Manly","Northern Beaches - Pittwater","Northern Beaches - Warringah","Parramatta","Penrith","Port Stephens Council","Queanbeyan-Palerang Regional Council","Randwick","Rockdale","Ryde","Shellharbour City Council","Shoalhaven City Council","Singleton Council","Snowy Monaro Regional Council","Strathfield","Sutherland","Sydney","The Hills","Tweed Shire Council","Upper Lachlan Shire Council","Victoria Daly Regional Council","Warren Shire Council","Waverley","Willoughby","Wingecarribee Shire Council","Wollondilly Shire Council","Wollongong City Council","Woollahra","Yass Valley Council"],$e=["Alpine Shire","Bass Coast Shire","Borough of Queenscliffe","City of Ballarat","City of Banyule","City of Bayside","City of Boroondara","City of Brimbank","City of Casey","City of Darebin","City of Frankston","City of Glen Eira","City of Greater Bendigo","City of Greater Dandenong","City of Greater Geelong","City of Greater Shepparton","City of Hobsons Bay","City of Hume","City of Kingston","City of Knox","City of Latrobe","City of Manningham","City of Maribyrnong","City of Maroondah","City of Melbourne","City of Melton","City of Monash","City of Moonee Valley","City of Moreland","City of Port Phillip","City of Stonnington","City of Warrnambool","City of Whitehorse","City of Whittlesea","City of Wodonga","City of Wyndham","City of Yarra","Corangamite Shire","Golden Plains Shire","Pyrenees Shire","Rural City of Ararat","Rural City of Benalla","Rural City of Horsham","Rural City of Mildura","Rural City of Swan Hill","Rural City of Wangaratta","Shire of Baw Baw","Shire of Buloke","Shire of Campaspe","Shire of Cardinia","Shire of Cardinia","Shire of Central Goldfields","Shire of East Gippsland","Shire of Gannawarra","Shire of Glenelg","Shire of Hepburn","Shire of Hindmarsh","Shire of Indigo","Shire of Loddon","Shire of Macedon Ranges","Shire of Mansfield","Shire of Mitchell","Shire of Moira","Shire of Moorabool","Shire of Mornington Peninsula","Shire of Mount Alexander","Shire of Moyne","Shire of Murrindindi","Shire of Nillumbik","Shire of Northern Grampians","Shire of Southern Grampians","Shire of Strathbogie","Shire of Towong","Shire of Wellington","Shire of West Wimmera","Shire of Yarra Ranges","Shire of Yarriambiack","South Gippsland Shire","Surf Coast Shire"],Ye=["City of Armadale","City of Bayswater","City of Belmont","City of Bunbury","City of Busselton","City of Canning","City of Cockburn","City of Fremantle","City of Gosnells","City Of Joondalup","City of Kwinana","City of Mandurah","City of Melville","City of Nedlands","City of Perth","City of Rockingham","City of South Perth","City of Stirling","City of Subiaco","City of Swan","City of Vincent","City of Wanneroo","Shire of Boddington","Shire of Capel","Shire of Chittering","Shire of Collie","Shire of Dandaragan","Shire of Dardanup","Shire of Gingin","Shire of Goomalling","Shire of Harvey","Shire of Kalamunda","Shire of Moora","Shire of Mundaring","Shire of Murray","Shire of Northam","Shire of Peppermint","Shire of Serpentine-Jarrahdale","Shire of Toodyay","Shire of Victoria Plains","Shire of Waroona","Shire of York","Town of Bassendean","Town of Cambridge","Town of Claremont","Town of Cottesloe","Town of East Fremantle","Town of Mosman Park","Town of Victoria Park"],Je=["Alice Springs","City of Darwin","City of Palmerston","Cook Shire Council","Coomalie Shire","Litchfield Shire","Town of Katherine","Victoria Daly Regional Council","Wagait Shire"],ee={QLD:ze,NSW:He,VIC:$e,WA:Ye,NT:Je};var le=[{value:"ACT",label:"Australian Capital Territory"},{value:"NSW",label:"New South Wales"},{value:"NT",label:"Northern Territory"},{value:"QLD",label:"Queensland"},{value:"SA",label:"South Australia"},{value:"TAS",label:"Tasmania"},{value:"VIC",label:"Victoria"},{value:"WA",label:"Western Australia"}];const{kwToOpts:M}=ie;function Ue({form:i,mode:t,showFields:l,setShowFields:o,children:d}){var p;const a={textStyle:{color:"#9BA8B6",fontSize:"12px"},cardText:{color:"#000",fontSize:"14px"}},c=i.getValues(),[x,f]=D.useState(()=>{const u=i.getValues(["state"]);return u&&!J(u)?u[0]:void 0}),h=t==="EDIT"||t==="ADD",[T]=te(["lawddevKwZoning","lawddevKwNearestCapitalCity","lawddevKwNatureOfAsset","lawddevKwAssetType","lawddevKwMainEnterprise","lawddevKw2ndEnterprise","lawddevKw3rdEnterprise","lawddevKwTerminology","lawddevKwTownDescriptionLink","lawddevKwPropertyClass","lawddevKwPropertySubClass","lawddevKwEnterprise"]),{data:P}=re({queryKey:["LIST_LGAs",x],queryFn:()=>{const u=Qe(x);if(!J(u))return u.map((g,m)=>({id:`${g}-${m}`,value:g,label:g}))}});return e.jsxs(_,{sx:{padding:2,width:"50%",marginRight:1},children:[e.jsx(r,{variant:"h6",sx:{marginBottom:2},children:"Location"}),e.jsx(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:e.jsx(n,{gridColumn:"span 2",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Address"}),e.jsx(r,{sx:a.cardText,children:c.address1})]}):h?e.jsx(w,{control:i.control,name:"address1",label:"Address",autoComplete:"none"}):null})}),e.jsxs(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:[e.jsx(n,{gridColumn:"span 1",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Suburb"}),e.jsx(r,{sx:a.cardText,children:c.suburb})]}):h?e.jsx(w,{control:i.control,name:"suburb",label:"Suburb",autoComplete:"none"}):null}),e.jsx(n,{gridColumn:"span 1",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"State"}),e.jsx(r,{sx:a.cardText,children:c.state||"-"})]}):h?e.jsx(S,{options:(p=le||[])==null?void 0:p.map(u=>({value:u.value,id:u.value,label:u.value})),control:i.control,name:"state",textFieldProps:{label:"State",placeholder:""},onOptionSelected:(u,g)=>{const m=g||void 0,A=m?m.value:void 0;f(A)},autoComplete:"none"}):null}),e.jsx(n,{gridColumn:"span 1",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Postal Code"}),e.jsx(r,{sx:a.cardText,children:c.postcode||"-"})]}):h?e.jsx(w,{control:i.control,name:"postcode",label:"Postal Code",autoComplete:"none"}):null})]}),l===!0?e.jsxs(e.Fragment,{children:[e.jsxs(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:[e.jsx(n,{gridColumn:"span 1",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Property Class"}),e.jsx(r,{sx:a.cardText,children:c.propertyClass||"-"})]}):h?e.jsx(S,{options:M(T.lawddevKwPropertyClass??[]),control:i.control,name:"propertyClass",textFieldProps:{label:"Property Class",placeholder:""}}):null}),e.jsx(n,{gridColumn:"span 1",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Property Sub Class"}),e.jsx(r,{sx:a.cardText,children:c.propertySubClass||"-"})]}):h?e.jsx(S,{options:M(T.lawddevKwPropertySubClass??[]),control:i.control,name:"propertySubClass",textFieldProps:{label:"Property Sub Class",placeholder:""}}):null})]}),e.jsx(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:e.jsx(n,{gridColumn:"span 2",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Nearest Capital City"}),e.jsx(r,{sx:a.cardText,children:c.nearestCity||"-"})]}):h?e.jsx(S,{options:M(T.lawddevKwNearestCapitalCity??[]),control:i.control,name:"nearestCity",textFieldProps:{label:"Nearest Capital City",placeholder:""}}):null})}),e.jsx(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:e.jsx(n,{gridColumn:"span 2",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Nearest Regional Centre"}),e.jsx(r,{sx:a.cardText,children:c.nearestRegion||"-"})]}):h?e.jsx(Ge,{options:[],control:i.control,name:"nearestRegion",label:"Nearest Regional Centre",onAdd:u=>{setOptions([...options,{value:u,label:u}])},sx:{mb:"-24px"}}):null})}),e.jsxs(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:[e.jsx(n,{gridColumn:"span 1",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Latitude"}),e.jsx(r,{sx:a.cardText,children:c.latitude||"-"})]}):h?e.jsx(w,{control:i.control,name:"latitude",label:"Latitude",type:"number"}):null}),e.jsx(n,{gridColumn:"span 1",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Longitude"}),e.jsx(r,{sx:a.cardText,children:c.longitude||"-"})]}):h?e.jsx(w,{control:i.control,name:"longitude",label:"Longitude",type:"number"}):null})]}),e.jsx(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:e.jsx(n,{gridColumn:"span 2",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Zoning"}),e.jsx(r,{sx:a.cardText,children:c.zoning||"-"})]}):h?e.jsx(S,{options:M(T.lawddevKwZoning??[]),control:i.control,name:"zoning",textFieldProps:{label:"Zoning",placeholder:""}}):null})}),e.jsx(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:e.jsx(n,{gridColumn:"span 2",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"LGA"}),e.jsx(r,{sx:a.cardText,children:c.LGA||"-"})]}):h?e.jsx(w,{control:i.control,name:"LGA",label:"Local Authority",placeholder:""}):null})}),e.jsx(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:e.jsx(n,{gridColumn:"span 2",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Local Plan"}),e.jsx(r,{sx:a.cardText,children:c.localPlan||"-"})]}):h?e.jsx(w,{control:i.control,name:"localPlan",label:"Local Plan"}):null})}),e.jsx(n,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mt:"14px",children:e.jsx(n,{gridColumn:"span 2",children:t==="VIEW"||t==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:a.textStyle,children:"Highest and Best Use"}),e.jsx(r,{sx:a.cardText,children:c.highestAndBestUse||"-"})]}):h?e.jsx(w,{control:i.control,name:"highestAndBestUse",label:"Highest and Best Use"}):null})})]}):null,t==="ADD"&&e.jsx(e.Fragment,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(we,{checked:l,onChange:()=>{o(!l)},inputProps:{"aria-label":"controlled"}}),e.jsx(r,{children:"Show All Fields"})]})}),d]})}const{kwToOpts:E}=ie,b={textStyle:{color:"#9BA8B6",fontSize:"12px"},cardText:{color:"#000",fontSize:"14px"}};function Ze(i){const{form:t,mode:l,showFields:o}=i,d=l==="EDIT"||l==="ADD",[a]=te(["lawddevKwElectricity","lawddevKwSewerage","lawddevKwGas","lawddevKwTelephone","lawddevKwMobileService","lawddevKwMail","lawddevKwInternet"]);return e.jsxs(_,{sx:{padding:2,width:"50%",mr:1},children:[e.jsx(r,{variant:"h6",sx:{marginBottom:2},children:"Services & Amenities"}),o===!0?e.jsx(e.Fragment,{children:e.jsxs(n,{display:"grid",gridTemplateColumns:"repeat(1, 1fr)",gap:2,mt:"14px",children:[e.jsx(n,{gridColumn:"span 1",children:l==="VIEW"||l==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:b.textStyle,children:"Electricity"}),e.jsx(r,{sx:b.cardText,textTransform:"capitalize",children:t.getValues("electricity")?t.getValues("electricity"):"-"})]}):d?e.jsx(S,{options:E(a.lawddevKwElectricity??[]),defaultValue:t.getValues("electricity")??"",control:t.control,name:"electricity",textFieldProps:{label:"Electricity",placeholder:""}}):null}),e.jsx(n,{gridColumn:"span 1",children:l==="VIEW"||l==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:b.textStyle,children:"Sewerage"}),e.jsx(r,{sx:b.cardText,children:t.getValues("sewerage")?t.getValues("sewerage"):"-"})]}):d?e.jsx(S,{options:E(a.lawddevKwSewerage??[]),defaultValue:t.getValues("sewerage")??"",control:t.control,name:"sewerage",textFieldProps:{label:"Sewerage",placeholder:""}}):null}),e.jsx(n,{gridColumn:"span 1",children:l==="VIEW"||l==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:b.textStyle,children:"Gas"}),e.jsx(r,{sx:b.cardText,children:t.getValues("gas")?t.getValues("gas"):"-"})]}):d?e.jsx(S,{options:E(a.lawddevKwGas??[]),defaultValue:t.getValues("gas")??"",control:t.control,name:"gas",textFieldProps:{label:"Gas",placeholder:""}}):null}),e.jsx(n,{gridColumn:"span 1",children:l==="VIEW"||l==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:b.textStyle,children:"Telephone"}),e.jsx(r,{sx:b.cardText,children:t.getValues("telephone")?t.getValues("telephone"):"-"})]}):d?e.jsx(S,{options:E(a.lawddevKwTelephone??[]),defaultValue:t.getValues("telephone")??"",control:t.control,name:"telephone",textFieldProps:{label:"Telephone",placeholder:""}}):null}),e.jsx(n,{gridColumn:"span 1",children:l==="VIEW"||l==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:b.textStyle,children:"Mobile Service"}),e.jsx(r,{sx:b.cardText,children:t.getValues("mobileService")?t.getValues("mobileService"):"-"})]}):d?e.jsx(S,{options:E(a.lawddevKwMobileService??[]),defaultValue:t.getValues("mobileService")??"",control:t.control,name:"mobileService",textFieldProps:{label:"Mobile Service",placeholder:""}}):null}),e.jsx(n,{gridColumn:"span 1",children:l==="VIEW"||l==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:b.textStyle,children:"Mail"}),e.jsx(r,{sx:b.cardText,children:t.getValues("mail")?t.getValues("mail"):"-"})]}):d?e.jsx(S,{options:E(a.lawddevKwMail??[]),defaultValue:t.getValues("mail")??"",control:t.control,name:"mail",textFieldProps:{label:"Mail",placeholder:""}}):null}),e.jsx(n,{gridColumn:"span 1",children:l==="VIEW"||l==="LINK"?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:b.textStyle,children:"Internet"}),e.jsx(r,{sx:b.cardText,children:t.getValues("internet")?t.getValues("internet"):"-"})]}):d?e.jsx(S,{options:E(a.lawddevKwInternet??[]),defaultValue:t.getValues("internet")??"",control:t.control,name:"internet",textFieldProps:{label:"Internet",placeholder:""}}):null})]})}):""]})}const Xe=i=>{const{form:t,name:l,defaultValue:o,...d}=i,{bind:a}=Te({form:t,name:l,queryKey:({ids:c,searchText:x})=>[{ids:c,searchText:x,type:"PROPERTIES",componentKey:"PropertyAutocomplete"}],getOptionLabel:c=>c.name,queryFn:async({queryKey:c})=>{const[{searchText:x,ids:f=[]}]=c,h=U([...f,o]),T=await X(x?{searchText:x,size:10}:{size:5}),P=q.uniq(h);console.log({searchText:x,ids:f,defaultValue:o,uniqueIds:P,values:h});const p=[...T];if(P!=null&&P.length){const g=await X({ids:P});g!=null&&g.length&&p.push(...g)}return q.uniqBy(U(p),"id")}});return e.jsx(S,{textFieldProps:{variant:"standard",placeholder:"Select property"},...a,...d,customRenderOption:(c,x)=>e.jsxs(n,{...c,sx:f=>({width:1,display:"flex",flexDirection:"column",alignItems:"flex-start!important",borderBottom:`1px solid ${f.palette.text.disabled}`}),children:[e.jsx(r,{variant:"subtitle2",fontWeight:900,children:x.label}),e.jsxs(r,{variant:"caption",sx:{color:"text.secondary"},children:["Address 1:"," ",e.jsx(r,{variant:"caption",sx:{color:"text.primary"},children:x._source.address1??""})]}),e.jsxs(r,{variant:"caption",sx:{color:"text.secondary"},children:["Address 2:"," ",e.jsx(r,{variant:"caption",sx:{color:"text.primary"},children:x._source.address2??""})]}),e.jsxs(n,{sx:{width:1,columnGap:2,display:"flex",justifyContent:"flex-start"},children:[e.jsxs(r,{variant:"caption",sx:{color:"text.secondary",width:"33%"},children:["Suburb:"," ",e.jsx(r,{variant:"caption",sx:{color:"text.primary"},children:x._source.suburb??""})]}),e.jsxs(r,{variant:"caption",sx:{color:"text.secondary",width:"33%"},children:["State:"," ",e.jsx(r,{variant:"caption",sx:{color:"text.primary"},children:x._source.state??""})]}),e.jsxs(r,{variant:"caption",sx:{color:"text.secondary",width:"33%"},children:["Postal Code:"," ",e.jsx(r,{variant:"caption",sx:{color:"text.primary"},children:x._source.postcode??""})]})]})]})})};function et({form:i,mode:t}){const l=t==="EDIT"||t==="ADD"||t==="LINK",[o,d]=ne({mode:ae});return l?e.jsxs(_,{sx:{padding:2,width:"100%"},children:[e.jsx(r,{variant:"h6",sx:{marginBottom:2}}),e.jsxs(n,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:2,mt:"14px",children:[t==="LINK"&&e.jsx(n,{gridColumn:"span 2",children:e.jsx(Xe,{form:i,name:"id",textFieldProps:{label:"Property",placeholder:"Link a property"}})}),(t==="EDIT"||t==="VIEW"||t==="ADD")&&e.jsx(n,{gridColumn:"span 2",children:e.jsx(w,{control:i.control,name:"name",label:"Name",autoComplete:"none"})}),t==="LINK"&&e.jsx(n,{sx:{width:"10%"},children:e.jsx(B,{sx:{marginTop:.5},variant:"contained",color:"primary",onClick:()=>{console.log("Current Mode",o),d({mode:"ADD"})},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(We,{})," ",e.jsx(r,{})]})})})]})]}):e.jsx(e.Fragment,{})}var z={},tt=Ie;Object.defineProperty(z,"__esModule",{value:!0});var se=z.default=void 0,rt=tt(Pe()),nt=e;se=z.default=(0,rt.default)((0,nt.jsx)("path",{d:"M5 15h2V8.41L18.59 20 20 18.59 8.41 7H15V5H5z"}),"NorthWest");function at({form:i,mode:t,children:l}){const o={textStyle:{color:"#9BA8B6",fontSize:"12px"},cardText:{color:"#000",fontSize:"14px"}},d=i.getValues(),a=R.useMemo(()=>t==="EDIT"||t==="ADD",[t]),c=R.useMemo(()=>t==="VIEW"||t==="LINK",[t]);return e.jsxs(_,{sx:{padding:2,width:"100%",marginRight:1},children:[e.jsx(r,{variant:"h6",sx:{marginBottom:2},children:"Property Detail"}),e.jsxs(n,{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:2,mt:"14px",children:[e.jsx(n,{gridColumn:"span 2",children:c?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:o.textStyle,children:"Address 1"}),e.jsx(r,{sx:o.cardText,children:d.address1})]}):a?e.jsx(w,{control:i.control,name:"address1",label:"Address 1"}):null}),e.jsx(n,{gridColumn:"span 2",children:c?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:o.textStyle,children:"Address 2"}),e.jsx(r,{sx:o.cardText,children:d.address1})]}):a?e.jsx(w,{control:i.control,name:"address2",label:"Address 2"}):null}),e.jsx(n,{gridColumn:"span 1",children:c?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:o.textStyle,children:"Suburb"}),e.jsx(r,{sx:o.cardText,children:d.suburb})]}):a?e.jsx(w,{control:i.control,name:"suburb",label:"Suburb"}):null}),e.jsx(n,{gridColumn:"span 1",children:c?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:o.textStyle,children:"State"}),e.jsx(r,{sx:o.cardText,children:d.state||"-"})]}):a?e.jsx(S,{options:le,control:i.control,name:"state",textFieldProps:{label:"State",placeholder:""}}):null}),e.jsx(n,{gridColumn:"span 1",children:c?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"caption",sx:o.textStyle,children:"Postal Code"}),e.jsx(r,{sx:o.cardText,children:d.postcode||"-"})]}):a?e.jsx(w,{control:i.control,name:"postcode",label:"Postal Code"}):null})]}),l]})}const it=async i=>{const t=Le(Q,i),[l]=await Ve([{...t,__op:"update"}]);return{...i,id:l.id}};function St(i){const{mode:t,setOpenPropertyDetailsForm:l,setQParams:o,handleSubmit:d,property:a,jobId:c,openLink:x}=i;console.log("PROPERTY DETAILS",{property:a,mode:t});const[{propertyId:f}]=ne({propertyId:ae}),h=Oe(),T=R.useMemo(()=>h===W.sales,[h]),P=Ne(),p=Me(),u=Ae(),[g,m]=D.useState(!1),{globalState:{authUser:A}}=Ee(),y=A==null?void 0:A.id,s=xe({resolver:Be(Re),defaultValues:t==="EDIT"||t==="VIEW"?a:{name:"",type:"PROPERTY",propertyOrigin:h,updatedBy:y,createdBy:y,__typename:"Project"}}),v=s.watch("id"),{data:C,isFetching:F,isLoading:K}=re({queryKey:["Q_PROPERTY",{selectedProperty:v}],queryFn:async()=>await(O==null?void 0:O(v))});R.useEffect(()=>{t!=="ADD"&&!F&&s.reset(C)},[s,C,v,F,K,t]);const k=()=>{o({propertyId:void 0}),s.reset()},{enqueueSnackbar:I}=Ke(),[N,H]=D.useState(!0),oe=async(j,L)=>{try{m(!0),I("Creating Property...",{variant:"info"});const V={...j,id:Fe.v4()},G=await d(V,L);return I("Property successfully created!",{variant:"success"}),m(!1),x&&(o({mode:"LINK"}),u.refetchQueries(["Q_PROPERTY_LIST"])),G}catch{m(!1),I("Failed to create property. Please try again.",{variant:"error"})}},ce=async(j,L)=>{try{const V={id:f??(p==null?void 0:p.propertyId),...j};I("Updating Property...",{variant:"info"});const G=await d(V,L);return I("Property successfully updated!",{variant:"success"}),u.invalidateQueries(["Q_JOB_PROPERTY_LIST"]),G}catch(V){I(`Failed to update property. Please try again.${V}`,{variant:"error"})}},de=async()=>{try{m(!0),I("Linking Property...",{variant:"info"});const L=[...(C==null?void 0:C.groups)||[],{id:c,name:null}],V={...C,groups:q.uniqBy(L,"id")};await it(V),I("Property successfully linked!",{variant:"success"}),l==null||l(!1),o({mode:"VIEW"}),m(!1)}catch(j){m(!1),I(`Failed to link property. Please try again.${j}`,{variant:"error"})}finally{u.refetchQueries({queryKey:["Q_JOB_PROPERTY_LIST"]}),u.refetchQueries({queryKey:["Q_PROPERTY_OPTIONS"]})}};return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:s.handleSubmit(async(j,L)=>{t==="LINK"?await de():await oe(j,L)},j=>{console.log("Error creating Property, Please try again.",j)}),children:[e.jsxs(n,{children:[e.jsx(n,{children:(t==="VIEW"||t==="EDIT")&&e.jsx(e.Fragment,{children:e.jsx(se,{sx:{color:"#184E9A",width:"20px",float:"left",cursor:"pointer",marginRight:"5px"},onClick:()=>{k(),P.goBack()}})})}),e.jsx(n,{children:t==="VIEW"&&e.jsx(r,{sx:{color:"#00000",fontWeight:"bold",float:"left",marginRight:"5px"},children:s.control._formValues.name||"-"})})]}),e.jsxs(n,{sx:{background:"white"},children:[t==="EDIT"?e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-end",marginBottom:2},children:[e.jsx(n,{children:e.jsx(B,{onClick:s.handleSubmit(async(j,L)=>{await ce(j,L)},j=>{console.error("Error on update Property:",j)}),sx:{height:"40px",width:"100px",marginRight:1},variant:"contained",children:"SAVE"})}),e.jsx(n,{children:e.jsx(B,{onClick:()=>{l==null||l(!1),o({mode:"VIEW"}),k()},sx:{height:"40px",width:"100px"},variant:"outlined",children:"CANCEL"})})]}):t==="ADD"||t=="LINK"?e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-end",marginBottom:2},children:[e.jsx(n,{children:e.jsx(B,{type:"submit",sx:{height:"40px",width:"100px",marginRight:1},variant:"contained",disabled:g===!0,children:g===!0?e.jsx(De,{}):"Save"})}),e.jsx(n,{children:e.jsx(B,{onClick:()=>{l==null||l(!1),o(t==="ADD"&&x?{mode:"LINK"}:{mode:"VIEW"}),k()},sx:{height:"40px",width:"100px"},variant:"outlined",disabled:g===!0,children:"CANCEL"})})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",marginBottom:2},children:e.jsx(n,{children:e.jsx(B,{sx:{height:"40px",width:"100px",marginRight:1},variant:"contained",onClick:()=>{o({mode:"EDIT"})},children:"EDIT"})})}),e.jsx(n,{sx:{marginBottom:"10px",width:"100%"},children:e.jsx(et,{mode:t,form:s})}),e.jsx(n,{sx:{display:"flex"},children:T?e.jsx(e.Fragment,{children:e.jsx(at,{mode:t,form:s,showFields:N,setShowFields:H,children:e.jsxs(n,{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:2,mt:"14px",children:[e.jsx(n,{gridColumn:"span 1",children:e.jsx(S,{control:s.control,name:"sizeUnit",textFieldProps:{label:"Measurement"},disableClearable:!0,options:[{id:"ha",label:"HA",value:"ha"},{id:"sqm",label:"SQM",value:"sqm"},{id:"ac",label:"AC",value:"ac"}]})}),e.jsx(n,{gridColumn:"span 1",children:e.jsx(w,{control:s.control,name:"sizeNumber",label:"Actual Size",type:"number"})})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{mode:t,form:s,showFields:N,setShowFields:H}),e.jsx(Ze,{mode:t,form:s,showFields:N})]})})]})]})})}export{St as P,De as S,jt as a,it as b,O as g,X as s,Oe as u};
