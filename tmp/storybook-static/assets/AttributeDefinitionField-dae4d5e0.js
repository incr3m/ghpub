import{j as e}from"./TransitionGroupContext-9d36972e.js";import{u as F}from"./useIncludeFieldNames-35a180a9.js";import{L as k,b as g,N as T,Q as u,J as j,O as S,B as v,X as A,i as B,W as I,m as D,aT as R,aU as E,ag as w,a9 as N,aV as z,p}from"./papaparse.min-b66e70e7.js";import{R as a}from"./index-f1f749bf.js";import{c as m}from"./camelCase-4e7e8b23.js";import{g as K}from"./_baseForOwn-9b89c4b6.js";import{T as L}from"./Trash-822e65ce.js";import{S as O}from"./Play-87fed129.js";import{F as y,A as _}from"./AttributeFieldTypes-f31007ac.js";import{B as f}from"./Button-352c3435.js";const b=D({header:{display:"flex",justifyContent:"space-between",alignItems:"center","& > span":{fontSize:"large"}},formContent:{"& > *":{marginBottom:10,paddingTop:10}}});function P({definition:t,onChange:i}){const o=a.useRef(null),[n,r]=a.useState({selectedKey:null,definition:t,attributes:[]});a.useEffect(()=>{r(s=>({...s,definition:t}))},[t]);const d=b(),h=a.useCallback(s=>{const l=s==null?void 0:s.key;l&&(r(c=>({...c,definition:{...c.definition,[l]:s}})),o.current.close())},[]);a.useEffect(()=>{if(!n.definition)return;const s=[],l=n.definition||{};for(const c in l)s.push(l[c]);r(c=>({...c,attributes:s})),i&&i(n.definition)},[n.definition]);const C=a.useCallback(s=>{r(l=>({...l,selectedKey:s.key})),o.current.open()},[]);return e.jsxs("div",{children:[e.jsx(k,{contentBox:{mt:2},labelComponent:"div",text:e.jsxs("div",{className:d.header,children:[e.jsx("span",{children:"Custom Fields"}),e.jsx(f,{variant:"outlined",size:"small",onClick:async()=>{r(s=>({...s,selectedKey:null})),await g.delay(100),o.current.open()},children:"Create Custom Field"})]}),children:e.jsxs(T,{data:n.attributes,onItem:s=>({...s,id:s.key}),onRowClick:C,children:[e.jsx(u,{dataId:"label"}),e.jsx(u,{dataId:"type",label:"Type",render:s=>j(m(s))}),e.jsx(u,{dataId:"desc",label:"Description"}),e.jsx(S,{dataId:"key",label:"action",width:"80px",render:s=>e.jsx(v,{display:"flex",justifyContent:"center",children:e.jsx(A,{title:"Delete",children:e.jsx(B,{size:"small",onClick:l=>{l.stopPropagation(),r(c=>{const x={...c.definition};return delete x[s],{...c,definition:x}})},children:e.jsx(L,{})})})})})]})}),e.jsx(I,{scroll:"body",maxWidth:"md",variant:"dialog",ref:o,dialogProps:{maxWidth:"xs"},children:e.jsx(M,{initialValues:K(n,["definition",n.selectedKey]),onSubmit:h,onClose:()=>{o.current.close()}})})]})}function U({attrKey:t}){const{values:i={},setFieldValue:o}=p(),n=i.label;a.useEffect(()=>{!n||t||o("key",m(n))},[t,n]);const r=a.useMemo(()=>Object.keys(y).map(d=>({value:d,label:j(m(d))})),[]);return e.jsxs(e.Fragment,{children:[e.jsx(O,{name:"type",label:"Field Type",options:r}),e.jsx(W,{})]})}function W({attrKey:t}){var n;const{values:i={}}=p();if(console.log(">>SettingForm/AttributeDefinition::","values",i),!i.type)return null;const o=((n=y[i.type])==null?void 0:n.attributeForm)||_;return e.jsx(o,{attrKey:t})}function M({initialValues:t,onSubmit:i,onClose:o}){const[n]=a.useState({initialValues:t||{}}),r=b();return e.jsx(R,{enableReinitialize:!0,initialValues:n.initialValues,onSubmit:i,children:()=>e.jsxs(E,{children:[e.jsxs(w,{children:[t!=null&&t.key?"Update":"Create"," Custom Field"]}),e.jsx(N,{className:r.formContent,children:e.jsx(U,{attrKey:t==null?void 0:t.key})}),e.jsxs(z,{children:[e.jsx(f,{onClick:o,children:"CANCEL"}),e.jsx(f,{variant:"contained",color:"primary",type:"submit",autoFocus:!0,children:"SUBMIT"})]})]})})}function ee({field:t}){F([t]);const{values:i={},setFieldValue:o}=p(),n=i[t],r=a.useCallback(d=>{o(t,d)},[t,o]);return e.jsx(P,{definition:n,onChange:r})}export{ee as A};
