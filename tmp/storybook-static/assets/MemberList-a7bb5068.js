import{j as e}from"./TransitionGroupContext-9d36972e.js";import{R as h}from"./index-f1f749bf.js";import{au as z,av as Q,F as V,B as m,v as A,o as G,bA as W,u as N,bB as Z,aM as J,T as L,R as K,W as Y,Y as X,z as ee,G as te,bC as re,l as oe,f as se,w as ie}from"./papaparse.min-b66e70e7.js";import{U as ae,a as me}from"./UserFormV2-0b48237f.js";import{u as ne}from"./useFetchMore-be228481.js";import{u as le}from"./ProjectLink-987015ba.js";import{q as F,u as g,f as pe}from"./index-bcfaa842.js";import{g as l}from"./_baseForOwn-9b89c4b6.js";import{b as ce,p as ue,o as de}from"./Play-87fed129.js";import{u as he}from"./Person-5be09a1e.js";import{D as Ce}from"./VewJobDetails.story-c6ae2e88.js";import{S as fe}from"./gqlTypes-a9abad81.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./index-96c5f47c.js";import"./Button-352c3435.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./MultipleSelectFieldInput-d0cee4a2.js";import"./SelectEsModelInput-d580a9f7.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./pick-dba65392.js";import"./react-router-19e5b27c.js";import"./tiny-invariant-dd7d57d2.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./Link-c687dc07.js";import"./react-router-dom-60ea8218.js";import"./useIncludeFieldNames-35a180a9.js";import"./Save-b67fa0ac.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";import"./uniq-0d482d7b.js";import"./auth-5b6b0f80.js";import"./useBeforeSave-e049f6dd.js";import"./find-8750f979.js";import"./index.esm-bf21a293.js";import"./index-18188c67.js";import"./zod-575fe4a8.js";import"./CloudUpload-462faa0c.js";import"./SyncEagleDevTool-4c34bdb8.js";import"./index-ce960f89.js";import"./userGroups-edff3f7b.js";import"./index-f70ce446.js";import"./searchUsers-04324aeb.js";import"./useTagSearch-f4fcfbe9.js";import"./Skeleton-cd6f071e.js";import"./index-5757e0d6.js";import"./useMutation-64d5b683.js";import"./isNativeReflectConstruct-05c29d01.js";import"./cloneDeep-91467704.js";import"./index-72884e22.js";import"./index-356e4a49.js";import"./stories-1f769a10.js";import"./index-63a3e378.js";import"./ExpandMore-79a3c159.js";import"./uniqBy-baac1626.js";import"./RemoveCircle-617bdac2.js";import"./index-b769406f.js";import"./DragIndicator-582939ba.js";import"./TableRow-00aadd87.js";import"./TableHead-dd1583ce.js";import"./capitalize-c31f38e2.js";import"./isString-2f2f79c0.js";import"./times-069ea398.js";import"./_castFunction-353dfc26.js";import"./TaskForm-863cdb73.js";import"./RepeatFields-8275ed19.js";import"./Alert-fd9a067a.js";import"./TaskAssignees-858ea3c9.js";import"./useTaskAssignees-9f1fd5d3.js";import"./github-91d085b0.js";import"./SortUpIcon-3aecf5f0.js";import"./OpportunityLink-b32d0c35.js";import"./index-9d3afdfc.js";import"./index-79afbab1.js";import"./Check-78df5e8e.js";import"./bundle-053bdffd.js";import"./MilestoneIcon-61fb6e69.js";import"./Trash-822e65ce.js";import"./index-5d349c56.js";import"./EstimateEditorPopover-b8debf9a.js";import"./AssigneeEditorPopover-2b4e6473.js";import"./ToggleButtonGroup-93d9af56.js";import"./index-71ed01a9.js";import"./index-4d31058a.js";import"./Undo-33c7aa7a.js";import"./camelCase-4e7e8b23.js";import"./AuditLogsNoBreadCrumbs-8da9c0ce.js";import"./ExpenseView-2f5d1473.js";import"./MenuOptions-0bc3bb51.js";import"./LocationBeFormBody-c033b2b3.js";import"./reduce-4f6f1985.js";var j={},xe=Q;Object.defineProperty(j,"__esModule",{value:!0});var E=j.default=void 0,be=xe(z()),ge=e;E=j.default=(0,be.default)((0,ge.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");function ye(r){return e.jsx(V,{width:"15px",height:"16px",viewBox:"0 0 15 16",paths:["M13.125 7.0625H12.5V6.4375C12.5 6.27174 12.4342 6.11277 12.3169 5.99556C12.1997 5.87835 12.0408 5.8125 11.875 5.8125C11.7092 5.8125 11.5503 5.87835 11.4331 5.99556C11.3158 6.11277 11.25 6.27174 11.25 6.4375V7.0625H10.625C10.4592 7.0625 10.3003 7.12835 10.1831 7.24556C10.0658 7.36277 10 7.52174 10 7.6875C10 7.85326 10.0658 8.01223 10.1831 8.12944C10.3003 8.24665 10.4592 8.3125 10.625 8.3125H11.25V8.9375C11.25 9.10326 11.3158 9.26223 11.4331 9.37944C11.5503 9.49665 11.7092 9.5625 11.875 9.5625C12.0408 9.5625 12.1997 9.49665 12.3169 9.37944C12.4342 9.26223 12.5 9.10326 12.5 8.9375V8.3125H13.125C13.2908 8.3125 13.4497 8.24665 13.5669 8.12944C13.6842 8.01223 13.75 7.85326 13.75 7.6875C13.75 7.52174 13.6842 7.36277 13.5669 7.24556C13.4497 7.12835 13.2908 7.0625 13.125 7.0625ZM8.3125 8.1375C8.64599 7.84883 8.91347 7.4918 9.0968 7.09064C9.28012 6.68948 9.375 6.25357 9.375 5.8125C9.375 4.9837 9.04576 4.18884 8.45971 3.60279C7.87366 3.01674 7.0788 2.6875 6.25 2.6875C5.4212 2.6875 4.62634 3.01674 4.04029 3.60279C3.45424 4.18884 3.125 4.9837 3.125 5.8125C3.125 6.25357 3.21988 6.68948 3.4032 7.09064C3.58653 7.4918 3.85401 7.84883 4.1875 8.1375C3.31259 8.53368 2.57029 9.17346 2.04936 9.98034C1.52843 10.7872 1.25092 11.7271 1.25 12.6875C1.25 12.8533 1.31585 13.0122 1.43306 13.1294C1.55027 13.2467 1.70924 13.3125 1.875 13.3125C2.04076 13.3125 2.19973 13.2467 2.31694 13.1294C2.43415 13.0122 2.5 12.8533 2.5 12.6875C2.5 11.6929 2.89509 10.7391 3.59835 10.0358C4.30161 9.33259 5.25544 8.9375 6.25 8.9375C7.24456 8.9375 8.19839 9.33259 8.90165 10.0358C9.60491 10.7391 10 11.6929 10 12.6875C10 12.8533 10.0658 13.0122 10.1831 13.1294C10.3003 13.2467 10.4592 13.3125 10.625 13.3125C10.7908 13.3125 10.9497 13.2467 11.0669 13.1294C11.1842 13.0122 11.25 12.8533 11.25 12.6875C11.2491 11.7271 10.9716 10.7872 10.4506 9.98034C9.92971 9.17346 9.18741 8.53368 8.3125 8.1375ZM6.25 7.6875C5.87916 7.6875 5.51665 7.57753 5.20831 7.37151C4.89996 7.16548 4.65964 6.87264 4.51773 6.53003C4.37581 6.18742 4.33868 5.81042 4.41103 5.44671C4.48338 5.08299 4.66195 4.7489 4.92417 4.48667C5.1864 4.22445 5.52049 4.04588 5.88421 3.97353C6.24792 3.90118 6.62492 3.93831 6.96753 4.08023C7.31014 4.22214 7.60298 4.46246 7.80901 4.77081C8.01503 5.07915 8.125 5.44166 8.125 5.8125C8.125 6.30978 7.92746 6.78669 7.57583 7.13833C7.22419 7.48996 6.74728 7.6875 6.25 7.6875Z"],...r})}function y({text:r,icon:i}){const o=F();return e.jsxs(m,{p:1,textAlign:"center",display:"flex",whiteSpace:"nowrap",color:o.palette.primary.dark,children:[e.jsx(m,{component:"span",mr:1,color:"#CDD3DB",children:i}),r]})}function je(r){return{index:"interval",body:{size:0,query:{bool:{must:[{bool:{should:r.map(i=>({term:{"userId.keyword":i.id}}))}}]}},aggs:{group_by_member:{terms:{field:"userId.keyword",size:r.length||void 0},aggs:{sum_ms:{sum:{field:"durationMs"}},by_project_count:{cardinality:{field:"forProjectId.keyword"}},by_task_count:{cardinality:{field:"taskId.keyword"}}}}}}}}function Se(){const r=se({index:"user",body:{size:0,aggs:{user_groups:{terms:{field:"group.keyword",size:999}}}}});return l(r,"result.aggregations.user_groups.buckets",[]).map(i=>i.key)}const fr=({active:r,title:i})=>{var D;const[o,S]=h.useState({searchTxt:"",memberDetails:{}}),I=F(),R=g("SHOW_MORE_BUTTON").value,k=g("SEARCH_USERS_LIMIT").value,$=g("TEAM_MEMBER_FORM_V2").value?ae:me,[f,B]=A({team:ie});le({paths:[{label:"",link:"/"},{label:"Team Members",link:"/member"}]});const T=G(),v=h.useCallback(async t=>{var u;const s=await T.query(W(je(t))),p=JSON.parse(((u=s==null?void 0:s.data)==null?void 0:u.q)||"{}"),c={};console.log(">>member/MemberList::","esData",p),l(p,"aggregations.group_by_member.buckets",[]).forEach(a=>{c[a.key]={projectCount:a.by_project_count.value,taskCount:a.by_task_count.value,intervalTotal:a.sum_ms.value/1e3/3600}}),S(a=>({...a,memberDetails:{...a.memberDetails,...c}}))},[T]),n={};o.searchTxt&&o.searchTxt.length>1&&(n.fullname={matchPhrasePrefix:o.searchTxt.toLowerCase()}),o.selectedGroup&&(n.group={eq:o.selectedGroup}),f.team&&(n.teamList={matchPhrase:`"${f.team}"`}),r&&(n.status={eq:"Active"}),r||(n.status={eq:"In-active"}),console.log({instanceUserLimit:k});const M=N(Te,{variables:{filter:n,sort:{field:"fullname",direction:"asc"},limit:k},onCompleted:t=>v(l(t,"searchUsers.items",[])),fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-first"}),C=h.useRef(null),{data:x,loading:_,refetch:b}=M,P=ne({...M,model:"User",op:"search",maxLength:5,onData:v}),U=he({callback:t=>{b({sort:{field:t.key,direction:t.sort}})}}),q=h.useCallback(async t=>{C.current.close(),await Z({index:"user",id:t==null?void 0:t.id}),b()},[b]),H=h.useCallback(()=>{C.current.close()},[]),w=((D=x==null?void 0:x.searchUsers)==null?void 0:D.items)||[];console.log(">>member/MemberList::","memberList",w);const O=Se();return console.log(">>member/MemberList::","userGroups",O),e.jsx(e.Fragment,{children:e.jsxs(m,{children:[e.jsx(m,{mb:2,children:e.jsx(J,{clearable:!0,displayCreateBtnOnHeader:!0,CreateIcon:e.jsx(ye,{style:{width:"15px",height:"15px"}}),headerTitle:e.jsx(m,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,mt:3,children:e.jsx(L,{variant:"h1",sx:{textTransform:"uppercase",fontSize:20,fontWeight:"bold"},children:i||"TEAM MEMBERS"})}),createLabel:"Team Member",onSearch:t=>{S(s=>({...s,searchTxt:t}))},controls:[e.jsx(m,{width:"200px",children:e.jsx(ke,{value:f.team,onChange:t=>{const s=t.currentTarget.value;B({team:s})}})},"group-filter")],onNewClicked:()=>{C.current.open()}})}),e.jsx(Ce,{isLoading:_,sorting:U,headers:[{name:"Team member",sortField:fe.Fullname,colSpan:2,hasSort:!0},{name:"Team",colSpan:2},{name:"Hours",colSpan:2},{name:"Tasks",colSpan:2},{name:"Projects",colSpan:2},{name:"Start Date",colSpan:2}],rows:w.map(t=>{const s=o.memberDetails,p=l({memberDetails:s},`memberDetails[${t.id}].intervalTotal`),c=l({memberDetails:s},`memberDetails[${t.id}].projectCount`),u=l({memberDetails:s},`memberDetails[${t.id}].taskCount`),a=[];if(t.teamList){let d;typeof t.teamList=="string"&&(d=JSON.parse(t.teamList)),d!=null&&d.length&&a.push(...d)}return{cells:[{colSpan:2,children:e.jsx(ce,{member:t,color:I.palette.primary.dark,withPosition:!0})},{colSpan:2,children:t.teamList?e.jsx(L,{children:a.join(",")}):null},{colSpan:2,children:p&&e.jsxs(m,{bgcolor:"#E6E9ED",padding:"2px",borderRadius:"15px",textAlign:"center",width:"200px",children:[p.toLocaleString(void 0,{maximumFractionDigits:0})," ","h"]})},{colSpan:2,children:u&&e.jsx(y,{text:`${u} tasks`,icon:e.jsx(ue,{})})},{colSpan:2,children:c&&e.jsx(y,{text:`${c} projects`,icon:e.jsx(de,{})})},{colSpan:2,children:t.startDate&&e.jsx(y,{text:pe(new Date(t.startDate),"LLL dd, yyyy"),icon:e.jsx(E,{})})}]}})}),!_&&R&&e.jsx(K,{onClick:P.more}),e.jsx(Y,{variant:"dialog",ref:C,dialogProps:{maxWidth:"xl",fullWidth:!0},children:e.jsx($,{onCancel:H,secondary:!0,onSubmit:q,isCreateModal:!0})})]})})};function ke(r){const[i]=X(["kwMemberTeamType"]);return e.jsx(ee,{children:e.jsx(te,{fullWidth:!0,variant:"medium",icon:re,label:"Filter Group",options:i.kwMemberTeamType.map(o=>({value:o,text:o})),...r})})}const Te=oe`
  query (
    $filter: SearchableUserFilterInput
    $nextToken: String
    $sort: SearchableUserSortInput
    $limit: Int
  ) {
    searchUsers(limit: $limit, filter: $filter, nextToken: $nextToken, sort: $sort) {
      nextToken
      items {
        id
        fullname
        profilePhoto
        position
        startDate
        teamList
        status
        attributes
        role {
          id
          name
        }
      }
    }
  }
`;export{fr as default};
