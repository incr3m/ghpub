import{R as s}from"./index-f1f749bf.js";import{k as E,b,s as F}from"./papaparse.min-b66e70e7.js";import{g as t}from"./_baseForOwn-9b89c4b6.js";function L({updateQuery:g,variables:m={},fetchMore:$,data:n,model:p="",op:h="list",listPath:o=void 0,maxLength:i=100,disabled:T=!1,onData:l=void 0},d=[]){const k=o?`${o}.nextToken`:`${h}${p}s.nextToken`,e=o?`${o}.items`:`${h}${p}s.items`,c=s.useRef({idMapping:null});s.useEffect(()=>{d&&(c.current.idMapping=null)},d);const u=s.useCallback(()=>{if(T)return;if(t(n,k)){c.current.idMapping||(c.current.idMapping=E(t(n,e,[]),"id"));const{idMapping:f}=c.current;$({variables:{...m,nextToken:t(n,k)}}).then(async({data:r})=>{r&&(await b.delay(2e3),g(w=>{const y=t(r,e,[]).filter(a=>a&&!(f!=null&&f[a.id])?f[a.id]=!0:!1),C=[...t(w,e,[]),...y];return l&&b.delay(0).then(()=>l(y)),F(e,C)(r)}))}).catch(r=>{console.log(">>hooks/useFetchMore::","err",r)})}},[T,n,k,e,$,m,g,l]);return s.useEffect(()=>{t(n,`${e}.length`,0)>=i||u()},[n,e,i,u]),{more:s.useCallback(()=>{t(n,`${e}.length`,0)<i||u()},[n,u,e,i])}}export{L as u};
