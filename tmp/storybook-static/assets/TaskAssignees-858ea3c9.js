import{j as t}from"./TransitionGroupContext-9d36972e.js";import{r as A,R as o}from"./index-f1f749bf.js";import{u as T,ay as M,m as P,k as C,L as I,ax as R,V as B,W as S,P as _,B as x,K as E,i as L}from"./papaparse.min-b66e70e7.js";import{g as z}from"./_baseForOwn-9b89c4b6.js";import{b as O,c as q}from"./Play-87fed129.js";const w=a=>{const i=T(M,{variables:a,fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});return[A.useMemo(()=>{var l,r;return((r=(l=i.data)==null?void 0:l.result)==null?void 0:r.items)||[]},[i.data]),i]};function W({children:a,...i}){return t.jsx(x,{border:"1px solid #f3f3f3",borderRadius:"5px",p:2,flex:"1",...i,children:a})}const D=P(a=>({root:{"& .MuiLink-root > div":{marginTop:3,display:"inline-flex"},"& .MuiChip-root":{marginTop:5,marginRight:a.spacing(1)},"& .MuiAvatar-root":{width:24,height:24}},addBtn:{margin:1}}));function F({id:a,isCompleted:i,readOnly:c,saved:g,onAssignementsChanged:l}){const r=o.useRef({saved:!1});r.current.onChange=l,r.current.saved=g;const[m,d]=o.useState({assignments:null}),h=D(),f=o.useRef(null),[p,v]=w({filter:{taskId:{eq:a||""},archived:{ne:!0}}});o.useEffect(()=>{var e,s;(s=(e=r.current).onChange)==null||s.call(e,m.assignments)},[m.assignments]),o.useEffect(()=>{const e=p;if(e.length<1||r.current.saved)return;const s=C(e,"userId");d(n=>({...n,assignments:s}))},[c,p]);const k=o.useCallback(e=>{const s=e.currentTarget.value;s&&(d(n=>{const u=n.assignments||{};return u[s]?n:(u[s]={userId:s},r.current.saved=!1,{...n,assignments:u})}),f.current.close())},[]),j=m.assignments||{},b=o.useCallback(e=>()=>{d(s=>{const n={...s.assignments};return z(s,`assignments.${e}.id`)?n[e]={...n[e],archived:!0}:n[e]=void 0,r.current.saved=!1,{...s,assignments:n}})},[]),y=()=>{if(i)return null;if(!c)return t.jsx(L,{color:"default",size:"small",className:h.addBtn,onClick:e=>f.current.open(e.currentTarget),children:t.jsx(q,{})})};return t.jsxs(W,{className:h.root,children:[t.jsxs(I,{text:"Assignees",children:[v.loading&&t.jsx(R,{}),Object.values(j).map(e=>{if(!e||e.archived)return null;const s={};return c||(s.onDelete=b(e.userId)),t.jsx(B,{...s,label:t.jsx(O,{compact:!0,id:e.userId})},e.userId)}),y()]}),t.jsx(S,{variant:"popover",ref:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsx(_,{children:t.jsx(x,{minWidth:"250px",p:2,pt:1,pb:1,children:t.jsx(E,{variant:"slim",model:"User",fullWidth:!0,label:"Select Member",onChange:k})})})})]})}const V=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));export{F as T,V as a,w as u};
