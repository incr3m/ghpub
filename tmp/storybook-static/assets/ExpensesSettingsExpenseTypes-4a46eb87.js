import{j as a}from"./TransitionGroupContext-9d36972e.js";import{r as c}from"./index-f1f749bf.js";import{u as N,V as R}from"./ExpenseView-2f5d1473.js";import{a as H,u as P}from"./useUpdateSetting-43faf859.js";import{E as V}from"./Play-87fed129.js";import{aw as q,g as w,bD as U,h as $,B as D,i as X,aq as g,bE as M}from"./papaparse.min-b66e70e7.js";import{b as z}from"./index-bcfaa842.js";import{d as J}from"./pick-dba65392.js";import{B as j}from"./Button-352c3435.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./_baseForOwn-9b89c4b6.js";import"./SortUpIcon-3aecf5f0.js";import"./TableRow-00aadd87.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./TableHead-dd1583ce.js";import"./index-96c5f47c.js";import"./Save-b67fa0ac.js";import"./ProjectLink-987015ba.js";import"./MenuOptions-0bc3bb51.js";import"./index-79afbab1.js";import"./react-router-19e5b27c.js";import"./index-4d501b15.js";import"./tiny-invariant-dd7d57d2.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./react-router-dom-60ea8218.js";import"./debounce-213cd46f.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";import"./isPlainObject-07477f89.js";import"./isNativeReflectConstruct-05c29d01.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./SelectEsModelInput-d580a9f7.js";import"./Link-c687dc07.js";import"./useIncludeFieldNames-35a180a9.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";function L(){var r=c.useRef(!0);return r.current?(r.current=!1,!0):r.current}var O=function(r,u){return r===u};function G(r,u){u===void 0&&(u=O);var m=c.useRef(),l=c.useRef(r),d=L();return!d&&!u(l.current,r)&&(m.current=l.current,l.current=r),m.current}const Y=r=>{const[u,m]=q(w(V),{update:(l,d)=>{console.log({cache:l,result:d,id:l.identify(d.data.result)}),l.evict({id:l.identify(d.data.result)})},...r});return[u,m]},f=({defaultValue:r,onBlur:u,...m})=>{const[l,d]=U(!1);return a.jsxs(a.Fragment,{children:[l&&a.jsx($,{autoFocus:!0,defaultValue:r,onBlur:x=>{u==null||u(x.target.value),d()},...m}),!l&&a.jsxs(D,{children:[r,a.jsx(X,{size:"small",onClick:()=>d(),children:a.jsx(J,{})})]})]})},Pe=()=>{const[r,{map:u,setMapById:m,setMap:l},{loading:d}]=N();G(u);const[x,{loading:C}]=Y({onCompleted:()=>{p("Expense Type deleted",{variant:"success"})},onError:e=>{console.log(e),p("Failed to delete Expense Type",{variant:"error"})}}),[b,{loading:S}]=H({onCompleted:()=>{p("Expense Type updated",{variant:"success"})},onError:e=>{console.log(e),p("Failed to update Expense Type",{variant:"error"})}}),[y,{loading:h}]=P({onCompleted:()=>{p("Expense type created",{variant:"success"})},onError:e=>{console.log(e),p("Failed to create expense type",{variant:"warning"})}}),{enqueueSnackbar:p}=z(),T=c.useMemo(()=>[{Header:"Name (unique)",accessor:"name",Cell:({value:e,row:n,setExpenseTypeMapById:s})=>n.depth===1?null:a.jsx(f,{defaultValue:e,onBlur:o=>{var i;s((i=n.original)==null?void 0:i.id,t=>({...t,name:o}))}})},{Header:"Code",accessor:"value.code",Cell:({value:e,row:n,setExpenseTypeMapById:s})=>n.depth===1?null:a.jsx(f,{defaultValue:e,type:"number",onBlur:o=>{var i;s((i=n.original)==null?void 0:i.id,t=>({...t,value:{...t==null?void 0:t.value,code:o}}))}})},{Header:"Sale Amount",accessor:"value.saleAmount",Cell:({value:e,row:n,setExpenseTypeMapById:s})=>n.depth===1?null:a.jsx(f,{defaultValue:e,type:"number",onBlur:o=>{var i;s((i=n.original)==null?void 0:i.id,t=>({...t,value:{...t==null?void 0:t.value,saleAmount:o}}))}})},{Header:"Purchase Amount",accessor:"value.purchaseAmount",Cell:({value:e,row:n,setExpenseTypeMapById:s})=>n.depth===1?null:a.jsx(f,{defaultValue:e,type:"number",onBlur:o=>{var i;s((i=n.original)==null?void 0:i.id,t=>({...t,value:{...t==null?void 0:t.value,purchaseAmount:o}}))}})},{Header:"Sale Tax Amount (rate)",accessor:"value.saleTaxAmount",Cell:({value:e,row:n,setExpenseTypeMapById:s})=>n.depth===1?null:a.jsx(f,{defaultValue:e,type:"number",onBlur:o=>{var i;s((i=n.original)==null?void 0:i.id,t=>({...t,value:{...t==null?void 0:t.value,saleTaxAmount:o}}))}})},{Header:"Actions",id:"actions",Cell:({row:e,loadingUpdate:n,handleSaveSetting:s,handleDeleteSetting:o,loadingDelete:i})=>{var t,E;return a.jsxs(g,{container:!0,spacing:1,children:[a.jsx(g,{item:!0,children:a.jsx(j,{variant:"outlined",color:"success",onClick:()=>s(e.original),disabled:n,children:(t=e.original)!=null&&t.__isNew?"Create":"Save"})}),!((E=e.original)!=null&&E.__isNew)&&a.jsx(g,{item:!0,children:a.jsx(j,{variant:"outlined",color:"error",onClick:()=>o(e.original),disabled:i,children:"Delete"})})]})}}],[]),k=c.useCallback(e=>{C||x({variables:{input:{id:e==null?void 0:e.id}}})},[C,x]),A=c.useCallback(e=>{S||b({variables:{input:{id:e==null?void 0:e.id,name:e==null?void 0:e.name,module:"expense",value:JSON.stringify(e.value)}}})},[S,b]),_=c.useCallback(async e=>{var B;if(h)return;const{name:n,value:s}=e,{code:o,saleAmount:i,purchaseAmount:t,saleTaxAmount:E}=s,v=(B=`${M}${n}`)==null?void 0:B.toLowerCase();await y({variables:{input:{id:v,code:v,module:"expense",name:n,value:JSON.stringify({name:n,code:o,saleAmount:i,purchaseAmount:t,saleTaxAmount:E})}}}),delete e.__isNew},[h,y]),F=c.useCallback(e=>{if(e!=null&&e.__isNew)return _(e);A(e)},[_,A]),I=c.useCallback(()=>{var o;const e=`New${+new Date}`,n=(o=`${M}${e}`)==null?void 0:o.toLowerCase(),s={id:n,code:n,name:e,__isNew:!0,value:{name:e,code:0,saleAmount:0,purchaseAmount:0,saleTaxAmount:0}};l(i=>({...i,[n]:s}))},[l]);return a.jsxs(D,{children:[a.jsx(g,{container:!0,spacing:1,justifyContent:"flex-end",alignItems:"center",children:a.jsx(g,{item:!0,children:a.jsx(j,{variant:"contained",onClick:I,disabled:d,children:"Add Expense Type"})})}),a.jsx(R,{loading:d||h,data:r,columns:T,setExpenseTypeMapById:m,loadingUpdate:S,loadingDelete:C,handleSaveSetting:F,handleDeleteSetting:k})]})};export{Pe as ExpensesSettingsExpenseTypes,Pe as default};
