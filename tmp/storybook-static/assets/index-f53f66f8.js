import{j as e}from"./TransitionGroupContext-9d36972e.js";import{R as s}from"./index-f1f749bf.js";import{u as $}from"./ProjectLink-987015ba.js";import{g as y,aw as E,u as _,B as x,q as F,bN as U,X as G,ba as L,i as M,J as I,c9 as J,M as v,as as Q,T as A,V as H,D as W,G as q,bC as z,S as D,a3 as V}from"./papaparse.min-b66e70e7.js";import{d as B}from"./Link-c687dc07.js";import{d as X,m as Y}from"./pick-dba65392.js";import{b as Z}from"./index-bcfaa842.js";import{B as p}from"./Button-352c3435.js";import{g as T}from"./_baseForOwn-9b89c4b6.js";import{r as N}from"./ExpenseView-2f5d1473.js";import{a as ee,b as O,c as K,d as te}from"./TableRow-00aadd87.js";import{T as ne}from"./TableHead-dd1583ce.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./Play-87fed129.js";import"./react-router-19e5b27c.js";import"./index-4d501b15.js";import"./tiny-invariant-dd7d57d2.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./react-router-dom-60ea8218.js";import"./index-96c5f47c.js";import"./debounce-213cd46f.js";import"./uniq-0d482d7b.js";import"./_arrayIncludes-2cfb33ae.js";import"./cloneDeep-91467704.js";import"./isPlainObject-07477f89.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./SelectEsModelInput-d580a9f7.js";import"./useIncludeFieldNames-35a180a9.js";import"./Save-b67fa0ac.js";import"./index-147ad7aa.js";import"./Add-be7f5660.js";import"./isNativeReflectConstruct-05c29d01.js";import"./SortUpIcon-3aecf5f0.js";import"./MenuOptions-0bc3bb51.js";import"./index-79afbab1.js";const le=y`
  mutation CreateKnowledgebaseSetting($value: AWSJSON!) {
    createSetting(
      input: {
        id: "knowledgebase-setting"
        code: "knowledgebase-setting"
        name: "Knowledgebase Settings"
        value: $value
      }
    ) {
      id
    }
  }
`,ae=y`
  mutation UpdateKnowledgebaseSetting($value: AWSJSON!) {
    updateSetting(
      input: {
        id: "knowledgebase-setting"
        code: "knowledgebase-setting"
        name: "Knowledgebase Settings"
        value: $value
      }
    ) {
      id
    }
  }
`,re=y`
  query GetKnowledgebaseSetting {
    getSetting(id: "knowledgebase-setting") {
      id
      value
    }
  }
`;function se(){const[n,l]=s.useState(""),[t,o]=s.useState(!1),[c]=E(le),[g]=E(ae),{data:i}=_(re),[h,b]=s.useState(!1),{enqueueSnackbar:w}=Z(),C=u=>l(u.target.value),S=()=>o(!0),f=()=>o(!1);s.useEffect(()=>{var u;if((u=i==null?void 0:i.getSetting)!=null&&u.value){const r=JSON.parse(i.getSetting.value);l(r.url)}},[i]);const k=async()=>{var u;if(n)try{b(!0),(u=i==null?void 0:i.getSetting)!=null&&u.value?await g({variables:{value:JSON.stringify({url:n})}}):await c({variables:{value:JSON.stringify({url:n})}}),w("Successfully set knowledgebase link",{variant:"success"}),f()}catch(r){console.error("failed to set knowledgebase setting: ",r),w("Failed to update link. Please try again.",{variant:"error"}),b(!1)}};return e.jsx(e.Fragment,{children:t?e.jsxs(x,{display:"flex",alignItems:"center",children:[e.jsx(F,{variant:"outlined",placeholder:"Knowledgebase link",value:n,onChange:C,startAdornment:e.jsx(U,{position:"start",children:e.jsx(x,{component:"span",color:"lightgrey",height:24,children:e.jsx(B,{})})})}),e.jsx(p,{onClick:f,children:"Cancel"}),e.jsx(p,{size:"small",variant:"contained",color:"primary",disabled:h,onClick:k,children:"Save"})]}):e.jsx(x,{maxWidth:300,display:"flex",alignItems:"center",children:n?e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(G,{title:n,children:e.jsx(L,{href:n,target:"_blank",rel:"noreferrer",style:{overflowX:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})}),e.jsx(M,{onClick:S,size:"small",children:e.jsx(X,{fontSize:"inherit"})})]}):e.jsx(p,{variant:"contained",color:"primary",onClick:S,children:"Set knowledgebase link"})})})}const ie=(n,{fallbackValue:l})=>{if(!localStorage.getItem(n)&&l===void 0)throw new Error("No value retrieved and no fallback supplied");return l===void 0&&console.warn("No fallback supplied to localStorage key."),localStorage.getItem(n)||l},oe=(n,l)=>localStorage.setItem(n,l.toString()),ce=(n,l)=>{localStorage.get(n)||localStorage.setItem(n,l.toString())},de={get:ie,setNoOverwrite:ce,setOverwrite:oe};function ue(n){return s.Children.map(n,({type:l,props:t})=>{if(typeof l=="string")switch(l){case"column":return{Header:(t==null?void 0:t.label)||I(t==null?void 0:t.dataId),accessor:t==null?void 0:t.dataId,width:t==null?void 0:t.width,Cell:o=>t==null?void 0:t.render(o.row.original)};case"text":default:return{Header:(t==null?void 0:t.label)||I(t==null?void 0:t.dataId),accessor:t==null?void 0:t.dataId,width:t==null?void 0:t.width}}})}function me(n){const[l,...t]=n;return{id:"actions",width:l.width,Cell:o=>e.jsx(ge,{tableInstance:o,primaryAction:l,secondaryActions:t})}}const ge=({tableInstance:n,primaryAction:l,secondaryActions:t=[]})=>{const[o,c]=s.useState(),g=h=>c(h.currentTarget),i=()=>c();return e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"contained",color:"secondary",onClick:()=>l.onClick(n.row.original),...l.buttonProps,children:l.label}),(t==null?void 0:t.length)>0&&e.jsx(M,{onClick:g,size:"large",children:e.jsx(Y,{})}),e.jsx(J,{anchorEl:o,onClose:i,open:!!o,children:t.map((h,b)=>e.jsx(v,{onClick:()=>h.onClick(n.row.original),children:h.label},b))})]})},P=s.forwardRef(({indeterminate:n,...l},t)=>{const o=s.useRef(),c=t||o;return s.useEffect(()=>{c.current.indeterminate=n},[c,n]),e.jsx(e.Fragment,{children:e.jsx(Q,{ref:c,...l})})});function he({data:n,dense:l,selectable:t,children:o,actions:c,onRowSelect:g=()=>{}}){const[i,h]=s.useState([]),b=N.useTable({data:n,columns:i},N.useRowSelect,a=>{a.allColumns.push(d=>{const m=[...d];return t&&m.unshift({id:"selection",Header:({getToggleAllRowsSelectedProps:j})=>e.jsx("div",{children:e.jsx(P,{...j()})}),Cell:({row:j})=>e.jsx("div",{children:e.jsx(P,{...j.getToggleRowSelectedProps()})})}),c&&(c==null?void 0:c.length)>0&&m.push(me(c)),m})}),{getTableProps:w,getTableBodyProps:C,headerGroups:S,rows:f,columns:k,prepareRow:u,selectedFlatRows:r}=b;return s.useEffect(()=>{g(r.map(a=>a==null?void 0:a.original))},[r,g]),s.useEffect(()=>{h(ue(o))},[o]),e.jsxs(ee,{...w(),size:l?"small":"medium",children:[e.jsxs("colgroup",{children:[t&&e.jsx("col",{width:1}),k.map((a,d)=>e.jsx("col",{width:a.width},d))]}),e.jsx(ne,{children:S.map((a,d)=>e.jsx(O,{...a.getHeaderGroupProps(),children:a.headers.map((m,j)=>e.jsx(K,{...m.getHeaderProps(),children:m.render("Header")},j))},d))}),e.jsx(te,{...C(),children:f.map((a,d)=>(u(a),e.jsx(O,{...a.getRowProps(),children:a.cells.map((m,j)=>e.jsx(K,{...m.getCellProps(),children:m.render("Cell")},j))},d)))})]})}const R="column";function xe(n){return e.jsx(A,{children:T(n,"value.properties.title[0][0]","")})}function fe(n){return e.jsx(e.Fragment,{children:T(n,'value.properties["Zxh^"][0][0]',"").split(",").map(l=>e.jsx(H,{size:"small",label:l,style:{backgroundColor:"#e3e3e3"}},l))})}const be=[{label:"Open in Notion",onClick:n=>window.open(`https://www.notion.so/${T(n,"value.id").replace(/-/g,"")}`,"_blank","noopener,noreferrer"),buttonProps:{variant:"outlined",color:"default"}}];function at(){const[n,l]=s.useState(parseInt(de.get("knowledgebase-setting-limit",{fallbackValue:50}))),[{searchQuery:t,embraceUrl:o,selectedFilter:c,limit:g},i]=s.useState({searchQuery:"",embraceUrl:"",limit:n}),[h,b]=s.useState([]),[w,C]=s.useState(),S=s.useCallback(()=>{i(r=>({...r,limit:r.limit+n}))},[n]);$({paths:[{label:"",link:"/"},{label:"Setting",link:"/setting"},{label:"Knowledge Base"}]});const f=_(y`
      query ($body: AWSJSON) {
        knowledgeBaseQuery(type: "notion-search", body: $body)
      }
    `,{variables:{body:JSON.stringify({searchQuery:t,embraceUrl:o,limit:g})}});s.useEffect(()=>{var a;const r=JSON.parse(((a=f.data)==null?void 0:a.knowledgeBaseQuery)||"{}");console.log(">>KnowledgeBase/index::","queryResult",r),r!=null&&r.blocks&&(b(r.blocks),C(r.total))},[f,g]),console.log(">>KnowledgeBase/index::","kbQuery",f);const k=s.useCallback(r=>{const a=r.target.value;i(d=>({...d,searchQuery:a}))},[]),u=s.useCallback(r=>{const a=r.target.value;l(a),i(d=>({...d,limit:a})),localStorage.setItem("knowledgebase-setting-limit",a.toString())},[]);return e.jsxs("div",{children:[e.jsxs(x,{mb:2,display:"flex",alignItems:"center",justifyContent:"center",children:[e.jsx(x,{flex:1,children:e.jsx(se,{})}),e.jsx(x,{width:"300px",mr:1,children:e.jsx(W,{onChange:k,textFieldProps:{debounce:1e3}})}),e.jsx(x,{width:"200px",mr:2,children:e.jsx(q,{fullWidth:!0,variant:"slim",value:c,label:"Module",icon:z,onChange:r=>{const a=r.currentTarget.value;let d="";a&&(d=`${window.location.origin}/${a}`),i(m=>({...m,embraceUrl:d}))},options:["common","crm","inventory","member","project","reports","sales","task","settings","timesheets"]})}),e.jsx(x,{children:e.jsxs(D,{value:n,onChange:u,children:[e.jsx(v,{value:10,children:"10"}),e.jsx(v,{value:20,children:"20"}),e.jsx(v,{value:30,children:"30"}),e.jsx(v,{value:40,children:"40"}),e.jsx(v,{value:50,children:"50"})]})})]}),e.jsxs(he,{dense:!0,data:h.filter(r=>!!T(r,"value.properties.title[0][0]")),actions:be,children:[e.jsx(R,{dataId:"title",render:xe}),e.jsx(R,{dataId:"module",render:fe})]}),e.jsx(x,{marginY:5,children:f.loading?e.jsx(V,{}):e.jsx(x,{display:"flex",justifyContent:"center",onClick:S,children:g<=w&&e.jsx(p,{variant:"outlined",children:"Load more"})})})]})}export{at as default};
