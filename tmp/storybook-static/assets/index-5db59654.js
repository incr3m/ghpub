import{j as e}from"./TransitionGroupContext-9d36972e.js";import{R as c}from"./index-f1f749bf.js";import{Z as S,d as R,M as p,l as k,m as B,u as P,B as m,W as L,aM as T,N as W,Q as I,O as F,V as g,J as O,a5 as V,al as f,aC as _,T as x,aN as w,aO as $}from"./papaparse.min-b66e70e7.js";import{w as z,e as n}from"./Play-87fed129.js";import{f as h}from"./index-bcfaa842.js";import{u as M}from"./react-router-19e5b27c.js";import{g as A}from"./_baseForOwn-9b89c4b6.js";import{d as H}from"./ViewColumn-83ad192f.js";import{B as N}from"./Button-352c3435.js";import{T as Q,a as D}from"./ToggleButtonGroup-93d9af56.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./index-96c5f47c.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./react-router-dom-60ea8218.js";import"./tiny-invariant-dd7d57d2.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";import"./isNativeReflectConstruct-05c29d01.js";const G=z(S);function q(){const{state:a}=c.useContext(R),o=a==null?void 0:a.readOnly;return e.jsxs(e.Fragment,{children:[e.jsx(n,{type:"date",fullWidth:!0,name:"identifiedDate",format:i=>i&&h(new Date(i),"MMM dd, yyyy")}),e.jsx(n,{fullWidth:!0,multiline:!0,name:"description"}),e.jsx(n,{fullWidth:!0,name:"impact"}),e.jsxs(n,{fullWidth:!0,name:"priority",select:!o,children:[e.jsx(p,{value:"low",children:"Low"}),e.jsx(p,{value:"medium",children:"Medium"}),e.jsx(p,{value:"high",children:"High"})]}),e.jsx(n,{type:"date",fullWidth:!0,name:"criticalResolutionDate",format:i=>i&&h(new Date(i),"MMM dd, yyyy")}),e.jsx(n,{fullWidth:!0,name:"resolutionSteps"}),e.jsx(n,{type:"date",fullWidth:!0,name:"resolvedDate",format:i=>i&&h(new Date(i),"MMM dd, yyyy")})]})}const E=({...a})=>{const{projectId:o}=M();return e.jsx(G,{title:"Issue",name:"issue",beforeSave:({identifiedDate:i,criticalResolutionDate:r,resolvedDate:l,...u})=>{let s={};return i&&(s={...s,identifiedDate:new Date(i)}),r&&(s={...s,criticalResolutionDate:new Date(r)}),l&&(s={...s,resolvedDate:new Date(l)}),{...s,...u,issueProjectId:o}},...a,children:e.jsx(q,{})})},J=k`
  query($issueProjectId: ID!, $filter: ModelIssueFilterInput, $p: Boolean!) {
    project: getProject(id: $issueProjectId) @include(if: $p) {
      id
      issues(sortDirection: DESC, limit: 99, filter: $filter) {
        ...ListIssues
      }
    }
  }
  fragment ListIssues on ModelIssueConnection {
    items {
      id
      description
      priority
      identifiedDate
      resolvedDate
      criticalResolutionDate
      impact
      updatedAt
    }
  }
`,U=B({cardItem:{minHeight:50,padding:20,cursor:"pointer","& .MuiChip-root":{float:"right"},"&:hover":{backgroundColor:"whitesmoke"}}}),Y={high:"red",medium:"#ffaa60",low:"grey"};function Z({value:a,setValue:o}){return e.jsxs(Q,{size:"small",value:a,exclusive:!0,onChange:o,children:[e.jsx(D,{value:"listView",size:"small",children:e.jsx($,{fontSize:"small"})}),e.jsx(D,{value:"cardView",size:"small",children:e.jsx(H,{fontSize:"small"})})]})}const Ce=()=>{const a=U(),{projectId:o}=M(),i=c.useRef(null),[r,l]=c.useState({viewMode:"listView",search:"",selectedId:null}),{data:u,refetch:s,loading:C}=P(J,{variables:{filter:{description:{contains:r.search}},issueProjectId:o||"_",p:!0},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),y=c.useCallback(t=>{l(d=>({...d,selectedId:t})),i.current.open()},[]),v=c.useCallback(()=>{l(t=>({...t,selectedId:null})),i.current.open()},[]);console.log(">>IssueList/index::","data",u);const j=[...A(u,"project.issues.items",[])];return e.jsxs(m,{children:[e.jsx(L,{variant:"dialog",ref:i,dialogProps:{maxWidth:"sm",fullWidth:!0},children:e.jsx(E,{id:r.selectedId,onSubmit:()=>{i.current.close(),s()},onCancel:()=>{i.current.close()}})}),e.jsx(m,{pr:1,mb:2,display:"flex",flexDirection:"row-reverse",children:e.jsx(N,{color:"primary",variant:"contained",onClick:v,children:"Add Issue âž•"})}),e.jsx(m,{mb:2,children:e.jsx(T,{start:!0,canCreate:!1,onSearch:t=>{l(d=>({...d,search:t}))},controls:[e.jsx(Z,{value:r.viewMode,setValue:(t,d)=>{l(b=>({...b,viewMode:d}))}},"toggler")]})}),e.jsx("br",{style:{clear:"both"}}),r.viewMode==="listView"&&e.jsxs(W,{data:j,loading:C,onRowClick:t=>{y(t==null?void 0:t.id)},children:[e.jsx(I,{dataId:"description"}),e.jsx(F,{dataId:"priority",render:t=>t&&e.jsx(g,{label:O(t),style:{backgroundColor:Y[V(t)]||"grey",color:"white"}})}),e.jsx(I,{dataId:"impact"}),e.jsx(f,{dataId:"identifiedDate",label:"Identified Date",format:"dd/MM/yyyy"}),e.jsx(f,{dataId:"criticalResolutionDate",label:"Critical Resolution Date",format:"dd/MM/yyyy"}),e.jsx(f,{dataId:"updatedAt",label:"Last Activity",format:"dd/MM/yyyy"})]}),r.viewMode==="cardView"&&e.jsx(m,{style:{margin:10,display:"grid",gridRowGap:20},children:j.map(t=>e.jsxs(_,{className:a.cardItem,onClick:()=>y(t.id),children:[e.jsx(g,{label:t.priority}),e.jsx(x,{color:"textSecondary",variant:"body1",component:"p",children:t.description}),e.jsxs(x,{color:"textSecondary",variant:"body2",component:"p",children:["Identitfied:"," ",t.identifiedDate&&w(new Date(t.identifiedDate),new Date,{addSuffix:!0})]}),e.jsxs(x,{color:"textSecondary",variant:"body2",component:"p",children:["Resolved:"," ",t.resolvedDate&&w(new Date(t.resolvedDate),new Date,{addSuffix:!0})]})]},t.id))})]})};export{Ce as default};
