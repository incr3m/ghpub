import{j as e}from"./TransitionGroupContext-9d36972e.js";import{r as _,R as h}from"./index-f1f749bf.js";import{u as K}from"./ProjectLink-987015ba.js";import{k as Y,P as X,D as Z,b as ee}from"./VewJobDetails.story-c6ae2e88.js";import{d as te}from"./pick-dba65392.js";import{d as ae,L as oe,u as re}from"./updateValuationTemplate-e87484e5.js";import{F as le}from"./index-ce960f89.js";import{a as se}from"./index.esm-bf21a293.js";import{b as z,l as ie}from"./index-bcfaa842.js";import{b6 as P,bs as H,bq as $,bT as ne,br as F,bU as ce,bV as me,M as D,B as d,T as w,h as V,bW as W,bX as B,S as q,aq as M,i as k,a2 as de,a8 as J,bY as ue,aa as pe}from"./papaparse.min-b66e70e7.js";import{B as u}from"./Button-352c3435.js";import{L as he}from"./LoadingButton-f7387eca.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./Play-87fed129.js";import"./react-router-19e5b27c.js";import"./index-4d501b15.js";import"./tiny-invariant-dd7d57d2.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./_baseForOwn-9b89c4b6.js";import"./react-router-dom-60ea8218.js";import"./index-96c5f47c.js";import"./debounce-213cd46f.js";import"./uniq-0d482d7b.js";import"./_arrayIncludes-2cfb33ae.js";import"./cloneDeep-91467704.js";import"./index-72884e22.js";import"./index-147ad7aa.js";import"./index-356e4a49.js";import"./stories-1f769a10.js";import"./index-63a3e378.js";import"./index-f70ce446.js";import"./zod-575fe4a8.js";import"./Add-be7f5660.js";import"./userGroups-edff3f7b.js";import"./SyncEagleDevTool-4c34bdb8.js";import"./searchUsers-04324aeb.js";import"./find-8750f979.js";import"./index-18188c67.js";import"./index-61adb48a.js";import"./useFetchMore-be228481.js";import"./useTagSearch-f4fcfbe9.js";import"./Skeleton-cd6f071e.js";import"./ExpandMore-79a3c159.js";import"./uniqBy-baac1626.js";import"./RemoveCircle-617bdac2.js";import"./index-b769406f.js";import"./DragIndicator-582939ba.js";import"./TableRow-00aadd87.js";import"./TableHead-dd1583ce.js";import"./capitalize-c31f38e2.js";import"./isString-2f2f79c0.js";import"./Save-b67fa0ac.js";import"./Person-5be09a1e.js";import"./times-069ea398.js";import"./_castFunction-353dfc26.js";import"./TaskForm-863cdb73.js";import"./SelectEsModelInput-d580a9f7.js";import"./useIncludeFieldNames-35a180a9.js";import"./RepeatFields-8275ed19.js";import"./useBeforeSave-e049f6dd.js";import"./Alert-fd9a067a.js";import"./TaskAssignees-858ea3c9.js";import"./useTaskAssignees-9f1fd5d3.js";import"./github-91d085b0.js";import"./SortUpIcon-3aecf5f0.js";import"./OpportunityLink-b32d0c35.js";import"./index-9d3afdfc.js";import"./index-79afbab1.js";import"./Check-78df5e8e.js";import"./bundle-053bdffd.js";import"./MilestoneIcon-61fb6e69.js";import"./Trash-822e65ce.js";import"./index-5d349c56.js";import"./EstimateEditorPopover-b8debf9a.js";import"./AssigneeEditorPopover-2b4e6473.js";import"./isNativeReflectConstruct-05c29d01.js";import"./isPlainObject-07477f89.js";import"./ToggleButtonGroup-93d9af56.js";import"./index-71ed01a9.js";import"./index-4d31058a.js";import"./Undo-33c7aa7a.js";import"./camelCase-4e7e8b23.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./Link-c687dc07.js";import"./AuditLogsNoBreadCrumbs-8da9c0ce.js";import"./ExpenseView-2f5d1473.js";import"./MenuOptions-0bc3bb51.js";import"./MultipleSelectFieldInput-d0cee4a2.js";import"./LocationBeFormBody-c033b2b3.js";import"./reduce-4f6f1985.js";const ve=async i=>{await P([{id:i,__typename:H.shape.__typename.value,__op:"delete"}])};async function N(i){var v;const m=$(ne,i.valuationTemplate),[c]=await P([{...m,__op:"create"}]);if(c!=null&&c.id){const o=(v=i==null?void 0:i.items)==null?void 0:v.map(n=>(n.groups=[{id:c.id}],$(ce,n))),y=await Promise.all((o==null?void 0:o.map(async n=>{const[T]=await P([{...n,__op:"create"}]);return{...n,id:T.id}}))??[]),r={...i.valuationTemplate,id:c.id};return{valuationTemplate:F(H,r),items:y.map(n=>F(me,n))}}return null}function Te({setShowAddValuationForm:i,templatesRefetch:m}){const[c,v]=_.useState(""),[o,y]=_.useState(1),[r,n]=_.useState([]),[T,g]=_.useState({}),[p,I]=_.useState([]),[b,O]=_.useState(""),{enqueueSnackbar:A}=z(),E=t=>{v(t.target.value)},x=t=>{y(t.target.value)},j=t=>{g({sx:t.target.value})},L=t=>{O(t.target.value)},C=()=>{let t=T;try{const l=JSON.parse(T.sx);typeof l=="object"&&l!==null?(console.log("The variable is a JSON object."),t=JSON.parse(T.sx)):t={}}catch{t={}}const s=p.map(l=>{let f=null;try{f=JSON.parse(l.value)}catch{f={id:l.id,value:l.value}}return f});n([...r,{code:c,sx:t,tempItems:s}]),I([]),g({})},S=(t,s)=>{const l=[...p];l[s].value=t.target.value,I(l)},a=t=>{const s=[...r];s.splice(t,1),n(s)},R=["subHeaderColumns","lineItem"].map(t=>e.jsx(D,{value:t,children:t},t)),Q=Array.from({length:8},(t,s)=>e.jsx(D,{value:s+1,children:s+1},s));_.useEffect(()=>{const t=Array.from({length:o},(s,l)=>({id:l,value:""}));I(t)},[o]);const G=async()=>{try{await i(!1),await A("Creating template!",{variant:"info"});const t=r&&r.map((f,U)=>({__typename:"Resource",code:f.code,order:U,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:f.tempItems,sx:ie.isEmpty(f.sx)?void 0:f.sx})),l=await N({valuationTemplate:{__typename:"Resource",name:b,order:0,archived:!1,type:"VALUATION_TEMPLATE",valuationType:"lineItem"},items:t});return await A("Template successfully created!",{variant:"success"}),await m(),l}catch{A("Failed to create template. Please try again.",{variant:"error"})}};return e.jsxs(d,{sx:{padding:2},children:[e.jsx(w,{variant:"h6",sx:{marginBottom:2},children:"Add Template Valuation"}),e.jsxs("div",{children:[e.jsx(d,{children:e.jsx(V,{variant:"filled",label:"Valuation Template Name",placeholder:"Name of Valuation Template",sx:{mr:1,mb:5,width:"400px"},value:b||"",onChange:L})}),e.jsxs(W,{sx:{width:"150px",mr:3},children:[e.jsx(B,{children:"Number of Fields"}),e.jsx(q,{value:o,onChange:x,children:Q})]}),e.jsxs(W,{sx:{width:"150px",mr:3},children:[e.jsx(B,{children:"Select type"}),e.jsx(q,{value:c,onChange:E,children:R})]}),e.jsx(V,{variant:"filled",label:"sx (optional)",placeholder:'{"fontWeight":"bold","color":"#1a59a8"}',sx:{mr:1},value:T.sx||"",onChange:j,multiline:!0,rows:4}),e.jsx(u,{variant:"contained",color:"primary",onClick:C,children:"Create TextFields"}),e.jsx("h3",{children:"Fill Up Text fields:"}),e.jsx(M,{container:!0,spacing:2,mt:2,children:p.map(t=>e.jsx(M,{item:!0,xs:12/p.length,children:e.jsx(V,{label:`Text Field ${t.id+1}`,sx:{width:"100%"},value:t.value,onChange:s=>S(s,t.id),variant:"filled",placeholder:'Any String OR {"value":"ASSESSED EBITDA","sx":{"fontWeight":"bold","color":"#1a59a8"}}',multiline:!0,rows:4})},t.id))}),r.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"Saved Text fields:"}),r.map((t,s)=>e.jsxs("div",{children:[e.jsxs("h4",{children:["Type: ",t.code]}),e.jsxs(M,{container:!0,spacing:2,children:[e.jsx(k,{sx:{mr:.5,mt:2},onClick:()=>a(s),children:e.jsx(Y,{})}),t.tempItems.map(l=>e.jsx(M,{item:!0,children:e.jsx(V,{label:`Text Field ${l.id+1}`,value:l.value,disabled:!0})},l.id))]})]},s))]})]}),e.jsxs(d,{sx:{marginTop:2,display:"flex",justifyContent:"flex-end"},children:[e.jsx(u,{sx:{height:"40px",width:"100px",marginRight:1},variant:"outlined",onClick:()=>{i(!1)},children:"Cancel"}),e.jsx(u,{sx:{height:"40px",width:"100px"},variant:"contained",onClick:G,children:"Save"})]})]})}const xe={valuationTemplate:{__typename:"Resource",code:"templateValDev",name:"Direct Comparison - Productive Unit",order:10,archived:!1,type:"VALUATION_TEMPLATE",valuationType:"lineItem"},items:[{__typename:"Resource",code:"lineItem",order:0,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"white",backgroundColor:"#184E9A",fontWeight:"bold"},tempItems:[{value:"Direct Comparison - Productive Unit"}]},{__typename:"Resource",code:"lineItem",order:1,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",backgroundColor:"#b4c6e7",fontWeight:"bold"},tempItems:[{value:""},{value:"AE"},{value:"Rate $/AE"},{value:"Value"}]},{__typename:"Resource",code:"lineItem",order:2,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Spring Creek"},{value:"1,100 @"},{value:"$10,000"},{value:"$11,000,000"}]},{__typename:"Resource",code:"lineItem",order:3,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",borderTop:"1px solid black",borderBottom:"1px solid black",fontWeight:"bold"},tempItems:[{value:"TOTAL (rounded)",sx:{float:"left"}},{value:"$11,000,000",sx:{float:"right"}}]}]},fe={valuationTemplate:{__typename:"Resource",code:"templateValDev",name:"Direct Comparison - All-Inclusive",order:11,archived:!1,type:"VALUATION_TEMPLATE",valuationType:"lineItem"},items:[{__typename:"Resource",code:"lineItem",order:0,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"white",backgroundColor:"#184E9A",fontWeight:"bold"},tempItems:[{value:"Direct Comparison - All-Inclusive"}]},{__typename:"Resource",code:"lineItem",order:1,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",backgroundColor:"#b4c6e7",fontWeight:"bold"},tempItems:[{value:""},{value:"Area (ha)"},{value:"Rate $/ha"},{value:"Value"}]},{__typename:"Resource",code:"lineItem",order:2,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Spring Creek"},{value:"9,235.95 @"},{value:""},{value:"$0"}]},{__typename:"Resource",code:"lineItem",order:3,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",borderTop:"1px solid black",borderBottom:"1px solid black",fontWeight:"bold"},tempItems:[{value:"TOTAL (rounded)",sx:{float:"left"}},{value:"$0",sx:{float:"right"}}]}]},_e={valuationTemplate:{__typename:"Resource",code:"templateValDev",name:"Direct Comparison - Summation",order:10,archived:!1,type:"VALUATION_TEMPLATE",valuationType:"lineItem"},items:[{__typename:"Resource",code:"lineItem",order:0,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"white",backgroundColor:"#184E9A",fontWeight:"bold"},tempItems:[{value:"Direct Comparison - Summation"}]},{__typename:"Resource",code:"lineItem",order:1,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",backgroundColor:"#b4c6e7",fontWeight:"bold"},tempItems:[{value:"Land Class"},{value:"Area (ha)"},{value:"Rate $/ha"},{value:"Value"}]},{__typename:"Resource",code:"lineItem",order:2,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Grazing"},{value:"4,890.95 @"},{value:"$1,750"},{value:"$8,559,163"}]},{__typename:"Resource",code:"lineItem",order:3,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Remnant Vegetation"},{value:"4,363.00 @"},{value:"$400"},{value:"$1,745,200"}]},{__typename:"Resource",code:"lineItem",order:4,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",borderTop:"1px solid black"},tempItems:[{value:"SubTotal"},{value:"9,253.95"},{value:""},{value:"$10,304,363"}]},{__typename:"Resource",code:"lineItem",order:5,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",backgroundColor:"#b4c6e7",fontWeight:"bold"},tempItems:[{value:"Structures"},{value:"Area (sqm)"},{value:"Rate $/sqm"},{value:"Value"}]},{__typename:"Resource",code:"lineItem",order:6,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Homestead"},{value:"481 @"},{value:"$850"},{value:"$408,850"}]},{__typename:"Resource",code:"lineItem",order:7,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Machinery Shed"},{value:"348 @"},{value:"$150"},{value:"$52,200"}]},{__typename:"Resource",code:"lineItem",order:8,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Workshop"},{value:"345 @"},{value:"$200"},{value:"$69,000"}]},{__typename:"Resource",code:"lineItem",order:9,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Hay Shed"},{value:"187 @"},{value:"$150"},{value:"$28,050"}]},{__typename:"Resource",code:"lineItem",order:10,archived:!1,type:"VALUATION_TEMPLATE_ITEM",tempItems:[{value:"Cattle Yard"},{value:""},{value:"Say"},{value:"$250,000"}]},{__typename:"Resource",code:"lineItem",order:11,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",borderTop:"1px solid black"},tempItems:[{value:"SubTotal"},{value:""},{value:""},{value:"$808,100"}]},{__typename:"Resource",code:"lineItem",order:12,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",marginTop:"5px"},tempItems:[{value:"Total"},{value:""},{value:""},{value:"$11,112,463"}]},{__typename:"Resource",code:"lineItem",order:13,archived:!1,type:"VALUATION_TEMPLATE_ITEM",sx:{color:"#184E9A",borderTop:"1px solid black",borderBottom:"1px solid black",fontWeight:"bold"},tempItems:[{value:"TOTAL (rounded)",sx:{float:"left"}},{value:"$11,110,000",sx:{float:"right"}}]}]},Ae={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:1e3,bgcolor:"background.paper",boxShadow:24,borderRadius:"12px",p:"30px"};function ia(){const[i,m]=h.useState(!1),[c,v]=h.useState("view"),[o,y]=h.useState(null),{enqueueSnackbar:r}=z(),[n,T]=h.useState(!1),[g,p]=h.useState(!1),[I,b]=h.useState(null),[O,A]=h.useState(!1);K({paths:[{label:"",link:"/"},{label:"Settings",link:"/settings"},{label:"LAWD"},{label:"Valuation Templates",link:"/settings/lawd/valuation-templates"}]});function E(a){const R={...a};y(()=>R)}const x=se({defaultValues:{}}),{data:j,isFetching:L,isLoading:C,refetch:S}=de({queryKey:["VALUATION_TEMPLATES"],queryFn:()=>ee()});return h.useEffect(()=>{T(C)},[C]),h.useEffect(()=>{x.setValue("valuationTemplate",o)},[o]),console.log("templates",j),e.jsxs(d,{sx:{overflow:"auto",height:"700px"},children:[e.jsx(X,{mb:2,children:"Valuation Templates Admin"}),e.jsx(J,{fullWidth:!0,maxWidth:"xl",open:O,children:e.jsx(Te,{setShowAddValuationForm:A,templatesRefetch:S})}),e.jsx(u,{variant:"contained",sx:{float:"right"},onClick:()=>{A(!0)},children:"Add Valuation Template"}),e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"contained",sx:{mr:3},onClick:async()=>{try{const a=await N(xe);return await r("Job successfully created!",{variant:"success"}),a}catch{r("Failed to create job. Please try again.",{variant:"error"})}},children:"SYNC - Productive Unit"}),e.jsx(u,{variant:"contained",sx:{mr:3},onClick:async()=>{try{const a=await N(fe);return await r("Job successfully created!",{variant:"success"}),a}catch{r("Failed to create job. Please try again.",{variant:"error"})}},children:"SYNC - All Inclusive"}),e.jsx(u,{variant:"contained",sx:{mr:3},onClick:async()=>{try{const a=await N(_e);return await r("Job successfully created!",{variant:"success"}),a}catch{r("Failed to create job. Please try again.",{variant:"error"})}},children:"SYNC - Summation"})]}),e.jsx(Z,{isLoading:n,headers:[{name:"Template Name",colSpan:11},{name:"",colSpan:.5},{name:"",colSpan:.5}],rows:()=>(j||[]).map(a=>({cells:[{colSpan:10,children:e.jsx(w,{sx:{transition:"0.3s all ease",cursor:"pointer","&:hover":{opacity:.8}},onClick:()=>{E(a),v("view"),m(!0)},children:a==null?void 0:a.name})},{colSpan:.5,children:e.jsx(k,{onClick:()=>{E(a),v("view"),m(!0)},children:e.jsx(ae,{})})},{colSpan:.5,children:e.jsx(k,{sx:{marginRight:3},onClick:()=>{E(a),v("edit"),m(!0)},children:e.jsx(te,{})})},{colSpan:.5,children:e.jsx(k,{sx:{marginRight:3},onClick:()=>{b(a==null?void 0:a.id),p(!0)},children:e.jsx(Y,{})})}]}))}),e.jsx(ue,{open:i,onClose:()=>m(!1),children:e.jsxs(d,{sx:Ae,children:[e.jsxs(d,{children:[c==="edit"?e.jsx(le,{control:x.control,name:"valuationTemplate.name",label:"Name",defaultValue:o==null?void 0:o.name,fullWidth:!0}):e.jsx(w,{children:o==null?void 0:o.name}),e.jsx(d,{marginTop:5,children:e.jsx(oe,{data:o==null?void 0:o.items})}),e.jsx(w,{variant:"subtitle2",mt:2})]}),c==="edit"?e.jsx(e.Fragment,{children:e.jsxs(d,{display:"flex",justifyContent:"flex-end",children:[e.jsx(he,{sx:{marginRight:1,width:"80px"},loading:L,disabled:L,variant:"contained",onClick:async()=>{const a=await re({id:x.control._formValues.valuationTemplate.id,name:x.control._formValues.valuationTemplate.name,type:x.control._formValues.valuationTemplate.type,code:x.control._formValues.valuationTemplate.code,__typename:"Resource"});await pe.refetchQueries({queryKey:["VALUATION_TEMPLATES"]}),r("Template name updated successfully!",{variant:"success"}),m(!1),console.log("Updating Valuation Template",a)},children:"Save"}),e.jsx(u,{sx:{width:"80px"},variant:"outlined",onClick:()=>m(!1),children:"Close"})]})}):null]})}),e.jsxs(J,{open:g,onClose:()=>{p(!1)},children:[e.jsx(d,{sx:{p:"24px"},children:"Are you sure you want to delete the template?"}),e.jsxs(d,{sx:{display:"flex",justifyContent:"flex-end",p:"24px"},children:[e.jsx(u,{onClick:async()=>{await r("Deleting...",{variant:"info"}),await ve(I),await S(),await r("Successfully Deleted",{variant:"success"}),await p(!1)},children:"Yes"}),e.jsx(u,{onClick:()=>{p(!1)},children:"Cancel"})]})]})]})}export{ia as default};
