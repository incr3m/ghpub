import{_ as lr}from"./iframe-ed7f5a3f.js";import{j as s,_ as cr,E as dr,s as ur}from"./TransitionGroupContext-9d36972e.js";import{R as c,r as L}from"./index-f1f749bf.js";import{au as me,av as ge,cG as Oe,e1 as fr,e2 as hr,e3 as mr,e4 as gr,e5 as pr,e6 as xr,e7 as vr,e8 as yr,e9 as br,B as j,C as Cr,m as Ce,aw as hn,l as X,u as be,P as Le,ah as pt,i as fe,cb as wr,ai as Me,W as we,a8 as mn,T as ye,cs as ke,K as De,o as pe,a4 as jr,aW as kr,a1 as gn,k as xt,J as pn,F as ze,b as ae,bc as Bt,h as vt,ea as xn,ad as Er,X as Ke,bN as vn,$ as yn,ac as Qe,a0 as Be,Y as bn,z as $e,G as Fe,bC as Tr,at as Cn,bF as wn,f as yt,ag as Sr,a9 as Ir,aV as Rr,a3 as Dr,cf as _r,L as Ar,s as He,bG as Or,v as $r,ab as Mr,ba as Pr,bQ as Lr,w as Te,c0 as zr,be as Nr}from"./papaparse.min-b66e70e7.js";import{d as jn}from"./debounce-213cd46f.js";import{a as J}from"./assertThisInitialized-ad1db8e7.js";import{r as Fr,p as Hr,ah as Br,ag as et,c as Wr,a as Ye,l as We,b as bt,f as Re,i as Vr,K as Gr,Y as qr,E as Ur,q as Kr,s as Qr,J as Yr,a7 as Zr}from"./index-bcfaa842.js";import{R as Jr}from"./index-96c5f47c.js";import{a as kn}from"./index-61adb48a.js";import{R as Ct,c as wt,K as Wt,I as Xr,S as es}from"./pick-dba65392.js";import{g as q}from"./_baseForOwn-9b89c4b6.js";import{u as En}from"./useFetchMore-be228481.js";import{P as ts,U as ns}from"./filter-f99df4e5.js";import{u as rs}from"./uniq-0d482d7b.js";import{j as Ze,b as ss,k as as,T as Tn,c as Sn,p as Je,t as os,o as is,a7 as ls,ae as In,a9 as cs,z as ds,r as us}from"./Play-87fed129.js";import{d as fs}from"./Check-78df5e8e.js";import{P as Rn,u as hs}from"./ProjectLink-987015ba.js";import{B as re}from"./Button-352c3435.js";import{U as ms}from"./index-4d31058a.js";import{p as gs}from"./_arrayIncludes-2cfb33ae.js";import{P as ps}from"./index-79afbab1.js";import{O as xs}from"./OpportunityLink-b32d0c35.js";import{D as vs,M as ys}from"./app_constants-e80240cb.js";import{s as bs}from"./index-34b70f05.js";import{s as Cs}from"./index-9ae6381b.js";import{i as ws}from"./isEqual-86613f76.js";import{l as js}from"./reduce-4f6f1985.js";import{A as ks}from"./Alert-fd9a067a.js";import{T as Dn}from"./Trash-822e65ce.js";function Es(e){return Fr(1,arguments),Hr(e).getDay()===1}var jt={},Ts=ge;Object.defineProperty(jt,"__esModule",{value:!0});var _n=jt.default=void 0,Ss=Ts(me()),Is=s;_n=jt.default=(0,Ss.default)((0,Is.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var kt={},Rs=ge;Object.defineProperty(kt,"__esModule",{value:!0});var An=kt.default=void 0,Ds=Rs(me()),_s=s;An=kt.default=(0,Ds.default)((0,_s.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");var Et={},As=ge;Object.defineProperty(Et,"__esModule",{value:!0});var On=Et.default=void 0,Os=As(me()),$s=s;On=Et.default=(0,Os.default)((0,$s.jsx)("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14zM7 10h5v5H7z"}),"Today");const Ms={ASC:"▲",DESC:"▼",NONE:""};function Ps({column:e,onSort:t,sortColumn:n,sortDirection:r,children:a}){r=n===e.key&&r||"NONE";function o(){if(!t)return;const i=e.sortDescendingFirst||!1;let l;switch(r){case"ASC":l=i?"NONE":"DESC";break;case"DESC":l=i?"ASC":"NONE";break;default:l=i?"DESC":"ASC";break}t(e.key,l)}return c.createElement("span",{className:"rdg-header-sort-cell",onClick:o},c.createElement("span",{className:"rdg-header-sort-name"},a),c.createElement("span",null,Ms[r]))}function Ls({children:e,column:t,...n}){function r(i){if(i.button!==0)return;const{currentTarget:l}=i,{right:d}=l.getBoundingClientRect(),f=d-i.clientX;if(f>11)return;const h=m=>{o(m.clientX+f,l)},u=()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",u)};i.preventDefault(),window.addEventListener("mousemove",h),window.addEventListener("mouseup",u)}function a(i){const l=i.changedTouches[0],{identifier:d}=l,{currentTarget:f}=i,{right:h}=f.getBoundingClientRect(),u=h-l.clientX;if(u>11)return;function m(b){for(const p of b.changedTouches)if(p.identifier===d)return p;return null}const g=b=>{const p=m(b);p&&o(p.clientX+u,f)},y=b=>{m(b)&&(window.removeEventListener("touchmove",g),window.removeEventListener("touchend",y))};window.addEventListener("touchmove",g),window.addEventListener("touchend",y)}function o(i,l){const d=i-l.getBoundingClientRect().left;d>0&&n.onResize(t,d)}return L.cloneElement(e,{onMouseDown:r,onTouchStart:a,children:c.createElement(c.Fragment,null,e.props.children,c.createElement("div",{className:"rdg-header-cell-resizer"}))})}function zs({height:e,column:t,allRowsSelected:n,onAllRowsSelectionChange:r,scrollLeft:a,...o}){function i(){return t.headerRenderer?L.createElement(t.headerRenderer,{column:t,allRowsSelected:n,onAllRowsSelectionChange:r}):t.name}let l=i();t.sortable&&(l=c.createElement(Ps,{column:t,onSort:o.onSort,sortColumn:o.sortColumn,sortDirection:o.sortDirection},l));const d=Oe("rdg-cell",t.headerCellClass,{"rdg-cell-frozen":t.frozen,"rdg-cell-frozen-last":t.idx===o.lastFrozenColumnIndex}),f={width:t.width,left:t.left};typeof a=="number"&&(f.transform=`translateX(${a}px)`),l=c.createElement("div",{className:d,style:f},l),t.resizable&&(l=c.createElement(Ls,{column:t,onResize:o.onResize},l));const h=o.draggableHeaderCell;return t.draggable&&h?c.createElement(h,{column:t,onHeaderDrop:o.onHeaderDrop},l):l}let tt;function Pe(){if(tt===void 0){const e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.width="50px",e.style.height="50px",e.style.overflow="scroll",document.body.appendChild(e),tt=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return tt}let nt;function $n(){if(nt===void 0){const e=document.createElement("a"),{style:t}=e;t.cssText="position:-webkit-sticky;position:sticky",nt=t.position?t.position.includes("sticky"):!1}return nt}function Tt(e){e.preventDefault()}function ue(e,t){return t===void 0?e:function(n){e(n),t(n)}}function Ns(e){let t=0,n=0,r=0,a=0,o=-1;const i=[];for(const h of e.columns){const u=Fs(h,e.columnWidths,e.viewportWidth,e.minColumnWidth),m={...h,width:u};u===void 0?a++:r+=u,m.frozen?(o++,i.splice(o,0,m)):i.push(m)}const l=e.viewportWidth-r-Pe(),d=Math.max(Math.floor(l/a),e.minColumnWidth);return{columns:i.map((h,u)=>{const m=h.width===void 0?d:h.width,g={...h,idx:u,width:m,left:t,formatter:h.formatter||e.defaultFormatter};return n+=m,t+=m,g}),lastFrozenColumnIndex:o,totalColumnWidth:n,viewportWidth:e.viewportWidth}}function Fs(e,t,n,r){if(t.has(e.key))return t.get(e.key);if(typeof e.width=="number")return e.width;if(typeof e.width=="string"&&/^\d+%$/.test(e.width))return Math.max(Math.floor(n*parseInt(e.width,10)/100),r)}function Hs(e,t){return typeof e.editable=="function"?e.editable(t):!!(e.editor||e.editable)}function Bs(e,t,n,r){let a=0,o=0;for(let l=0;l<t;l++){const d=e[l];d&&(d.width&&(a+=d.width),d.frozen&&(o+=d.width))}const i=e[t];if(i){const l=a-o-n,d=a+i.width-n;if(l<0)return l;if(d>r)return d-r}return 0}function Ws(e,t){if(t===-1)return 0;const n=e[t];return n.left+n.width}const Ne=8;function Vs(e,t,n,r){const o=Math.floor(n/t),i=Math.min(r-1,Math.floor((n+e)/t)),l=Math.max(0,Math.floor((o-4)/Ne)*Ne),d=Math.min(r-1,Math.ceil((i+4)/Ne)*Ne);return[l,d]}function Gs({columnMetrics:e,scrollLeft:t}){const{columns:n,lastFrozenColumnIndex:r,viewportWidth:a}=e,o=Ws(n,r),i=t+o,l=t+a,d=n.length-1,f=Math.min(r+1,d);if(i>=l)return[f,f];let h=f;for(;h<d;){const{left:y,width:b}=n[h];if(y+b>i)break;h++}let u=h;for(;u<d;){const{left:y,width:b}=n[u];if(y+b>=l)break;u++}const m=Math.max(f,h-1),g=Math.min(d,u+1);return[m,g]}function qs(e,t,n){const r=[];for(let a=0;a<=n;a++){const o=e[a];a<t&&!o.frozen||r.push(o)}return r}function Us(e){return e>47&&e<58||e===32||e===13||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function Ks(e){return(e.ctrlKey===!0||e.metaKey===!0)&&e.key!=="Control"}var ie;(function(e){e.NONE="none",e.CHANGE_ROW="changeRow",e.LOOP_OVER_ROW="loopOverRow"})(ie||(ie={}));var Vt;(function(e){e.Column="column"})(Vt||(Vt={}));var Se;(function(e){e.CELL_UPDATE="CELL_UPDATE",e.COLUMN_FILL="COLUMN_FILL",e.COPY_PASTE="COPY_PASTE",e.CELL_DRAG="CELL_DRAG"})(Se||(Se={}));const Qs=1,Ys=3;function Zs({selectedPosition:{idx:e,rowIdx:t},columns:n,rowHeight:r,scrollLeft:a}){if(e<0)return{width:0,left:0,top:0,height:r,zIndex:1};const o=n[e],{width:i}=o,l=o.frozen?o.left+a:o.left,d=t*r,f=o.frozen?Ys:Qs;return{width:i,left:l,top:d,height:r,zIndex:f}}function Js({selectedPosition:e,columns:t,rows:n,onCheckCellIsEditable:r}){const a=t[e.idx],o=n[e.rowIdx];return(r?r({row:o,column:a,...e}):!0)&&Hs(a,o)}function Gt({cellNavigationMode:e,columns:t,rowsCount:n,nextPosition:r}){if(e!==ie.NONE){const{idx:a,rowIdx:o}=r,i=t.length,l=a===i,d=a===-1;if(l){if(e===ie.CHANGE_ROW){if(!(o===n-1))return{idx:0,rowIdx:o+1}}else if(e===ie.LOOP_OVER_ROW)return{rowIdx:o,idx:0}}else if(d){if(e===ie.CHANGE_ROW){if(!(o===0))return{rowIdx:o-1,idx:i-1}}else if(e===ie.LOOP_OVER_ROW)return{rowIdx:o,idx:i-1}}}return r}function Xs(e,{cellNavigationMode:t,columns:n,rowsCount:r,selectedPosition:{rowIdx:a,idx:o}}){if(t===ie.NONE||t===ie.CHANGE_ROW){const i=o===n.length-1,l=o===0,d=a===r-1,f=a===0;return e.shiftKey===!0?l&&f:i&&d}return!1}function Mn(e){if(e===void 0)throw new Error("Please specify the rowKey prop to use selection")}function ea({height:e,width:t,onSelectedRowsChange:n,rowKey:r,rows:a,...o}){const i=L.useCallback(l=>{if(!n)return;Mn(r);const d=new Set;if(l)for(const f of a)d.add(f[r]);n(d)},[n,a,r]);return c.createElement("div",{className:"rdg-header-row",style:{width:t,height:e,lineHeight:`${e}px`}},o.columns.map(l=>c.createElement(zs,{key:l.key,column:l,lastFrozenColumnIndex:o.lastFrozenColumnIndex,height:e,onResize:o.onColumnResize,onHeaderDrop:o.onHeaderDrop,allRowsSelected:o.allRowsSelected,onAllRowsSelectionChange:i,draggableHeaderCell:o.draggableHeaderCell,onSort:o.onSort,sortColumn:o.sortColumn,sortDirection:o.sortDirection,scrollLeft:l.frozen?o.scrollLeft:void 0})))}function ta({height:e,width:t,columns:n,lastFrozenColumnIndex:r,scrollLeft:a,filters:o,onFiltersChange:i}){function l(d,f){var h;const u={...o};u[d]=f,(h=i)===null||h===void 0||h(u)}return c.createElement("div",{className:"rdg-header-row",style:{width:t,height:e,lineHeight:`${e}px`}},n.map(d=>{var f;const{key:h}=d,u=Oe("rdg-cell",{"rdg-cell-frozen":d.frozen,"rdg-cell-frozen-last":d.idx===r}),m={width:d.width,left:d.left};return d.frozen&&typeof a=="number"&&(m.transform=`translateX(${a}px)`),c.createElement("div",{key:h,style:m,className:u},d.filterRenderer&&L.createElement(d.filterRenderer,{column:d,value:(f=o)===null||f===void 0?void 0:f[d.key],onChange:g=>l(h,g)}))}))}class na{constructor(){this.subscribers=new Map}subscribe(t,n){this.subscribers.has(t)||this.subscribers.set(t,new Set);const r=this.subscribers.get(t);return r.add(n),()=>{r.delete(n)}}dispatch(t,...n){const r=this.subscribers.get(t);r&&r.forEach(a=>a(...n))}}const ht=L.forwardRef(function({width:t,height:n,top:r,left:a,zIndex:o,className:i,...l},d){return c.createElement("div",Object.assign({className:Oe("rdg-cell-mask",i),style:{height:n,width:t,zIndex:o,transform:`translate(${a}px, ${r}px)`},"data-test":"cell-mask",ref:d},l))});function ra({draggedPosition:e,getSelectedDimensions:t}){const{overRowIdx:n,idx:r,rowIdx:a}=e;if(a===n)return null;const o=a<n,i=o?a+1:n,l=o?n:a-1,d=o?"react-grid-cell-dragged-over-down":"react-grid-cell-dragged-over-up",f=t({idx:r,rowIdx:i});for(let h=i+1;h<=l;h++){const{height:u}=t({idx:r,rowIdx:h});f.height+=u}return c.createElement(ht,Object.assign({},f,{className:d}))}function rt(e){return e&&Br(e)==="object"&&e.constructor===Object}function _e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{clone:!0},r=n.clone?J({},e):e;return rt(e)&&rt(t)&&Object.keys(t).forEach(function(a){a!=="__proto__"&&(rt(t[a])&&a in e?r[a]=_e(e[a],t[a],n):r[a]=t[a])}),r}function Ve(e){for(var t="https://mui.com/production-error/?code="+e,n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified Material-UI error #"+e+"; visit "+t+" for the full message."}function qt(e){if(typeof e!="string")throw new Error(Ve(7));return e.charAt(0).toUpperCase()+e.slice(1)}function he(e,t){if(e==null)return{};var n=cr(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var sa=typeof Symbol=="function"&&Symbol.for;const aa=sa?Symbol.for("mui.nested"):"__THEME_NESTED__";var oa=["checked","disabled","error","focused","focusVisible","required","expanded","selected"];function ia(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.disableGlobal,n=t===void 0?!1:t,r=e.productionPrefix,a=r===void 0?"jss":r,o=e.seed,i=o===void 0?"":o,l=i===""?"":"".concat(i,"-"),d=0,f=function(){return d+=1,d};return function(h,u){var m=u.options.name;if(m&&m.indexOf("Mui")===0&&!u.options.link&&!n){if(oa.indexOf(h.key)!==-1)return"Mui-".concat(h.key);var g="".concat(l).concat(m,"-").concat(h.key);return!u.options.theme[aa]||i!==""?g:"".concat(g,"-").concat(f())}return"".concat(l).concat(a).concat(f())}}function la(e){var t=e.theme,n=e.name,r=e.props;if(!t||!t.props||!t.props[n])return r;var a=t.props[n],o;for(o in a)r[o]===void 0&&(r[o]=a[o]);return r}function ca(){return{plugins:[fr(),hr(),mr(),gr(),pr(),typeof window>"u"?null:xr(),vr()]}}function Pn(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.baseClasses,n=e.newClasses;if(e.Component,!n)return t;var r=J({},t);return Object.keys(n).forEach(function(a){n[a]&&(r[a]="".concat(t[a]," ").concat(n[a]))}),r}var da={set:function(t,n,r,a){var o=t.get(n);o||(o=new Map,t.set(n,o)),o.set(r,a)},get:function(t,n,r){var a=t.get(n);return a?a.get(r):void 0},delete:function(t,n,r){var a=t.get(n);a.delete(r)}};const Ie=da;var ua=c.createContext(null);const fa=ua;function Ln(){var e=c.useContext(fa);return e}var ha=yr(ca()),ma=ia(),ga=new Map,pa={disableGeneration:!1,generateClassName:ma,jss:ha,sheetsCache:null,sheetsManager:ga,sheetsRegistry:null},xa=c.createContext(pa),Ut=-1e9;function va(){return Ut+=1,Ut}var ya={};const ba=ya;function Ca(e){var t=typeof e=="function";return{create:function(r,a){var o;try{o=t?e(r):e}catch(d){throw d}if(!a||!r.overrides||!r.overrides[a])return o;var i=r.overrides[a],l=J({},o);return Object.keys(i).forEach(function(d){l[d]=_e(l[d],i[d])}),l},options:{}}}function wa(e,t,n){var r=e.state,a=e.stylesOptions;if(a.disableGeneration)return t||{};r.cacheClasses||(r.cacheClasses={value:null,lastProp:null,lastJSS:{}});var o=!1;return r.classes!==r.cacheClasses.lastJSS&&(r.cacheClasses.lastJSS=r.classes,o=!0),t!==r.cacheClasses.lastProp&&(r.cacheClasses.lastProp=t,o=!0),o&&(r.cacheClasses.value=Pn({baseClasses:r.cacheClasses.lastJSS,newClasses:t,Component:n})),r.cacheClasses.value}function ja(e,t){var n=e.state,r=e.theme,a=e.stylesOptions,o=e.stylesCreator,i=e.name;if(!a.disableGeneration){var l=Ie.get(a.sheetsManager,o,r);l||(l={refs:0,staticSheet:null,dynamicStyles:null},Ie.set(a.sheetsManager,o,r,l));var d=J({},o.options,a,{theme:r,flip:typeof a.flip=="boolean"?a.flip:r.direction==="rtl"});d.generateId=d.serverGenerateClassName||d.generateClassName;var f=a.sheetsRegistry;if(l.refs===0){var h;a.sheetsCache&&(h=Ie.get(a.sheetsCache,o,r));var u=o.create(r,i);h||(h=a.jss.createStyleSheet(u,J({link:!1},d)),h.attach(),a.sheetsCache&&Ie.set(a.sheetsCache,o,r,h)),f&&f.add(h),l.staticSheet=h,l.dynamicStyles=br(u)}if(l.dynamicStyles){var m=a.jss.createStyleSheet(l.dynamicStyles,J({link:!0},d));m.update(t),m.attach(),n.dynamicSheet=m,n.classes=Pn({baseClasses:l.staticSheet.classes,newClasses:m.classes}),f&&f.add(m)}else n.classes=l.staticSheet.classes;l.refs+=1}}function ka(e,t){var n=e.state;n.dynamicSheet&&n.dynamicSheet.update(t)}function Ea(e){var t=e.state,n=e.theme,r=e.stylesOptions,a=e.stylesCreator;if(!r.disableGeneration){var o=Ie.get(r.sheetsManager,a,n);o.refs-=1;var i=r.sheetsRegistry;o.refs===0&&(Ie.delete(r.sheetsManager,a,n),r.jss.removeStyleSheet(o.staticSheet),i&&i.remove(o.staticSheet)),t.dynamicSheet&&(r.jss.removeStyleSheet(t.dynamicSheet),i&&i.remove(t.dynamicSheet))}}function Ta(e,t){var n=c.useRef([]),r,a=c.useMemo(function(){return{}},t);n.current!==a&&(n.current=a,r=e()),c.useEffect(function(){return function(){r&&r()}},[a])}function Sa(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.name,r=t.classNamePrefix,a=t.Component,o=t.defaultTheme,i=o===void 0?ba:o,l=he(t,["name","classNamePrefix","Component","defaultTheme"]),d=Ca(e),f=n||r||"makeStyles";d.options={index:va(),name:n,meta:f,classNamePrefix:f};var h=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=Ln()||i,y=J({},c.useContext(xa),l),b=c.useRef(),p=c.useRef();Ta(function(){var x={name:n,state:{},stylesCreator:d,stylesOptions:y,theme:g};return ja(x,m),p.current=!1,b.current=x,function(){Ea(x)}},[g,d]),c.useEffect(function(){p.current&&ka(b.current,m),p.current=!0});var C=wa(b.current,m.classes,a);return C};return h}var Ia=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function(r){var a=n.defaultTheme,o=n.withTheme,i=o===void 0?!1:o,l=n.name,d=he(n,["defaultTheme","withTheme","name"]),f=l,h=Sa(t,J({defaultTheme:a,Component:r,name:l||r.displayName,classNamePrefix:f},d)),u=c.forwardRef(function(g,y){g.classes;var b=g.innerRef,p=he(g,["classes","innerRef"]),C=h(J({},r.defaultProps,g)),x,w=p;return(typeof l=="string"||i)&&(x=Ln()||a,l&&(w=la({theme:x,name:l,props:p})),i&&!w.theme&&(w.theme=x)),c.createElement(r,J({ref:b||y,classes:C},w))});return dr(u,r),u}};const Ra=Ia;var ve=["xs","sm","md","lg","xl"];function Da(e){var t=e.values,n=t===void 0?{xs:0,sm:600,md:960,lg:1280,xl:1920}:t,r=e.unit,a=r===void 0?"px":r,o=e.step,i=o===void 0?5:o,l=he(e,["values","unit","step"]);function d(g){var y=typeof n[g]=="number"?n[g]:g;return"@media (min-width:".concat(y).concat(a,")")}function f(g){var y=ve.indexOf(g)+1,b=n[ve[y]];if(y===ve.length)return d("xs");var p=typeof b=="number"&&y>0?b:g;return"@media (max-width:".concat(p-i/100).concat(a,")")}function h(g,y){var b=ve.indexOf(y);return b===ve.length-1?d(g):"@media (min-width:".concat(typeof n[g]=="number"?n[g]:g).concat(a,") and ")+"(max-width:".concat((b!==-1&&typeof n[ve[b+1]]=="number"?n[ve[b+1]]:y)-i/100).concat(a,")")}function u(g){return h(g,g)}function m(g){return n[g]}return J({keys:ve,values:n,up:d,down:f,between:h,only:u,width:m},l)}function _a(e,t,n){var r;return J({gutters:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return console.warn(["Material-UI: theme.mixins.gutters() is deprecated.","You can use the source of the mixin directly:",`
      paddingLeft: theme.spacing(2),
      paddingRight: theme.spacing(2),
      [theme.breakpoints.up('sm')]: {
        paddingLeft: theme.spacing(3),
        paddingRight: theme.spacing(3),
      },
      `].join(`
`)),J({paddingLeft:t(2),paddingRight:t(2)},o,et({},e.up("sm"),J({paddingLeft:t(3),paddingRight:t(3)},o[e.up("sm")])))},toolbar:(r={minHeight:56},et(r,"".concat(e.up("xs")," and (orientation: landscape)"),{minHeight:48}),et(r,e.up("sm"),{minHeight:64}),r)},n)}var Aa={black:"#000",white:"#fff"};const Ge=Aa;var Oa={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"};const St=Oa;var $a={50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",A100:"#8c9eff",A200:"#536dfe",A400:"#3d5afe",A700:"#304ffe"};const st=$a;var Ma={50:"#fce4ec",100:"#f8bbd0",200:"#f48fb1",300:"#f06292",400:"#ec407a",500:"#e91e63",600:"#d81b60",700:"#c2185b",800:"#ad1457",900:"#880e4f",A100:"#ff80ab",A200:"#ff4081",A400:"#f50057",A700:"#c51162"};const at=Ma;var Pa={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"};const ot=Pa;var La={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"};const it=La;var za={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"};const lt=za;var Na={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"};const ct=Na;function zn(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.min(Math.max(t,e),n)}function Fa(e){e=e.substr(1);var t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g"),n=e.match(t);return n&&n[0].length===1&&(n=n.map(function(r){return r+r})),n?"rgb".concat(n.length===4?"a":"","(").concat(n.map(function(r,a){return a<3?parseInt(r,16):Math.round(parseInt(r,16)/255*1e3)/1e3}).join(", "),")"):""}function Ha(e){e=Ae(e);var t=e,n=t.values,r=n[0],a=n[1]/100,o=n[2]/100,i=a*Math.min(o,1-o),l=function(u){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(u+r/30)%12;return o-i*Math.max(Math.min(m-3,9-m,1),-1)},d="rgb",f=[Math.round(l(0)*255),Math.round(l(8)*255),Math.round(l(4)*255)];return e.type==="hsla"&&(d+="a",f.push(n[3])),It({type:d,values:f})}function Ae(e){if(e.type)return e;if(e.charAt(0)==="#")return Ae(Fa(e));var t=e.indexOf("("),n=e.substring(0,t);if(["rgb","rgba","hsl","hsla"].indexOf(n)===-1)throw new Error(Ve(3,e));var r=e.substring(t+1,e.length-1).split(",");return r=r.map(function(a){return parseFloat(a)}),{type:n,values:r}}function It(e){var t=e.type,n=e.values;return t.indexOf("rgb")!==-1?n=n.map(function(r,a){return a<3?parseInt(r,10):r}):t.indexOf("hsl")!==-1&&(n[1]="".concat(n[1],"%"),n[2]="".concat(n[2],"%")),"".concat(t,"(").concat(n.join(", "),")")}function Ba(e,t){var n=Kt(e),r=Kt(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function Kt(e){e=Ae(e);var t=e.type==="hsl"?Ae(Ha(e)).values:e.values;return t=t.map(function(n){return n/=255,n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function Wa(e,t){if(e=Ae(e),t=zn(t),e.type.indexOf("hsl")!==-1)e.values[2]*=1-t;else if(e.type.indexOf("rgb")!==-1)for(var n=0;n<3;n+=1)e.values[n]*=1-t;return It(e)}function Va(e,t){if(e=Ae(e),t=zn(t),e.type.indexOf("hsl")!==-1)e.values[2]+=(100-e.values[2])*t;else if(e.type.indexOf("rgb")!==-1)for(var n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;return It(e)}var Qt={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Ge.white,default:St[50]},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},dt={text:{primary:Ge.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",hint:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:St[800],default:"#303030"},action:{active:Ge.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function Yt(e,t,n,r){var a=r.light||r,o=r.dark||r*1.5;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:t==="light"?e.light=Va(e.main,a):t==="dark"&&(e.dark=Wa(e.main,o)))}function Ga(e){var t=e.primary,n=t===void 0?{light:st[300],main:st[500],dark:st[700]}:t,r=e.secondary,a=r===void 0?{light:at.A200,main:at.A400,dark:at.A700}:r,o=e.error,i=o===void 0?{light:ot[300],main:ot[500],dark:ot[700]}:o,l=e.warning,d=l===void 0?{light:it[300],main:it[500],dark:it[700]}:l,f=e.info,h=f===void 0?{light:lt[300],main:lt[500],dark:lt[700]}:f,u=e.success,m=u===void 0?{light:ct[300],main:ct[500],dark:ct[700]}:u,g=e.type,y=g===void 0?"light":g,b=e.contrastThreshold,p=b===void 0?3:b,C=e.tonalOffset,x=C===void 0?.2:C,w=he(e,["primary","secondary","error","warning","info","success","type","contrastThreshold","tonalOffset"]);function k(H){var P=Ba(H,dt.text.primary)>=p?dt.text.primary:Qt.text.primary;return P}var E=function(P){var W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:500,G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,I=arguments.length>3&&arguments[3]!==void 0?arguments[3]:700;if(P=J({},P),!P.main&&P[W]&&(P.main=P[W]),!P.main)throw new Error(Ve(4,W));if(typeof P.main!="string")throw new Error(Ve(5,JSON.stringify(P.main)));return Yt(P,"light",G,x),Yt(P,"dark",I,x),P.contrastText||(P.contrastText=k(P.main)),P},O={dark:dt,light:Qt},z=_e(J({common:Ge,type:y,primary:E(n),secondary:E(a,"A400","A200","A700"),error:E(i),warning:E(d),info:E(h),success:E(m),grey:St,contrastThreshold:p,getContrastText:k,augmentColor:E,tonalOffset:x},O[y]),w);return z}function Nn(e){return Math.round(e*1e5)/1e5}function qa(e){return Nn(e)}var Zt={textTransform:"uppercase"},Jt='"Roboto", "Helvetica", "Arial", sans-serif';function Ua(e,t){var n=typeof t=="function"?t(e):t,r=n.fontFamily,a=r===void 0?Jt:r,o=n.fontSize,i=o===void 0?14:o,l=n.fontWeightLight,d=l===void 0?300:l,f=n.fontWeightRegular,h=f===void 0?400:f,u=n.fontWeightMedium,m=u===void 0?500:u,g=n.fontWeightBold,y=g===void 0?700:g,b=n.htmlFontSize,p=b===void 0?16:b,C=n.allVariants,x=n.pxToRem,w=he(n,["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"]),k=i/14,E=x||function(H){return"".concat(H/p*k,"rem")},O=function(P,W,G,I,v){return J({fontFamily:a,fontWeight:P,fontSize:E(W),lineHeight:G},a===Jt?{letterSpacing:"".concat(Nn(I/W),"em")}:{},v,C)},z={h1:O(d,96,1.167,-1.5),h2:O(d,60,1.2,-.5),h3:O(h,48,1.167,0),h4:O(h,34,1.235,.25),h5:O(h,24,1.334,0),h6:O(m,20,1.6,.15),subtitle1:O(h,16,1.75,.15),subtitle2:O(m,14,1.57,.1),body1:O(h,16,1.5,.15),body2:O(h,14,1.43,.15),button:O(m,14,1.75,.4,Zt),caption:O(h,12,1.66,.4),overline:O(h,12,2.66,1,Zt)};return _e(J({htmlFontSize:p,pxToRem:E,round:qa,fontFamily:a,fontSize:i,fontWeightLight:d,fontWeightRegular:h,fontWeightMedium:m,fontWeightBold:y},z),w,{clone:!1})}var Ka=.2,Qa=.14,Ya=.12;function Z(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(Ka,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(Qa,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(Ya,")")].join(",")}var Za=["none",Z(0,2,1,-1,0,1,1,0,0,1,3,0),Z(0,3,1,-2,0,2,2,0,0,1,5,0),Z(0,3,3,-2,0,3,4,0,0,1,8,0),Z(0,2,4,-1,0,4,5,0,0,1,10,0),Z(0,3,5,-1,0,5,8,0,0,1,14,0),Z(0,3,5,-1,0,6,10,0,0,1,18,0),Z(0,4,5,-2,0,7,10,1,0,2,16,1),Z(0,5,5,-3,0,8,10,1,0,3,14,2),Z(0,5,6,-3,0,9,12,1,0,3,16,2),Z(0,6,6,-3,0,10,14,1,0,4,18,3),Z(0,6,7,-4,0,11,15,1,0,4,20,3),Z(0,7,8,-4,0,12,17,2,0,5,22,4),Z(0,7,8,-4,0,13,19,2,0,5,24,4),Z(0,7,9,-4,0,14,21,2,0,5,26,4),Z(0,8,9,-5,0,15,22,2,0,6,28,5),Z(0,8,10,-5,0,16,24,2,0,6,30,5),Z(0,8,11,-5,0,17,26,2,0,6,32,5),Z(0,9,11,-5,0,18,28,2,0,7,34,6),Z(0,9,12,-6,0,19,29,2,0,7,36,6),Z(0,10,13,-6,0,20,31,3,0,8,38,7),Z(0,10,13,-6,0,21,33,3,0,8,40,7),Z(0,10,14,-6,0,22,35,3,0,8,42,7),Z(0,11,14,-7,0,23,36,3,0,9,44,8),Z(0,11,15,-7,0,24,38,3,0,9,46,8)];const Ja=Za;var Xa={borderRadius:4};const eo=Xa;function to(e){var t=e.spacing||8;return typeof t=="number"?function(n){return t*n}:Array.isArray(t)?function(n){return t[n]}:typeof t=="function"?t:function(){}}function no(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:8;if(e.mui)return e;var t=to({spacing:e}),n=function(){for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return o.length===0?t(1):o.length===1?t(o[0]):o.map(function(l){if(typeof l=="string")return l;var d=t(l);return typeof d=="number"?"".concat(d,"px"):d}).join(" ")};return Object.defineProperty(n,"unit",{get:function(){return e}}),n.mui=!0,n}var Xt={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},en={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function tn(e){return"".concat(Math.round(e),"ms")}const ro={easing:Xt,duration:en,create:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["all"],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.duration,a=r===void 0?en.standard:r,o=n.easing,i=o===void 0?Xt.easeInOut:o,l=n.delay,d=l===void 0?0:l;return he(n,["duration","easing","delay"]),(Array.isArray(t)?t:[t]).map(function(f){return"".concat(f," ").concat(typeof a=="string"?a:tn(a)," ").concat(i," ").concat(typeof d=="string"?d:tn(d))}).join(",")},getAutoHeightDuration:function(t){if(!t)return 0;var n=t/36;return Math.round((4+15*Math.pow(n,.25)+n/5)*10)}};var so={mobileStepper:1e3,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};const ao=so;function oo(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.breakpoints,n=t===void 0?{}:t,r=e.mixins,a=r===void 0?{}:r,o=e.palette,i=o===void 0?{}:o,l=e.spacing,d=e.typography,f=d===void 0?{}:d,h=he(e,["breakpoints","mixins","palette","spacing","typography"]),u=Ga(i),m=Da(n),g=no(l),y=_e({breakpoints:m,direction:"ltr",mixins:_a(m,g,a),overrides:{},palette:u,props:{},shadows:Ja,typography:Ua(u,f),spacing:g,shape:eo,transitions:ro,zIndex:ao},h),b=arguments.length,p=new Array(b>1?b-1:0),C=1;C<b;C++)p[C-1]=arguments[C];return y=p.reduce(function(x,w){return _e(x,w)},y),y}var io=oo();const lo=io;function co(e,t){return Ra(e,J({defaultTheme:lo},t))}var uo=function(t){return{root:{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,fontSize:t.typography.pxToRem(24),transition:t.transitions.create("fill",{duration:t.transitions.duration.shorter})},colorPrimary:{color:t.palette.primary.main},colorSecondary:{color:t.palette.secondary.main},colorAction:{color:t.palette.action.active},colorError:{color:t.palette.error.main},colorDisabled:{color:t.palette.action.disabled},fontSizeInherit:{fontSize:"inherit"},fontSizeSmall:{fontSize:t.typography.pxToRem(20)},fontSizeLarge:{fontSize:t.typography.pxToRem(35)}}},Fn=L.forwardRef(function(t,n){var r=t.children,a=t.classes,o=t.className,i=t.color,l=i===void 0?"inherit":i,d=t.component,f=d===void 0?"svg":d,h=t.fontSize,u=h===void 0?"medium":h,m=t.htmlColor,g=t.titleAccess,y=t.viewBox,b=y===void 0?"0 0 24 24":y,p=he(t,["children","classes","className","color","component","fontSize","htmlColor","titleAccess","viewBox"]);return L.createElement(f,J({className:Wr(a.root,o,l!=="inherit"&&a["color".concat(qt(l))],u!=="default"&&u!=="medium"&&a["fontSize".concat(qt(u))]),focusable:"false",viewBox:b,color:m,"aria-hidden":g?void 0:!0,role:g?"img":void 0,ref:n},p),r,g?L.createElement("title",null,g):null)});Fn.muiName="SvgIcon";const nn=co(uo,{name:"MuiSvgIcon"})(Fn);function fo(e,t){var n=function(a,o){return c.createElement(nn,J({ref:o},a),e)};return n.muiName=nn.muiName,c.memo(c.forwardRef(n))}const ho=fo(L.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));class mo extends c.Component{constructor(){super(...arguments),this.input=c.createRef()}getInputNode(){return this.input.current}getValue(){return{[this.props.column.key]:this.input.current.value}}render(){return c.createElement("input",{className:"rdg-text-editor",ref:this.input,defaultValue:this.props.value,onBlur:this.props.onCommit})}}function go({onClickOutside:e,children:t}){const n=L.useRef(!1);return L.useEffect(()=>{function r(){n.current?n.current=!1:e()}return document.addEventListener("click",r),()=>{document.removeEventListener("click",r)}},[e]),c.cloneElement(c.Children.only(t),{onClickCapture(){n.current=!0}})}function po({rowIdx:e,column:t,row:n,width:r,height:a,left:o,top:i,onCommit:l,onCommitCancel:d,scrollLeft:f,scrollTop:h,firstEditorKeyPress:u}){const m=L.useRef(null),[g,y]=L.useState(!0),b=L.useRef(f),p=L.useRef(h),C=L.useCallback(()=>{var v;return(v=m.current)===null||v===void 0?void 0:v.getInputNode()},[]);L.useLayoutEffect(()=>{const v=C();v instanceof HTMLElement&&v.focus(),v instanceof HTMLInputElement&&v.select()},[C]);function x(){const v=n[t.key];return u==="Delete"||u==="Backspace"?"":u==="Enter"?v:u||v}(b.current!==f||p.current!==h)&&d();function w(){const v=C();return v instanceof HTMLInputElement&&v.selectionEnd===0}function k(){const v=C();return v instanceof HTMLInputElement&&v.selectionStart===v.value.length}function E(){var v,R,D,A;return A=(D=(v=m.current)===null||v===void 0?void 0:(R=v).hasResults)===null||D===void 0?void 0:D.call(R),A??!1}function O(){var v,R,D,A;return A=(D=(v=m.current)===null||v===void 0?void 0:(R=v).isSelectOpen)===null||D===void 0?void 0:D.call(R),A??!1}function z(v){var R,D,A;const V=(A=(R=m.current)===null||R===void 0?void 0:(D=R).validate)===null||A===void 0?void 0:A.call(D,v);return typeof V=="boolean"?(y(V),V):!0}function H(v){return v==="ArrowLeft"&&!w()||v==="ArrowRight"&&!k()||v==="Escape"&&O()||["ArrowUp","ArrowDown"].includes(v)&&E()}function P(){if(!m.current)return;const v=m.current.getValue();if(z(v)){const R=t.key;l({cellKey:R,rowIdx:e,updated:v})}}function W(v){H(v.key)?v.stopPropagation():["Enter","Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(v.key)?P():v.key==="Escape"&&d()}function G(){return t.editor?c.createElement(t.editor,{ref:m,column:t,value:x(),row:n,height:a,onCommit:P,onCommitCancel:d,onOverrideKeyDown:W}):c.createElement(mo,{ref:m,column:t,value:x(),onCommit:P})}const I=Oe("rdg-editor-container",{"has-error":!g});return c.createElement(go,{onClickOutside:P},c.createElement("div",{className:I,style:{height:a,width:r,left:o,top:i},onKeyDown:W,onContextMenu:Tt},G(),!g&&c.createElement(ho,{className:"form-control-feedback"})))}function xo({target:e,children:t}){const[n,r]=L.useState(!1);return L.useLayoutEffect(()=>{r(!0)},[]),n?Jr.createPortal(t,e):null}var te;(function(e){e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Escape=27]="Escape",e[e.ArrowLeft=37]="ArrowLeft",e[e.ArrowUp=38]="ArrowUp",e[e.ArrowRight=39]="ArrowRight",e[e.ArrowDown=40]="ArrowDown",e[e.Delete=46]="Delete",e[e.c=67]="c",e[e.v=86]="v"})(te||(te={}));function vo(e){return[te.ArrowLeft,te.ArrowUp,te.ArrowRight,te.ArrowDown].includes(e.keyCode)}function yo({columns:e,rows:t,rowHeight:n,eventBus:r,enableCellAutoFocus:a,enableCellCopyPaste:o,enableCellDragAndDrop:i,editorPortalTarget:l,cellNavigationMode:d,canvasRef:f,scrollLeft:h,scrollTop:u,onSelectedCellChange:m,onCheckCellIsEditable:g,onRowsUpdate:y,scrollToCell:b}){const[p,C]=L.useState(()=>a&&document.activeElement===document.body&&e.length>0&&t.length>0?{idx:0,rowIdx:0}:{idx:-1,rowIdx:-1}),[x,w]=L.useState(null),[k,E]=L.useState(null),[O,z]=L.useState(null),[H,P]=L.useState(!1),W=L.useRef(null);L.useEffect(()=>{var _;p.rowIdx===-1||p.idx===-1||(_=W.current)===null||_===void 0||_.focus()},[p]),L.useEffect(()=>{var _;H||(_=W.current)===null||_===void 0||_.focus()},[H]),L.useEffect(()=>r.subscribe("SELECT_CELL",N)),L.useEffect(()=>{if(k===null)return;const _=Q=>{E({...k,overRowIdx:Q})};return r.subscribe("DRAG_ENTER",_)},[k,r]),(p.idx>e.length||p.rowIdx>t.length)&&(C({idx:-1,rowIdx:-1}),w(null),E(null));function G(){if(!f.current)return null;const{left:_,top:Q}=f.current.getBoundingClientRect(),{scrollTop:ee,scrollLeft:le}=document.scrollingElement||document.documentElement,Ee=e[p.idx];return{left:_+le+Ee.left-(Ee.frozen?0:h),top:Q+ee+p.rowIdx*n-u}}function I(_){switch(_){case te.ArrowUp:return{...p,rowIdx:p.rowIdx-1};case te.ArrowDown:return{...p,rowIdx:p.rowIdx+1};case te.ArrowLeft:return{...p,idx:p.idx-1};case te.ArrowRight:return{...p,idx:p.idx+1};default:return p}}function v(_){Ks(_)?A(_):_.keyCode===te.Escape?K():_.keyCode===te.Tab?V(_):vo(_)?S(_):(Us(_.keyCode)||[te.Backspace,te.Delete,te.Enter].includes(_.keyCode))&&R(_)}function R(_){!H&&T(p)&&(z(_.key),P(!0))}function D(){P(!1),z(null)}function A({keyCode:_}){o&&(_===te.c?$():_===te.v&&B())}function V(_){if(t.length===0)return;if(Xs(_,{cellNavigationMode:d,columns:e,rowsCount:t.length,selectedPosition:p})){if(H){D();return}C({idx:-1,rowIdx:-1});return}_.preventDefault();const Q=d===ie.NONE?ie.CHANGE_ROW:d,ee=_.shiftKey?te.ArrowLeft:te.ArrowRight;let le=I(ee);le=Gt({columns:e,rowsCount:t.length,cellNavigationMode:Q,nextPosition:le}),N(le)}function K(){D(),w(null)}function $(){const{idx:_,rowIdx:Q}=p,ee=t[Q][e[_].key];w({idx:_,rowIdx:Q,value:ee})}function B(){if(x===null||!T(p))return;const{rowIdx:_}=p,Q=e[p.idx].key,{rowIdx:ee,idx:le,value:Ee}=x,ir=e[le].key;y({cellKey:Q,fromRow:ee,toRow:_,updated:{[Q]:Ee},action:Se.COPY_PASTE,fromCellKey:ir})}function S(_){_.preventDefault();let Q=I(_.keyCode);Q=Gt({columns:e,rowsCount:t.length,cellNavigationMode:d,nextPosition:Q}),N(Q)}function M({idx:_,rowIdx:Q}){return Q>=0&&Q<t.length&&_>=0&&_<e.length}function T(_){return M(_)&&Js({columns:e,rows:t,selectedPosition:_,onCheckCellIsEditable:g})}function N(_,Q=!1){var ee;H&&D(),M(_)&&(b(_),C(_),(ee=m)===null||ee===void 0||ee({..._}),Q&&T(_)&&P(!0))}function F(){return i&&T(p)}function U(_){_.dataTransfer.effectAllowed="copy";const Q=JSON.stringify(p);try{_.dataTransfer.setData("text/plain",Q)}catch{_.dataTransfer.setData("text",Q)}E({...p,overRowIdx:p.rowIdx})}function Y(){if(k===null)return;const{rowIdx:_,overRowIdx:Q}=k,le=e[k.idx].key,Ee=t[_][le];y({cellKey:le,fromRow:_,toRow:Q,updated:{[le]:Ee},action:Se.CELL_DRAG}),E(null)}function ne(){const Q=e[p.idx].key,ee=t[p.rowIdx][Q];y({cellKey:Q,fromRow:p.rowIdx,toRow:t.length-1,updated:{[Q]:ee},action:Se.COLUMN_FILL})}function de({cellKey:_,rowIdx:Q,updated:ee}){y({cellKey:_,fromRow:Q,toRow:Q,updated:ee,action:Se.CELL_UPDATE}),D()}function ce(_){const Q=n*_.rowIdx,ee=Zs({selectedPosition:_,columns:e,scrollLeft:h,rowHeight:n});return ee.top=Q,ee}return c.createElement("div",{onKeyDown:v},x&&M(x)&&c.createElement(ht,Object.assign({className:"rdg-cell-copied"},ce(x))),k&&M(k)&&c.createElement(ra,{draggedPosition:k,getSelectedDimensions:ce}),!H&&M(p)&&c.createElement(ht,Object.assign({className:"rdg-selected",tabIndex:0,ref:W},ce(p)),F()&&c.createElement("div",{className:"drag-handle",draggable:!0,onDragStart:U,onDragEnd:Y,onDoubleClick:ne})),H&&M(p)&&c.createElement(xo,{target:l},c.createElement(po,Object.assign({firstEditorKeyPress:O,onCommit:de,onCommitCancel:D,rowIdx:p.rowIdx,row:t[p.rowIdx],column:e[p.idx],scrollLeft:h,scrollTop:u},ce(p),G()))))}function bo({children:e,className:t,column:n,idx:r,isRowSelected:a,isSummaryRow:o,lastFrozenColumnIndex:i,row:l,rowIdx:d,scrollLeft:f,eventBus:h,onRowClick:u,enableCellRangeSelection:m,onClick:g,onDoubleClick:y,onContextMenu:b,onDragOver:p,onMouseDown:C,onMouseEnter:x,...w}){function k(v){h.dispatch("SELECT_CELL",{idx:r,rowIdx:d},v)}function E(){var v;k(),(v=u)===null||v===void 0||v(d,l,n)}function O(){h.dispatch("SELECT_START",{idx:r,rowIdx:d});function v(){h.dispatch("SELECT_END"),window.removeEventListener("mouseup",v)}window.addEventListener("mouseup",v)}function z(){h.dispatch("SELECT_UPDATE",{idx:r,rowIdx:d})}function H(){k()}function P(){k(!0)}function W(v,R){h.dispatch("SELECT_ROW",{rowIdx:d,checked:v,isShiftClick:R})}const{cellClass:G}=n;t=Oe("rdg-cell",{"rdg-cell-frozen":n.frozen,"rdg-cell-frozen-last":n.idx===i},typeof G=="function"?G(l):G,t);const I={width:n.width,left:n.left};return f!==void 0&&(I.transform=`translateX(${f}px)`),e||(e=L.createElement(n.formatter,{column:n,rowIdx:d,row:l,isRowSelected:a,onRowSelectionChange:W,isSummaryRow:o})),c.createElement("div",Object.assign({className:t,style:I,onClick:o?g:ue(E,g),onDoubleClick:o?y:ue(P,y),onContextMenu:o?b:ue(H,b),onDragOver:o?p:ue(Tt,p),onMouseDown:o||!m?C:ue(O,C),onMouseEnter:o||!m?x:ue(z,x)},w),e)}const Hn=L.memo(bo);function Rt({cellRenderer:e=Hn,className:t,enableCellRangeSelection:n,eventBus:r,height:a,rowIdx:o,isRowSelected:i,isSummaryRow:l,lastFrozenColumnIndex:d,onRowClick:f,row:h,scrollLeft:u,viewportColumns:m,width:g,onDragEnter:y,onDragOver:b,onDrop:p,...C}){function x(E){E.preventDefault(),r.dispatch("DRAG_ENTER",o)}function w(E){E.preventDefault(),E.dataTransfer.dropEffect="copy"}function k(){return m.map(E=>c.createElement(e,{key:E.key,idx:E.idx,rowIdx:o,column:E,lastFrozenColumnIndex:d,row:h,scrollLeft:E.frozen&&typeof u=="number"?u:void 0,isRowSelected:i,isSummaryRow:l,eventBus:r,onRowClick:f,enableCellRangeSelection:n}))}return t=Oe("rdg-row",`rdg-row-${o%2===0?"even":"odd"}`,{"rdg-row-selected":i},t),c.createElement("div",Object.assign({className:t,style:{width:g,height:a},onDragEnter:l?y:ue(x,y),onDragOver:l?b:ue(w,b),onDrop:l?p:ue(Tt,p)},C),k())}const Co=L.forwardRef(function(t,n){function r(l){const{onRowExpandToggle:d}=t;if(d){const f=l??!t.isExpanded;d({rowIdx:t.rowIdx,shouldExpand:f,columnGroupName:t.columnGroupName,name:t.name})}}function a(){r(!t.isExpanded)}function o(){t.eventBus.dispatch("SELECT_CELL",{rowIdx:t.rowIdx,idx:0})}const i=t.renderer||wo;return c.createElement("div",{onClick:o},c.createElement(i,Object.assign({},t,{ref:n,onRowExpandClick:a,onRowExpandToggle:r})))}),wo=L.forwardRef(function(t,n){function r({key:u}){const{onRowExpandToggle:m}=t;u==="ArrowLeft"&&m(!1),u==="ArrowRight"&&m(!0),u==="Enter"&&m(!t.isExpanded)}const{treeDepth:a=0,height:o,onRowExpandClick:i,isExpanded:l,columnGroupDisplayName:d,name:f}=t,h=a*20;return c.createElement("div",{className:"rdg-row-group",style:{height:o},onKeyDown:r,tabIndex:0,ref:n},c.createElement("span",{className:"rdg-row-expand-icon",style:{marginLeft:h},onClick:i},l?String.fromCharCode(9660):String.fromCharCode(9658)),c.createElement("strong",null,d,": ",f))});function jo({columnMetrics:e,viewportColumns:t,eventBus:n,rowIdx:r,row:a,rowGroupRenderer:o,rowHeight:i,rowRenderer:l,scrollLeft:d,...f}){const{__metaData:h}=a,u={rowIdx:r,row:a,width:e.totalColumnWidth,height:i,viewportColumns:t,isRowSelected:f.isRowSelected,lastFrozenColumnIndex:e.lastFrozenColumnIndex,scrollLeft:d,isSummaryRow:!1,eventBus:n,onRowClick:f.onRowClick,enableCellRangeSelection:f.enableCellRangeSelection};if(h){if(h.getRowRenderer)return h.getRowRenderer(u,r);if(h.isGroup)return c.createElement(Co,Object.assign({},u,h,{name:a.name,eventBus:n,renderer:o,onRowExpandToggle:f.onRowExpandToggle}))}return c.createElement(l||Rt,u)}const ko=L.memo(jo),Eo=L.memo(Rt);function To({columnMetrics:e,viewportColumns:t,height:n,scrollLeft:r,onScroll:a,rows:o,rowHeight:i,rowKey:l,summaryRows:d,selectedRows:f,onSelectedRowsChange:h,...u},m){const[g]=L.useState(()=>new na),[y,b]=L.useState(0),p=L.useRef(null),C=L.useRef(null),x=L.useRef(-1),w=W(),k=$n()?void 0:r,{columns:E,lastFrozenColumnIndex:O}=e,[z,H]=Vs(w,i,y,o.length);function P($){const{scrollLeft:B,scrollTop:S}=$.currentTarget;b(S),a({scrollLeft:B,scrollTop:S}),C.current&&(C.current.scrollLeft=B)}function W(){const $=e.totalColumnWidth>e.viewportWidth?Pe():0;return n-$}function G(){if(O===-1)return 0;const $=E[O];return $.left+$.width}function I({idx:$,rowIdx:B}){const{current:S}=p;if(!S)return;const{clientWidth:M,clientHeight:T,scrollLeft:N,scrollTop:F}=S;if(typeof $=="number"&&$>O){const{left:U,width:Y}=E[$],ne=U<N+Y+G(),de=U+Y>M+N;if(ne||de){const ce=Bs(E,$,N,M);S.scrollLeft=N+ce}}typeof B=="number"&&(B*i<F?S.scrollTop=B*i:(B+1)*i>F+T&&(S.scrollTop=(B+1)*i-T))}function v($){I({idx:$})}function R($){const{current:B}=p;B&&(B.scrollTop=$*i)}function D($,B){g.dispatch("SELECT_CELL",$,B)}function A($,B){D({rowIdx:$,idx:B},!0)}L.useEffect(()=>{if(!h)return;const $=({rowIdx:B,checked:S,isShiftClick:M})=>{Mn(l);const T=new Set(f),N=o[B][l];if(S){T.add(N);const F=x.current;if(x.current=B,M&&F!==-1&&F!==B){const U=Math.sign(B-F);for(let Y=F+U;Y!==B;Y+=U)T.add(o[Y][l])}}else T.delete(N),x.current=-1;h(T)};return g.subscribe("SELECT_ROW",$)},[g,h,o,l,f]),L.useImperativeHandle(m,()=>({scrollToColumn:v,scrollToRow:R,selectCell:D,openCellEditor:A}));function V(){var $,B;const S=[];for(let M=z;M<=H;M++){const T=o[M];let N=M,F=!1;if(l!==void 0){const U=T[l];F=(B=($=f)===null||$===void 0?void 0:$.has(U),B??!1),(typeof U=="string"||typeof U=="number")&&(N=U)}S.push(c.createElement(ko,{key:N,rowIdx:M,row:T,columnMetrics:e,viewportColumns:t,eventBus:g,rowGroupRenderer:u.rowGroupRenderer,rowHeight:i,rowRenderer:u.rowRenderer,scrollLeft:k,isRowSelected:F,onRowClick:u.onRowClick,onRowExpandToggle:u.onRowExpandToggle,enableCellRangeSelection:typeof u.onSelectedCellRangeChange=="function"}))}return S}const K=d&&d.length>0&&c.createElement("div",{ref:C,className:"rdg-summary"},d.map(($,B)=>c.createElement(Eo,{key:B,rowIdx:B,row:$,width:e.totalColumnWidth+Pe(),height:i,viewportColumns:t,isRowSelected:!1,lastFrozenColumnIndex:e.lastFrozenColumnIndex,scrollLeft:k,isSummaryRow:!0,eventBus:g})));return c.createElement(c.Fragment,null,c.createElement("div",{className:"rdg-viewport",style:{height:n-2-(d?d.length*i+2:0)},ref:p,onScroll:P},c.createElement(yo,{rows:o,rowHeight:i,columns:E,height:w,enableCellAutoFocus:u.enableCellAutoFocus,enableCellCopyPaste:u.enableCellCopyPaste,enableCellDragAndDrop:u.enableCellDragAndDrop,cellNavigationMode:u.cellNavigationMode,eventBus:g,canvasRef:p,scrollLeft:r,scrollTop:y,scrollToCell:I,editorPortalTarget:u.editorPortalTarget,onCheckCellIsEditable:u.onCheckCellIsEditable,onRowsUpdate:u.onRowsUpdate,onSelectedCellChange:u.onSelectedCellChange,onSelectedCellRangeChange:u.onSelectedCellRangeChange}),c.createElement("div",{className:"rdg-grid",style:{width:e.totalColumnWidth,paddingTop:z*i,paddingBottom:(o.length-1-H)*i}},V())),K)}const So=L.forwardRef(To);function Io(e){return c.createElement(c.Fragment,null,e.row[e.column.key])}function Ro({rowKey:e,rowHeight:t=35,headerRowHeight:n=t,headerFiltersHeight:r=45,minColumnWidth:a=80,height:o=350,width:i,enableCellAutoFocus:l=!0,enableFilters:d=!1,enableCellCopyPaste:f=!1,enableCellDragAndDrop:h=!1,cellNavigationMode:u=ie.NONE,editorPortalTarget:m=document.body,defaultFormatter:g=Io,columns:y,rows:b,selectedRows:p,onSelectedRowsChange:C,...x},w){var k;const[E,O]=L.useState(()=>new Map),[z,H]=L.useState(0),[P,W]=L.useState(0),G=L.useRef(null),I=L.useRef(null),v=(i||P)-2,R=$n()?void 0:z,D=L.useMemo(()=>v<=0?null:Ns({columns:y,minColumnWidth:a,viewportWidth:v,columnWidths:E,defaultFormatter:g}),[E,y,g,a,v]),[A,V]=L.useMemo(()=>D?Gs({columnMetrics:D,scrollLeft:z}):[0,0],[D,z]),K=L.useMemo(()=>D?qs(D.columns,A,V):[],[V,A,D]);L.useLayoutEffect(()=>{if(i)return;function T(){W(G.current.getBoundingClientRect().width)}return T(),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T)}},[i]);function $(T,N){var F,U;const Y=new Map(E),ne=y.find(ce=>ce.key===T.key).width,de=typeof ne=="number"?Math.min(ne,a):a;N=Math.max(N,de),Y.set(T.key,N),O(Y),(U=(F=x).onColumnResize)===null||U===void 0||U.call(F,T.idx,N)}function B(T){var N,F;I.current&&(I.current.scrollLeft=T.scrollLeft),H(T.scrollLeft),(F=(N=x).onScroll)===null||F===void 0||F.call(N,T)}function S(T){var N,F;(F=(N=x).onRowsUpdate)===null||F===void 0||F.call(N,T)}const M=n+(d?r:0);return c.createElement("div",{className:"rdg-root",style:{width:i,lineHeight:`${t}px`},ref:G},D&&c.createElement(c.Fragment,null,c.createElement("div",{ref:I,className:"rdg-header"},c.createElement(ea,{rowKey:e,rows:b,height:n,width:D.totalColumnWidth+Pe(),columns:K,onColumnResize:$,lastFrozenColumnIndex:D.lastFrozenColumnIndex,draggableHeaderCell:x.draggableHeaderCell,onHeaderDrop:x.onHeaderDrop,allRowsSelected:((k=p)===null||k===void 0?void 0:k.size)===b.length,onSelectedRowsChange:C,sortColumn:x.sortColumn,sortDirection:x.sortDirection,onSort:x.onSort,scrollLeft:R}),d&&c.createElement(ta,{height:r,width:D.totalColumnWidth+Pe(),lastFrozenColumnIndex:D.lastFrozenColumnIndex,columns:K,scrollLeft:R,filters:x.filters,onFiltersChange:x.onFiltersChange})),b.length===0&&x.emptyRowsView?L.createElement(x.emptyRowsView):c.createElement(So,{ref:w,rowKey:e,rowHeight:t,rowRenderer:x.rowRenderer,rows:b,selectedRows:p,onSelectedRowsChange:C,columnMetrics:D,viewportColumns:K,onScroll:B,height:o-M,rowGroupRenderer:x.rowGroupRenderer,enableCellAutoFocus:l,enableCellCopyPaste:f,enableCellDragAndDrop:h,cellNavigationMode:u,scrollLeft:z,editorPortalTarget:m,summaryRows:x.summaryRows,onCheckCellIsEditable:x.onCheckCellIsEditable,onRowsUpdate:S,onSelectedCellChange:x.onSelectedCellChange,onSelectedCellRangeChange:x.onSelectedCellRangeChange,onRowClick:x.onRowClick,onRowExpandToggle:x.onRowExpandToggle})))}const Do=L.forwardRef(Ro);function _o(){c.useEffect(()=>{const e=document.head,t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href="/rdg13.css",e.appendChild(t),()=>{e.removeChild(t)}},[])}const Ao=Ce({root:e=>({position:"relative","& .rdg-root":{border:"none"},"& .rdg-header":{backgroundColor:"inherit","& .rdg-cell":{border:"none",textAlign:"center"}},"& .rdg-grid":{...e.stretchHeight&&{paddingBottom:"0 !important"}},"& .rdg-viewport":{...e.stretchHeight&&{height:"auto !important",overflow:"hidden"},border:"1px solid #E6E9ED",boxSizing:"border-box",borderRadius:"12px",borderBottomLeftRadius:0,borderBottomRightRadius:0},"& .rdg-row .rdg-cell":{border:"1px solid #F4F5F7"},"& .rdg-row .rdg-cell:first-child":()=>{const t={};return e.highLightFirstColumn&&(t.backgroundColor="#F4F5F7",t.border="1px solid #E6E9ED"),t},"& .rdg-summary":{borderTopLeftRadius:0,borderTopRightRadius:0,border:"1px solid #E6E9ED",boxSizing:"border-box",borderRadius:"12px",backgroundColor:"#F4F5F7",fontWeight:"bold","& div":{backgroundColor:"inherit"},"& .rdg-cell":{border:"1px solid #E6E9ED"}}})}),se=c.createContext({});function Oo({context:e={},highLightFirstColumn:t=!1,stretchHeight:n=!0,loading:r,...a}){const o=c.useRef({});_o();const[i,l]=c.useState({stretchHeight:n}),d=c.useRef(null),f=Ao({highLightFirstColumn:t,stretchHeight:n});return o.current.height=a.height,o.current.autoHeight=jn(()=>{if(console.log(">>DataGrid/index::","calc height",a.height),!a.height){const h=window.innerHeight;if(h<1||!d.current)return;const u=20,m=40,g=h-d.current.offsetTop-u-m;l(y=>g===y.autoHeight?y:{...y,autoHeight:g})}},200),c.useLayoutEffect(()=>{o.current.autoHeight()}),s.jsxs("div",{ref:d,className:f.root,children:[s.jsx(se.Provider,{value:{...a,context:e},children:s.jsx(Do,{...a,height:i.autoHeight>0?i.autoHeight:a.height||600})}),r&&s.jsx(j,{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",top:0,left:0,width:"100%",bgcolor:"rgba(255, 255, 255, 0.5)",height:"100%",children:s.jsx(Cr,{})})]})}const $o=({startInterval:e,endInterval:t,filters:n={},unit:r,targetIds:a})=>{let o=[];return a&&(o=[{bool:{should:(a.length>0?a:["non-exist"]).map(i=>({term:{"assignToId.keyword":i}}))}}]),{key:"ESQUERY_FETCH_CONSOLIDATED",index:"allocation",body:{size:0,query:{bool:{must_not:[{term:{"assignType.keyword":"Task"}}],must:[...o,n.assignType&&{term:{"assignType.keyword":n.assignType}},n.assignToId&&{term:{"assignToId.keyword":n.assignToId}},n.userId&&{term:{"memberId.keyword":n.userId}},{range:{date:{gte:e,lte:t}}}].filter(i=>i)}},aggs:{group_by_member:{terms:{field:"memberId.keyword"},aggs:{...r==="WEEK"&&{group_by_period:{date_histogram:{field:"date",interval:"week"},aggs:{sum_now:{sum:{field:"duration"}}}}},...r==="DAY"&&{group_by_period:{terms:{field:"date"},aggs:{sum_now:{sum:{field:"duration"}}}}}}}}}}},ut="DAY";function Mo(){const[e,t]=hn(X`
      mutation CreateAllocation(
        $id: ID!
        $input: CreateAllocationInput!
        $condition: ModelAllocationConditionInput
      ) {
        deleteAllocation(input: { id: $id }) {
          id
        }
        createAllocation(input: $input, condition: $condition) {
          id
          date
          unit
        }
      }
    `);return[c.useCallback(({resourceId:r,projectId:a,unit:o,allocDate:i,memberId:l,duration:d})=>{const f=`${r}::${a}::${o}::${i}`;return e({variables:{id:f,input:{id:f,memberId:l,projectId:a,duration:d,date:`${i}T00:00:00.000Z`,unit:o}}}).then(h=>{console.log(">>member/MemberSchedule::","res",h)})},[e]),t]}function Po({rows:e=[],columns:t=[]}){const[n,r]=c.useState({summaryRows:[],columnKeys:[]});return c.useEffect(()=>{r(a=>({...a,columnKeys:t.map(o=>o.key)}))},[t]),c.useEffect(()=>{const a=n.columnKeys;if(a.length<1)return;const[o,...i]=a,l={[o]:"Total"};e.forEach(d=>{for(const f of i)l[f]=(l[f]||0)+(Number(d[f])||0)}),console.log(">>scheduler/index::","rows",e,n.columnKeys,l),r(d=>({...d,summaryRows:[l]}))},[e,n.columnKeys]),{summaryRows:n.summaryRows}}var Dt={},Lo=ge;Object.defineProperty(Dt,"__esModule",{value:!0});var Bn=Dt.default=void 0,zo=Lo(me()),No=s;Bn=Dt.default=(0,zo.default)((0,No.jsx)("path",{d:"M3 13h2v-2H3zm0 4h2v-2H3zm2 4v-2H3c0 1.1.89 2 2 2M3 9h2V7H3zm12 12h2v-2h-2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 12H9V5h10zm-8 6h2v-2h-2zm-4 0h2v-2H7z"}),"FlipToFront");var _t={},Fo=ge;Object.defineProperty(_t,"__esModule",{value:!0});var At=_t.default=void 0,Ho=Fo(me()),rn=s;At=_t.default=(0,Ho.default)([(0,rn.jsx)("path",{d:"m8 7.5 4 4 4-4V4H8zm0 9V20h8v-3.5l-4-4z",opacity:".3"},"0"),(0,rn.jsx)("path",{d:"M18 2H6v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18zm-2 14.5V20H8v-3.5l4-4zm0-9-4 4-4-4V4h8z"},"1")],"HourglassFullTwoTone");var Ot={},Bo=ge;Object.defineProperty(Ot,"__esModule",{value:!0});var Wn=Ot.default=void 0,Wo=Bo(me()),Vo=s;Wn=Ot.default=(0,Wo.default)((0,Vo.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z"}),"CheckCircleOutlined");function Go({model:e,opts:t={}}){if(!e)throw new Error("No Model Defined");const[n,r]=hn(X`
      mutation($input: Create${e}Input!) {
        cta: create${e}(input: $input) {
          id
        }
      }
    `,t);return[c.useCallback(({input:a})=>n({variables:{input:a}}),[n]),r]}function Vn(e){return{startTime:{range:[`${e.toLocaleDateString("en-se")}T00:00:00.000Z`,`${Ye(e,1).toLocaleDateString("en-se")}T00:00:00.000Z`]}}}function Gn({taskId:e,userId:t,startDate:n}){return`${e}::${t}::${n}`}function qo({task:e}){const t=wt(e==null?void 0:e.projectId);return console.log(">>scheduler/SchedDailyTaskUserBlock::","proj",t,os),console.log("kraketoa task: ",e),s.jsxs("div",{className:"tsk",children:[s.jsx(Rn,{project:t}),s.jsx(Tn,{task:e,whiteSpace:"normal"})]})}const Uo=ke({root:{backgroundColor:"#dbe0e6",padding:10,maxWidth:250,"& .tsk":{width:"190px",padding:"10px 0"},"& .tsk-prj":{display:"flex",marginTop:10,color:"#697D92",minHeight:24},"& .tsk-prj > svg":{marginRight:5,opacity:.6},"& .tsk-code":{padding:"0 10px",marginBottom:5,display:"inline-block",color:"white"},"& ul":{paddingTop:0},"& .adtask":{marginTop:15,border:"dashed 1px #9BA8B6",borderRadius:10,paddingTop:10,color:"#626a73",opacity:.7},"& .adtask:hover":{opacity:1},"& .adtask > *":{width:"100%"},"& .atask-pnl":{backgroundColor:"white",marginTop:15,border:"solid 1px lightgrey",borderRadius:10,borderBottom:"none",boxShadow:"0px 2px 1px -1px rgb(241, 241, 241), 0px 1px 1px 0px rgb(241, 241, 241), 0px 1px 3px 0px rgb(187, 187, 187)"}}})(e=>s.jsx(Le,{className:e.classes.root,children:e.children}));function qn({userId:e,date:t=new Date,persist:n=!0,compact:r=!1,filters:a,onTasksChanged:o,maxListHeight:i}){const l=c.useRef({}),d=t,f=c.useRef(null),[h,u]=c.useState({selectedKey:null,selectedTaskOption:null,selectedSchedTask:null,values:[],options:!1,idx:null});l.current.filters=a,c.useEffect(()=>{o&&o(h.values)},[o,h.values]);const{data:m}=be(X`
  {
    user:getUser(id: "${e}"){
      id
      fullname
      position
      profilePhoto
    }
  }`,{skip:r}),g=c.useMemo(()=>({...Vn(d),userId:{eq:e}}),[d,e]),y=be(Un,{variables:{filter:g},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});console.log(">>scheduler/SchedDailyTaskUserBlock::",`schedQ ${e}`,y),En({...y,model:"TaskAssignment",op:"search"});const[b]=Go({model:"TaskAssignment"}),[p]=Ze({opts:{forceDelete:!0}}),[C,x]=c.useState(!1),{data:{projects:w={}}={}}=be(Yo,{variables:{filter:{status:{eq:"COMPLETED"}}},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),k=L.useRef();k.current=w;const E=c.useCallback((v,R)=>{u(D=>({...D,selectedKey:R,selectedSchedTask:null})),f.current.open(v.currentTarget||v.target)},[]),O=c.useCallback((v,R)=>{u(D=>({...D,selectedKey:q(R,"user.id"),selectedSchedTask:R}))},[]);c.useEffect(()=>{const{filters:v}=l.current,R=q(y,"data.searchTaskAssignments.items",[]);u(D=>({...D,values:R.filter(A=>{const V=q(A,"task.projectId");return!(v&&v.projectId!==V)})}))},[y]);const z=c.useCallback((v,R)=>{u(D=>({...D,selectedTaskOption:R}))},[]),H=c.useCallback(()=>{const v=h.selectedTaskOption;v&&u(R=>{const{values:D}=R,A=Ct(d),V=A.dateCeil,K=Gn({taskId:v._id,userId:e,startDate:V});return D.push({id:K,task:v._source,user:{id:e},__typename:"TaskAssignment"}),n&&b({input:{id:K,userId:e,taskId:v._id,startTime:A.ceilISOString}}).then($=>{console.log(">>scheduler/SchedRowRenderer::","res",$)}).catch(()=>{alert("Something went wrong..")}),{...R,values:[...D]}})},[h.selectedTaskOption,d,b,e,n]),P=c.useCallback(async()=>{h.selectedSchedTask&&(n&&await p(h.selectedSchedTask),f.current.close(),x(!1),u(v=>{const{values:R}=v;return{...v,values:R.filter(D=>D.id!==h.selectedSchedTask.id)}}))},[p,n,h.selectedSchedTask]),W=!h.selectedSchedTask&&h.selectedKey,G=c.useCallback(v=>{E(v,e)},[E,e]),I=c.useCallback(({text:v})=>{var V,K,$,B;const R={bool:{must:[],must_not:[]}};console.log({text:v});let D={};v&&(D=v.startsWith("#")?{term:{"code.keyword":v.replace("#","")}}:{query_string:{query:`*${v}*`}},R.bool.must.push(D));const{projectId:A}=a||{};if(A&&R.bool.must.push({term:{"projectId.keyword":A}}),console.log({projectsRef:k}),(K=(V=k.current)==null?void 0:V.items)!=null&&K.length){const S=(B=($=k.current)==null?void 0:$.items)==null?void 0:B.map(M=>({term:{"projectId.keyword":M.id}}));R.bool.must_not.push(S)}return console.log({q:R}),R},[a]);return s.jsxs(j,{component:r?"div":Uo,maxWidth:r?"500px":"250px",children:[r?s.jsx(j,{children:"Tasks:"}):s.jsx(s.Fragment,{children:s.jsx(Le,{children:s.jsx(j,{p:2,children:s.jsx(ss,{member:m==null?void 0:m.user,withPosition:!0})})})}),s.jsxs(j,{children:[s.jsx(j,{...i&&{maxHeight:i,overflow:"auto"},children:s.jsxs(pt,{dense:!0,children:[h.values.map((v,R)=>v.task?s.jsxs(j,{border:"solid 1px grey",className:"atask-pnl",borderRadius:"5px",mb:1,children:[s.jsx("div",{style:{display:"flex",justifyContent:"flex-end",paddingTop:5,paddingRight:5},children:h!=null&&h.options&&R===h.idx?s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"outlined",size:"small",onClick:A=>{O(A,v),x(!0)},children:"Delete"}),s.jsx(j,{ml:1,alignSelf:"center",children:s.jsx(fe,{size:"small",children:s.jsx(wr,{onClick:()=>u(A=>({...A,options:!h.options,idx:R})),fontSize:"small"})})})]}):s.jsx(fe,{size:"small",children:s.jsx(as,{onClick:()=>u(A=>({...A,options:!h.options,idx:R})),fontSize:"small"})})}),s.jsx(Me,{className:"atask",button:!0,children:r?s.jsx(Tn,{task:v.task,maxWidth:"100%"}):s.jsx(qo,{task:v.task})},R)]},R):null),!r&&s.jsx(Me,{className:"adtask",button:!0,onClick:G,children:s.jsx("center",{children:s.jsx(Sn,{})})})]})}),r&&s.jsx(j,{mb:1,children:s.jsx(re,{size:"small",variant:"outlined",onClick:G,children:"➕ Add Leave"})})]}),s.jsx(we,{ref:f,anchorOrigin:{vertical:W?"bottom":"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:W&&s.jsxs(j,{p:1,pl:2,display:"flex",width:"350px",alignItems:"center",children:[s.jsx(Ko,{variant:"slim",model:"Task",label:"Search Task Title or Code(#)",fullWidth:!0,query:I,icon:Je,onChange:z,value:q(h,"selectedTaskOption._id")}),s.jsx(j,{ml:1,children:s.jsx(fe,{color:"primary",size:"small",onClick:H,children:s.jsx(fs,{})})})]})}),s.jsx(mn,{open:C,onClose:()=>x(!1),children:s.jsx(j,{p:2,children:s.jsxs(s.Fragment,{children:[s.jsx(ye,{children:"Are you sure you want to delete this task?"}),s.jsxs(j,{mt:2,display:"flex",justifyContent:"flex-end",children:[s.jsx(j,{mr:2,children:s.jsx(re,{color:"secondary",size:"small",onClick:()=>x(!1),children:"Cancel"})}),s.jsx(re,{color:"primary",variant:"contained",size:"small",onClick:P,children:"Confirm"})]})]})})})]})}const Ko=ke({opt:{padding:6,marginLeft:4,marginRight:4,cursor:"pointer","& > div":{fontSize:"small",opacity:.6}}})(({classes:e,...t})=>s.jsx(De,{...t,getOptionLabel:n=>{var r,a,o;return`${(r=n._source)!=null&&r.code?`(#${(a=n._source)==null?void 0:a.code})`:""} ${((o=n._source)==null?void 0:o.title)||""}`},renderOption:(n,r)=>s.jsx(Qo,{className:e.opt,data:r,props:n})}));function Qo({className:e,data:t,props:n}){var d,f,h,u;const r=(d=t._source)==null?void 0:d.projectId,a=(f=t._source)==null?void 0:f.code,o=(h=t._source)==null?void 0:h.title,i=wt(r),l={...n,className:e};return s.jsxs("div",{...l,children:[i&&s.jsx("div",{children:i.name}),((u=i==null?void 0:i.company)==null?void 0:u.name)&&s.jsx(j,{children:s.jsx(ye,{color:"textSecondary",variant:"caption",children:s.jsx("strong",{children:i.company.name||""})})}),s.jsxs("span",{children:[a&&s.jsxs("strong",{children:["#",a]})," ",o]})]})}const Un=X`
  query ($filter: SearchableTaskAssignmentFilterInput, $nextToken: String) {
    searchTaskAssignments(filter: $filter, nextToken: $nextToken, limit: 100) {
      nextToken
      items {
        id
        startTime
        userId
        user {
          id
          fullname
          profilePhoto
        }
        taskId
        task {
          id
          code
          title
          projectId
        }
      }
    }
  }
`,Yo=X`
  query SearchProjectsByFilter($filter: SearchableProjectFilterInput) {
    projects: searchProjects(filter: $filter) {
      items {
        id
        name
        status
      }
    }
  }
`;function Zo(e){const t=pe(),n=c.useCallback(async r=>{const{sourceAllocation:a,sourceAllocationAssignments:o=[]}=r,i=await t.mutate({mutation:X`
        mutation {
          deleteAllocation(input:{id: "${a.id}"}){
            id
          }
          ${o.reduce(function(l,d,f){return`
            ${l}
            d_${f}: deleteTaskAssignment(input:{id: "${d.id}"}){
              id
            }
            `},"")}
        }
        `});console.log(">>SchedGridActions/MoveAllocationForm::","data",i)},[t]);return s.jsx(Qn,{...e,formLabel:"Move",onSave:n})}const Kn=c.createContext();function Jo({onSelect:e,onClose:t,context:n,selectedCell:r}){const[a,o]=c.useState({mode:null}),i=c.useCallback(()=>{t&&t()},[t]);console.log(">>SchedGridActions/SchedGridCellOptions::","context",n,r);const l=c.useMemo(()=>{switch(a.mode){case oe.COPY_TO:return s.jsx(Qn,{onClose:i});case oe.MOVE_TO:return s.jsx(Zo,{onClose:i})}return null},[i,a.mode]);return s.jsx(Kn.Provider,{value:{context:n,selectedCell:r},children:s.jsxs(j,{children:[!a.mode&&s.jsxs(pt,{style:{padding:0},children:[s.jsx(Me,{button:!0,onClick:()=>{o(d=>({...d,mode:oe.MOVE_TO})),e(oe.MOVE_TO)},children:"Move to .."}),s.jsx(jr,{}),s.jsx(Me,{button:!0,onClick:()=>{o(d=>({...d,mode:oe.COPY_TO})),e(oe.COPY_TO)},children:"Copy to .."})]}),s.jsx(mn,{open:!!a.mode,onClose:i,children:l||s.jsx("div",{})})]})})}const je={Project:{icon:is,hasTasks:!0},Opportunity:{icon:ls}};function $t(e,t){return`${t}@@${e}`}function xe(e){var d,f,h,u;const{type:t,modelId:n}=c.useMemo(()=>{if(!e)return{};const[m,...g]=e.split("@@");return{type:m,modelId:g.join("@@")}},[e]),r=wt(t==="Project"&&n),a=be(Xo,{skip:We.capitalize(t)!=="Opportunity",variables:{id:n}}),o=(r==null?void 0:r.name)||((f=(d=a.data)==null?void 0:d.model)==null?void 0:f.name),i=(r==null?void 0:r.name)||((u=(h=a.data)==null?void 0:h.model)==null?void 0:u.name),l=r==null?void 0:r.color;if(e)return{id:n,type:t,display:o,name:i,filterKey:e,color:l,hasTasks:je[We.capitalize(t)].hasTasks}}const Xo=X`
  query GET_OPP_INFO($id: ID!) {
    model: getOpportunity(id: $id) {
      id
      name
    }
  }
`;function Mt(e,t){return e.filter(n=>{var r;return((r=n.task)==null?void 0:r.projectId)===t})}function Qn({formLabel:e="Copy",onClose:t,onSave:n}){const r=c.useContext(Kn),[a,o]=c.useState({memberId:null,date:null,saving:!1});console.log(">>SchedGridActions/CopyAllocationForm::","ctx",r);const{enqueueSnackbar:i}=bt(),l=xe(r.selectedCell.projectId),[d]=Ze({opts:{watch:!1,forceDelete:!0}}),f=`${r.selectedCell.columnKey}T00:00:00.000Z`,{data:h,loading:u}=be(Pt,{variables:{filter:{memberId:{eq:r.selectedCell.memberId},assignToId:{eq:l.id},assignType:{eq:l.type},date:{matchPhrasePrefix:f}},asgnFilter:{userId:{eq:r.selectedCell.memberId},startTime:{match:f}}},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),m=q(h,"searchAllocations.items[0]"),g=c.useMemo(()=>{const x=q(h,"searchTaskAssignments.items",[]);return Mt(x,m==null?void 0:m.assignToId)},[h,m]),y=c.useCallback(x=>{const w=x.currentTarget.value;o(k=>({...k,memberId:w}))},[]),b=c.useCallback(x=>{o(w=>({...w,date:x}))},[]),p=pe(),C=c.useCallback(async function(){const x=a.date,w=a.memberId;if(!x||!w)return;o(O=>({...O,saving:!0}));const{unit:k}=r.context,E=await ei({date:x,copyToMemberId:w,unit:k,apollo:p,deleteAllocFn:d,source:{allocation:m,assignments:g},projectInfo:l});console.log(">>SchedGridActions/CopyAllocationForm::","save",E),n&&await n({sourceAllocation:m,sourceAllocationAssignments:g}),r.context.reloadData(),i(`${e} successful!`,{variant:"success"}),t&&t()},[a.date,a.memberId,r.context,l,p,m,g,n,i,e,t,d]);return s.jsxs(j,{p:2,minWidth:"300px",children:[s.jsxs(ye,{children:[e," Allocation"]}),s.jsxs(j,{mt:2,children:[s.jsx(ye,{variant:"caption",children:"From"}),s.jsx(ms,{id:r.selectedCell.memberId,mt:1})]}),s.jsxs(j,{mt:1,children:[s.jsx(ye,{variant:"caption",children:"Date"}),s.jsx(j,{mt:1,children:s.jsx("label",{children:s.jsx("strong",{children:Re(new Date(r.selectedCell.columnKey),"E, LLL dd, yyyy")})})})]}),s.jsx(kr,{mt:1,mb:1}),s.jsxs(j,{children:[s.jsxs(ye,{variant:"caption",children:[e," To"]}),s.jsx(De,{value:a.memberId,variant:"slim",model:"User",fullWidth:!0,label:"Member",onChange:y}),s.jsx(In,{label:"Date",value:a.date,onChange:b})]}),!m&&!u&&s.jsx(j,{children:"Allocation not found!"}),s.jsxs(j,{mt:3,textAlign:"right",children:[s.jsx(re,{size:"small",color:"primary",variant:"contained",onClick:C,disabled:!m||u||a.saving,children:e})," ",s.jsx(re,{size:"small",variant:"outlined",onClick:t,children:"Cancel"})]})]})}async function ei({apollo:e,date:t,copyToMemberId:n,source:{allocation:r,assignments:a},deleteAllocFn:o,projectInfo:i}){const d=Ct(t).ceilISOString,f=await e.query({query:Pt,variables:{filter:{memberId:{eq:n},assignToId:{eq:i.id},assignType:{eq:i.type},date:{matchPhrasePrefix:d}},asgnFilter:{userId:{eq:n},startTime:{match:d}}},fetchPolicy:"network-only"}),[h,...u]=q(f,"data.searchAllocations.items",[]),m=h==null?void 0:h.id,g={...gs(gn(r,["__typename","id"])),date:d,memberId:n};m&&(g.id=m);const y=[],b=[];if(i.hasTasks){const x=Mt(q(f,"data.searchTaskAssignments.items",[]),r.assignToId),w=xt(x,"taskId");a.forEach(k=>{w[k.taskId]||y.push(k.taskId),delete w[k.taskId]}),b.push(...Object.values(w).map(k=>k.id))}const p=[];p.push(e.mutate({mutation:Yn({op:m?"update":"create",startDate:d,createTaskIds:y,deleteTaskAsgnIds:b,userId:n}),variables:{input:g}})),u&&u.length>0&&u.forEach(x=>{x!=null&&x.id&&p.push(o(x))});const[C]=await Promise.all(p);return C}const Yn=({op:e,userId:t,startDate:n,createTaskIds:r=[],deleteTaskAsgnIds:a=[]})=>{const o=`
  mutation ($input: ${pn(e)}AllocationInput!){
    ${e}Allocation(input: $input){
      id
    }
    ${r.reduce((i,l,d)=>`
        ${i}
        c_${d}:createTaskAssignment(input:{
          id: "${Gn({taskId:l,userId:t,startDate:n})}",
          userId: "${t}",
          taskId: "${l}",
          startTime: "${n}",
        }){
          id
        }
        `,"")}
    ${a.reduce((i,l,d)=>`
        ${i}
        d_${d}:deleteTaskAssignment(input:{
          id: "${l}",
        }){
          id
        }
        `,"")}
  }
`;return console.log(">>scheduler/SchedGridCellDetailsEditView::","m",o),X(o)},Pt=X`
  query(
    $filter: SearchableAllocationFilterInput
    $asgnFilter: SearchableTaskAssignmentFilterInput
  ) {
    searchAllocations(filter: $filter, limit: 25) {
      items {
        id
        memberId
        projectId
        assignToId
        assignType
        taskId
        duration
        date
      }
    }
    searchTaskAssignments(
      filter: $asgnFilter
      limit: 400
      sort: { field: createdAt, direction: desc }
    ) {
      items {
        id
        taskId
        task {
          id
          projectId
        }
      }
    }
  }
`;Ce({root:{display:"flex",alignItems:"flex-start","& > div":{marginRight:20,minWidth:200}},moreBtn:{alignSelf:"center",minWidth:"100px"}});c.createContext();Ce(()=>({root:{"& .rdg-viewport":{height:"100% !important"},"& .rdg-row":{backgroundColor:"#fff",marginBottom:20,"& span":{verticalAlign:"top"},"& .adtask":{textAlign:"center"}},"& .rdg-row:hover":{backgroundColor:"#fff"}}}));function ti(e){return s.jsx(ze,{...e,width:"18",height:"17",viewBox:"0 0 18 17",paths:["M15.6667 5.1665V2.6665H14V3.49984H12.3333V2.6665H5.66667V3.49984H4V2.6665H2.33333V5.1665H15.6667ZM15.6667 6.83317H2.33333V15.1665H15.6667V6.83317ZM14 0.999837H15.6667C16.5871 0.999837 17.3333 1.74603 17.3333 2.6665V15.1665C17.3333 16.087 16.5871 16.8332 15.6667 16.8332H2.33333C1.41286 16.8332 0.666667 16.087 0.666667 15.1665V2.6665C0.666667 1.74603 1.41286 0.999837 2.33333 0.999837H4V0.166504H5.66667V0.999837H12.3333V0.166504H14V0.999837ZM6.5 10.1665H4.83333V8.49984H6.5V10.1665ZM9.83333 10.1665H8.16667V8.49984H9.83333V10.1665ZM13.1667 10.1665H11.5V8.49984H13.1667V10.1665ZM6.5 13.4998H4.83333V11.8332H6.5V13.4998ZM9.83333 13.4998H8.16667V11.8332H9.83333V13.4998Z"]})}const Zn=c.createContext({}),ni=c.forwardRef(({children:e,...t},n)=>{const r=c.useRef(null);return s.jsx(we,{variant:"popover",ref:n,popoverProps:{...t,action:r},children:s.jsx(Zn.Provider,{value:{popoverRef:r},children:e})})});var Lt={},ri=ge;Object.defineProperty(Lt,"__esModule",{value:!0});var Jn=Lt.default=void 0,si=ri(me()),ai=s;Jn=Lt.default=(0,si.default)((0,ai.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckBox");var zt={},oi=ge;Object.defineProperty(zt,"__esModule",{value:!0});var Xn=zt.default=void 0,ii=oi(me()),li=s;Xn=zt.default=(0,ii.default)((0,li.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"CheckBoxOutlineBlank");function er(e,t){let n,r;const o=e.filter(l=>Vr(new Date(l))).sort(),i=[];return o.forEach(l=>{const d=new Date(l)-new Date(n);n&&d<=864e5?Bt(i).push(l):i.push([l]),n=l;const f=Bt(i);f&&f.includes(t)&&(r=f)}),r||[t]}function ci({editorRef:e,selectedCell:t,deleting:n=!1,context:r}){const[a,o]=c.useState({allocDates:[],selectedTaskIds:[]}),[i,l]=c.useState({projectId:t.projectId,memberId:t.memberId});console.log(">>scheduler/SchedGridCellDetailsEditView::qqqWWW","selectedCell",t,r);const{setting:d}=r,{allocationDetail:f,columnKey:h}=t;c.useEffect(()=>{const C=Object.keys(f);o(x=>({...x,allocDates:er(C,h)}))},[f,h]),e.current.saveAllocFn={},e.current.save=c.useCallback(async()=>{console.log(">>scheduler/SchedGridCellDetailsEditView::","editorRef.current.saveAllocFn",e.current.saveAllocFn);const{saveAllocFn:C}=e.current,x=await ae.map(Object.values(C),w=>w());return console.log(">>scheduler/SchedGridCellDetailsEditView::","res",x),!0},[e]),e.current.setAllocValueFn={},e.current.setValueToAll=c.useCallback((C,x)=>{const{setAllocValueFn:w}=e.current;Object.values(w).forEach(k=>{k(C,x)})},[e]);const u=c.useCallback(C=>{const x=C.currentTarget.value;l(w=>({...w,memberId:x}))},[]),m=c.useCallback(C=>{const x=C.currentTarget.value;l(w=>({...w,projectId:x}))},[]),g=c.useContext(Zn);console.log(">>scheduler/SchedGridCellDetailsEditView::","poCtx",g);const y=c.useCallback(()=>{o(C=>{const{allocDates:x}=C,w=x==null?void 0:x.length;if(w<1)return C;const k=Ye(new Date(x[w-1]),1);return{...C,allocDates:[...x,k.toISOString().substring(0,10)]}}),ae.delay(300).then(()=>{var x,w;const C=(w=(x=g.popoverRef)==null?void 0:x.current)==null?void 0:w.updatePosition;C&&C()})},[g]),b=c.useCallback(C=>{o(x=>({...x,selectedTaskIds:rs(C.map(w=>w.task.id))}))},[]),p=xe(i.projectId);return s.jsxs(j,{maxWidth:"300px",children:[!n&&s.jsxs(s.Fragment,{children:[s.jsx(De,{value:i.memberId,variant:"slim",model:"User",fullWidth:!0,readOnly:!0,label:"Team Member",onChange:u}),s.jsx(De,{variant:"slim",model:p.type,label:p.type,value:p.id,readOnly:!0,fullWidth:!0,onChange:m}),h&&p.type==="Project"&&s.jsx(qn,{userId:i.memberId,date:new Date(h),persist:!1,compact:!0,filters:{projectId:p.id},onTasksChanged:b,maxListHeight:"200px"})]}),s.jsxs(j,{children:[n?"Select dates to delete":"Dates",":",s.jsx(di,{scroll:a.allocDates.length>4,children:a.allocDates.map(C=>s.jsx(hi,{date:C,value:f[C]||(d==null?void 0:d.defaultAllocDuration)||0,groupIds:i,taskIds:a.selectedTaskIds,unit:r.unit,editorRef:e,readOnly:n,onSelect:n?()=>{}:void 0},C))})]}),!n&&s.jsx(ui,{onClick:y})]})}const di=ke({root:e=>({maxHeight:"200px",overflowY:e.scroll?"auto":"hidden"})})(({classes:e,children:t})=>s.jsx("div",{className:e.root,children:t})),ui=ke({root:{height:0,"& button":{marginTop:16}}})(({classes:e,...t})=>s.jsx("div",{className:e.root,children:s.jsx(re,{...t,size:"small",variant:"outlined",children:"➕ Add Date"})})),fi=Ce({root:{display:"flex",justifyContent:"space-between",alignItems:"center","& input":{height:14}},date:{marginRight:5,height:47},value:{marginRight:5,height:47},valueDeleted:{opacity:1},deselected:{opacity:.3},actionBtns:{marginTop:3,"& svg":{width:20,height:20},"& button":{color:"inherit"}}});function hi({editorRef:e,groupIds:{memberId:t,projectId:n,taskId:r},taskIds:a,readOnly:o,date:i,value:l,onSelect:d}){const[f,h]=c.useState({date:i,value:l,saving:!1,saved:!1,selected:!0}),u=fi(),[m]=Ze({opts:{watch:!1,forceDelete:!0}}),g=pe(),y=xe(n);e.current.setAllocValueFn[i]=c.useCallback((x,w={})=>{w.selectedOnly&&!f.selected||h(k=>({...k,value:Number(x)}))},[f.selected]),e.current.saveAllocFn[i]=c.useCallback(async()=>{h(A=>({...A,saving:!0}));const x=f.value,w=f.date,k=`${w}T00:00:00.000Z`,E=y.type,O=y.id,z=await g.query({query:Pt,variables:{filter:{memberId:{eq:t},assignType:{eq:E},assignToId:{eq:O},date:{matchPhrase:w}},asgnFilter:{userId:{eq:t},startTime:{match:k}}},fetchPolicy:"network-only"});console.log(">>scheduler/SchedGridCellDetails::","res",z);const[H,...P]=q(z,"data.searchAllocations.items",[]),W=H==null?void 0:H.id,G={memberId:t,assignType:E,assignToId:O,taskId:r,duration:x,date:k};W&&(G.id=W),console.log(">>scheduler/SchedGridCellDetailsEditView::","res",t,k,z);const I=[],v=[];if(y.hasTasks){const A=xt(Mt(q(z,"data.searchTaskAssignments.items",[]),y.id),"taskId");a.forEach(V=>{A[V]||v.push(V),delete A[V]}),I.push(...Object.values(A).map(V=>V.id)),console.log(">>scheduler/SchedGridCellDetailsEditView::","deleteTaskIds,createTaskIds",A,I,v)}const R=[];R.push(g.mutate({mutation:Yn({op:W?"update":"create",startDate:k,createTaskIds:v,deleteTaskAsgnIds:I,userId:t}),variables:{input:G}})),console.log(">>scheduler/SchedGridCellDetails::","duplicates",P),P&&P.length>0&&P.forEach(A=>{A!=null&&A.id&&R.push(m(A))});const[D]=await ae.all(R);console.log(">>scheduler/SchedGridCellDetails::","save",D),h(A=>({...A,saving:!1,saved:!0}))},[f.value,f.date,g,t,y,r,a,m]);const b=c.useCallback(function(x){const w=Ct(x);h(k=>({...k,date:w.dateCeil}))},[]),p=c.useCallback(function(x){const w=x.target.value;h(k=>({...k,value:Number(w)}))},[]),C=c.useCallback(()=>{if(f.saving||f.saved)return;const x=f.value>0?0:1;p({target:{value:x}})},[p,f.saved,f.saving,f.value]);return s.jsxs("div",{className:`${u.root} ${f.value<1?u.valueDeleted:""} ${f.selected?"":u.deselected}`,children:[s.jsx("div",{className:u.date,children:s.jsx(In,{value:new Date(f.date),readOnly:o,label:"",onChange:b})}),s.jsx(j,{className:u.value,sx:{"& input":{minHeight:"18px"}},children:s.jsx(vt,{margin:"dense",variant:"outlined",onChange:p,value:f.value,size:"small",inputProps:{disabled:o,step:1,min:0,max:999,type:"number"}})}),!!d&&s.jsx(j,{className:u.actionBtns,children:s.jsx(fe,{size:"small",onClick:()=>{h(x=>{const w=!x.selected;return d(w),{...x,selected:w}})},children:f.selected?s.jsx(Jn,{}):s.jsx(Xn,{})})}),!o&&s.jsx(j,{className:u.actionBtns,color:f.saving&&"brown"||f.saved&&"green"||"red",children:s.jsx(fe,{size:"small",onClick:C,children:f.saving&&s.jsx(At,{})||f.saved&&s.jsx(Wn,{})||s.jsx(Ue.DeleteIcon,{})})})]})}var Nt={},mi=ge;Object.defineProperty(Nt,"__esModule",{value:!0});var qe=Nt.default=void 0,gi=mi(me()),sn=s;qe=Nt.default=(0,gi.default)([(0,sn.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,sn.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"Schedule");function pi({selectedCell:e,context:t}){const[n,r]=c.useState({schedCurrent:null,schedStart:null,schedEnd:null,schedDates:[],totalHr:0}),{allocationDetail:a,columnKey:o}=e,i=xe(e.projectId);c.useEffect(()=>{let m=0;console.log(">>scheduler/SchedGridCellDetailsReadView::","allocationDetail",a);const g=er(Object.keys(a||{}),o);if(!g||g.length<1)return;const[y]=g,b=g[g.length-1];g.forEach(p=>{m+=a[p]}),r(p=>({...p,totalHr:m,schedCurrent:Re(new Date(o),"LLL dd, yyyy"),schedStart:Re(new Date(y),"LLL dd, yyyy"),schedEnd:Re(new Date(b),"LLL dd, yyyy"),schedDates:g}))},[a,o]);const{totalHr:l,schedStart:d,schedEnd:f,schedCurrent:h}=n,u=be(vi,{variables:{id:e.memberId},skip:!(e!=null&&e.memberId)});return console.log(">>scheduler/SchedGridCellDetails::","memberInfo",u),console.log(">>scheduler/SchedGridCellDetailsReadView::","projectTypeInfo",i),s.jsxs(s.Fragment,{children:[s.jsx(ye,{variant:"overline",children:"Allocation"}),s.jsxs(j,{display:"flex",alignItems:"center",mt:1,children:[s.jsx(j,{component:q(je,[i==null?void 0:i.type,"icon"])}),s.jsxs(j,{ml:1,height:"32px",display:"flex",alignItems:"center",children:[i.type==="Project"&&s.jsx(Rn,{id:i.id}),i.type==="Opportunity"&&s.jsx(xs,{opportunity:i})]})]}),s.jsxs(j,{mt:1,mb:1,display:"flex",alignItems:"center",children:[s.jsx(j,{component:On}),s.jsx(j,{ml:1,children:h})]}),s.jsxs(j,{mt:1,mb:1,display:"flex",alignItems:"center",children:[s.jsx(j,{component:qe,mr:1}),e.value||0,s.jsx(j,{ml:1,children:"h"})]}),q(je,[i==null?void 0:i.type,"hasTasks"])&&s.jsxs(j,{mt:1,mb:1,display:"flex",alignItems:"center",children:[s.jsx(j,{component:Je,mr:1}),s.jsx(xi,{projectId:i.id,memberId:e.memberId,schedDates:n.schedDates,currentDate:o,unit:t.unit})]}),s.jsx(ye,{variant:"overline",children:"Allocation Group"}),s.jsxs(j,{mt:1,mb:1,display:"flex",alignItems:"center",children:[s.jsx(j,{component:xn}),s.jsx(j,{ml:1,children:d===f?d:`${d} - ${f}`})]}),s.jsxs(j,{mt:1,mb:1,display:"flex",alignItems:"center",children:[s.jsx(j,{component:qe,mr:1}),l||"0",s.jsx(j,{ml:1,children:"h"})]})]})}function xi({memberId:e,currentDate:t,projectId:n}){const r=c.useMemo(()=>({...Vn(new Date(t)),userId:{eq:e}}),[t,e]),{data:a}=be(Un,{variables:{filter:r},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});return c.useMemo(()=>{let o=0;return q(a,"searchTaskAssignments.items",[]).forEach(i=>{o+=q(i,"task.projectId")===n?1:0}),s.jsxs("span",{children:[o," task",o>1&&"s"]})},[a,n])}const vi=X`
  query($id: ID!) {
    getUser(id: $id) {
      id
      fullname
      profilePhoto
    }
  }
`;function yi({context:e,selectedCell:t}){const n=c.useRef(null),r=t==null?void 0:t.mode,[a,o]=c.useState({loading:!1,editing:Number((t==null?void 0:t.value)||0)<1||r===oe.DUPLICATE,deleting:r===oe.DELETE});console.log(">>scheduler/SchedGridCellDetails::","context,selectedCell",e,t);const{deleting:i,editing:l,loading:d}=a,f=c.useRef({}),h=xe(t.projectId),u=c.useCallback(()=>{o(p=>({...p,editing:!p.editing}))},[]),m=c.useCallback(async()=>{if(!f.current.save)return;o(C=>({...C,loading:!0})),await f.current.save()&&e.closeDetailsPopper({reloadAll:!0}),o(C=>({...C,loading:!1}))},[e]),g=c.useCallback(()=>{f.current.setValueToAll&&(f.current.setValueToAll(0,{selectedOnly:!0}),ae.delay(500).then(()=>{m()}))},[m]),y=c.useCallback(p=>{console.log(">>scheduler/SchedGridCellDetails::","e.currentTarget",t),n.current.open(p.currentTarget)},[t]),b=!i&&l;return s.jsxs(j,{p:2,borderTop:`solid 10px ${(h==null?void 0:h.color)||"lightgrey"}`,minWidth:"250px",children:[l||i?s.jsx(ci,{deleting:i,context:e,editorRef:f,selectedCell:t}):s.jsx(pi,{selectedCell:t,context:e}),s.jsxs(j,{mt:2,display:"flex",justifyContent:b||i?"flex-end":"space-between",children:[s.jsx(j,{display:"flex",children:b&&s.jsxs(s.Fragment,{children:[s.jsx(re,{size:"small",variant:"contained",color:"primary",onClick:m,disabled:d,children:"Save"}),s.jsx(j,{mr:1}),s.jsx(re,{size:"small",variant:"outlined",onClick:u,disabled:d,children:l?"Cancel":"Edit"})]})}),i&&s.jsxs(s.Fragment,{children:[s.jsx(re,{size:"small",variant:"outlined",onClick:()=>o(p=>({...p,deleting:!1})),disabled:d,children:"Cancel"}),s.jsx(j,{width:5}),s.jsx(re,{size:"small",variant:"outlined",onClick:g,color:"secondary",disabled:d,children:"Confirm Delete"})]}),!i&&!l&&e.allowEdit&&s.jsxs(j,{children:[h.hasTasks&&s.jsx(ft,{icon:Je,title:"Update Tasks",onClick:y})," ",s.jsx(ft,{icon:Ue.DuplicateIcon,title:"Options",onClick:p=>{e.onCellClicked&&e.onCellClicked(p,{...t,mode:oe.SHOW_OPTIONS})}})," ",s.jsx(ft,{icon:Ue.DeleteIcon,color:"secondary",title:"Delete",onClick:()=>o(p=>({...p,deleting:!0}))})]})]}),s.jsx(we,{ref:n,variant:"dialog",dialogProps:{maxWidth:"sm"},children:t&&s.jsx(qn,{userId:t.memberId,date:new Date(t.columnKey),filters:{projectId:h.id}})})]})}const ft=ke({root:{minWidth:50,padding:5,"& svg":{height:20,width:20}}})(({classes:e,icon:t,...n})=>s.jsx(re,{...n,className:e.root,size:"small",variant:"outlined",children:s.jsx(t,{})})),bi=e=>X`
  mutation ($input: ${pn(e)}AllocationInput!){
    ${e}Allocation(input: $input){
      id
    }
  }
`,Ci=X`
  query ($filter: SearchableAllocationFilterInput) {
    searchAllocations(filter: $filter, limit: 25) {
      items {
        id
        date
        duration
        unit
      }
    }
  }
`,Xe=c.createContext(),tr=c.createContext();function wi({children:e,onResizeStart:t,onResizing:n,onResizeFinish:r}){const a=c.useRef({data:{}});a.current.onResizeStart=t,a.current.onResizing=n,a.current.onResizeFinish=r;const[o,i]=c.useState({resizing:!1}),l=c.useCallback(()=>{i(u=>u.resizing?(a.current.onResizeFinish(a.current.data),{...u,resizing:!1}):u)},[]);c.useEffect(()=>{o.resizing||window.removeEventListener("mouseup",l)},[l,o.resizing]);const d=c.useCallback(u=>{const m=u.target,g=m.className||"";let y;g.includes("rzrR")?y="right":g.includes("rzrL")&&(y="left"),a.current.data={direction:y,element:m,startCellKey:m.getAttribute("name")},a.current.onResizeStart(a.current.data),i(b=>b.resizing?b:(window.addEventListener("mouseup",l),{...b,resizing:!0}))},[l]),f=c.useCallback(jn(function(u){const m=u;a.current.data.element=m,a.current.data.currentCellKey=m.getAttribute("name"),a.current.onResizing(a.current.data)},100),[]),h=c.useCallback(u=>{const m=u.target;f(m)},[f]);return s.jsx(tr.Provider,{value:{...o,handleStartResize:d,handleMouseEnter:h},children:e})}const ji=ke({rzrBlock:{right:0,left:0,height:40,position:"absolute","& > div":{width:80,height:40,margin:"0 auto"}},rzrR:{right:0,width:5,height:40,position:"absolute",cursor:"w-resize"},rzrL:{left:0,width:5,height:40,position:"absolute",cursor:"w-resize"}})(function({cellKey:e,classes:t,canResizeLeft:n,canResizeRight:r}){const{handleStartResize:a,handleMouseEnter:o,resizing:i}=c.useContext(tr);return s.jsx(s.Fragment,{children:i?s.jsx("div",{className:t.rzrBlock,children:s.jsx("div",{name:e,onMouseEnter:o})}):s.jsxs(s.Fragment,{children:[n&&s.jsx("div",{name:e,className:t.rzrL,onMouseDown:a}),r&&s.jsx("div",{name:e,className:t.rzrR,onMouseDown:a})]})})}),Ue={DeleteIcon:Dn,DuplicateIcon:Bn},oe={DELETE:"DELETE",DUPLICATE:"DUPLICATE",SHOW_OPTIONS:"SHOW_OPTIONS",COPY_TO:"COPY_TO",MOVE_TO:"MOVE_TO"},nr=Ce({projectHr:{cursor:"pointer","& .pName":{textOverflow:"ellipsis",overflow:"hidden auto",height:"25px",paddingTop:"5px",paddingLeft:"10px",textAlign:"left",fontSize:"smaller"},"& .pName:hover":{fontWeight:"bold"},"&:hover":{backgroundColor:"#ececec",borderRadius:10},"& .MuiTextField-root":{padding:0,margin:0},"& input":{textAlign:"center"},"& .ht:hover":{backgroundColor:"rgba(255, 255, 255, 0.5)"}},barControls:{float:"right",padding:5,paddingBottom:0,"& > span":{marginLeft:5},"& > span > svg":{width:15,height:15,cursor:"pointer",opacity:.6},"& > span > svg:hover":{opacity:1}},emptyBox:{width:"100%",display:"flex",justifyContent:"center",color:"#5f5f5f",opacity:.2,"&:hover":{opacity:1}}});function an(e){const[t,n]=e,r=t>0?0:10,a=n>0?0:10;return`${r}px ${a}px ${a}px ${r}px`}function ki(e){const{context:t}=c.useContext(se),{details:n}=c.useContext(Xe),{column:{key:r},row:a}=e,{getSideValues:o}=t,i=e.row[r];let l,d;const f=!t.projectInfo,h={},u=r!=="resource";i&&u&&(l=q(t,"projectInfo.color")||"#FA126C",d="white");const m={allocationDetail:a};if(!!l){const[b,p]=o(a,r);if(h.borderRadius=an([b,p]),console.log(">>scheduler/SchedGridCellRenderer::","row",a),m.isHead=!b,m.isTail=!p,f){let C="";b&&p?C+=` ${t.classes.cellGradientCenter}`:(b||(C+=` ${t.classes.cellGradientStart}`),b&&!p&&(C+=` ${t.classes.cellGradientEnd}`)),h.className=C,h.color="white",h.onClick=a._expand}}const y=c.useMemo(()=>{if(!n||!r||!f)return null;const b=[];for(const p in n){const C=n[p];let x=C[r];const w=o(C,r),k=an(w),E=!w[0],O=!w[1];x||(x=null),b.push(s.jsx(on,{columnKey:r,memberId:a.id,projectId:p,styles:{borderRadius:k},value:x,isHead:E,isTail:O,allocationDetail:C},p))}return b},[n,r,f,o,a.id]);return s.jsx(Hn,{...e,isSummaryRow:!0,children:u?s.jsxs(s.Fragment,{children:[f?s.jsx(rr,{color:l,styles:h,value:i,showEmpty:!1}):s.jsx(on,{memberId:a.id,projectInfo:t.projectInfo,columnKey:r,styles:h,value:i,...m}),y]}):s.jsx(j,{height:"100%",color:d,children:i||""})})}const on=({projectId:e,projectInfo:t,styles:n,columnKey:r,memberId:a,value:o,isHead:i,isTail:l,allocationDetail:d})=>{const f=`${e}:::${r}`,h=c.useRef({}),u=c.useRef(null),[m,g]=c.useState({editing:!1,hovered:!1}),[y,b]=c.useState(o),{updateDetails:p}=c.useContext(Xe),C=nr(),x=xe(e),w=t||x,k=w.filterKey,{context:{onCellClicked:E,updateRowValue:O,allowEdit:z}}=c.useContext(se);c.useEffect(()=>{b(o)},[o]);const H=c.useMemo(()=>({columnKey:r,memberId:a,projectId:k,value:y,allocationDetail:d,onUpdate(V){const K=Number(V)-Number(y);O(a,r,$=>($||0)+K),b(V),p($=>Er($,[k,r],Number(V)))}}),[r,a,k,y,O,d,p]),P=(w==null?void 0:w.color)||"#d3d3d3",W=(w==null?void 0:w.name)||"--";let G=y&&Number(y)>0;G===0&&(G=void 0);const I=c.useCallback(V=>K=>{const $={current:u.current,currentTarget:u.current};E&&E(G?$:K,{...H,mode:V}),K.stopPropagation()},[G,E,H]),v=c.useCallback(V=>{if(V.stopPropagation(),!z)return;const K=Date.now(),$=h.current.lastClick||K,B=K-$;if(B===0||B>1e3){h.current.lastClick=K;return}h.current.lastClick=K,g(S=>S.editing?S:{...S,editing:!0})},[z]),R=c.useCallback(()=>{g(V=>({...V,editing:!1}))},[]),D=c.useCallback(V=>()=>{g(K=>({...K,hovered:V}))},[]),A={cellKey:f,canResizeLeft:G&&i,canResizeRight:G&&l};return s.jsx(rr,{className:C.projectHr,color:P,onClick:I(null),onMouseEnter:D(!0),onMouseLeave:D(!1),resizer:A,children:G&&s.jsxs(j,{...n,ref:u,lineHeight:1,width:"100%",height:"45px",bgcolor:P,children:[m.hovered&&z&&s.jsxs(j,{className:C.barControls,children:[s.jsx("span",{title:"Options",onClick:I(oe.SHOW_OPTIONS),children:s.jsx(Ue.DuplicateIcon,{})})," ",s.jsx("span",{title:"Delete Allocation",onClick:I(oe.DELETE),children:s.jsx(Dn,{})})]}),i?s.jsx(j,{className:"pName",children:W}):s.jsx(j,{height:"25px"}),s.jsx(j,{className:z?"ht":"",onClick:v,children:m.editing?s.jsx(Ei,{onDone:R,selectedCell:H,cachedValue:y}):s.jsxs(j,{children:[y," h"]})})]})})};function Ei({cachedValue:e,selectedCell:t,onDone:n}){const[r,a]=c.useState({loading:!1}),o=c.useRef(null),i=e,{context:l}=c.useContext(se),d=pe(),[f]=Ze({opts:{watch:!1,forceDelete:!0}}),h=xe(t.projectId);c.useEffect(()=>{ae.delay(200).then(()=>o.current.focus())},[]);const u=c.useCallback(async()=>{const y=o.current.value;if(i===y)return;a(W=>({...W,loading:!0}));const{columnKey:b,memberId:p}=t,C=h.type,x=h.id,w=await d.query({query:Ci,variables:{filter:{memberId:{eq:p},assignType:{eq:C},assignToId:{eq:x},date:{matchPhrasePrefix:b}}},fetchPolicy:"network-only"});console.log(">>scheduler/SchedGridCellDetails::","res",w);const[k,...E]=q(w,"data.searchAllocations.items",[]),O=k==null?void 0:k.id,z={memberId:p,assignType:C,assignToId:x,duration:y,date:`${b}T00:00:00.000Z`};O&&(z.id=O);const H=[];H.push(d.mutate({mutation:bi(O?"update":"create"),variables:{input:z}})),E&&E.length>0&&(console.log(">>scheduler/SchedGridCellDetails::","duplicates",E),E.forEach(W=>{W&&H.push(f(W))}));const[P]=await ae.all(H);ae.delay(1500).then(()=>{l.onAllocationUpdated()}),t.onUpdate(y),console.log(">>scheduler/SchedGridCellDetails::","save",P),l.closeDetailsPopper()},[d,t,i,l,f,h]),m=c.useCallback(async()=>{await u(),n()},[u,n]),g=c.useCallback(y=>{y.keyCode===13&&m()},[m]);return s.jsx(vt,{inputRef:o,margin:"dense",variant:"outlined",onBlur:m,onKeyDown:g,inputProps:{defaultValue:e,disabled:r.loading,step:1,min:0,max:999,type:"number"}})}function rr({color:e,styles:t,value:n,className:r,onClick:a,onMouseEnter:o,onMouseLeave:i,children:l,showEmpty:d=!0,resizer:f}){const{context:{theme:h,allowEdit:u}}=c.useContext(se),m={className:r,height:or,display:"flex",alignItems:"center",onClick:a,onMouseEnter:o,onMouseLeave:i};e&&(m.color=h.palette.getContrastText(e));let g;return l?g=l:n?g=s.jsx(j,{width:"100%",paddingTop:"2px",lineHeight:1,bgcolor:e,fontWeight:"bold",height:"20px",...t,children:n?`${n} h`:""}):d&&u?g=s.jsx(Ti,{}):(g=null,delete m.onClick),s.jsxs(j,{...m,children:[u&&s.jsx(ji,{...f||{}}),g]})}function Ti(){const e=nr();return s.jsx("div",{className:e.emptyBox,height:"100%",children:s.jsx(Sn,{})})}const Si="35px";ur("div")({"& > .rdg-cell":{overflow:"visible",zIndex:99,background:"none !important"},"& > .rdg-cell > button":{height:Si,borderRadius:"12px"},"& .MuiAvatar-root":{height:20,width:20}});ke(e=>({tooltip:{backgroundColor:"#f5f5f9",color:"rgba(0, 0, 0, 0.87)",maxWidth:220,fontSize:e.typography.pxToRem(12),border:"1px solid #dadde9"}}))(Ke);function Ii({filter:e,...t}){return s.jsx(j,{sx:{"& div > div":{marginTop:"5px"},"& div > div > div":{marginTop:"5px"}},children:s.jsx(cs,{...t,format:vs,InputAdornmentProps:{position:"start"},InputProps:{startAdornment:s.jsx(vn,{position:"start",children:s.jsx(j,{color:"lightgrey",component:ti})})},renderDay:(n,r,a)=>{const o={};return e(n,r,a)||(o.disabled=!0),s.jsx(ts,{...a,...o})}})})}Ce({root:{marginBottom:20,"& .rdg-root .rdg-cell":{textAlign:"center",padding:0}}});function Ri({date:e}){const[t,n]=Re(e,"LLL dd, yyyy|||E").split("|||");return s.jsxs(j,{lineHeight:1,marginTop:"15px",children:[s.jsx(j,{fontWeight:"normal",children:n.toUpperCase()}),s.jsx(j,{fontSize:"smaller",mt:1,children:t})]})}X`
  query FETCH_TASK_TIMELINE(
    $filter: SearchableTaskAssignmentFilterInput
    $nextToken: String
  ) {
    searchTaskAssignments(
      filter: $filter
      nextToken: $nextToken
      limit: 25
      sort: { field: startTime, direction: asc }
    ) {
      nextToken
      items {
        id
        startTime
        userId
        user {
          id
          fullname
          profilePhoto
          position
        }
        task {
          id
          code
          title
          project {
            id
            name
            color
          }
        }
      }
    }
  }
`;const mt="subrow::";function Di({subRowId:e}){const t=xe(We.capitalize(e)),n=t==null?void 0:t.display;return s.jsxs(j,{textAlign:"left",paddingLeft:"40px",display:"flex",alignItems:"center",name:`${mt}${e}`,children:[s.jsx(j,{component:je[We.capitalize(t.type)].icon,mr:1,color:(t==null?void 0:t.color)||"lightgrey",onMouseEnter:r=>r.stopPropagation()}),s.jsx(j,{textOverflow:"ellipsis",overflow:"hidden auto",width:"150px",children:n||"--"})]})}function _i({data:e,source:t,context:n}){const[r,a]=c.useState({colByKeys:{},totalAllocations:null,totalHrs:null,taskCount:null});c.useEffect(()=>{a(i=>{const l=xt(n.columns,"key");return delete l.resource,{...i,colByKeys:l}})},[n.columns]),c.useEffect(()=>{let i=0,l=0;Object.entries(e.rowData).forEach(d=>{const[f,h]=d;r.colByKeys[f]&&(l+=h,i++)}),a(d=>({...d,totalAllocations:i,totalHrs:l}))},[e.rowData,r.colByKeys]);const o=pe();return yn(async i=>{var b,p;if(Qe(r.colByKeys)||!t||!(e!=null&&e.rowData))return;const l=e.memberId;let d,f,h;if(t){const C=t.getAttribute("name");C&&C.startsWith(mt)&&([f,d]=C.replace(mt,"").split("@@"))}const u=Object.keys(r.colByKeys),m=await o.query({query:X`
          query {
            ${Be({q:{index:"taskassignment",body:{size:0,query:{bool:{must:[{term:{"userId.keyword":l}},{range:{startTime:{gte:Gr(new Date(u[0])),lte:qr(new Date(u[u.length]))}}}]}},aggs:{per_tasks:{terms:{field:"taskId.keyword"}}}}}})}
          }
        `,fetchPolicy:"cache-first"}),g=JSON.parse(((b=m.data)==null?void 0:b.q)||"{}");if(!i())return;const y=q(g,"aggregations.per_tasks.buckets",[]);if(h=y.length,f==="Project"){const C=await o.query({query:X`
            query {
              ${Be({q:{index:"task",body:{size:0,query:{bool:{must:[{term:{"projectId.keyword":d}},{bool:{should:y.map(w=>({term:{"id.keyword":w==null?void 0:w.key}}))}}]}}}}})}
            }
          `,fetchPolicy:"cache-first"}),x=JSON.parse(((p=C.data)==null?void 0:p.q)||"{}");h=q(x,"hits.total",0)}i()&&a(C=>({...C,taskCount:h}))},[o,e,t,r.colByKeys]),s.jsx(Le,{children:s.jsxs(j,{p:2,children:[s.jsxs(j,{display:"flex",alignItems:"center",children:[s.jsx(j,{component:xn}),s.jsxs(j,{ml:1,children:[r.totalAllocations||"--"," allocations"]})]}),s.jsxs(j,{display:"flex",mt:1,alignItems:"center",children:[s.jsx(j,{component:qe}),s.jsxs(j,{ml:1,children:[r.totalHrs||"--"," h"]})]}),s.jsxs(j,{display:"flex",mt:1,alignItems:"center",children:[s.jsx(j,{component:Je}),s.jsxs(j,{ml:1,children:[r.taskCount||"--"," tasks"]})]})]})})}function Ai({context:e,summaryRef:t}){const[n,r]=c.useState({data:null,source:null}),a=c.useRef(null);return t.current.open=c.useCallback((o,i)=>{console.log(">>scheduler/SchedGridRowSummary::","data",i,o),a.current.open(o),r(l=>({...l,data:i,source:o}))},[]),t.current.close=c.useCallback(()=>{a.current.close()},[]),s.jsx(we,{variant:"popper",ref:a,popperProps:{placement:"right-start"},children:s.jsx(_i,{data:n.data,source:n.source,context:e})})}function Oi(){return{"& .sched-usr-row-hrs ":{marginLeft:5,backgroundColor:"#888888",padding:"2px 3px",fontSize:"smaller",borderRadius:3,color:"white",display:"inline-block"}}}function $i({userId:e}){var a;let t=0;const{context:{aggregations:n}}=c.useContext(se),r=n.current?n.current.find(o=>o.key===e):null;return r&&(t=(((a=r.group_by_period)==null?void 0:a.buckets)||[]).map(d=>d.sum_now.value).reduce((d,f)=>d+f,0)),t<1?null:s.jsx("span",{className:"sched-usr-row-hrs",children:t})}function Mi(e){return s.jsx(ze,{...e,width:"24px",height:"24px",viewBox:"0 0 24 24",paths:["M18.5 3.5L20.5 5.5L5.5 20.5L3.5 18.5L18.5 3.5M7 4C8.66 4 10 5.34 10 7C10 8.66 8.66 10 7 10C5.34 10 4 8.66 4 7C4 5.34 5.34 4 7 4M17 14C18.66 14 20 15.34 20 17C20 18.66 18.66 20 17 20C15.34 20 14 18.66 14 17C14 15.34 15.34 14 17 14M7 6C6.45 6 6 6.45 6 7C6 7.55 6.45 8 7 8C7.55 8 8 7.55 8 7C8 6.45 7.55 6 7 6M17 16C16.45 16 16 16.45 16 17C16 17.55 16.45 18 17 18C17.55 18 18 17.55 18 17C18 16.45 17.55 16 17 16Z"]})}function Pi({users:e=[],refDate:t,filters:n,compact:r,setFilters:a,filterUserId:o,filterTeamId:i,propsUserId:l}){var h;const[d]=bn(["kwMemberTeamType"]),f=c.useCallback(u=>{a({refDate:u})},[a]);return s.jsxs(j,{mb:1,display:"flex",justifyContent:"space-between",children:[s.jsxs(j,{flex:"1",display:"flex",flexWrap:"wrap",rowGap:2,children:[s.jsx($e,{mr:1,width:"200px",children:s.jsx(Ii,{label:"Date",value:t,onChange:f,filter:u=>Es(u)})}),s.jsx($e,{mr:1,width:"300px",children:s.jsx(Fe,{fullWidth:!0,variant:"default",label:"Filter Group",iconStyles:{marginTop:"0px"},icon:Wt,options:(d.kwMemberTeamType||[]).map(u=>({value:u,text:u})),value:i,onChange:u=>{const m=u.currentTarget.value;a({teamId:m})}})}),s.jsx($e,{mr:1,width:"200px",children:s.jsx(Fe,{fullWidth:!0,variant:"default",label:"Filter Member",value:o,icon:Wt,readOnly:!!l,iconStyles:{marginTop:"0px"},onChange:u=>{const m=u.currentTarget.value;a({userId:m})},options:(h=e.map(u=>({value:u.id,text:u.fullname,status:u.status})))==null?void 0:h.filter(u=>(u==null?void 0:u.status)!=="In-active")})}),s.jsx(ys,{withActions:!1,values:gn(n,["refDate","teamId","userId","assignType","assignToId"]),onApply:u=>{a(u)},children:u=>s.jsx(s.Fragment,{children:s.jsx(Li,{value:(u.filters.oppPct||"").split("-")[0],onChange:m=>{let g=m.target.value;g>0?g=`${g}-100`:g=void 0,u.setFilters({oppPct:g})}})})})]}),!r&&s.jsxs(j,{width:"230px",children:[s.jsx($e,{ml:1,width:"200px",mb:2,children:s.jsx(Fe,{fullWidth:!0,variant:"default",icon:Tr,value:n.assignType,iconStyles:{marginTop:"0px"},label:"Allocation Type",onChange:u=>{const m=u.currentTarget.value;a({assignType:m})},options:Object.keys(je).map(u=>({value:u,text:u}))})}),n.assignType?s.jsx($e,{mr:3,width:"200px",mb:2,children:s.jsx(De,{model:n.assignType,label:`${n.assignType} Filter`,value:n.assignToId,icon:q(je,[n.assignType,"icon"]),readOnly:n.r||!n.assignType,onChange:u=>{const m=u.currentTarget.value;a({assignToId:m})},fullWidth:!0})}):s.jsx("div",{})]})]})}function Li(e){return s.jsx(vt,{variant:"outlined",margin:"dense",type:"number",fullWidth:!0,label:"Opportunity Likelihood >= %",placeholder:"50",InputProps:{startAdornment:s.jsx(vn,{position:"start",children:s.jsx(Mi,{})})},...e})}function zi(e){return s.jsx(ze,{...e,width:"10px",height:"10px",viewBox:"0 0 10 10",paths:["M7 7V9C7 9.57614 6.57614 10 6 10H1C0.423858 10 0 9.57614 0 9V4C0 3.42386 0.423858 3 1 3H3V1C3 0.423858 3.42386 0 4 0H9C9.57614 0 10 0.423858 10 1V6C10 6.57614 9.57614 7 9 7H7ZM6 7H4C3.42386 7 3 6.57614 3 6V4H1V9H6V7ZM4 1V6H9V1H4Z"]})}const Ni=2,ln="q_";function sr({unit:e,userId:t,addDaysCount:n=7,beforeSubmit:r,children:a}){const[o,i]=c.useState({pct:null}),{context:{userMappingRef:l,unit:d}}=c.useContext(se),f=e||d;c.useEffect(()=>{o.pct},[o.pct]);const{globalState:{appLoading:h},updateGlobalState:u}=Cn(),{enqueueSnackbar:m}=bt(),g=pe(),y=c.useCallback(async({userMapping:b}={})=>{let p=b||l.current;if(t&&(p={[t]:l.current[t]}),r){const x=await ae.resolve(r());x!=null&&x.userMapping&&(p=x==null?void 0:x.userMapping)}console.log(">>etc/BatchCopyAllocationButton::","userMapping",p),u({appLoading:!0});const C=[];for(const x in p){const w=p[x];for(const k in w){const E=w[k],[O,z]=k.split("@@");for(const H in E){const P=Ye(new Date(H),n).toISOString().substring(0,10);C.push({input:{date:`${P}T00:00:00.000Z`,assignType:O,assignToId:z,memberId:x,duration:E[H]||0},filter:{date:{matchPhrasePrefix:P},assignType:{eq:O},assignToId:{eq:z},memberId:{eq:x}}})}}}console.log(">>etc/BatchCopyAllocationButton::","uFilters",C,f),C.length>0&&(i(x=>({...x,pct:0})),await ae.map(wn(C,Ni),async function(x){let w="",k="",E={};x.forEach(function(G,I){w+=`
          $filter_${I}: SearchableAllocationFilterInput
          `,k+=`
          ${ln}${I}: searchAllocations(filter:$filter_${I}){
            items{
              id
            }
          }
          `,E[`filter_${I}`]=G.filter});const O=await g.query({query:X`query(${w}){${k}}`,variables:E,fetchPolicy:"network-only"});w="",k="",E={};for(const G in O.data){const I=G.replace(ln,""),v=I,R=q(O,`data.${G}.items.0.id`),D={...x[I].input};let A="Create";R&&(D.id=R,A="Update"),w+=`
          $input_${v}:  ${A}AllocationInput!
          `,k+=`
          m_${v}: ${A.toLowerCase()}Allocation(input:$input_${v}){
            id
          }
          `,E[`input_${v}`]=D}if(Qe(E))return;const z=w,H=k,P=E,W=await g.mutate({mutation:X`mutation(${z}){${H}}`,variables:P});console.log(">>etc/BatchCopyAllocationButton::","mRes",W)},{concurrency:1})),u({appLoading:!1}),m("Week Duplicated",{variant:"success"})},[r,l,t,u,f,m,n,g]);return a?a({disabled:h,onClick:y}):s.jsx(ar,{disabled:h,onClick:y})}function ar({title:e,...t}){return s.jsx(Ke,{title:e||"Duplicate Week",children:s.jsx(fe,{size:"small",...t,children:s.jsx(zi,{})})})}function Fi({loaderRef:e,rowId:t,onFetched:n}){const{context:r}=c.useContext(se),{startInterval:a,endInterval:o,unit:i,filterTargetIds:l}=r,d=c.useRef(null);d.current={onFetched:n};const f=yt(Ht({startInterval:a,endInterval:o,memberId:t,unit:i,assignType:r.assignType,filterTargetIds:l})),{refetch:h}=f;e.current.refetch=h;const u=q(r,"reloadTimestamp._all");return c.useEffect(()=>{u&&h()},[u,h]),console.log(">>scheduler/SchedGridRowLoader::","esQ",f),yn(async m=>{if(!m()||!f.result)return;const g=Ft(f.result);d.current.onFetched&&d.current.onFetched(g)},[f.result]),null}function Ft(e){const t={};return q(e,"aggregations.group_by_assign_type.buckets",[]).forEach(n=>{const r=n.key;q(n,"group_by_project.buckets",[]).forEach(a=>{const o=$t(a.key,r);t[o]={},q(a,"group_by_period.buckets",[]).forEach(i=>{t[o][i.key_as_string.substring(0,10)]=q(i,"sum_now.value")})})}),t}function Ht({startInterval:e,endInterval:t,memberId:n,unit:r,assignType:a,filterTargetIds:o}){return{key:"ESQUERY_FETCH_MEMBER_CONSOLIDATED",index:"allocation",body:{size:0,query:{bool:{must:[o&&{bool:{should:o.map(i=>({term:{"assignToId.keyword":i}}))}},a&&{term:{"assignType.keyword":a}},{range:{duration:{gt:0}}},{term:{"memberId.keyword":n}},{range:{date:{gte:e,lte:t}}}].filter(Boolean)}},aggs:{group_by_assign_type:{terms:{field:"assignType.keyword"},aggs:{group_by_project:{terms:{field:"assignToId.keyword"},aggs:{...r==="WEEK"&&{group_by_period:{date_histogram:{field:"date",interval:"week"},aggs:{sum_now:{sum:{field:"duration"}}}}},...r==="DAY"&&{group_by_period:{terms:{field:"date"},aggs:{sum_now:{sum:{field:"duration"}}}}}}}}}}}}}const Hi=3;function Bi({onCancel:e}){const{enqueueSnackbar:t}=bt(),[n,r]=c.useState({loading:!1}),{rows:a,context:o}=c.useContext(se),i=o.unit==="DAY"?"Week":"",l=pe(),d=c.useCallback(async()=>{const{startInterval:f,endInterval:h,unit:u,assignType:m}=o,g={};return await ae.map(wn(a,Hi),async(y,b)=>{const p={};y.forEach((w,k)=>{p[`q_${k}`]=Ht({startInterval:f,endInterval:h,memberId:w.id,unit:u,assignType:m})});const C=Be(p),x=await l.query({query:X`
         query FETCH_USER_MAPPING_ALL_${b} {
           ${C}
         }
       `});for(const w in x.data){const k=w.replace("q_",""),E=JSON.parse(q(x,`data.${w}`,"{}")),O=Ft(E),z=y[k].id;g[z]=O}},{concurrency:1}),console.log(">>etc/BatchCopyContent::","userMapping",g),g},[l,a,o]);return s.jsxs(s.Fragment,{children:[s.jsxs(Sr,{children:["Confirm Duplicate ",i]}),s.jsxs(Ir,{children:["Copy this ",i,"'s allocation to next period?"]}),s.jsxs(Rr,{children:[s.jsx(re,{onClick:e,children:"No"}),s.jsx(sr,{children:({disabled:f,onClick:h})=>s.jsx(re,{variant:"contained",color:"primary",disabled:f||n.loading,onClick:async()=>{let u=!1;try{r(g=>({...g,loading:!0}));const m=await d();console.log(">>etc/BatchCopyContent::","userMapping",m),Qe(m)||await(h==null?void 0:h({userMapping:m})),u=!0}catch(m){console.log(m),t("Failed to duplicate",{variant:"error"})}finally{r(m=>({...m,loading:!1})),u&&(e==null||e())}},children:"Yes"})})]})]})}const Wi=Ce({root:{display:"flex","& > div":{margin:"0 auto"}}});function Vi(){const e=c.useRef(null),t=Wi(),{context:{allowEdit:n}}=c.useContext(se),r=c.useCallback(o=>{console.log(">>etc/SchedGridTeamMemberHeader::","e",o),e.current.open()},[]),a=c.useCallback(()=>{e.current.close()},[]);return s.jsxs("div",{className:t.root,children:[s.jsxs("div",{children:[s.jsx(Gi,{}),n&&s.jsx(ar,{title:"Duplicate Week (All Users)",onClick:r})]}),s.jsx(we,{ref:e,variant:"dialog",anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx(Bi,{onCancel:a})})]})}function Gi(){const e=c.useRef(null),[t]=bn(["kwMemberTeamType"]),{context:{teamId:n,setFilters:r}}=c.useContext(se),a=c.useCallback(l=>{l.stopPropagation(),e.current.toggle(l.target)},[]);let o="TEAM MEMBER";n&&(o=n);const i=[void 0,...t.kwMemberTeamType||[]];return s.jsxs(s.Fragment,{children:[s.jsx(ds,{box:{padding:"0 10px",fontWeight:"bold"},onClick:a,children:o.toUpperCase()}),s.jsx(we,{ref:e,variant:"popper",anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:s.jsx(Ur,{onClickAway:a,children:s.jsx(Le,{elevation:18,children:s.jsx(pt,{children:i.map((l,d)=>s.jsx(Me,{button:!0,onClick:()=>{r({teamId:l}),e.current.close()},children:l||"ALL"},d))})})})})]})}const cn={position:"absolute",border:"solid 1px lightgrey",top:18};function qi(){return{"& .rdg-header":{overflow:"visible"},"& .rdg-header .rdg-cell ":{overflow:"visible"},"& .rdg-header .sched-nav-prev ":{...cn,left:-30},"& .rdg-header .sched-nav-next ":{...cn,right:-22}}}function dn({icon:e,className:t,onClick:n}){const{context:r}=c.useContext(se);return s.jsx(fe,{size:"small",className:t,onClick:a=>n(a,{context:r}),children:s.jsx(e,{})})}function Ui(e){return e.map((n,r)=>{const a={...n};return r===0?a.name=s.jsxs(s.Fragment,{children:[s.jsx(dn,{className:"sched-nav-prev",icon:_n,onClick:(o,{context:i})=>{let l;i.unit==="WEEK"&&(l=Cs(i.refDate,gt)),i.unit==="DAY"&&(l=bs(i.refDate,7)),i.setFilters({refDate:l})}}),a.name]}):r===e.length-1&&(a.name=s.jsxs(s.Fragment,{children:[a.name,s.jsx(dn,{className:"sched-nav-next",icon:An,onClick:(o,{context:i})=>{let l;i.unit==="WEEK"&&(l=kn(i.refDate,gt)),i.unit==="DAY"&&(l=Ye(i.refDate,7)),i.setFilters({refDate:l})}})]})),a})}function Ki({compact:e,className:t,children:n,controls:r,alerts:a,...o}){const[i,l]=c.useState({gridMode:!0,listMode:!1}),d=i.gridMode?"item":"list";let f;e||i.listMode?f=s.jsx("div",{...o,children:n(i)}):f=s.jsx(Le,{...o,className:t,children:n(i)});const h=c.useCallback((u,m)=>{l(g=>({...g,listMode:m==="list",gridMode:m==="item"}))},[]);return s.jsxs(c.Suspense,{fallback:s.jsx(Dr,{}),children:[s.jsxs(j,{mt:1,display:"flex",justifyContent:"space-between",children:[s.jsx(j,{height:"48px",children:a(i)}),s.jsxs(j,{display:"flex",children:[r(i),s.jsx(_r,{value:d,onChange:h})]})]}),f]})}function Qi(e){return s.jsx(ze,{...e,viewBox:"0 0 13 15",paths:["M2.125 3.125H10.875C11.5654 3.125 12.125 3.68464 12.125 4.375V10.625C12.125 11.3154 11.5654 11.875 10.875 11.875H2.125C1.43464 11.875 0.875 11.3154 0.875 10.625V4.375C0.875 3.68464 1.43464 3.125 2.125 3.125ZM2.125 4.375V10.625H10.875V4.375H2.125ZM11.5 13.125V14.375H1.5V13.125H11.5ZM11.5 0.625V1.875H1.5V0.625H11.5Z"]})}function Yi(e){return s.jsx(ze,{...e,viewBox:"0 0 13 9",paths:["M11.5 3.16071V5.83929C11.5 6.50355 10.9208 7 10.25 7H2.75C2.07919 7 1.5 6.50355 1.5 5.83929V3.16071C1.5 2.49645 2.07919 2 2.75 2H10.25C10.9208 2 11.5 2.49645 11.5 3.16071ZM2.75 3.25V5.75H10.25V3.25H2.75ZM0.25 8.875V7.625H12.75V8.875H0.25ZM0.25 1.375V0.125H12.75V1.375H0.25Z"]})}function Zi({onNewProjectSelect:e}){const t=c.useRef(null),[n,r]=c.useState({selectedType:"Project"}),{context:{assignType:a,projectInfo:o}}=c.useContext(se),i=c.useCallback(u=>{t.current.open(u.currentTarget)},[]),l=c.useCallback(u=>{const m=u.currentTarget.value;e(m,n.selectedType),t.current.close()},[e,n.selectedType]),d=c.useCallback(u=>{const m=u.currentTarget.value;r(g=>({...g,selectedType:m}))},[]),f=[{"name.keyword":{order:"asc"}}],h=c.useMemo(()=>{let u;return n.selectedType==="Project"&&(u={bool:{must_not:[{term:{"status.keyword":"COMPLETED"}}]}}),n.selectedType==="Opportunity"&&(u={bool:{must_not:[{term:{stage:"won"}},{term:{stage:"lost"}}]}}),u},[n]);return s.jsxs(s.Fragment,{children:[s.jsx(Ji,{}),!o&&s.jsx(Ke,{title:"Add Allocation",children:s.jsx(fe,{size:"small",onClick:i,children:s.jsx(Xr,{})})}),s.jsx(we,{variant:"popover",ref:t,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:s.jsxs(j,{width:"250px",padding:"0 10px 5px",mt:"5px",children:[s.jsx(Ar,{text:"Allocation Type",paddingTop:"3px",children:a?s.jsx("strong",{children:a}):s.jsx(Fe,{fullWidth:!0,variant:"slim-boxed",value:a||n.selectedType,readOnly:!!a,disableClearable:!0,onChange:d,options:Object.keys(je).map(u=>({value:u,text:u}))})}),s.jsx(De,{variant:"slim",model:n.selectedType,label:`Select ${n.selectedType}`,onChange:l,sort:f,query:h,fullWidth:!0})]})})]})}function Ji(){const{context:{assignType:e,unit:t,startInterval:n,endInterval:r}}=c.useContext(se),o=c.useContext(Xe).rowId,i=pe(),l=c.useCallback(async()=>{const d=Be({q:Ht({startInterval:n,endInterval:r,memberId:o,unit:t,assignType:e})}),f=await i.query({query:X`
         {
           ${d}
         }
       `}),h=JSON.parse(q(f,"data.q","{}")),u=Ft(h);return{userMapping:{[o]:u}}},[i,e,r,n,t,o]);return s.jsx(sr,{beforeSubmit:l,userId:o,unit:t})}function un(e,t){const n=Object.keys(e||{}).length;return t+(n||1)*t}function Xi({...e}){var W,G;const[t,n]=c.useState({defaultHeight:e.height,height:e.height,details:null,tempDetails:null,expanded:!1,loading:!1}),r=c.useRef({}),a=pe(),{context:{projectInfo:o,summaryRef:i,userMappingRef:l,allowEdit:d,...f},forceExpanded:h}=c.useContext(se),u=h(e.row.id),m=u||t.expanded,g=o==null?void 0:o.id,y=c.useCallback(()=>{n(I=>({...I,details:null,expanded:!I.expanded,height:I.defaultHeight,loading:!I.expanded}))},[]),b=c.useCallback(I=>{for(const v in I)for(const R in I[v])Number(I[v][R])<1&&delete I[v][R];return I},[]),p=c.useCallback(()=>{r.current.refetch()},[]),C=c.useCallback(I=>{const v=I(t.details),R=b(v);n(D=>({...D,details:R}))},[b,t.details]);c.useEffect(()=>{u&&(m&&u||y())},[m,y,u]),c.useEffect(()=>{n(I=>g?{...I,expanded:!1,details:null,height:I.defaultHeight}:I)},[g]);const x=c.useCallback(I=>{n(v=>({...v,details:b(I),tempDetails:null,loading:!1,height:un(I,v.defaultHeight)}))},[b]),w=c.useCallback((I,v)=>{n(R=>{const D={...R.details},A=$t(I,v);return D[A]||(D[A]={}),{...R,details:D,height:un(D,R.defaultHeight)}})},[]),k=c.useMemo(()=>Object.keys(t.details||{}),[t.details]),E=c.useCallback((I,v)=>R=>{I?i.current.open(R.target,v):i.current.close()},[i]),O=(W=e.row)==null?void 0:W.id,z=c.useMemo(()=>({[O]:t.details}),[t.details,O]);l.current[O]=z[O];const H=s.jsxs(j,{minHeight:t.defaultHeight,position:"relative",children:[s.jsxs(j,{height:t.defaultHeight,display:"flex",alignItems:"center",justifyContent:"space-between",children:[s.jsx("div",{onMouseEnter:E(!0,{memberId:e.row.id,projectId:g,rowData:e.row}),onMouseLeave:E(!1),children:e.row.resource}),s.jsxs(j,{children:[d&&(g||t.height>t.defaultHeight)&&s.jsx(j,{component:Zi,height:"30px",onNewProjectSelect:w}),!u&&!g&&s.jsx(Ke,{title:m?"Shrink Row":"Collapse Row",children:s.jsx("span",{children:s.jsx(j,{height:"30px",component:fe,size:"small",disabled:t.loading,onClick:y,children:t.loading?s.jsx(At,{}):m?s.jsx(Yi,{}):s.jsx(Qi,{})})})})]})]}),!g&&s.jsxs(s.Fragment,{children:[k.map(I=>s.jsx(j,{height:t.defaultHeight,onMouseEnter:E(!0,{memberId:e.row.id,projectId:I,rowData:q(t,["details",I])}),onMouseLeave:E(!1),children:s.jsx(Di,{subRowId:I})},I)),m&&s.jsx(Fi,{loaderRef:r,rowId:e.row.id,onFetched:x})]})]}),P=g?{...e.row,resource:H}:{...e.row,resource:H,_details:t.details,_expand:y,_updateDetails:C};return e.row.show?s.jsx(Xe.Provider,{value:{rowId:(G=e.row)==null?void 0:G.id,refetch:p,details:t.tempDetails||t.details,expand:y,updateDetails:C},children:s.jsx(wi,{onResizeStart:()=>{},onResizing:I=>{const{startCellKey:v,currentCellKey:R}=I,[D,A]=v.split(":::"),[,V]=R.split(":::");n(K=>{const $=K.tempDetails||K.details;let B;if(v===R)B=null;else{const S=$[D][A];B=He([D,V],S)($)}return{...K,tempDetails:B}})},onResizeFinish:async I=>{console.log(">>scheduler/SchedGridRowRenderer::","resizeData",I);const{startCellKey:v}=I;if(!t.tempDetails)return;const[R]=v.split(":::"),D=t.tempDetails[R],A=t.details[R],V=js(D,function(M,T,N){return ws(T,A[N])?M:M.concat(N)},[]);if(V.length<1)return;const K=[],$=O,[B,S]=R.split("@@");for(const M of V)K.push({memberId:$,assignType:B,assignToId:S,duration:D[M],date:`${M}T00:00:00.000Z`,__typename:"Allocation",__op:"create"});if(K.length>0){const M=Or(...K);await a.mutate({mutation:X`
              mutation (
                ${M.args}
              ){
                ${M.body}
              }
            `,variables:{...M.vars}}),ae.delay(1e3).then(()=>{f.reloadData()})}},children:s.jsx(Rt,{...e,height:t.height,cellRenderer:ki,row:P})})}):null}function el({oppPct:e}){const t=(e||"").split("-"),n=Number(t[0])||0,r=Number(t[1]);console.log(">>scheduler/useGetOppIdsByPct::","startPct,endPct",n,r);const a=yt({key:"ES_SCHEDULER_OPPID_Q",index:"opportunity",skip:!e,body:{size:99,query:{bool:{must_not:{exists:{field:"archived"}},must:[{bool:{should:[n<1&&{bool:{must_not:{exists:{field:"confidence"}}}},{range:{confidence:{gte:n,lte:r}}}].filter(Boolean)}}]}}}});return e?q(a,"result.hits.hits",[]).map(o=>o._source.id):null}const tl=c.lazy(()=>lr(()=>import("./SchedGridList-9c173857.js"),["./SchedGridList-9c173857.js","./TransitionGroupContext-9d36972e.js","./index-f1f749bf.js","./_commonjsHelpers-042e6b4d.js","./assertThisInitialized-ad1db8e7.js","./papaparse.min-b66e70e7.js","./_arrayIncludes-2cfb33ae.js","./_baseForOwn-9b89c4b6.js","./index-bcfaa842.js","./index-96c5f47c.js","./isNativeReflectConstruct-05c29d01.js","./Button-352c3435.js","./isPlainObject-07477f89.js","./debounce-213cd46f.js","./iframe-ed7f5a3f.js","./index-4d501b15.js","./papaparse-cdbe7e6d.css","./Play-87fed129.js","./react-router-19e5b27c.js","./tiny-invariant-dd7d57d2.js","./filter-f99df4e5.js","./LocalizationProvider-a287304f.js","./react-router-dom-60ea8218.js","./uniq-0d482d7b.js","./cloneDeep-91467704.js","./useFetchMore-be228481.js"],import.meta.url)),fn=250,gt=5,or=60,nl=["PROJECT_FUTURE_ALLOC_Q"],rl=Ce({root:{marginBottom:20,"& .rdg-row":{transition:"0.2s ease"},"& .rdg-root .rdg-cell":{textAlign:"center",padding:0,border:"none"},'& .rdg-grid div[role="total"]':{borderTop:"solid lightgrey",fontWeight:"bold"},...qi(),...Oi()},grid:{padding:"15px 30px",paddingBottom:30,marginTop:30},disabledDay:{"& p":{color:"gainsboro"}},cellGradientStart:{cursor:"pointer",backgroundImage:"linear-gradient(45deg, #FF8E53 30%, #FA126C 90%);"},cellGradientCenter:{cursor:"pointer",backgroundImage:"linear-gradient(45deg, #FA126C 30%, #FA126C 90%);"},cellGradientEnd:{cursor:"pointer",backgroundImage:"linear-gradient(45deg, #FA126C 30%, #FF8E53 90%);"},styledCell:e=>({backgroundColor:`${e.color} !important`})});function Ol({userId:e,compact:t}){const n=Kr(),r=c.useRef(null),a=c.useRef(null),o=c.useRef({}),i=c.useRef({}),[l,d]=c.useState({rows:[],columns:[],userRowNum:{},selectedCell:null,reloadTimestamp:{}}),[f,h]=$r({assignToId:Te,assignType:Te,r:zr,refDate:Nr,userId:Te,teamId:Te,unit:Te,oppPct:Te});hs({paths:[{label:"",link:"/"},{label:"Scheduler",link:"/scheduler"},{label:"Team Members",link:"/scheduler"}]});const{updateGlobalState:u}=Cn(),m=Mr("scheduler-setting"),g=f.unit||ut,y=e||f.userId,b=f.teamId,p=c.useMemo(()=>f.refDate||Qr(new Date,{weekStartsOn:1}),[f.refDate]);let C;f.assignToId&&f.assignType&&(C=$t(f.assignToId,f.assignType));const x=xe(C),w=rl(),{startInterval:k,endInterval:E}=c.useMemo(()=>{switch(g){case"WEEK":return{startInterval:p,endInterval:new Date(kn(p,gt).getTime()-1)};case"DAY":return{startInterval:p,endInterval:Yr(p,{weekStartsOn:1})}}},[p,g]);c.useEffect(()=>{let S=[];switch(g){case"WEEK":S=es({refDate:p,startInterval:k,endInterval:E,options:{editable:!0}});break;case"DAY":S=Zr({start:k,end:E}).map(T=>({key:Re(T,"yyyy-MM-dd"),name:s.jsx(Ri,{date:T}),editable:!0}));break}S=Ui(S);const M=[{key:"resource",name:s.jsx(Vi,{}),width:fn},...S];d(T=>({...T,columns:M}))},[k,E,p,g]);const O=el({oppPct:f.oppPct});console.log(">>scheduler/SchedGrid::","oppIds",O);const z=yt($o({startInterval:k,endInterval:E,filters:{...f},unit:g,targetIds:O})),H=c.useCallback(()=>{d(S=>({...S,reloadTimestamp:{...S.reloadTimestamp,_all:Date.now()}}))},[]),P=c.useCallback(()=>{us(nl)},[]),W=c.useCallback(async({delay:S=4e3}={})=>{u({appLoading:!0}),z.refetch(),H(),await ae.delay(S),z.refetch(),H(),await ae.delay(1e3),P(),u({appLoading:!1})},[u,z,H,P]),G=be(X`
      query ListUsers($limit: Int, $nextToken: String) {
        searchUsers(
          limit: $limit
          nextToken: $nextToken
          sort: { field: fullname, direction: asc }
        ) {
          nextToken
          items {
            id
            fullname
            teamList
            status
            profilePhoto
            role {
              id
              name
            }
          }
        }
      }
    `,{variables:{limit:10},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),I=q(G,"data.searchUsers.items");En({...G,model:"User",op:"search"});const v=c.useRef();c.useEffect(()=>{Qe(l.userRowNum)||z.loading||(v.current=q(z,"result.aggregations.group_by_member.buckets",[]),d(S=>{let M=S.rows;const T={};function N(F){const U=M[F];U&&(S.columns.forEach(Y=>{Y.editable&&delete U[Y.key]}),M[F]=U)}return v.current.forEach(F=>{const U=F.key,Y=l.userRowNum[U];N(Y),T[Y]=!0,q(F,"group_by_period.buckets",[]).forEach(ne=>{const de=(ne.key_as_string||"").substring(0,10),ce=q(ne,"sum_now.value","");M=He([Y,de],ce)(M)})}),M.forEach((F,U)=>{T[U]||N(U)}),{...S,rows:M}}))},[z,l.userRowNum]),c.useEffect(()=>{if(!I)return;const S={},M=I.map((T,N)=>{var U,Y;let F=!1;return F=y&&T.id!==y||b&&!((U=T==null?void 0:T.teamList)!=null&&U.includes(b)),S[T.id]=N,{id:T.id,status:T==null?void 0:T.status,resource:s.jsx(Pr,{href:`/member/${T.id}`,children:s.jsxs(j,{display:"flex",p:1,height:"100%",alignItems:"center",children:[s.jsx(ns,{s3Key:T.profilePhoto,size:"small"}),s.jsxs(j,{ml:1,display:"grid",lineHeight:1,children:[s.jsxs(j,{height:"17px",textOverflow:"ellipsis",overflow:"hidden auto",maxWidth:`${fn-70}px`,children:[T.fullname,s.jsx($i,{userId:T.id})]}),s.jsx(j,{mt:"5px",color:"grey !important",textAlign:"left",fontSize:"smaller",height:"15px",textOverflow:"ellipsis",overflow:"hidden auto",children:((Y=T.role)==null?void 0:Y.name)||"-"})]})]})}),show:!F}});d(T=>({...T,rows:M,userRowNum:S}))},[I,y,b]),console.log(">>scheduler/SchedGrid::","users",I);const[R]=Mo(),D=c.useCallback(S=>{if(f.projectId&&S.action==="CELL_UPDATE"){const M=f.projectId,T=q(S,"cellKey"),N=Number(q(S,["updated",T],0)),F=g,U=q(l.rows,[S.fromRow,"id"]);R({resourceId:U,projectId:M,unit:F,allocDate:T,memberId:U,duration:N}),d(Y=>{let ne=Y.rows;return ne=He([S.fromRow,T],N)(ne),{...Y,rows:ne}})}},[g,f.projectId,l.rows,R]),A=Po({rows:l.rows,columns:l.columns}),V=c.useCallback(S=>{d(M=>({...M,selectedCell:{...M.selectedCell,mode:S}}))},[]),K=c.useCallback(()=>{a.current.close()},[]),$={theme:n,classes:w,setting:m,refDate:p,reloadData:W,summaryRef:i,userMappingRef:o,aggregations:v,endInterval:E,projectInfo:x,startInterval:k,filterTargetIds:O,unit:g,teamId:b,onAllocationUpdated:P,columns:l.columns,assignType:f.assignType,reloadTimestamp:l.reloadTimestamp,allowEdit:g===ut},B=c.useMemo(()=>{const S={};return l.columns.forEach((M,T)=>{let N=null,F=null;T>0&&(N=l.columns[T-1]),T<l.columns.length-1&&(F=l.columns[T+1]);const U=[];U.push(N&&N.editable?N.key:null),U.push(F&&F.editable?F.key:null),S[M.key]=U}),S},[l.columns]);return $.onCellClicked=c.useCallback((S,M)=>{switch(M.mode){case oe.SHOW_OPTIONS:d(T=>({...T,selectedCell:M})),a.current.open(S==null?void 0:S.currentTarget);break;default:d(T=>({...T,selectedCell:M})),r.current.open(S==null?void 0:S.currentTarget)}},[]),$.closeDetailsPopper=c.useCallback(({reloadAll:S}={})=>{r.current.close(),S&&W()},[W]),$.getSideValues=c.useCallback((S={},M)=>{const[T,N]=B[M];return[T?q(S,T):null,N?q(S,N):null]},[B]),$.updateRowValue=c.useCallback((S,M,T)=>{d(N=>{const{rows:F,userRowNum:U}=N,Y=`${U[S]}.${M}`,ne=q(F,Y),de=He(Y,T(ne))(F);return{...N,rows:de,reloadTimestamp:{...N.reloadTimestamp,[S]:Date.now()}}})},[]),$.setFilters=h,console.log(">>scheduler/SchedGrid::","state",l.rows),s.jsx("div",{className:w.root,children:s.jsxs(j,{children:[!t&&s.jsx(ps,{mt:3,mb:3,children:"TEAM MEMBERS"}),s.jsx(Pi,{users:I,refDate:p,filters:f,compact:t,setFilters:h,filterUserId:y,filterTeamId:b,propsUserId:e}),s.jsx(Ki,{alerts:({gridMode:S})=>!$.allowEdit&&S&&s.jsx(ks,{severity:"warning",action:s.jsx(re,{color:"primary",size:"small",onClick:()=>{h({unit:ut})},children:"Switch to Day View"}),children:"View is on read-only mode."}),controls:({gridMode:S})=>S&&s.jsx(j,{mr:1,display:"inline-flex",children:s.jsx(Lr,{value:g,options:["DAY","WEEK"],onChange:(M,T)=>{h({unit:T})}})}),className:w.grid,children:({gridMode:S,listMode:M})=>{var T;if(M)return s.jsx(tl,{filters:f});if(S){const N=(T=l==null?void 0:l.rows)==null?void 0:T.filter(F=>(F==null?void 0:F.status)==="In-active"?null:F);return s.jsx(Oo,{loading:z.loading,highLightFirstColumn:!0,columns:l.columns,rows:N,rowHeight:or,rowRenderer:Xi,forceExpanded:F=>F===y,context:$,...A,onRowsUpdate:D})}}}),s.jsx(ni,{ref:r,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(yi,{context:$,selectedCell:l.selectedCell})}),s.jsx(we,{variant:"popover",ref:a,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"left"},children:s.jsx(Jo,{onSelect:V,onClose:K,context:$,selectedCell:l.selectedCell})}),s.jsx(Ai,{context:$,summaryRef:i})]})})}export{Ol as S};
