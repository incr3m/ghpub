import{g as a}from"./_baseForOwn-9b89c4b6.js";import{p}from"./filter-f99df4e5.js";const s={cognitoUser:null,groupKeys:null,groups:[],exGroupKeys:null,exGroups:[]},c={setCognitoUser(e,r){s.cognitoUser=e;const n=a(e,"cognito:groups")||a(e,'signInUserSession.idToken.payload["cognito:groups"]');console.log({groups:n,cognitoUser:e}),s.groupKeys=n||[],s.exGroupKeys=Object.keys(r.exclusions),console.log(">>libs/auth::","groups",s.groupKeys),s.groups=p(s.groupKeys),s.exGroups=p(s.exGroupKeys),console.log("@apps_main_src_common_libs_auth_ts::","cognitoUser",r)},getCognitoUser(){return s.cognitoUser},getUserPermissions(){return s.groupKeys||[]},isAdmin(){var e;return!!((e=s.groupKeys)!=null&&e.includes("admin"))},canAccess(e,r,n,u){var g;if(u)try{if(!((g=c.getUserPermissions())!=null&&g.length))return!1;if(!(u!=null&&u.skipAdm)&&c.isAdmin())return!0;console.log(">>libs/auth::","context",{module:e,resource:r,operation:n});const o=u==null?void 0:u.permGroup[e];if(console.log({groupModule:o}),!o)return!1;const l=Object.keys(o);if(console.log({groupModuleKeys:l}),l.includes("*"))return!0;const t=o==null?void 0:o[r];if(console.log({groupResource:t}),!t)return!1;const i=Object.values(t);return console.log({groupResourceKeys:i}),i.includes("*")?!0:i==null?void 0:i.includes(n)}catch(o){return console.log("AuthLib Error",o),!1}else{const o=c.canAccess(e,r,n,{permGroup:s.groups,skipAdm:!1});if(console.log("@apps_main_src_common_libs_auth_ts::","isAllowed",o),o){const l=c.canAccess(e,r,n,{permGroup:s.exGroups,skipAdm:!0});return console.log("@apps_main_src_common_libs_auth_ts::","isInExclusion",{isInExclusion:l,x:s.exGroups,module:e,resource:r,operation:n}),!l}return o}}};export{c as a};
