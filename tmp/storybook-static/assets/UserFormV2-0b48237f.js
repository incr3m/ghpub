var Ze=Object.defineProperty;var Xe=(r,e,a)=>e in r?Ze(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a;var se=(r,e,a)=>(Xe(r,typeof e!="symbol"?e+"":e,a),a);import{j as t}from"./TransitionGroupContext-9d36972e.js";import{R as j,r as Ye}from"./index-f1f749bf.js";import{bx as et,l as K,cQ as xe,cR as Te,bq as tt,a1 as rt,b6 as Q,a as ee,au as Re,av as De,B as x,u as Ue,aw as st,a8 as at,ag as it,a9 as nt,aV as lt,a2 as ke,V as $,cs as Le,d as Ae,T as I,ar as ot,as as ut,L as Oe,p as me,a3 as ct,c8 as fe,e as Z,$ as dt,a6 as ue,at as z,Y as te,cS as pt,aC as xt,Z as mt,x as ae,i as Fe,cb as ft,aq as w,bo as ht,a4 as yt,cT as bt,cU as gt,bR as O,aJ as He,cV as jt}from"./papaparse.min-b66e70e7.js";import{v as vt,w as he,x as wt,_ as Ft}from"./VewJobDetails.story-c6ae2e88.js";import{e as S,S as W,a as _t,w as St,k as Et,J as Mt}from"./Play-87fed129.js";import{F as Be,M as _e}from"./MultipleSelectFieldInput-d0cee4a2.js";import{b as re,u as P,q as Ge,a8 as Se,a9 as J,f as Ee,w as It}from"./index-bcfaa842.js";import{S as ce}from"./SelectEsModelInput-d580a9f7.js";import{U as Pt}from"./filter-f99df4e5.js";import{w as We}from"./pick-dba65392.js";import{d as Ct}from"./Person-5be09a1e.js";import{a as N}from"./auth-5b6b0f80.js";import{u as Tt}from"./useBeforeSave-e049f6dd.js";import{u as Rt}from"./useIncludeFieldNames-35a180a9.js";import{f as X,F as ie}from"./find-8750f979.js";import{a as Dt}from"./index.esm-bf21a293.js";import{s as Ut}from"./zod-575fe4a8.js";import{g as kt}from"./_baseForOwn-9b89c4b6.js";import{d as Me}from"./CloudUpload-462faa0c.js";import{B as k}from"./Button-352c3435.js";import{k as ye,F as Lt,l as Ie,m as At}from"./SyncEagleDevTool-4c34bdb8.js";import"./index-96c5f47c.js";import{R as Ot}from"./index-5757e0d6.js";import{S as Y}from"./Skeleton-cd6f071e.js";import{F as _}from"./index-ce960f89.js";import{F as L}from"./index-f70ce446.js";import{f as Ht}from"./react-router-19e5b27c.js";import{s as Pe}from"./searchUsers-04324aeb.js";import{u as Bt}from"./useMutation-64d5b683.js";const de=async(r,e)=>{const a={email:e.email,role:e.userRoleId,id:void 0};e.id&&(a.id=e.id);const s=await et.mutate({mutation:K`
      mutation ($metadata: AWSJSON) {
        updateCognito(type: "${r}", metadata: $metadata)
      }
    `,variables:{metadata:JSON.stringify(a)}});return JSON.parse(s.data.updateCognito)};function qe(r){const e="id"in r&&r.id?xe:Te,a=tt(e,{...r,__typename:"User"});return console.log("@src_common_graphql_api_mutations_user_saveUser_ts::","res",a),e.safeParse(a)}const Ve=async(r,e)=>{const{isAdmin:a,createAuthUser:s=!0,uid:i}=e,o="id"in r&&r.id,n=o?xe.parse(r):Te.parse(r);if(console.log("aaaaaaaa",o),a||rt(n,["group","costPerHour","overHeadPerHour"]),o){let u=null;if(console.log("ZZZZZZZ"),s){console.log("XXXXXXXXX");const p=await ee({key:"getUser",variables:{id:r.id}}),y=p==null?void 0:p.cognitoId;u=await de(y?"update-user":"create-user",n)}const c={...n};return u&&(c.cognitoId=u),await Q([{...c,__op:"update",__typename:"User"}]),r.id}else{let u=i||"";if(console.log("BBBBBB"),s){const p=await de("create-user",{...n});if(console.log("CCCCCC",p),!p){console.log("DDDDD");const y="Failed creating user";throw alert(y),new Error(y)}u=p,n.cognitoId=u}const[c]=await Q([{...n,id:u,__op:"create",__typename:"User"}]);return c.id}};var be={},Gt=De;Object.defineProperty(be,"__esModule",{value:!0});var $e=be.default=void 0,Wt=Gt(Re()),qt=t;$e=be.default=(0,Wt.default)((0,qt.jsx)("path",{d:"M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"}),"VpnKey");function pe({userId:r,disabled:e=!1}){const[a,s]=j.useState({opened:!1});return console.log(">>member/ResetPassBtn::","userId",r),t.jsxs(t.Fragment,{children:[t.jsxs(k,{disabled:e,variant:"outlined",onClick:()=>{s(i=>({...i,opened:!0}))},children:["Reset",t.jsx(x,{mr:1}),t.jsx($e,{})]}),a.opened&&t.jsx(Vt,{userId:r,onClose:()=>s(i=>({...i,opened:!1}))})]})}function Vt({userId:r,...e}){const a=Ue(K`
      query ($id: ID!) {
        getUser(id: $id) {
          id
          email
        }
      }
    `,{variables:{id:r}}),s=kt(a,"data.getUser.email"),{enqueueSnackbar:i}=re(),[o,{loading:n}]=st(K`
      mutation ($metadata: AWSJSON) {
        updateCognito(type: "RESET_PASSWORD", metadata: $metadata)
      }
    `,{skip:!s,variables:{metadata:JSON.stringify({email:s})},onCompleted(){i("Reset password request sent!",{variant:"success"}),e.onClose()}});return t.jsxs(at,{...e,open:!0,maxWidth:"md",children:[t.jsx(it,{children:"Confirm Reset Password"}),t.jsx(nt,{children:t.jsxs(vt,{children:["Reset confirmation code will be sent to ",t.jsx("strong",{children:s}),". Continue?"]})}),t.jsxs(lt,{children:[t.jsx(k,{disabled:!s||n,variant:"outlined",color:"secondary",onClick:o,children:"Yes, I know what I'm doing"}),t.jsx(k,{disabled:n,variant:"outlined",onClick:e.onClose,children:"Cancel"})]})]})}const Ne=r=>{const{userId:e}=r,{data:a}=ke({queryKey:["USER_Q",e],queryFn:()=>ee({key:"getUser",variables:{id:e}})}),s=j.useMemo(()=>{var i;return(i=a==null?void 0:a.integrations)==null?void 0:i.map(o=>{let n=o;if(typeof o=="string"&&(n=JSON.parse(o)),console.log("@apps_main_src_modules_member_UserForm_UserOidcIntegration_tsx::","ite1m",o,n),(n==null?void 0:n.type)==="OIDC")return n.code})},[a]);return console.log("@apps_main_src_modules_member_UserForm_UserOidcIntegration_tsx::","integrations",{user:a,integrations:s}),s?t.jsx(t.Fragment,{children:s.map(i=>t.jsx($,{label:i,size:"small",sx:{ml:1},color:"info"},i))}):null},$t=Le(r=>({root:{"& > *":{height:80,width:80,borderRadius:20,border:"5px solid #F4F5F7"},"& svg":{backgroundColor:r.palette.grey[400],color:"lightgrey"}}}))(r=>t.jsx("div",{className:r.classes.root,children:r.children}));function Nt({onProfileChange:r,onAsEmbraceUserChange:e,asEmbraceUser:a,id:s}){var T,R,M,m;const[i,o]=j.useState({tempPhoto:null}),{data:n,state:u}=j.useContext(Ae),c=(T=P("TEAM_MEMBER_GROUP_FIELD"))==null?void 0:T.value,p=(R=P("TEAM_MEMBER_JOB_TITLE_FIELD"))==null?void 0:R.value,y=(c==null?void 0:c.show)??!0,g=(p==null?void 0:p.show)??!1,v=j.useCallback((...d)=>{const f=d[0].target.files[0];r(...d),f&&We(f).then(D=>{o(U=>({...U,tempPhoto:D}))})},[r]),b=n==null?void 0:n.profilePhoto,h=u==null?void 0:u.readOnly;j.useEffect(()=>{h&&o(d=>({...d,tempPhoto:null}))},[h]);const C=j.useCallback(d=>{d&&o(l=>({...l,tempPhoto:d}))},[]);return t.jsxs(x,{display:"flex",children:[t.jsxs(x,{width:"150px",p:2,pt:0,children:[t.jsx(x,{pl:2,children:t.jsx($t,{children:u.readOnly?t.jsx(Pt,{isSquare:!0,s3Key:b,onUrl:C}):i.tempPhoto?t.jsx("img",{src:i.tempPhoto,alt:"profile preview"}):t.jsx(Ct,{})})}),!u.readOnly&&t.jsx(x,{width:"120px",height:"60px",children:t.jsx(Be,{fullWidth:!0,name:"profilePhoto",label:t.jsx(x,{children:"Profile Photo"}),onChange:v})})]}),t.jsxs(x,{flex:"1",children:[u.readOnly?t.jsxs(I,{variant:"overline",sx:{display:"flex"},children:[t.jsx(x,{component:"span",fontSize:"x-large",fontWeight:"bold",lineHeight:"1",children:n==null?void 0:n.fullname}),a&&t.jsx($,{label:"Embrace user",size:"small",sx:{ml:1}}),t.jsx(Ne,{userId:s})]}):t.jsxs(x,{display:"flex",justifyContent:"space-between",children:[t.jsx(x,{flex:"1",mr:2,children:t.jsx(S,{fullWidth:!0,name:"firstName"})}),t.jsx(x,{flex:"1",mr:2,children:t.jsx(S,{fullWidth:!0,name:"surname"})}),t.jsx(x,{flex:"1",children:t.jsx(ot,{label:"Embrace user",control:t.jsx(ut,{onChange:d=>e(d.target.checked),checked:a})})})]}),t.jsxs(x,{display:"flex",justifyContent:"space-between",mt:2,alignItems:"baseline",children:[g&&t.jsx(x,{flex:"1",mr:2,children:((M=N)==null?void 0:M.isAdmin())&&t.jsx(S,{fullWidth:!0,name:"jobTitle"})}),y&&t.jsx(x,{flex:"1",mr:2,children:(m=N)!=null&&m.isAdmin()?t.jsx(W,{name:"group",options:["admin"]}):t.jsx(Oe,{text:"Group",children:n==null?void 0:n.group})}),t.jsx(x,{flex:"1",mr:2,children:t.jsx(zt,{})}),t.jsx(x,{flex:"1",mr:2,children:t.jsx(S,{disabled:s?!0:void 0,fullWidth:!0,name:"email"})}),t.jsx(x,{flex:"1",children:t.jsx(S,{name:"mobile"})})]})]})]})}function zt(){const{values:r,setFieldValue:e}=me(),{isReadOnly:a}=_t(),s=Ge(),i=Ue(K`
      query ($id: ID!) {
        getRole(id: $id) {
          id
          name
          costPerHour
        }
      }
    `,{variables:{id:r==null?void 0:r.userRoleId},skip:!(r!=null&&r.userRoleId)});return console.log("@src_modules_member_UserForm_ProfilePanel_tsx::","userQ",i),j.useEffect(()=>{var o,n;a||i!=null&&i.data&&e("costPerHour",(n=(o=i==null?void 0:i.data)==null?void 0:o.getRole)==null?void 0:n.costPerHour)},[a,e,i.data]),t.jsx(x,{display:"flex",children:t.jsx(ce,{autoFit:!0,boxProps:{sx:{"& label.Mui-disabled":{visibility:"hidden"},"& .Mui-disabled fieldset legend":{height:"unset",maxWidth:"unset",visibility:"visible"},"& .Mui-disabled fieldset span":{opacity:.76},"& input.Mui-disabled":{"-webkit-text-fill-color":s.palette.text.primary}},flex:1},fullWidth:!0,sort:[{"name.keyword":{order:"asc"}}],model:"Role",label:"Role",name:"userRoleId"})})}function Jt(r){return r.reduce((e,a)=>typeof a=="number"?e+"["+a+"]":e+(e===""?"":".")+a,"")}class Kt extends Error{constructor(a,s){super(a);se(this,"details");se(this,"type");this.details=s.details,this.type="ZodValidationError"}}function ze(r,e,a){return r.code==="invalid_union"?r.unionErrors.reduce((s,i)=>{const o=i.issues.map(n=>ze(n,e,a)).join(e);return s.includes(o)||s.push(o),s},[]).join(a):r.path.length>0?`${r.message} at "${Jt(r.path)}"`:r.message}function Je(r,e={}){const{maxIssuesInMessage:a=99,issueSeparator:s="; ",unionSeparator:i=", or ",prefixSeparator:o=": ",prefix:n="Validation error"}=e,u=r.errors.slice(0,a).map(p=>ze(p,s,i)).join(s),c=u?[n,u].join(o):n;return new Kt(c,{details:r.errors})}function Qt({photo:r,height:e,width:a,loading:s}){return t.jsx("div",{children:r?t.jsx("img",{src:r,height:e,width:a}):t.jsx(Zt,{height:e,text:s?t.jsx(ct,{}):"Empty"})})}const Zt=Le({root:r=>({placeContent:"center",display:"flex",alignItems:"center",height:r.height||"100px",border:"solid 1px gainsboro"})})(({classes:r,text:e="Empty"})=>t.jsx("div",{className:r.root,children:t.jsx("center",{children:e})}));function Xt({name:r,label:e,height:a="160px",width:s="160px",s3Path:i}){const[o,n]=j.useState({tempPhoto:null,fetching:!1});Rt([r]);const{state:{readOnly:u}}=j.useContext(Ae),{values:c={}}=me(),p=fe();Tt(async v=>{let b=v[r];"File"in window&&b instanceof File&&(b=await p({path:i,key:Z.v4(),file:b}));const h={...v,[r]:b};return console.log(">>Company/DetailsForm::","image",b),h});const y=c[r];dt(async v=>{if(!y||typeof y!="string")return;n(h=>({...h,fetching:!0}));const b=await ue.get(y,{level:"public"});v()&&n(h=>({...h,tempPhoto:b,fetching:!1}))},[y]);const g=j.useCallback((...v)=>{const h=v[0].target.files[0];h&&We(h).then(C=>{n(T=>({...T,tempPhoto:C}))})},[]);return t.jsxs(t.Fragment,{children:[t.jsx(Qt,{height:a,width:s,loading:o.fetching,photo:o.tempPhoto}),!u&&t.jsx(x,{mt:1,width:"102px",display:"inline-block",children:t.jsx(Be,{fullWidth:!0,name:r,asBlob:!0,single:!0,label:e,onChange:g})})]})}const Ke={deleteUser:async r=>{const e=await de("delete-user",{id:r});console.log("@apps_main_src_modules_member_services_UserService_ts::","res",e),await Q([{__typename:"User",__op:"delete",id:r}])},saveUser:async r=>{const{values:e,isAdmin:a,createAuthUser:s}=r;await Ve(e,{isAdmin:a,createAuthUser:s})}},Yt=St(mt),V={card:{padding:"10px 20px",width:"100%",display:"grid",gridTemplateColumns:"repeat(3, 0.33fr)",columnGap:"16px"},column:{display:"grid",rowGap:"16px"},title:{gridColumn:"1 / span 3",marginBottom:"24px",fontWeight:"bold"}};function er(r){const{availabilityMon:e,availabilityTue:a,availabilityWed:s,availabilityThu:i,availabilityFri:o,availabilitySat:n,availabilitySun:u,...c}=r;return c.availability={monday:e??0,tuesday:a??0,wednesday:s??0,thursday:i??0,friday:o??0,saturday:n??0,sunday:u??0},c}function tr(r){const e=r.attributes.availability||{};return r.availabilityMon=e.monday??0,r.availabilityTue=e.tuesday??0,r.availabilityWed=e.wednesday??0,r.availabilityThu=e.thursday??0,r.availabilityFri=e.friday??0,r.availabilitySat=e.saturday??0,r.availabilitySun=e.sunday??0,r}function Xr({id:r,...e}){var m,d;const[a,s]=j.useState(!1),i=P("GROUP_LIST_FIELD_LABEL").value,o=P("ALWAYS_SHOW_GROUP_LIST_FIELD").value??!0,n=Ge(),u=z(),c=he((m=u==null?void 0:u.globalState)==null?void 0:m.teamList,"Admin");console.log(">>UserForm/index::","global",{global:u,hasAdmin:c});const[p,y]=j.useState(null),[g]=te(["kwMemberTeamType","kwCompanyOfficeList","kwContactInterest","kwTeamMemberDepartment","kwTeamMemberPublicHolidays","kwTeamMemberStatusList","kwTeamMemberEmployeeType"]),v=[{name:"availabilityMon",label:"Mon"},{name:"availabilityTue",label:"Tue"},{name:"availabilityWed",label:"Wed"},{name:"availabilityThu",label:"Thu"},{name:"availabilityFri",label:"Fri"},{name:"availabilitySat",label:"Sat"},{name:"availabilitySun",label:"Sun"}],{enqueueSnackbar:b}=re(),h=fe();pt(async()=>{let l=!1;if(r){const f=await ee({key:"getUser",variables:{id:r}});l=!!(f!=null&&f.cognitoId)}s(l)});const C=async l=>{var D;let f={...l,attributes:{...l.attributes,signOff:l.signOff},fullname:`${l.firstName} ${l.surname}`,email:(D=l==null?void 0:l.email)==null?void 0:D.trim(),__typename:"User"};console.log({USER_FORM:f,formValues:l}),f=er(f);try{const U=qe(f);if(console.log({signature:f.signatures}),f.signatures instanceof File&&await h({path:"member/signatures",key:f.id,file:f.signatures}),!U.success)throw new Error(Je(U.error).message);if(f=U.data,console.log("@src_modules_member_UserForm_index_tsx::","values111",f),p){const q=await h({path:"member/photos",key:Z.v4(),file:p});f.profilePhoto=q}await Ve(f,{isAdmin:N.isAdmin(),createAuthUser:a}),b("User saved successfully",{variant:"success"})}catch(U){throw b(U.message),U}},T=j.useCallback(l=>{y(l.target.files[0])},[]),R=async l=>{await Ke.deleteUser(l),b("User has been deleted",{variant:"success"})},M=[];return r&&M.push(t.jsx(pe,{userId:r},"reset-btn")),t.jsx(Yt,{id:r,name:"User",title:`${r?"":"Create"} Team Member`,...e,actions:M,overrideSave:C,overrideDelete:R,parseData:l=>{if(!l)return l;let f={...l};return l.attributes&&(f.attributes=JSON.parse(f.attributes),f=tr(f),f.publicHoliday=f.attributes.publicHoliday,f.department=f.attributes.department,f.signOff=f.attributes.signOff,f.jobTitle=f.attributes.jobTitle),f},children:t.jsxs(x,{paddingLeft:"20px",style:{width:"100%",display:"grid",rowGap:5},children:[t.jsx(Nt,{id:r,onProfileChange:T,asEmbraceUser:a,onAsEmbraceUserChange:s}),t.jsxs(xt,{variant:"outlined",sx:V.card,children:[t.jsx(I,{variant:"overline",sx:V.title,children:"Summary"}),t.jsxs(x,{sx:V.column,children:[t.jsx(W,{name:"status",options:g.kwTeamMemberStatusList}),t.jsx(W,{name:"employeeType",options:g.kwTeamMemberEmployeeType}),t.jsx(W,{name:"office",options:g.kwCompanyOfficeList}),t.jsx(W,{name:"department",options:g.kwTeamMemberDepartment}),(o||c)&&t.jsx(_e,{fullWidth:!0,name:"teamList",label:i,parseValue:l=>{if(console.log({value:l}),!!l)return JSON.parse(l).map(f=>({value:f}))},formatValue:l=>JSON.stringify(l.map(f=>f.value)),readOnlyDisplay:(l=[])=>(console.log({values:l}),t.jsx(Oe,{text:i,mb:2,children:l.map(f=>t.jsx($,{sx:{fontSize:"16px"},label:f.value},f.value))})),options:g.kwMemberTeamType}),t.jsx(W,{name:"publicHoliday",options:g.kwTeamMemberPublicHolidays}),t.jsxs(x,{sx:{mr:"-8px","& > .MuiBox-root > .MuiBox-root":{p:"8px"}},children:[t.jsx(I,{fontSize:12,sx:{opacity:.76,ml:"4px"},children:"Availability"}),t.jsx(x,{sx:{ml:"-7px",width:"95%%",display:"flex",flexDirection:"row","& .MuiFormControl-root":{mt:"12px",ml:"8px"}},children:v.map((l,f)=>t.jsx(S,{sx:{backgroundColor:"#F4F5F7",m:"4px",flex:"1",borderRadius:"4px",textAlign:"center"},name:l.name,label:l.label,type:"tel",defaultReadOnlyText:"0",InputLabelProps:{shrink:!0}},f))}),t.jsx(x,{sx:{py:"16px",px:"8px"},children:t.jsx(S,{name:"signOff",label:"Sign Off",multiline:!0})}),t.jsx(x,{children:t.jsx(x,{children:t.jsx(Xt,{s3Path:"member/signatures",label:void 0,name:"signatures"})})})]})]}),t.jsxs(x,{sx:V.column,children:[t.jsx(S,{fullWidth:!0,type:"date",name:"dobDate",label:"Date of Birth"}),t.jsx(S,{type:"date",name:"startDate"}),t.jsx(S,{type:"date",name:"hireDate"}),t.jsx(rr,{}),t.jsx(_e,{fullWidth:!0,name:"interests",placeholder:"Interest",options:g.kwContactInterest}),t.jsx(ce,{autoFit:!0,name:"userManagerId",model:"User",label:"Manager",boxProps:{sx:{"& label.Mui-disabled":{visibility:"hidden"},"& .Mui-disabled fieldset legend":{height:"unset",maxWidth:"unset",visibility:"visible"},"& .Mui-disabled fieldset span":{opacity:.76},"& input.Mui-disabled":{paddingLeft:"1px","-webkit-text-fill-color":n.palette.text.primary}}}}),t.jsx(ce,{autoFit:!0,name:"userMentorId",model:"User",label:"Mentor",boxProps:{sx:{"& label.Mui-disabled":{visibility:"hidden"},"& .Mui-disabled fieldset legend":{height:"unset",maxWidth:"unset",visibility:"visible"},"& .Mui-disabled fieldset span":{opacity:.76},"& input.Mui-disabled":{"-webkit-text-fill-color":n.palette.text.primary}}}})]}),t.jsxs(x,{sx:V.column,children:[((d=N)==null?void 0:d.isAdmin())&&t.jsxs(t.Fragment,{children:[t.jsx(S,{name:"costPerHour",label:"Cost (Hourly)",type:"number"}),t.jsx(S,{name:"overHeadPerHour",label:"Overhead (Hourly)",type:"number"})]}),t.jsx(S,{name:"homePhone"}),t.jsx(S,{name:"certifications"}),t.jsx(S,{name:"workHistory"}),t.jsx(S,{name:"spouse"}),t.jsx(S,{name:"children"}),t.jsx(S,{name:"githubUrl"})]})]})]})})}const rr=()=>{const{values:{status:r,terminationDate:e,readOnly:a}={}}=me();return t.jsx(j.Fragment,{children:(r!=="Active"||e&&a)&&t.jsx(S,{type:"date",fullWidth:!0,name:"terminationDate"})})};var ge={},sr=De;Object.defineProperty(ge,"__esModule",{value:!0});var Qe=ge.default=void 0,ar=sr(Re()),ir=t;Qe=ge.default=(0,ar.default)((0,ir.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96M3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4z"}),"CloudOff");const nr={async deleteTeamMember(r){await Q([{id:r,__typename:"User",__op:"delete"}],{waitEs:!0})}};function lr(r){const{isCreateModal:e,userId:a,onDelete:s}=r,[i,o]=Ye.useState(!1),n=ye(),u=n.control.state.isSaving,c=n.control.state.isSaving,p=n.control.state.isEditing,{globalState:{authUser:y}}=z(),g=Ot.isStaffRole(y);function v(){o(C=>!C)}function b(){n.control.setEditing(!p)}function h(){n.control.setEditing(!1)}return t.jsxs(x,{sx:{overflow:"hidden"},children:[i&&t.jsx(Se,{direction:"left",in:i,children:t.jsx(ae,{direction:"row",columnGap:"8px",minHeight:35.5,children:t.jsx(Fe,{onClick:v,size:"small",children:t.jsx(Et,{})})})}),e?t.jsxs(ae,{direction:"row",columnGap:"8px",display:i?"none":"inline-flex",sx:{alignItems:"center"},children:[t.jsx(k,{variant:"outlined",onClick:h,disabled:u,children:"Cancel"}),t.jsx(k,{variant:"contained",type:"submit",disabled:u,children:u?"Creating...":"Create User"})]}):t.jsx(Se,{direction:"left",in:!i,children:t.jsxs(ae,{direction:"row",columnGap:"8px",display:i?"none":"inline-flex",sx:{alignItems:"center"},children:[!p&&t.jsxs(t.Fragment,{children:[t.jsx(pe,{userId:a}),!g&&t.jsxs(t.Fragment,{children:[t.jsx(k,{variant:"outlined",onClick:b,children:"Edit Details"}),t.jsx(k,{variant:"outlined",onClick:s,children:t.jsx(Mt,{})})]})]}),p&&t.jsxs(t.Fragment,{children:[t.jsx(pe,{userId:a,disabled:c}),t.jsx(k,{variant:"outlined",onClick:h,disabled:c,children:"Cancel"}),t.jsx(k,{variant:"contained",disabled:c,type:"submit",children:c?"Updating...":"Update User"})]}),t.jsx(Fe,{onClick:v,size:"small",children:t.jsx(ft,{})})]})})]})}const or={default:r=>Array.isArray(r)?"Is array":J(r)?"Date object":r,date:r=>{if(Array.isArray(r))return"Is array";const e="dd-MM-yyyy";if(typeof r=="string"){const a=new Date(r);return Ee(a,e)}return Ee(r,e)},currency:r=>Array.isArray(r)?"Is array":J(r)?"Date object":It.numberFormatter(r).toCurrency(),strArray:r=>J(r)||typeof r=="string"||typeof r=="number"?"Array must be passed":r.join(", "),pre:r=>J(r)?"Date object":t.jsx("pre",{children:r})};function F(r){const{field:e,value:a,isLoading:s=!1,variant:i="default"}=r,o=or[i],n=Array.isArray(a)?a.length?a:void 0:a;return t.jsxs(x,{children:[t.jsx(I,{variant:"caption",sx:{color:"text.secondary",textTransform:"capitalize"},children:e??"Label"}),s?t.jsx(Y,{variant:"text",width:"128px",height:"28px",sx:{mt:"-6px"}}):n?t.jsx(I,{sx:{mt:"-4px","& pre":{mt:"6px",fontFamily:"inherit",fontSize:14}},children:o(n)}):t.jsx(Y,{variant:"rounded",width:"128px",height:"28px",sx:{mt:"-6px",bgcolor:"transparent"}})]})}function ur(r){var g,v;const{member:e,rolesList:a,isLoading:s=!1}=r,i=(g=P("TEAM_MEMBER_GROUP_FIELD"))==null?void 0:g.value,o=(v=P("TEAM_MEMBER_JOB_TITLE_FIELD"))==null?void 0:v.value,n=(i==null?void 0:i.show)??!0,u=(o==null?void 0:o.show)??!1,c=j.useMemo(()=>{if(!a||!a.length||!(e!=null&&e.userRoleId))return"";const b=X(a,h=>h.value===e.userRoleId);return(b==null?void 0:b.label)??""},[a,e]),p=ye(),{isEditing:y}=p.control.state;return console.log("@apps_main_src_modules_member_MemberForm_DisplayFields_PrimaryFields_tsx::","member",e),t.jsxs(w,{lg:10.75,sx:{display:"flex",flexDirection:"column",rowGap:"12px"},children:[s?t.jsx(Y,{width:"400px",height:"42px"}):t.jsxs(I,{variant:"h6",fontWeight:"900",textTransform:"uppercase",sx:()=>e!=null&&e.fullname?{}:{color:"text.disabled"},children:[e!=null&&e.fullname?e==null?void 0:e.fullname.trim():"Name Unavailable",!y&&e&&e.cognitoId&&t.jsxs(t.Fragment,{children:[t.jsx($,{label:"Embrace user",size:"small",sx:{ml:1}}),t.jsx(Ne,{userId:e.id}),(e==null?void 0:e.humanResourcesId)&&t.jsx($,{label:`HR ID: ${e==null?void 0:e.humanResourcesId}`,size:"small",sx:{ml:1}})]})]}),t.jsxs(x,{sx:{display:"flex",columnGap:"128px",alignItems:"center",flexDirection:"row"},children:[t.jsx(F,{isLoading:s,field:"Status",value:e==null?void 0:e.status}),n&&t.jsx(F,{isLoading:s,field:"Group",value:e==null?void 0:e.group}),u&&t.jsx(F,{isLoading:s,field:"Job Title",value:e==null?void 0:e.jobTitle}),t.jsx(F,{isLoading:s,field:"Role",value:c}),t.jsx(F,{isLoading:s,field:"Email",value:e==null?void 0:e.email}),t.jsx(F,{isLoading:s,field:"Mobile",value:e==null?void 0:e.mobile})]})]})}const ne={display:"flex",rowGap:"12px",flexDirection:"column"};function cr(r){var y,g;const{member:e,membersList:a,isLoading:s=!1}=r,i=z(),o=he((y=i==null?void 0:i.globalState)==null?void 0:y.teamList,"Admin"),n=((g=P("TEAM_MEMBER_SIGNOFF_FIELD").value)==null?void 0:g.show)??!1,u=P("ALWAYS_SHOW_GROUP_LIST_FIELD").value??!0,c=P("GROUP_LIST_FIELD_LABEL").value,p=j.useMemo(()=>{const v={manager:"",mentor:""};if(e!=null&&e.userManagerId){const b=X(a,h=>h.value===(e==null?void 0:e.userManagerId));v.manager=(b==null?void 0:b.label)??""}if(e!=null&&e.userMentorId){const b=X(a,h=>h.value===(e==null?void 0:e.userMentorId));v.mentor=(b==null?void 0:b.label)??""}return v},[a,e]);return t.jsxs(w,{item:!0,lg:12,sx:{display:"flex",columnGap:"8px",flexWrap:"nowrap",justifyContent:"space-between"},children:[t.jsx(w,{item:!0,lg:4,children:t.jsxs(x,{sx:ne,children:[(u||o)&&t.jsx(F,{variant:"strArray",isLoading:s,field:c,value:e==null?void 0:e.teamList}),t.jsx(F,{isLoading:s,field:"Employee Type",value:e==null?void 0:e.employeeType}),t.jsx(F,{isLoading:s,field:"Office",value:e==null?void 0:e.office}),t.jsx(F,{isLoading:s,field:"Department",value:e==null?void 0:e.department}),t.jsx(F,{variant:"date",isLoading:s,field:"Start Date",value:e==null?void 0:e.startDateV2}),t.jsx(F,{variant:"date",isLoading:s,field:"Hire Date",value:e==null?void 0:e.hireDate}),n&&t.jsx(F,{variant:"pre",isLoading:s,field:"Sign Off",value:e==null?void 0:e.signOff})]})}),t.jsx(w,{item:!0,lg:4,children:t.jsxs(x,{sx:ne,children:[t.jsx(F,{variant:"date",isLoading:s,field:"Date of Birth",value:e==null?void 0:e.dobDate}),t.jsx(F,{variant:"currency",isLoading:s,field:"Cost (Hourly)",value:e==null?void 0:e.costPerHour}),t.jsx(F,{variant:"currency",isLoading:s,field:"Overhead (Hourly)",value:e==null?void 0:e.overHeadPerHour}),t.jsx(F,{isLoading:s,field:"Manager",value:(p==null?void 0:p.manager)??""}),t.jsx(F,{isLoading:s,field:"Mentor",value:(p==null?void 0:p.mentor)??""}),t.jsx(F,{isLoading:s,field:"GitHub URL",value:e==null?void 0:e.githubUrl})]})}),t.jsx(w,{item:!0,lg:4,children:t.jsxs(x,{sx:ne,children:[t.jsx(F,{isLoading:s,field:"Work History",value:e==null?void 0:e.workHistory}),t.jsx(F,{isLoading:s,field:"Certifications",value:e==null?void 0:e.certifications}),t.jsx(F,{variant:"strArray",isLoading:s,field:"Interests",value:e==null?void 0:e.interestsV2}),t.jsx(F,{isLoading:s,field:"Home Phone",value:e==null?void 0:e.homePhone}),t.jsx(F,{isLoading:s,field:"Spouse",value:e==null?void 0:e.spouse}),t.jsx(F,{isLoading:s,field:"Children",value:e==null?void 0:e.children})]})})]})}const B=r=>r.map((e,a)=>({id:`${e}-${a}`,label:e,value:e}));function dr(r){const{form:e}=r,[a]=te(["kwTeamMemberPublicHolidays"]),s={"& input::-webkit-outer-spin-button, & input::-webkit-inner-spin-button":{m:0,WebkitAppearance:"none"},"& input[type=number]":{MozAppearance:"textfield"},"& .MuiClearableButton":{opacity:0,width:"22px",height:"22px",transform:"translateX(8px)","& .MuiSvgIcon-root":{fontSize:14}}},i=j.useRef(null),o=j.useRef(null),n=j.useRef(null),u=j.useRef(null),c=j.useRef(null),p=j.useRef(null),y=j.useRef(null);return t.jsxs(w,{item:!0,lg:12,sx:{display:"flex",flexWrap:"nowrap"},children:[t.jsxs(w,{item:!0,lg:7,children:[t.jsx(I,{component:"p",variant:"caption",sx:{color:"text.secondary",textTransform:"capitalize",width:1},children:"Availability"}),t.jsxs(x,{sx:{display:"flex",columnGap:"8px"},children:[t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("availability.monday",null),i.current&&(i.current.value="")},inputProps:{ref:i},control:e.control,name:"availability.monday",type:"number",label:"Mon",sx:{width:76,...s}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("availability.tuesday",null),o.current&&(o.current.value="")},inputProps:{ref:o},control:e.control,name:"availability.tuesday",type:"number",label:"Tue",sx:{width:76,...s}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("availability.wednesday",null),n.current&&(n.current.value="")},inputProps:{ref:n},control:e.control,name:"availability.wednesday",type:"number",label:"Wed",sx:{width:76,...s}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("availability.thursday",null),u.current&&(u.current.value="")},inputProps:{ref:u},control:e.control,name:"availability.thursday",type:"number",label:"Thu",sx:{width:76,...s}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("availability.friday",null),c.current&&(c.current.value="")},inputProps:{ref:c},control:e.control,name:"availability.friday",type:"number",label:"Fri",sx:{width:76,...s}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("availability.saturday",null),p.current&&(p.current.value="")},inputProps:{ref:p},control:e.control,name:"availability.saturday",type:"number",label:"Sat",sx:{width:76,...s}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("availability.sunday",null),y.current&&(y.current.value="")},inputProps:{ref:y},control:e.control,name:"availability.sunday",type:"number",label:"Sun",sx:{width:76,...s}})]})]}),t.jsx(w,{item:!0,lg:5,sx:{display:"flex",alignItems:"flex-end"},children:t.jsx(L,{control:e.control,name:"publicHoliday",options:B(a.kwTeamMemberPublicHolidays??[]),textFieldProps:{label:"Public Holidays"},sx:{width:350}})})]})}const E={primaryFormFieldBox:{display:"flex",columnGap:"24px",alignItems:"center",flexDirection:"row"},muiError:{"& .MuiFormHelperText-root.Mui-error":{position:"absolute",bottom:"-22px"}}},je=j.createContext({});function pr(r){var b,h,C;const{form:e,rolesList:a,isCreateModal:s}=r,[i]=te(["kwTeamMemberStatusList"]),o=[{label:"Admin",value:"admin"}],n=(b=P("TEAM_MEMBER_GROUP_FIELD"))==null?void 0:b.value,u=(h=P("TEAM_MEMBER_JOB_TITLE_FIELD"))==null?void 0:h.value,c=(C=P("TEAM_MEMBER_HR_ID_FIELD"))==null?void 0:C.value,p=(n==null?void 0:n.show)??!0,y=(u==null?void 0:u.show)??!1,g=(c==null?void 0:c.show)??!0,v={form:e,rolesList:a,adminGroup:o,showGroupField:p,showJobTitleField:y,showHumanResIdField:g};return t.jsxs(w,{lg:10.75,sx:{display:"flex",flexDirection:"column",rowGap:"24px"},children:[t.jsxs(x,{sx:E.primaryFormFieldBox,children:[t.jsx(_,{clearable:!0,clearFn:()=>e.setValue("firstName",""),control:e.control,required:!0,name:"firstName",label:"First Name",sx:{width:300,...E.muiError}}),t.jsx(_,{clearable:!0,clearFn:()=>e.setValue("surname",""),control:e.control,required:!0,name:"surname",label:"Last Name",sx:{width:300,...E.muiError}}),t.jsx(L,{control:e.control,name:"status",options:B(i.kwTeamMemberStatusList??[]),textFieldProps:{label:"Status",required:!0},sx:{width:300,...E.muiError}}),t.jsx(x,{mt:"6px",children:t.jsx(Lt,{control:e.control,name:"isEmbraceUser",label:{text:"Embrace User",placement:"end"}})})]}),t.jsx(je.Provider,{value:v,children:s?t.jsx(xr,{}):t.jsx(mr,{})})]})}function xr(){const{form:r,rolesList:e,adminGroup:a,showGroupField:s,showJobTitleField:i}=j.useContext(je);return t.jsxs(x,{sx:E.primaryFormFieldBox,mb:2,children:[s&&t.jsx(L,{control:r.control,name:"group",options:a,textFieldProps:{label:"Group"},sx:{width:300,...E.muiError}}),i&&t.jsx(_,{control:r.control,name:"jobTitle",label:"Job Title",sx:{width:300,...E.muiError}}),t.jsx(L,{control:r.control,name:"userRoleId",options:e,textFieldProps:{label:"Role",required:!0},sx:{width:300,...E.muiError}}),t.jsx(_,{clearable:!0,clearFn:()=>r.setValue("mobile",""),control:r.control,name:"mobile",label:"Mobile",sx:{width:300,...E.muiError}}),t.jsx(_,{clearable:!0,clearFn:()=>r.setValue("email",""),control:r.control,required:!0,name:"email",label:"Email",sx:{width:300,...E.muiError}})]})}function mr(){const{form:r,rolesList:e,adminGroup:a,showGroupField:s,showJobTitleField:i,showHumanResIdField:o}=j.useContext(je);return t.jsxs(t.Fragment,{children:[t.jsxs(x,{sx:E.primaryFormFieldBox,mb:0,children:[s&&t.jsx(L,{control:r.control,name:"group",options:a,textFieldProps:{label:"Group"},sx:{width:300,...E.muiError}}),i&&t.jsx(_,{clearable:!0,clearFn:()=>r.setValue("jobTitle",""),control:r.control,name:"jobTitle",label:"Job Title",sx:{width:300,...E.muiError}}),t.jsx(L,{disableClearable:!0,control:r.control,name:"userRoleId",options:e,textFieldProps:{label:"Role",required:!0},sx:{width:300,...E.muiError}}),o&&t.jsx(_,{clearable:!0,clearFn:()=>r.setValue("humanResourcesId",""),control:r.control,name:"humanResourcesId",label:"HR ID",sx:{width:300,...E.muiError}})]}),t.jsxs(x,{sx:E.primaryFormFieldBox,mb:2,children:[t.jsx(_,{clearable:!0,clearFn:()=>r.setValue("mobile",""),control:r.control,name:"mobile",label:"Mobile",sx:{width:300,...E.muiError}}),t.jsx(_,{control:r.control,disabled:!0,required:!0,name:"email",label:"Email",sx:{width:300,...E.muiError}})]})]})}const le={display:"flex",rowGap:"12px",flexDirection:"column"};function fr(r){var y,g;const{form:e}=r,a=z(),s=he((y=a==null?void 0:a.globalState)==null?void 0:y.teamList,"Admin"),i=((g=P("TEAM_MEMBER_SIGNOFF_FIELD").value)==null?void 0:g.show)??!1,o=P("ALWAYS_SHOW_GROUP_LIST_FIELD").value??!0,n=P("GROUP_LIST_FIELD_LABEL").value,[u]=te(["kwMemberTeamType","kwCompanyOfficeList","kwContactInterest","kwTeamMemberDepartment","kwTeamMemberEmployeeType"]),c=j.useRef(null),p=j.useRef(null);return t.jsxs(w,{item:!0,lg:12,sx:{display:"flex",columnGap:"24px",flexWrap:"nowrap",justifyContent:"space-between"},children:[t.jsx(w,{lg:3.86,children:t.jsxs(x,{sx:le,children:[(o||s)&&t.jsx(L,{control:e.control,name:"teamList",multiple:!0,size:"small",options:B(u.kwMemberTeamType??[]),textFieldProps:{label:n}}),t.jsx(L,{control:e.control,name:"employeeType",options:B(u.kwTeamMemberEmployeeType??[]),textFieldProps:{label:"Employee Type"}}),t.jsx(L,{control:e.control,name:"office",options:B(u.kwCompanyOfficeList??[]),textFieldProps:{label:"Office"}}),t.jsx(L,{control:e.control,name:"department",options:B(u.kwTeamMemberDepartment??[]),textFieldProps:{label:"Department"}}),t.jsx(ie,{clearable:!0,clearFn:()=>e.setValue("startDateV2",null),control:e.control,name:"startDateV2",textFieldProps:{label:"Start Date"}}),t.jsx(ie,{clearable:!0,clearFn:()=>e.setValue("hireDate",null),control:e.control,name:"hireDate",textFieldProps:{label:"Hire Date"}}),i&&t.jsx(_,{control:e.control,name:"signOff",label:"Sign Off",multiline:!0,minRows:3})]})}),t.jsx(w,{item:!0,lg:3.86,children:t.jsxs(x,{sx:le,children:[t.jsx(ie,{clearable:!0,clearFn:()=>e.setValue("dobDate",null),control:e.control,name:"dobDate",textFieldProps:{label:"Date of Birth"}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("costPerHour",void 0),c.current&&(c.current.value="")},control:e.control,name:"costPerHour",type:"number",label:"Cost (Hourly)",sx:{"& input::-webkit-outer-spin-button, & input::-webkit-inner-spin-button":{m:0,WebkitAppearance:"none"},"& input[type=number]":{MozAppearance:"textfield"}},inputProps:{ref:c}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("costPerHour",void 0),p.current&&(p.current.value="")},control:e.control,name:"overHeadPerHour",type:"number",label:"Overhead (Hourly)",sx:{"& input::-webkit-outer-spin-button, & input::-webkit-inner-spin-button":{m:0,WebkitAppearance:"none"},"& input[type=number]":{MozAppearance:"textfield"}},inputProps:{ref:p}}),t.jsx(Ie,{form:e,name:"userManagerId",textFieldProps:{label:"Manager"}}),t.jsx(Ie,{form:e,name:"userMentorId",textFieldProps:{label:"Mentor"}}),t.jsx(_,{clearable:!0,clearFn:()=>e.setValue("githubUrl",""),control:e.control,name:"githubUrl",label:"GitHub URL"})]})}),t.jsx(w,{item:!0,lg:3.86,children:t.jsxs(x,{sx:le,children:[t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("workHistory","")},control:e.control,name:"workHistory",label:"Work History"}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("certifications","")},control:e.control,name:"certifications",label:"Certifications"}),t.jsx(L,{control:e.control,name:"interestsV2",multiple:!0,size:"small",options:B(u.kwContactInterest??[]),textFieldProps:{label:"Interests"}}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("homePhone","")},control:e.control,name:"homePhone",type:"tel",label:"Home Phone"}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("spouse","")},control:e.control,name:"spouse",label:"Spouse"}),t.jsx(_,{clearable:!0,clearFn:()=>{e.setValue("children","")},control:e.control,name:"children",label:"Children"})]})})]})}function H(r){const{field:e,value:a,isLoading:s=!1}=r;return t.jsxs(x,{sx:{width:76,height:64,rowGap:"6px",display:"flex",borderRadius:"8px",bgcolor:"#eaeaea",alignItems:"center",flexDirection:"column",justifyContent:"center"},children:[t.jsx(I,{variant:"caption",sx:{color:"text.secondary",textTransform:"capitalize"},children:e??"Label"}),s?t.jsx(Y,{variant:"text",width:"24px",height:"36px",sx:{mt:"-6px"}}):t.jsx(I,{mt:"-4px",children:a??0})]})}function hr(r){var s,i,o,n,u,c,p;const{member:e,isLoading:a=!1}=r;return t.jsxs(w,{item:!0,lg:12,sx:{display:"flex",flexWrap:"nowrap"},children:[t.jsxs(w,{item:!0,lg:7,children:[t.jsx(I,{component:"p",variant:"caption",sx:{color:"text.secondary",textTransform:"capitalize",width:1},children:"Availability"}),t.jsxs(x,{sx:{display:"flex",columnGap:"8px"},children:[t.jsx(H,{isLoading:a,field:"Mon",value:(s=e==null?void 0:e.availability)==null?void 0:s.monday}),t.jsx(H,{isLoading:a,field:"Tue",value:(i=e==null?void 0:e.availability)==null?void 0:i.tuesday}),t.jsx(H,{isLoading:a,field:"Wed",value:(o=e==null?void 0:e.availability)==null?void 0:o.wednesday}),t.jsx(H,{isLoading:a,field:"Thu",value:(n=e==null?void 0:e.availability)==null?void 0:n.thursday}),t.jsx(H,{isLoading:a,field:"Fri",value:(u=e==null?void 0:e.availability)==null?void 0:u.friday}),t.jsx(H,{isLoading:a,field:"Sat",value:(c=e==null?void 0:e.availability)==null?void 0:c.saturday}),t.jsx(H,{isLoading:a,field:"Sun",value:(p=e==null?void 0:e.availability)==null?void 0:p.sunday})]})]}),t.jsx(w,{item:!0,lg:5,children:t.jsx(F,{isLoading:a,field:"Public Holidays",value:e==null?void 0:e.publicHoliday})})]})}function yr(r){const{data:e,isLoading:a,form:s,membersList:i,rolesList:o,isCreateModal:n=!1,onSetProfilePhoto:u,onSetSignaturePhoto:c}=r,p=ht(),y=Ht(),{enqueueSnackbar:g}=re(),[v]=j.useState(n?"Create Team Member":"Team Member"),h=ye().control.state.isEditing;async function C(){if(await p({title:"Delete user?",options:{width:"400px"},content:d=>t.jsxs("div",{children:[t.jsx(I,{children:"Are you sure you want to proceed?"}),t.jsxs(x,{textAlign:"right",m:2,mr:0,children:[t.jsx(k,{onClick:()=>d.close(),children:"Cancel"}),t.jsx(x,{component:"span",mr:2}),t.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>d.submit(!0),children:"Continue"})]})]})})&&(e!=null&&e.id))try{await nr.deleteTeamMember(e.id),y.push("/member/list/active")}catch(d){g("Team member deletion failed",{variant:"error"}),console.log("@MemberForm::handleMemberDelete","Error",d)}}function T(m){u&&u(m),s.setValue("profilePhoto",m.name)}function R(m){c&&c(m),s.setValue("signature",m.name)}const{data:M}=ke({enabled:!!(e!=null&&e.profilePhoto)||!!(e!=null&&e.signature),queryKey:["FETCH_MEMBER_S3_STORAGE",e==null?void 0:e.profilePhoto,e==null?void 0:e.signature],queryFn:async()=>{const m=await ue.get((e==null?void 0:e.profilePhoto)??"",{level:"public"}),d=await ue.get((e==null?void 0:e.signature)??"",{level:"public"});return{profilePhotoUrl:m,signaturePhotoUrl:d}}});return console.log("@MemberForm","props",{isCreateModal:n,data:e,membersList:i,s3:M}),t.jsxs(x,{sx:{p:"20px"},children:[t.jsxs(w,{container:!0,alignItems:"center",children:[t.jsx(w,{xs:12,lg:6,children:t.jsx(I,{variant:"h1",sx:{fontSize:20,fontWeight:"900",letterSpacing:1.25,textTransform:"uppercase"},children:v})}),t.jsx(w,{xs:12,lg:6,sx:{display:"flex",justifyContent:"flex-end"},children:t.jsx(lr,{userId:e==null?void 0:e.id,isCreateModal:n,onDelete:C})})]}),t.jsx(yt,{sx:{my:"24px"}}),t.jsxs(w,{container:!0,alignItems:"center",children:[t.jsx(w,{item:!0,lg:1.25,sx:{display:"flex",justifyContent:"center"},children:t.jsx(bt,{alt:e==null?void 0:e.fullname,src:M==null?void 0:M.profilePhotoUrl,editMode:h,variant:"rounded",sx:{width:98,height:98,border:"4px solid",borderColor:"gainsboro"},icon:t.jsx(Me,{fontSize:"large",sx:{color:"#343434"}}),onImageSet:T})}),h?t.jsx(pr,{form:s,rolesList:o,isCreateModal:n}):t.jsx(ur,{member:e??{},isLoading:a,rolesList:o})]}),t.jsxs(w,{container:!0,sx:{p:"16px 24px",mt:"24px",borderRadius:"12px",border:"1px solid gainsboro"},children:[t.jsx(w,{item:!0,lg:12,mb:"16px",children:t.jsx(I,{variant:"subtitle2",textTransform:"uppercase",fontWeight:900,children:"Summary"})}),h?t.jsx(fr,{membersList:i,form:s}):t.jsx(cr,{member:e??{},membersList:i,isLoading:a})]}),t.jsxs(w,{container:!0,sx:{mt:"24px",columnGap:"24px",flexWrap:"nowrap",justifyContent:"space-between"},children:[t.jsxs(w,{item:!0,lg:9,sx:{p:"16px 24px 36px",borderRadius:"12px",border:"1px solid gainsboro"},children:[t.jsx(w,{item:!0,lg:12,mb:"16px",children:t.jsx(I,{variant:"subtitle2",textTransform:"uppercase",fontWeight:900,children:"Schedule & Availability"})}),h?t.jsx(dr,{form:s}):t.jsx(hr,{member:e??{},isLoading:a})]}),t.jsxs(w,{item:!0,lg:2.9,sx:{p:"16px 24px",borderRadius:"12px",border:"1px solid gainsboro"},children:[t.jsx(w,{item:!0,lg:12,mb:"16px",children:t.jsx(I,{variant:"subtitle2",textTransform:"uppercase",fontWeight:900,children:"Signature"})}),t.jsx(w,{item:!0,lg:12,children:t.jsx(gt,{src:M==null?void 0:M.signaturePhotoUrl,editMode:h,uploadIcon:t.jsx(Me,{fontSize:"large",sx:{color:"#343434"}}),emptyIcon:t.jsx(Qe,{fontSize:"large"}),onImageSet:R})})]})]})]})}const br={firstName:"",surname:"",status:"",userRoleId:"",group:null,email:null,mobile:null,isEmbraceUser:!1,jobTitle:null,teamList:[],employeeType:null,office:null,department:null,startDateV2:null,hireDate:null,terminationDateV2:null,dobDate:null,costPerHour:null,overHeadPerHour:null,userManagerId:null,userMentorId:null,githubUrl:null,workHistory:null,certifications:null,interestsV2:[],homePhone:null,spouse:null,children:null,publicHolidays:null,availability:{sunday:0,saturday:0,monday:8,tuesday:8,wednesday:8,thursday:8,friday:8},profilePhoto:null,signature:null},gr=xe.omit({id:!0,fullname:!0,firstName:!0,surname:!0,status:!0,userRoleId:!0,email:!0,skillEntity:!0,__typename:!0}).extend({id:O.string().optional().nullable(),isEmbraceUser:O.boolean().optional().nullable(),firstName:O.string().nonempty("Required"),surname:O.string().nonempty("Required"),status:O.string().nonempty("Required"),userRoleId:O.string().nonempty("Required"),email:O.string({invalid_type_error:"Valid email required"}).nonempty("Required").email("Invalid email")}),oe={valuer:"Valuation"};function jr(r,e){return!r&&!e?"":!r&&e?`${e}`:r&&!e?`${r}`:`${r} ${e}`}function vr(r){const{queryKeyToInvalidate:e,executeQueryInvalidation:a}=r,s=He();return Bt(Ke.saveUser,{onMutate:async i=>{var u;if(!a||!e)return;const o=(u=i==null?void 0:i._source)==null?void 0:u.id;if(!o)return;await s.cancelQueries([e,{id:o}]);const n=s.getQueryData([e,{id:o}]);return s.setQueryData([e,{id:o}],c=>{var g,v;const y={...i._source?i._source:{},fullname:jr((g=i._source)==null?void 0:g.firstName,(v=i._source)==null?void 0:v.surname)};return{...c,...y}}),n},onError:(i,o,n)=>{var c;const u=(c=n==null?void 0:n.prevData)==null?void 0:c.id;u&&(console.log("@useSaveUser","onError::",{_error:i,_data:o}),s.setQueryData([e,{id:u}],()=>n.prevData))}})}const Ce="FETCH_TEAM_MEMBER_DETAILS";function Yr({id:r,isCreateModal:e=!1,...a}){const s=z();console.log(">>UserForm/index::","global",s);const[i,o]=j.useState(),[n,u]=j.useState(),{mutate:c}=vr({executeQueryInvalidation:!e,queryKeyToInvalidate:Ce}),{enqueueSnackbar:p}=re(),y=He(),g=fe(),[{data:v},{data:b},{data:h,isLoading:C}]=wt({queries:[{queryKey:["FETCH_TEAM_MEMBERS",r],queryFn:async()=>{const m=await Pe({});if(m)return m.items.map(d=>({label:d.fullname,value:d.id}))}},{queryKey:["FETCH_USER_ROLES"],queryFn:async()=>{const m=await ee({key:"searchRoles",variables:{filter:{archived:{ne:!0}},depthLimit:1}});if(m!=null&&m.items)return m.items.map(d=>{var l;return{value:(d==null?void 0:d.id)??"",label:(oe==null?void 0:oe[(l=d==null?void 0:d.name)==null?void 0:l.toLowerCase()])??(d==null?void 0:d.name)??""}})}},{queryKey:[Ce,{id:r}],queryFn:async()=>{const m=await Pe({ids:[r]});if(console.log("@apps_main_src_modules_member_UserForm_UserFormV2_tsx::","res",m),!m)return;const d=X(m.items,{id:r}),l=d!=null&&d.attributes?JSON.parse(d.attributes):null;return{...d,isEmbraceUser:!!(d!=null&&d.cognitoId),teamList:d!=null&&d.teamList?JSON.parse(d.teamList):[],interestsV2:d!=null&&d.interests?d.interests.split(","):[],startDateV2:l!=null&&l.startDateV2?new Date(l.startDateV2):null,terminationDateV2:l!=null&&l.terminationDateV2?new Date(l.terminationDateV2):null,department:(l==null?void 0:l.department)??null,publicHoliday:(l==null?void 0:l.publicHoliday)??null,availability:l!=null&&l.availability?{...l.availability}:null,signature:(l==null?void 0:l.signature)??null,jobTitle:(l==null?void 0:l.jobTitle)??null,signOff:(l==null?void 0:l.signOff)??null,humanResourcesId:(l==null?void 0:l.humanResourcesId)??null}}}]}),T=Dt({defaultValues:br,values:h,resolver:Ut(gr)}),R=At({defaultState:{isEditing:e},onStateChange(m){!m.isEditing&&e&&a.onCancel()}}),M=async m=>{var U,q,ve,we;const d=(q=(U=s.globalState)==null?void 0:U.authUser)==null?void 0:q.id,l=new Date,f=e?{createdBy:d,createdAt:l}:{updatedBy:d,updatedAt:l};let D={...m,fullname:`${m.firstName} ${m.surname}`,email:(ve=m==null?void 0:m.email)==null?void 0:ve.trim(),interests:(we=m.interestsV2)!=null&&we.length?m.interestsV2.join():null,__typename:"User",...f};try{if(n){const G=await g({path:"member/signatures",key:Z.v4(),file:n});D.signature=G}if(i){const G=await g({path:"member/photos",key:Z.v4(),file:i});D.profilePhoto=G}const A=qe(D);if(!A.success)throw new Error(Je(A.error).message);D=A.data,console.log({USER_FORM:D,res:A,formValues:m,user:h}),c({values:D,isAdmin:N.isAdmin(),createAuthUser:m.isEmbraceUser,_source:m}),e&&a.onCancel&&a.onCancel(),p("User saved successfully",{variant:"success"})}catch(A){const G=A;throw p(G.message),console.log({USER_FORM:{type:"ERROR",error:G}}),A}};return t.jsx(jt,{control:R,children:t.jsx(Ft,{formContext:T,handleSubmit:T.handleSubmit(async m=>{R.setSaving(!0),await M(m),R.setSaving(!1),R.setEditing(!1),y.refetchQueries({queryKey:["FECTH_TEAM_MEMBER",{id:r}]})},(...m)=>{console.error(m)}),children:t.jsx(yr,{data:h,form:T,isLoading:C,isCreateModal:e,membersList:v??[],rolesList:b??[],onSetProfilePhoto:o,onSetSignaturePhoto:u})})})}export{Yr as U,Xr as a};
