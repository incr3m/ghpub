import{j as e}from"./TransitionGroupContext-9d36972e.js";import{R as I,r as w}from"./index-f1f749bf.js";import{d as U}from"./Add-be7f5660.js";import{a2 as P,au as H,av as q,F as B,aq as C,bN as K,bO as _,aJ as D,B as u,K as J,ah as V,ai as Q,bP as $,a$ as N}from"./papaparse.min-b66e70e7.js";import{l as m,b as z}from"./index-bcfaa842.js";import{k as G,i as W}from"./pick-dba65392.js";import"./_baseForOwn-9b89c4b6.js";import"./index-96c5f47c.js";import{F as Y}from"./index-ce960f89.js";import{b as Z}from"./Play-87fed129.js";import{a as X}from"./index.esm-bf21a293.js";import{s as b}from"./zod-575fe4a8.js";import{u as v}from"./react-router-19e5b27c.js";import{u as M}from"./useMutation-64d5b683.js";import{B as E}from"./Button-352c3435.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";import"./isNativeReflectConstruct-05c29d01.js";import"./filter-f99df4e5.js";import"./LocalizationProvider-a287304f.js";import"./index-61adb48a.js";import"./useGetProjectSummaryFields-0ab32aca.js";import"./SelectEsModelInput-d580a9f7.js";import"./Link-c687dc07.js";import"./react-router-dom-60ea8218.js";import"./tiny-invariant-dd7d57d2.js";import"./useIncludeFieldNames-35a180a9.js";import"./Save-b67fa0ac.js";import"./index-147ad7aa.js";import"./uniq-0d482d7b.js";import"./cloneDeep-91467704.js";const tt=o=>["PROJECT_MEMBERS_TOTAL",o],et=o=>P({queryKey:tt(o),queryFn:()=>G({projectIds:[o]}),enabled:!!o});var h={},ot=q;Object.defineProperty(h,"__esModule",{value:!0});var g=h.default=void 0,nt=ot(H()),rt=e;g=h.default=(0,nt.default)((0,rt.jsx)("path",{d:"M7 11v2h10v-2zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"RemoveCircleOutline");function st(o){return e.jsx(B,{...o,width:"24",height:"24",viewBox:"0 0 24 24",paths:["M7,15H9C9,16.08 10.37,17 12,17C13.63,17 15,16.08 15,15C15,13.9 13.96,13.5 11.76,12.97C9.64,12.44 7,11.78 7,9C7,7.21 8.47,5.69 10.5,5.18V3H13.5V5.18C15.53,5.69 17,7.21 17,9H15C15,7.92 13.63,7 12,7C10.37,7 9,7.92 9,9C9,10.1 10.04,10.5 12.24,11.03C14.36,11.56 17,12.22 17,15C17,16.79 15.53,18.31 13.5,18.82V21H10.5V18.82C8.47,18.31 7,16.79 7,15Z"]})}const it=o=>{const{onSubmit:r,form:n,loading:s}=o;return e.jsx(e.Fragment,{children:e.jsxs(C,{spacing:2,container:!0,alignItems:"center",children:[e.jsx(C,{item:!0,xs:6,children:e.jsx(Z,{id:n.getValues("userId")})}),e.jsx(C,{item:!0,xs:6,children:e.jsx(Y,{disabled:s,control:n.control,label:s?"Cost (Hourly) Saving...":"Cost (Hourly)",name:"costPerHour",sx:{ml:"100px",'& label[data-shrink="false"]':{transform:"translate(14px, 13px) scale(1) !important"}},InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(st,{sx:{ml:"-4px"}})})},type:"number",onChange:m.debounce(()=>r==null?void 0:r(),500)})})]})})},ct=o=>{const{member:r,onSubmit:n,onError:s}=o,a=X({resolver:b(_),defaultValues:r});return e.jsx(it,{onSubmit:()=>{a.handleSubmit(n,s)()},form:a,loading:r==null?void 0:r.__optimistic})},p=N(_);function Nt(){const[o,r]=I.useState({selectedUserId:null}),{projectId:n}=v(),{enqueueSnackbar:s}=z(),a=D(),x=w.useMemo(()=>["PROJECT_MEMBERS",n],[n]),{refetch:j}=et(n),{data:y=[],refetch:f}=P({queryKey:x,queryFn:async()=>await p.find({"projectId.keyword":[n]},{size:1e4}),enabled:!!n}),{mutateAsync:T,isLoading:S}=M({mutationKey:["MUTATION_PROJECT_MEMBER_ADD"],mutationFn:async t=>{await p.create([{id:t==null?void 0:t.id,projectId:t==null?void 0:t.projectId,userId:t==null?void 0:t.userId,costPerHour:t==null?void 0:t.costPerHour}])},onError:t=>{t!=null&&t.message.includes("ConditionalCheckFailedException")?s("User already exist",{variant:"error"}):console.error(t)},onSettled:m.debounce(async()=>{await Promise.all([j(),f()])},200)}),{mutateAsync:F,isLoading:R}=M({mutationKey:["MUTATION_PROJECT_MEMBER_UPDATE"],mutationFn:async t=>{await p.update([{id:t==null?void 0:t.id,projectId:t==null?void 0:t.projectId,userId:t==null?void 0:t.userId,costPerHour:t==null?void 0:t.costPerHour}])},onError:t=>{t!=null&&t.message.includes("ConditionalCheckFailedException")?s("User already exist",{variant:"error"}):console.error(t)},onMutate:async t=>{await a.cancelQueries({queryKey:x});let c;return a.setQueryData(x,l=>{const d=m.keyBy(structuredClone(l??[]),"id"),i={id:t==null?void 0:t.id,projectId:t==null?void 0:t.projectId,userId:t==null?void 0:t.userId,costPerHour:t==null?void 0:t.costPerHour,__typename:"ProjectMember",__optimistic:!0};d&&(d[i==null?void 0:i.id]=m.merge(d==null?void 0:d[i==null?void 0:i.id],i));const A=Object.values(d);return c=structuredClone(l),A}),{previousData:c}},onSettled:m.debounce(async()=>{await Promise.all([j(),f()])},200)}),{mutateAsync:O,isLoading:L}=M({mutationKey:["MUTATION_PROJECT_MEMBER_ADD"],mutationFn:async t=>{await p.remove([t==null?void 0:t.id])},onError:t=>{t!=null&&t.message.includes("ConditionalCheckFailedException")?s("User already exist",{variant:"error"}):console.error(t)},onSettled:m.debounce(async()=>{await Promise.all([j(),f()])},200)}),k=I.useCallback(t=>{const c=t.currentTarget.value;r(l=>({...l,selectedUserId:c}))},[]);return e.jsxs(u,{mt:2,children:[e.jsxs(u,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(u,{width:"170px",display:"inline-block",sx:{"& .MuiInputLabel-formControl:not(.MuiInputLabel-shrink)":{transform:"translate(14px, 20px) scale(1) !important"},"& .MuiFormLabel-root.Mui-focused, & .MuiFormLabel-root.MuiFormLabel-filled":{transform:"translate(14px, 2px) scale(0.75) !important"}},children:e.jsx(J,{fullWidth:!0,value:o.selectedUserId||"",model:"User",variant:"slim-filter",label:"Select Member",onChange:k,query:W})}),e.jsx(u,{width:"75px",p:1,display:"inline-block",children:e.jsxs(E,{disabled:!o.selectedUserId||S||L||R,variant:"contained",onClick:async()=>{const t={id:`${n}_${o.selectedUserId}`,userId:o.selectedUserId,projectId:n};console.log({payload:t}),await T(t)},color:"primary",children:[e.jsx(U,{}),"Add"]})})]}),e.jsx(u,{children:e.jsx(V,{children:y==null?void 0:y.map(t=>e.jsxs(Q,{button:!0,children:[e.jsx(u,{sx:{minWidth:"700px",display:"flex",justifyContent:"space-between"},children:e.jsx(ct,{member:t,onSubmit:async c=>{await F(c)},onError:console.error},t.id)}),e.jsx($,{children:e.jsx(E,{disabled:t==null?void 0:t.__optimistic,color:"secondary",variant:"outlined",onClick:async()=>{await O({id:t.id})},children:e.jsx(g,{})})})]},`${t.id}`))})})]})}export{Nt as default};
