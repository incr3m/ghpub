import{j as g}from"./TransitionGroupContext-9d36972e.js";import{R as l}from"./index-f1f749bf.js";import{p as F,d as j}from"./papaparse.min-b66e70e7.js";import{u as O}from"./useBeforeSave-e049f6dd.js";import{u as b}from"./useIncludeFieldNames-35a180a9.js";import{f as J}from"./_baseForOwn-9b89c4b6.js";import"./assertThisInitialized-ad1db8e7.js";import"./_commonjsHelpers-042e6b4d.js";import"./_arrayIncludes-2cfb33ae.js";import"./index-bcfaa842.js";import"./index-96c5f47c.js";import"./isNativeReflectConstruct-05c29d01.js";import"./Button-352c3435.js";import"./isPlainObject-07477f89.js";import"./debounce-213cd46f.js";import"./iframe-ed7f5a3f.js";import"../sb-preview/runtime.js";import"./index-4d501b15.js";const y="_";function k(f,e){return f[e]?f[e]||"{}":void 0}function M(f){const{field:e,children:p,beforeSave:V,initialValues:v,stringifyOnSave:x=!0}=f,o=l.useRef({stringifyOnSave:x});b([e]);const{values:d={},setValues:S}=F(),{formRef:m}=l.useContext(j),t=k(d,e);return o.current.values=d,o.current.beforeSave=V||(n=>n),o.current.initialValues=v||(n=>n),l.useEffect(()=>{if(!t)return;const n=`${e}${y}`;let i;const a=typeof t=="string";if(a||J(t)){i={};const r=a?JSON.parse(t):t;for(const u in r)i[n+u]=r[u]}else if(Array.isArray(t))i=t.map(r=>JSON.parse(r));else if(t!=null&&t.id){i={};for(const r in t)i[n+r]=t[r]}if(!i)return;const c=o.current.initialValues(i),s={...o.current.values,...c};m.current.initialValues={...m.current.initialValues||{},...c},console.log(">>JsonField/index::","data",{rawData:t,data:i,initVal:s}),S(s)},[e,m,t,S]),O(function(n){const i={...n},a={},c=`${e}${y}`;for(const r in n)if(r.startsWith(c)){const u=r.replace(c,"");a[u]=n[r],delete i[r]}const s=o.current.beforeSave({...i,[e]:a});return s===!1||!o.current.stringifyOnSave?s:{...s,[e]:JSON.stringify(s[e])}},`${e}:beforeSave`),g.jsx(g.Fragment,{children:p})}export{M as default,y as nameSeparator};
